(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{6158:function(tt){tt.exports=function(){"use strict";var tt,ti,ta;function define(tc,th){if(tt){if(ti){var tf="var sharedChunk = {}; ("+tt+")(sharedChunk); ("+ti+")(sharedChunk);",td={};tt(td),ta=th(td),"undefined"!=typeof window&&(ta.workerUrl=window.URL.createObjectURL(new Blob([tf],{type:"text/javascript"})))}else ti=th}else tt=th}return define(["exports"],function(tt){function e(tt,ti){return tt(ti={exports:{}},ti.exports),ti.exports}var ti,ta,tc=n;function n(tt,ti,ta,tc){this.cx=3*tt,this.bx=3*(ta-tt)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*ti,this.by=3*(tc-ti)-this.cy,this.ay=1-this.cy-this.by,this.p1x=tt,this.p1y=tc,this.p2x=ta,this.p2y=tc}n.prototype.sampleCurveX=function(tt){return((this.ax*tt+this.bx)*tt+this.cx)*tt},n.prototype.sampleCurveY=function(tt){return((this.ay*tt+this.by)*tt+this.cy)*tt},n.prototype.sampleCurveDerivativeX=function(tt){return(3*this.ax*tt+2*this.bx)*tt+this.cx},n.prototype.solveCurveX=function(tt,ti){var ta,tc,th,tf,td;for(void 0===ti&&(ti=1e-6),th=tt,td=0;td<8;td++){if(Math.abs(tf=this.sampleCurveX(th)-tt)<ti)return th;var tm=this.sampleCurveDerivativeX(th);if(1e-6>Math.abs(tm))break;th-=tf/tm}if((th=tt)<(ta=0))return ta;if(th>(tc=1))return tc;for(;ta<tc&&!(Math.abs((tf=this.sampleCurveX(th))-tt)<ti);)tt>tf?ta=th:tc=th,th=.5*(tc-ta)+ta;return th},n.prototype.solve=function(tt,ti){return this.sampleCurveY(this.solveCurveX(tt,ti))};var th=a;function a(tt,ti){this.x=tt,this.y=ti}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(tt){return this.clone()._add(tt)},sub:function(tt){return this.clone()._sub(tt)},multByPoint:function(tt){return this.clone()._multByPoint(tt)},divByPoint:function(tt){return this.clone()._divByPoint(tt)},mult:function(tt){return this.clone()._mult(tt)},div:function(tt){return this.clone()._div(tt)},rotate:function(tt){return this.clone()._rotate(tt)},rotateAround:function(tt,ti){return this.clone()._rotateAround(tt,ti)},matMult:function(tt){return this.clone()._matMult(tt)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(tt){return this.x===tt.x&&this.y===tt.y},dist:function(tt){return Math.sqrt(this.distSqr(tt))},distSqr:function(tt){var ti=tt.x-this.x,ta=tt.y-this.y;return ti*ti+ta*ta},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(tt){return Math.atan2(this.y-tt.y,this.x-tt.x)},angleWith:function(tt){return this.angleWithSep(tt.x,tt.y)},angleWithSep:function(tt,ti){return Math.atan2(this.x*ti-this.y*tt,this.x*tt+this.y*ti)},_matMult:function(tt){var ti=tt[2]*this.x+tt[3]*this.y;return this.x=tt[0]*this.x+tt[1]*this.y,this.y=ti,this},_add:function(tt){return this.x+=tt.x,this.y+=tt.y,this},_sub:function(tt){return this.x-=tt.x,this.y-=tt.y,this},_mult:function(tt){return this.x*=tt,this.y*=tt,this},_div:function(tt){return this.x/=tt,this.y/=tt,this},_multByPoint:function(tt){return this.x*=tt.x,this.y*=tt.y,this},_divByPoint:function(tt){return this.x/=tt.x,this.y/=tt.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var tt=this.y;return this.y=this.x,this.x=-tt,this},_rotate:function(tt){var ti=Math.cos(tt),ta=Math.sin(tt),tc=ta*this.x+ti*this.y;return this.x=ti*this.x-ta*this.y,this.y=tc,this},_rotateAround:function(tt,ti){var ta=Math.cos(tt),tc=Math.sin(tt),th=ti.y+tc*(this.x-ti.x)+ta*(this.y-ti.y);return this.x=ti.x+ta*(this.x-ti.x)-tc*(this.y-ti.y),this.y=th,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(tt){return tt instanceof a?tt:Array.isArray(tt)?new a(tt[0],tt[1]):tt};var tf="undefined"!=typeof self?self:{};function u(tt,ti,ta,th){var tf=new tc(tt,ti,ta,th);return function(tt){return tf.solve(tt)}}var td=u(.25,.1,.25,1);function p(tt,ti,ta){return Math.min(ta,Math.max(ti,tt))}function c(tt,ti,ta){var tc=ta-ti,th=((tt-ti)%tc+tc)%tc+ti;return th===ti?ta:th}function h(tt){for(var ti=[],ta=arguments.length-1;ta-- >0;)ti[ta]=arguments[ta+1];for(var tc=0;tc<ti.length;tc+=1){var th=ti[tc];for(var tf in th)tt[tf]=th[tf]}return tt}var tm=1;function y(){return tm++}function d(){return function t(tt){return tt?(tt^16*Math.random()>>tt/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(tt){return!!tt&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(tt)}function v(tt,ti){tt.forEach(function(tt){ti[tt]&&(ti[tt]=ti[tt].bind(ti))})}function g(tt,ti){return -1!==tt.indexOf(ti,tt.length-ti.length)}function x(tt,ti,ta){var tc={};for(var th in tt)tc[th]=ti.call(ta||this,tt[th],th,tt);return tc}function b(tt,ti,ta){var tc={};for(var th in tt)ti.call(ta||this,tt[th],th,tt)&&(tc[th]=tt[th]);return tc}function w(tt){return Array.isArray(tt)?tt.map(w):"object"==typeof tt&&tt?x(tt,w):tt}var ty={};function A(tt){ty[tt]||("undefined"!=typeof console&&console.warn(tt),ty[tt]=!0)}function S(tt,ti,ta){return(ta.y-tt.y)*(ti.x-tt.x)>(ti.y-tt.y)*(ta.x-tt.x)}function k(tt){for(var ti=0,ta=0,tc=tt.length,th=tc-1,tf=void 0,td=void 0;ta<tc;th=ta++)ti+=((td=tt[th]).x-(tf=tt[ta]).x)*(tf.y+td.y);return ti}function I(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function z(tt){var ti={};if(tt.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(tt,ta,tc,th){var tf=tc||th;return ti[ta]=!tf||tf.toLowerCase(),""}),ti["max-age"]){var ta=parseInt(ti["max-age"],10);isNaN(ta)?delete ti["max-age"]:ti["max-age"]=ta}return ti}var tg=null;function E(tt){if(null==tg){var ti=tt.navigator?tt.navigator.userAgent:null;tg=!!tt.safari||!(!ti||!(/\b(iPad|iPhone|iPod)\b/.test(ti)||ti.match("Safari")&&!ti.match("Chrome")))}return tg}function P(tt){try{var ti=tf[tt];return ti.setItem("_mapbox_test_",1),ti.removeItem("_mapbox_test_"),!0}catch(tt){return!1}}var t_,tv,tx,tb,tw=tf.performance&&tf.performance.now?tf.performance.now.bind(tf.performance):Date.now.bind(Date),tS=tf.requestAnimationFrame||tf.mozRequestAnimationFrame||tf.webkitRequestAnimationFrame||tf.msRequestAnimationFrame,tT=tf.cancelAnimationFrame||tf.mozCancelAnimationFrame||tf.webkitCancelAnimationFrame||tf.msCancelAnimationFrame,tI={now:tw,frame:function(tt){var ti=tS(tt);return{cancel:function(){return tT(ti)}}},getImageData:function(tt,ti){void 0===ti&&(ti=0);var ta=tf.document.createElement("canvas"),tc=ta.getContext("2d");if(!tc)throw Error("failed to create canvas 2d context");return ta.width=tt.width,ta.height=tt.height,tc.drawImage(tt,0,0,tt.width,tt.height),tc.getImageData(-ti,-ti,tt.width+2*ti,tt.height+2*ti)},resolveURL:function(tt){return t_||(t_=tf.document.createElement("a")),t_.href=tt,t_.href},hardwareConcurrency:tf.navigator&&tf.navigator.hardwareConcurrency||4,get devicePixelRatio(){return tf.devicePixelRatio},get prefersReducedMotion(){return!!tf.matchMedia&&(null==tv&&(tv=tf.matchMedia("(prefers-reduced-motion: reduce)")),tv.matches)}},tE={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},tA={supported:!1,testSupport:function(tt){!tP&&tb&&(tz?N(tt):tx=tt)}},tP=!1,tz=!1;function N(tt){var ti=tt.createTexture();tt.bindTexture(tt.TEXTURE_2D,ti);try{if(tt.texImage2D(tt.TEXTURE_2D,0,tt.RGBA,tt.RGBA,tt.UNSIGNED_BYTE,tb),tt.isContextLost())return;tA.supported=!0}catch(tt){}tt.deleteTexture(ti),tP=!0}tf.document&&((tb=tf.document.createElement("img")).onload=function(){tx&&N(tx),tx=null,tz=!0},tb.onerror=function(){tP=!0,tx=null},tb.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var G=function(tt,ti){this._transformRequestFn=tt,this._customAccessToken=ti,this._createSkuToken()};function Z(tt){return 0===tt.indexOf("mapbox:")}G.prototype._createSkuToken=function(){var tt=function(){for(var tt="",ti=0;ti<10;ti++)tt+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",tt].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=tt.token,this._skuTokenExpiresAt=tt.tokenExpiresAt},G.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},G.prototype.transformRequest=function(tt,ti){return this._transformRequestFn&&this._transformRequestFn(tt,ti)||{url:tt}},G.prototype.normalizeStyleURL=function(tt,ti){if(!Z(tt))return tt;var ta=Y(tt);return ta.path="/styles/v1"+ta.path,this._makeAPIURL(ta,this._customAccessToken||ti)},G.prototype.normalizeGlyphsURL=function(tt,ti){if(!Z(tt))return tt;var ta=Y(tt);return ta.path="/fonts/v1"+ta.path,this._makeAPIURL(ta,this._customAccessToken||ti)},G.prototype.normalizeSourceURL=function(tt,ti){if(!Z(tt))return tt;var ta=Y(tt);return ta.path="/v4/"+ta.authority+".json",ta.params.push("secure"),this._makeAPIURL(ta,this._customAccessToken||ti)},G.prototype.normalizeSpriteURL=function(tt,ti,ta,tc){var th=Y(tt);return Z(tt)?(th.path="/styles/v1"+th.path+"/sprite"+ti+ta,this._makeAPIURL(th,this._customAccessToken||tc)):(th.path+=""+ti+ta,$(th))},G.prototype.normalizeTileURL=function(tt,ti){if(this._isSkuTokenExpired()&&this._createSkuToken(),tt&&!Z(tt))return tt;var ta=Y(tt);ta.path=ta.path.replace(/(\.(png|jpg)\d*)(?=$)/,(tI.devicePixelRatio>=2||512===ti?"@2x":"")+(tA.supported?".webp":"$1")),ta.path=ta.path.replace(/^.+\/v4\//,"/"),ta.path="/v4"+ta.path;var tc=this._customAccessToken||function(tt){for(var ti=0;ti<tt.length;ti+=1){var ta=tt[ti].match(/^access_token=(.*)$/);if(ta)return ta[1]}return null}(ta.params)||tE.ACCESS_TOKEN;return tE.REQUIRE_ACCESS_TOKEN&&tc&&this._skuToken&&ta.params.push("sku="+this._skuToken),this._makeAPIURL(ta,tc)},G.prototype.canonicalizeTileURL=function(tt,ti){var ta=Y(tt);if(!ta.path.match(/(^\/v4\/)/)||!ta.path.match(/\.[\w]+$/))return tt;var tc="mapbox://tiles/";tc+=ta.path.replace("/v4/","");var th=ta.params;return ti&&(th=th.filter(function(tt){return!tt.match(/^access_token=/)})),th.length&&(tc+="?"+th.join("&")),tc},G.prototype.canonicalizeTileset=function(tt,ti){for(var ta=!!ti&&Z(ti),tc=[],th=0,tf=tt.tiles||[];th<tf.length;th+=1){var td=tf[th];J(td)?tc.push(this.canonicalizeTileURL(td,ta)):tc.push(td)}return tc},G.prototype._makeAPIURL=function(tt,ti){var ta="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",tc=Y(tE.API_URL);if(tt.protocol=tc.protocol,tt.authority=tc.authority,"http"===tt.protocol){var th=tt.params.indexOf("secure");th>=0&&tt.params.splice(th,1)}if("/"!==tc.path&&(tt.path=""+tc.path+tt.path),!tE.REQUIRE_ACCESS_TOKEN)return $(tt);if(!(ti=ti||tE.ACCESS_TOKEN))throw Error("An API access token is required to use Mapbox GL. "+ta);if("s"===ti[0])throw Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+ta);return tt.params=tt.params.filter(function(tt){return -1===tt.indexOf("access_token")}),tt.params.push("access_token="+ti),$(tt)};var tC=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function J(tt){return tC.test(tt)}var tk=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Y(tt){var ti=tt.match(tk);if(!ti)throw Error("Unable to parse URL object");return{protocol:ti[1],authority:ti[2],path:ti[3]||"/",params:ti[4]?ti[4].split("&"):[]}}function $(tt){var ti=tt.params.length?"?"+tt.params.join("&"):"";return tt.protocol+"://"+tt.authority+tt.path+ti}function W(tt){if(!tt)return null;var ti=tt.split(".");if(!ti||3!==ti.length)return null;try{return JSON.parse(decodeURIComponent(tf.atob(ti[1]).split("").map(function(tt){return"%"+("00"+tt.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(tt){return null}}var Q=function(tt){this.type=tt,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Q.prototype.getStorageKey=function(tt){var ti,ta=W(tE.ACCESS_TOKEN);return ti=ta&&ta.u?tf.btoa(encodeURIComponent(ta.u).replace(/%([0-9A-F]{2})/g,function(tt,ti){return String.fromCharCode(Number("0x"+ti))})):tE.ACCESS_TOKEN||"",tt?"mapbox.eventData."+tt+":"+ti:"mapbox.eventData:"+ti},Q.prototype.fetchEventData=function(){var tt=P("localStorage"),ti=this.getStorageKey(),ta=this.getStorageKey("uuid");if(tt)try{var tc=tf.localStorage.getItem(ti);tc&&(this.eventData=JSON.parse(tc));var th=tf.localStorage.getItem(ta);th&&(this.anonId=th)}catch(tt){A("Unable to read from LocalStorage")}},Q.prototype.saveEventData=function(){var tt=P("localStorage"),ti=this.getStorageKey(),ta=this.getStorageKey("uuid");if(tt)try{tf.localStorage.setItem(ta,this.anonId),Object.keys(this.eventData).length>=1&&tf.localStorage.setItem(ti,JSON.stringify(this.eventData))}catch(tt){A("Unable to write to LocalStorage")}},Q.prototype.processRequests=function(tt){},Q.prototype.postEvent=function(tt,ti,ta,tc){var th=this;if(tE.EVENTS_URL){var tf=Y(tE.EVENTS_URL);tf.params.push("access_token="+(tc||tE.ACCESS_TOKEN||""));var td={event:this.type,created:new Date(tt).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:"01",userId:this.anonId},tm=ti?h(td,ti):td,ty={url:$(tf),headers:{"Content-Type":"text/plain"},body:JSON.stringify([tm])};this.pendingRequest=wt(ty,function(tt){th.pendingRequest=null,ta(tt),th.saveEventData(),th.processRequests(tc)})}},Q.prototype.queueRequest=function(tt,ti){this.queue.push(tt),this.processRequests(ti)};var tM,tD,tL=function(tt){function e(){tt.call(this,"map.load"),this.success={},this.skuToken=""}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(tt,ti,ta,tc){this.skuToken=ta,(tE.EVENTS_URL&&tc||tE.ACCESS_TOKEN&&Array.isArray(tt)&&tt.some(function(tt){return Z(tt)||J(tt)}))&&this.queueRequest({id:ti,timestamp:Date.now()},tc)},e.prototype.processRequests=function(tt){var ti=this;if(!this.pendingRequest&&0!==this.queue.length){var ta=this.queue.shift(),tc=ta.id,th=ta.timestamp;tc&&this.success[tc]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=d()),this.postEvent(th,{skuToken:this.skuToken},function(tt){tt||tc&&(ti.success[tc]=!0)},tt))}},e}(Q),tB=new(function(tt){function e(ti){tt.call(this,"appUserTurnstile"),this._customAccessToken=ti}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(tt,ti){tE.EVENTS_URL&&tE.ACCESS_TOKEN&&Array.isArray(tt)&&tt.some(function(tt){return Z(tt)||J(tt)})&&this.queueRequest(Date.now(),ti)},e.prototype.processRequests=function(tt){var ti=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var ta=W(tE.ACCESS_TOKEN),tc=ta?ta.u:tE.ACCESS_TOKEN,th=tc!==this.eventData.tokenU;m(this.anonId)||(this.anonId=d(),th=!0);var tf=this.queue.shift();if(this.eventData.lastSuccess){var td=new Date(this.eventData.lastSuccess),tm=new Date(tf),ty=(tf-this.eventData.lastSuccess)/864e5;th=th||ty>=1||ty<-1||td.getDate()!==tm.getDate()}else th=!0;if(!th)return this.processRequests();this.postEvent(tf,{"enabled.telemetry":!1},function(tt){tt||(ti.eventData.lastSuccess=tf,ti.eventData.tokenU=tc)},tt)}},e}(Q)),tR=tB.postTurnstileEvent.bind(tB),tO=new tL,tF=tO.postMapLoadEvent.bind(tO),tU=500,tV=50;function lt(){tf.caches&&!tM&&(tM=tf.caches.open("mapbox-tiles"))}function pt(tt){var ti=tt.indexOf("?");return ti<0?tt:tt.slice(0,ti)}var tN,tj=1/0;function ft(){return null==tN&&(tN=tf.OffscreenCanvas&&new tf.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof tf.createImageBitmap),tN}var tq={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(tq);var tZ,tG,tX=function(tt){function e(ti,ta,tc){401===ta&&J(tc)&&(ti+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),tt.call(this,ti),this.status=ta,this.url=tc,this.name=this.constructor.name,this.message=ti}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),tW=I()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===tf.location.protocol?tf.parent:tf).location.href},xt=function(tt,ti){var ta,tc,th,td,tm,ty,tg,t_,tv;if(!(/^file:/.test(ta=tt.url)||/^file:/.test(tW())&&!/^\w+:/.test(ta))){if(tf.fetch&&tf.Request&&tf.AbortController&&tf.Request.prototype.hasOwnProperty("signal"))return th=new tf.AbortController,td=new tf.Request(tt.url,{method:tt.method||"GET",body:tt.body,credentials:tt.credentials,headers:tt.headers,referrer:tW(),signal:th.signal}),tm=!1,ty=!1,tg=(tc=td.url).indexOf("sku=")>0&&J(tc),"json"===tt.type&&td.headers.set("Accept","application/json"),t_=function(ta,tc,th){if(!ty){if(ta&&"SecurityError"!==ta.message&&A(ta),tc&&th)return tv(tc);var tm=Date.now();tf.fetch(td).then(function(ta){if(ta.ok){var tc=tg?ta.clone():null;return tv(ta,tc,tm)}return ti(new tX(ta.statusText,ta.status,tt.url))}).catch(function(tt){20!==tt.code&&ti(Error(tt.message))})}},tv=function(ta,tc,th){("arrayBuffer"===tt.type?ta.arrayBuffer():"json"===tt.type?ta.json():ta.text()).then(function(tt){ty||(tc&&th&&function(tt,ti,ta){if(lt(),tM){var tc={status:ti.status,statusText:ti.statusText,headers:new tf.Headers};ti.headers.forEach(function(tt,ti){return tc.headers.set(ti,tt)});var th=z(ti.headers.get("Cache-Control")||"");th["no-store"]||(th["max-age"]&&tc.headers.set("Expires",new Date(ta+1e3*th["max-age"]).toUTCString()),new Date(tc.headers.get("Expires")).getTime()-ta<42e4||function(tt,ti){if(void 0===tD)try{new Response(new ReadableStream),tD=!0}catch(tt){tD=!1}tD?ti(tt.body):tt.blob().then(ti)}(ti,function(ti){var ta=new tf.Response(ti,tc);lt(),tM&&tM.then(function(ti){return ti.put(pt(tt.url),ta)}).catch(function(tt){return A(tt.message)})}))}}(td,tc,th),tm=!0,ti(null,tt,ta.headers.get("Cache-Control"),ta.headers.get("Expires")))}).catch(function(tt){ty||ti(Error(tt.message))})},tg?function(tt,ti){if(lt(),!tM)return ti(null);var ta=pt(tt.url);tM.then(function(tt){tt.match(ta).then(function(tc){var th=function(tt){if(!tt)return!1;var ti=new Date(tt.headers.get("Expires")||0),ta=z(tt.headers.get("Cache-Control")||"");return ti>Date.now()&&!ta["no-cache"]}(tc);tt.delete(ta),th&&tt.put(ta,tc.clone()),ti(null,tc,th)}).catch(ti)}).catch(ti)}(td,t_):t_(null,null),{cancel:function(){ty=!0,tm||th.abort()}};if(I()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",tt,ti,void 0,!0)}return function(tt,ti){var ta=new tf.XMLHttpRequest;for(var tc in ta.open(tt.method||"GET",tt.url,!0),"arrayBuffer"===tt.type&&(ta.responseType="arraybuffer"),tt.headers)ta.setRequestHeader(tc,tt.headers[tc]);return"json"===tt.type&&(ta.responseType="text",ta.setRequestHeader("Accept","application/json")),ta.withCredentials="include"===tt.credentials,ta.onerror=function(){ti(Error(ta.statusText))},ta.onload=function(){if((ta.status>=200&&ta.status<300||0===ta.status)&&null!==ta.response){var tc=ta.response;if("json"===tt.type)try{tc=JSON.parse(ta.response)}catch(tt){return ti(tt)}ti(null,tc,ta.getResponseHeader("Cache-Control"),ta.getResponseHeader("Expires"))}else ti(new tX(ta.statusText,ta.status,tt.url))},ta.send(tt.body),{cancel:function(){return ta.abort()}}}(tt,ti)},bt=function(tt,ti){return xt(h(tt,{type:"arrayBuffer"}),ti)},wt=function(tt,ti){return xt(h(tt,{method:"POST"}),ti)},tK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";tZ=[],tG=0;var At=function(tt,ti){if(tA.supported&&(tt.headers||(tt.headers={}),tt.headers.accept="image/webp,*/*"),tG>=tE.MAX_PARALLEL_IMAGE_REQUESTS){var ta={requestParameters:tt,callback:ti,cancelled:!1,cancel:function(){this.cancelled=!0}};return tZ.push(ta),ta}tG++;var tc=!1,i=function(){if(!tc)for(tc=!0,tG--;tZ.length&&tG<tE.MAX_PARALLEL_IMAGE_REQUESTS;){var tt=tZ.shift();tt.cancelled||(tt.cancel=At(tt.requestParameters,tt.callback).cancel)}},th=bt(tt,function(tt,ta,tc,th){var td,tm,ty;i(),tt?ti(tt):ta&&(ft()?function(tt,ti){var ta=new tf.Blob([new Uint8Array(tt)],{type:"image/png"});tf.createImageBitmap(ta).then(function(tt){ti(null,tt)}).catch(function(tt){ti(Error("Could not load image because of "+tt.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(ta,ti):(td=new tf.Image,tm=tf.URL,td.onload=function(){ti(null,td),tm.revokeObjectURL(td.src),td.onload=null,tf.requestAnimationFrame(function(){td.src=tK})},td.onerror=function(){return ti(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ty=new tf.Blob([new Uint8Array(ta)],{type:"image/png"}),td.cacheControl=tc,td.expires=th,td.src=ta.byteLength?tm.createObjectURL(ty):tK))});return{cancel:function(){th.cancel(),i()}}};function St(tt,ti,ta){ta[tt]&&-1!==ta[tt].indexOf(ti)||(ta[tt]=ta[tt]||[],ta[tt].push(ti))}function kt(tt,ti,ta){if(ta&&ta[tt]){var tc=ta[tt].indexOf(ti);-1!==tc&&ta[tt].splice(tc,1)}}var It=function(tt,ti){void 0===ti&&(ti={}),h(this,ti),this.type=tt},tJ=function(tt){function e(ti,ta){void 0===ta&&(ta={}),tt.call(this,"error",h({error:ti},ta))}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(It),Ct=function(){};Ct.prototype.on=function(tt,ti){return this._listeners=this._listeners||{},St(tt,ti,this._listeners),this},Ct.prototype.off=function(tt,ti){return kt(tt,ti,this._listeners),kt(tt,ti,this._oneTimeListeners),this},Ct.prototype.once=function(tt,ti){return this._oneTimeListeners=this._oneTimeListeners||{},St(tt,ti,this._oneTimeListeners),this},Ct.prototype.fire=function(tt,ti){"string"==typeof tt&&(tt=new It(tt,ti||{}));var ta=tt.type;if(this.listens(ta)){tt.target=this;for(var tc=0,th=this._listeners&&this._listeners[ta]?this._listeners[ta].slice():[];tc<th.length;tc+=1)th[tc].call(this,tt);for(var tf=0,td=this._oneTimeListeners&&this._oneTimeListeners[ta]?this._oneTimeListeners[ta].slice():[];tf<td.length;tf+=1){var tm=td[tf];kt(ta,tm,this._oneTimeListeners),tm.call(this,tt)}var ty=this._eventedParent;ty&&(h(tt,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),ty.fire(tt))}else tt instanceof tJ&&console.error(tt.error);return this},Ct.prototype.listens=function(tt){return this._listeners&&this._listeners[tt]&&this._listeners[tt].length>0||this._oneTimeListeners&&this._oneTimeListeners[tt]&&this._oneTimeListeners[tt].length>0||this._eventedParent&&this._eventedParent.listens(tt)},Ct.prototype.setEventedParent=function(tt,ti){return this._eventedParent=tt,this._eventedParentData=ti,this};var tY={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pt=function(tt,ti,ta,tc){this.message=(tt?tt+": ":"")+ta,tc&&(this.identifier=tc),null!=ti&&ti.__line__&&(this.line=ti.__line__)};function Mt(tt){var ti=tt.value;return ti?[new Pt(tt.key,ti,"constants have been deprecated as of v8")]:[]}function Bt(tt){for(var ti=[],ta=arguments.length-1;ta-- >0;)ti[ta]=arguments[ta+1];for(var tc=0;tc<ti.length;tc+=1){var th=ti[tc];for(var tf in th)tt[tf]=th[tf]}return tt}function Tt(tt){return tt instanceof Number||tt instanceof String||tt instanceof Boolean?tt.valueOf():tt}function Vt(tt){if(Array.isArray(tt))return tt.map(Vt);if(tt instanceof Object&&!(tt instanceof Number||tt instanceof String||tt instanceof Boolean)){var ti={};for(var ta in tt)ti[ta]=Vt(tt[ta]);return ti}return Tt(tt)}var tH=function(tt){function e(ti,ta){tt.call(this,ta),this.message=ta,this.key=ti}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(Error),Dt=function(tt,ti){void 0===ti&&(ti=[]),this.parent=tt,this.bindings={};for(var ta=0,tc=ti;ta<tc.length;ta+=1){var th=tc[ta];this.bindings[th[0]]=th[1]}};Dt.prototype.concat=function(tt){return new Dt(this,tt)},Dt.prototype.get=function(tt){if(this.bindings[tt])return this.bindings[tt];if(this.parent)return this.parent.get(tt);throw Error(tt+" not found in scope.")},Dt.prototype.has=function(tt){return!!this.bindings[tt]||!!this.parent&&this.parent.has(tt)};var t$={kind:"null"},tQ={kind:"number"},t0={kind:"string"},t1={kind:"boolean"},t2={kind:"color"},t5={kind:"object"},t4={kind:"value"},t3={kind:"collator"},t6={kind:"formatted"},t8={kind:"resolvedImage"};function Xt(tt,ti){return{kind:"array",itemType:tt,N:ti}}function Jt(tt){if("array"===tt.kind){var ti=Jt(tt.itemType);return"number"==typeof tt.N?"array<"+ti+", "+tt.N+">":"value"===tt.itemType.kind?"array":"array<"+ti+">"}return tt.kind}var t9=[t$,tQ,t0,t1,t2,t6,t5,Xt(t4),t8];function Yt(tt,ti){if("error"===ti.kind)return null;if("array"===tt.kind){if("array"===ti.kind&&(0===ti.N&&"value"===ti.itemType.kind||!Yt(tt.itemType,ti.itemType))&&("number"!=typeof tt.N||tt.N===ti.N))return null}else{if(tt.kind===ti.kind)return null;if("value"===tt.kind){for(var ta=0;ta<t9.length;ta+=1)if(!Yt(t9[ta],ti))return null}}return"Expected "+Jt(tt)+" but found "+Jt(ti)+" instead."}function $t(tt,ti){return ti.some(function(ti){return ti.kind===tt.kind})}function Wt(tt,ti){return ti.some(function(ti){return"null"===ti?null===tt:"array"===ti?Array.isArray(tt):"object"===ti?tt&&!Array.isArray(tt)&&"object"==typeof tt:ti===typeof tt})}var t7=e(function(tt,ti){var ta={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(tt){return(tt=Math.round(tt))<0?0:tt>255?255:tt}function i(tt){return n("%"===tt[tt.length-1]?parseFloat(tt)/100*255:parseInt(tt))}function a(tt){var ti;return(ti="%"===tt[tt.length-1]?parseFloat(tt)/100:parseFloat(tt))<0?0:ti>1?1:ti}function o(tt,ti,ta){return ta<0?ta+=1:ta>1&&(ta-=1),6*ta<1?tt+(ti-tt)*ta*6:2*ta<1?ti:3*ta<2?tt+(ti-tt)*(2/3-ta)*6:tt}try{ti.parseCSSColor=function(tt){var ti,tc=tt.replace(/ /g,"").toLowerCase();if(tc in ta)return ta[tc].slice();if("#"===tc[0])return 4===tc.length?(ti=parseInt(tc.substr(1),16))>=0&&ti<=4095?[(3840&ti)>>4|(3840&ti)>>8,240&ti|(240&ti)>>4,15&ti|(15&ti)<<4,1]:null:7===tc.length&&(ti=parseInt(tc.substr(1),16))>=0&&ti<=16777215?[(16711680&ti)>>16,(65280&ti)>>8,255&ti,1]:null;var th=tc.indexOf("("),tf=tc.indexOf(")");if(-1!==th&&tf+1===tc.length){var td=tc.substr(0,th),tm=tc.substr(th+1,tf-(th+1)).split(","),ty=1;switch(td){case"rgba":if(4!==tm.length)break;ty=a(tm.pop());case"rgb":return 3!==tm.length?null:[i(tm[0]),i(tm[1]),i(tm[2]),ty];case"hsla":if(4!==tm.length)break;ty=a(tm.pop());case"hsl":if(3!==tm.length)break;var tg=(parseFloat(tm[0])%360+360)%360/360,t_=a(tm[1]),tv=a(tm[2]),tx=tv<=.5?tv*(t_+1):tv+t_-tv*t_,tb=2*tv-tx;return[n(255*o(tb,tx,tg+1/3)),n(255*o(tb,tx,tg)),n(255*o(tb,tx,tg-1/3)),ty]}}return null}}catch(tt){}}).parseCSSColor,te=function(tt,ti,ta,tc){void 0===tc&&(tc=1),this.r=tt,this.g=ti,this.b=ta,this.a=tc};te.parse=function(tt){if(tt){if(tt instanceof te)return tt;if("string"==typeof tt){var ti=t7(tt);if(ti)return new te(ti[0]/255*ti[3],ti[1]/255*ti[3],ti[2]/255*ti[3],ti[3])}}},te.prototype.toString=function(){var tt=this.toArray(),ti=tt[1],ta=tt[2],tc=tt[3];return"rgba("+Math.round(tt[0])+","+Math.round(ti)+","+Math.round(ta)+","+tc+")"},te.prototype.toArray=function(){var tt=this.a;return 0===tt?[0,0,0,0]:[255*this.r/tt,255*this.g/tt,255*this.b/tt,tt]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(tt,ti,ta){this.sensitivity=tt?ti?"variant":"case":ti?"accent":"base",this.locale=ta,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(tt,ti){return this.collator.compare(tt,ti)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var re=function(tt,ti,ta,tc,th){this.text=tt,this.image=ti,this.scale=ta,this.fontStack=tc,this.textColor=th},ne=function(tt){this.sections=tt};ne.fromString=function(tt){return new ne([new re(tt,null,null,null,null)])},ne.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some(function(tt){return 0!==tt.text.length||tt.image&&0!==tt.image.name.length})},ne.factory=function(tt){return tt instanceof ne?tt:ne.fromString(tt)},ne.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map(function(tt){return tt.text}).join("")},ne.prototype.serialize=function(){for(var tt=["format"],ti=0,ta=this.sections;ti<ta.length;ti+=1){var tc=ta[ti];if(tc.image)tt.push(["image",tc.image.name]);else{tt.push(tc.text);var th={};tc.fontStack&&(th["text-font"]=["literal",tc.fontStack.split(",")]),tc.scale&&(th["font-scale"]=tc.scale),tc.textColor&&(th["text-color"]=["rgba"].concat(tc.textColor.toArray())),tt.push(th)}}return tt};var ie=function(tt){this.name=tt.name,this.available=tt.available};function ae(tt,ti,ta,tc){return"number"==typeof tt&&tt>=0&&tt<=255&&"number"==typeof ti&&ti>=0&&ti<=255&&"number"==typeof ta&&ta>=0&&ta<=255?void 0===tc||"number"==typeof tc&&tc>=0&&tc<=1?null:"Invalid rgba value ["+[tt,ti,ta,tc].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof tc?[tt,ti,ta,tc]:[tt,ti,ta]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function oe(tt){if(null===tt||"string"==typeof tt||"boolean"==typeof tt||"number"==typeof tt||tt instanceof te||tt instanceof ee||tt instanceof ne||tt instanceof ie)return!0;if(Array.isArray(tt)){for(var ti=0;ti<tt.length;ti+=1)if(!oe(tt[ti]))return!1;return!0}if("object"==typeof tt){for(var ta in tt)if(!oe(tt[ta]))return!1;return!0}return!1}function se(tt){if(null===tt)return t$;if("string"==typeof tt)return t0;if("boolean"==typeof tt)return t1;if("number"==typeof tt)return tQ;if(tt instanceof te)return t2;if(tt instanceof ee)return t3;if(tt instanceof ne)return t6;if(tt instanceof ie)return t8;if(Array.isArray(tt)){for(var ti,ta=tt.length,tc=0;tc<tt.length;tc+=1){var th=se(tt[tc]);if(ti){if(ti===th)continue;ti=t4;break}ti=th}return Xt(ti||t4,ta)}return t5}function ue(tt){var ti=typeof tt;return null===tt?"":"string"===ti||"number"===ti||"boolean"===ti?String(tt):tt instanceof te||tt instanceof ne||tt instanceof ie?tt.toString():JSON.stringify(tt)}ie.prototype.toString=function(){return this.name},ie.fromString=function(tt){return tt?new ie({name:tt,available:!1}):null},ie.prototype.serialize=function(){return["image",this.name]};var le=function(tt,ti){this.type=tt,this.value=ti};le.parse=function(tt,ti){if(2!==tt.length)return ti.error("'literal' expression requires exactly one argument, but found "+(tt.length-1)+" instead.");if(!oe(tt[1]))return ti.error("invalid value");var ta=tt[1],tc=se(ta),th=ti.expectedType;return"array"===tc.kind&&0===tc.N&&th&&"array"===th.kind&&("number"!=typeof th.N||0===th.N)&&(tc=th),new le(tc,ta)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof ne?this.value.serialize():this.value};var pe=function(tt){this.name="ExpressionEvaluationError",this.message=tt};pe.prototype.toJSON=function(){return this.message};var et={string:t0,number:tQ,boolean:t1,object:t5},he=function(tt,ti){this.type=tt,this.args=ti};he.parse=function(tt,ti){if(tt.length<2)return ti.error("Expected at least one argument.");var ta,tc,th,tf=1,td=tt[0];if("array"===td){if(tt.length>2){var tm=tt[1];if("string"!=typeof tm||!(tm in et)||"object"===tm)return ti.error('The item type argument of "array" must be one of string, number, boolean',1);ta=et[tm],tf++}else ta=t4;if(tt.length>3){if(null!==tt[2]&&("number"!=typeof tt[2]||tt[2]<0||tt[2]!==Math.floor(tt[2])))return ti.error('The length argument to "array" must be a positive integer literal',2);tc=tt[2],tf++}th=Xt(ta,tc)}else th=et[td];for(var ty=[];tf<tt.length;tf++){var tg=ti.parse(tt[tf],tf,t4);if(!tg)return null;ty.push(tg)}return new he(th,ty)},he.prototype.evaluate=function(tt){for(var ti=0;ti<this.args.length;ti++){var ta=this.args[ti].evaluate(tt);if(!Yt(this.type,se(ta)))return ta;if(ti===this.args.length-1)throw new pe("Expected value to be of type "+Jt(this.type)+", but found "+Jt(se(ta))+" instead.")}return null},he.prototype.eachChild=function(tt){this.args.forEach(tt)},he.prototype.outputDefined=function(){return this.args.every(function(tt){return tt.outputDefined()})},he.prototype.serialize=function(){var tt=this.type,ti=[tt.kind];if("array"===tt.kind){var ta=tt.itemType;if("string"===ta.kind||"number"===ta.kind||"boolean"===ta.kind){ti.push(ta.kind);var tc=tt.N;("number"==typeof tc||this.args.length>1)&&ti.push(tc)}}return ti.concat(this.args.map(function(tt){return tt.serialize()}))};var fe=function(tt){this.type=t6,this.sections=tt};fe.parse=function(tt,ti){if(tt.length<2)return ti.error("Expected at least one argument.");var ta=tt[1];if(!Array.isArray(ta)&&"object"==typeof ta)return ti.error("First argument must be an image or text section.");for(var tc=[],th=!1,tf=1;tf<=tt.length-1;++tf){var td=tt[tf];if(th&&"object"==typeof td&&!Array.isArray(td)){th=!1;var tm=null;if(td["font-scale"]&&!(tm=ti.parse(td["font-scale"],1,tQ)))return null;var ty=null;if(td["text-font"]&&!(ty=ti.parse(td["text-font"],1,Xt(t0))))return null;var tg=null;if(td["text-color"]&&!(tg=ti.parse(td["text-color"],1,t2)))return null;var t_=tc[tc.length-1];t_.scale=tm,t_.font=ty,t_.textColor=tg}else{var tv=ti.parse(tt[tf],1,t4);if(!tv)return null;var tx=tv.type.kind;if("string"!==tx&&"value"!==tx&&"null"!==tx&&"resolvedImage"!==tx)return ti.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");th=!0,tc.push({content:tv,scale:null,font:null,textColor:null})}}return new fe(tc)},fe.prototype.evaluate=function(tt){return new ne(this.sections.map(function(ti){var ta=ti.content.evaluate(tt);return se(ta)===t8?new re("",ta,null,null,null):new re(ue(ta),null,ti.scale?ti.scale.evaluate(tt):null,ti.font?ti.font.evaluate(tt).join(","):null,ti.textColor?ti.textColor.evaluate(tt):null)}))},fe.prototype.eachChild=function(tt){for(var ti=0,ta=this.sections;ti<ta.length;ti+=1){var tc=ta[ti];tt(tc.content),tc.scale&&tt(tc.scale),tc.font&&tt(tc.font),tc.textColor&&tt(tc.textColor)}},fe.prototype.outputDefined=function(){return!1},fe.prototype.serialize=function(){for(var tt=["format"],ti=0,ta=this.sections;ti<ta.length;ti+=1){var tc=ta[ti];tt.push(tc.content.serialize());var th={};tc.scale&&(th["font-scale"]=tc.scale.serialize()),tc.font&&(th["text-font"]=tc.font.serialize()),tc.textColor&&(th["text-color"]=tc.textColor.serialize()),tt.push(th)}return tt};var ye=function(tt){this.type=t8,this.input=tt};ye.parse=function(tt,ti){if(2!==tt.length)return ti.error("Expected two arguments.");var ta=ti.parse(tt[1],1,t0);return ta?new ye(ta):ti.error("No image name provided.")},ye.prototype.evaluate=function(tt){var ti=this.input.evaluate(tt),ta=ie.fromString(ti);return ta&&tt.availableImages&&(ta.available=tt.availableImages.indexOf(ti)>-1),ta},ye.prototype.eachChild=function(tt){tt(this.input)},ye.prototype.outputDefined=function(){return!1},ye.prototype.serialize=function(){return["image",this.input.serialize()]};var ea={"to-boolean":t1,"to-color":t2,"to-number":tQ,"to-string":t0},me=function(tt,ti){this.type=tt,this.args=ti};me.parse=function(tt,ti){if(tt.length<2)return ti.error("Expected at least one argument.");var ta=tt[0];if(("to-boolean"===ta||"to-string"===ta)&&2!==tt.length)return ti.error("Expected one argument.");for(var tc=ea[ta],th=[],tf=1;tf<tt.length;tf++){var td=ti.parse(tt[tf],tf,t4);if(!td)return null;th.push(td)}return new me(tc,th)},me.prototype.evaluate=function(tt){if("boolean"===this.type.kind)return!!this.args[0].evaluate(tt);if("color"===this.type.kind){for(var ti,ta,tc=0,th=this.args;tc<th.length;tc+=1){if(ta=null,(ti=th[tc].evaluate(tt))instanceof te)return ti;if("string"==typeof ti){var tf=tt.parseColor(ti);if(tf)return tf}else if(Array.isArray(ti)&&!(ta=ti.length<3||ti.length>4?"Invalid rbga value "+JSON.stringify(ti)+": expected an array containing either three or four numeric values.":ae(ti[0],ti[1],ti[2],ti[3])))return new te(ti[0]/255,ti[1]/255,ti[2]/255,ti[3])}throw new pe(ta||"Could not parse color from value '"+("string"==typeof ti?ti:String(JSON.stringify(ti)))+"'")}if("number"===this.type.kind){for(var td=null,tm=0,ty=this.args;tm<ty.length;tm+=1){if(null===(td=ty[tm].evaluate(tt)))return 0;var tg=Number(td);if(!isNaN(tg))return tg}throw new pe("Could not convert "+JSON.stringify(td)+" to number.")}return"formatted"===this.type.kind?ne.fromString(ue(this.args[0].evaluate(tt))):"resolvedImage"===this.type.kind?ie.fromString(ue(this.args[0].evaluate(tt))):ue(this.args[0].evaluate(tt))},me.prototype.eachChild=function(tt){this.args.forEach(tt)},me.prototype.outputDefined=function(){return this.args.every(function(tt){return tt.outputDefined()})},me.prototype.serialize=function(){if("formatted"===this.type.kind)return new fe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ye(this.args[0]).serialize();var tt=["to-"+this.type.kind];return this.eachChild(function(ti){tt.push(ti.serialize())}),tt};var ec=["Unknown","Point","LineString","Polygon"],ge=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ge.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ge.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ec[this.feature.type]:this.feature.type:null},ge.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ge.prototype.canonicalID=function(){return this.canonical},ge.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ge.prototype.parseColor=function(tt){var ti=this._parseColorCache[tt];return ti||(ti=this._parseColorCache[tt]=te.parse(tt)),ti};var xe=function(tt,ti,ta,tc){this.name=tt,this.type=ti,this._evaluate=ta,this.args=tc};xe.prototype.evaluate=function(tt){return this._evaluate(tt,this.args)},xe.prototype.eachChild=function(tt){this.args.forEach(tt)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){return[this.name].concat(this.args.map(function(tt){return tt.serialize()}))},xe.parse=function(tt,ti){var ta,tc=tt[0],th=xe.definitions[tc];if(!th)return ti.error('Unknown expression "'+tc+'". If you wanted a literal array, use ["literal", [...]].',0);for(var tf=Array.isArray(th)?th[0]:th.type,td=Array.isArray(th)?[[th[1],th[2]]]:th.overloads,tm=td.filter(function(ti){var ta=ti[0];return!Array.isArray(ta)||ta.length===tt.length-1}),ty=null,tg=0;tg<tm.length;tg+=1){var t_=tm[tg],tv=t_[0],tx=t_[1];ty=new je(ti.registry,ti.path,null,ti.scope);for(var tb=[],tw=!1,tS=1;tS<tt.length;tS++){var tT=tt[tS],tI=Array.isArray(tv)?tv[tS-1]:tv.type,tE=ty.parse(tT,1+tb.length,tI);if(!tE){tw=!0;break}tb.push(tE)}if(!tw){if(Array.isArray(tv)&&tv.length!==tb.length)ty.error("Expected "+tv.length+" arguments, but found "+tb.length+" instead.");else{for(var tA=0;tA<tb.length;tA++){var tP=Array.isArray(tv)?tv[tA]:tv.type,tz=tb[tA];ty.concat(tA+1).checkSubtype(tP,tz.type)}if(0===ty.errors.length)return new xe(tc,tf,tx,tb)}}}if(1===tm.length)(ta=ti.errors).push.apply(ta,ty.errors);else{for(var tC=(tm.length?tm:td).map(function(tt){var ti;return Array.isArray(ti=tt[0])?"("+ti.map(Jt).join(", ")+")":"("+Jt(ti.type)+"...)"}).join(" | "),tk=[],tM=1;tM<tt.length;tM++){var tD=ti.parse(tt[tM],1+tk.length);if(!tD)return null;tk.push(Jt(tD.type))}ti.error("Expected arguments of type "+tC+", but found ("+tk.join(", ")+") instead.")}return null},xe.register=function(tt,ti){for(var ta in xe.definitions=ti,ti)tt[ta]=xe};var be=function(tt,ti,ta){this.type=t3,this.locale=ta,this.caseSensitive=tt,this.diacriticSensitive=ti};function we(tt,ti){tt[0]=Math.min(tt[0],ti[0]),tt[1]=Math.min(tt[1],ti[1]),tt[2]=Math.max(tt[2],ti[0]),tt[3]=Math.max(tt[3],ti[1])}function _e(tt,ti){return!(tt[0]<=ti[0]||tt[2]>=ti[2]||tt[1]<=ti[1]||tt[3]>=ti[3])}function Ae(tt,ti){var ta=(180+tt[0])/360,tc=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+tt[1]*Math.PI/360)))/360,th=Math.pow(2,ti.z);return[Math.round(ta*th*8192),Math.round(tc*th*8192)]}function Se(tt,ti,ta){return ti[1]>tt[1]!=ta[1]>tt[1]&&tt[0]<(ta[0]-ti[0])*(tt[1]-ti[1])/(ta[1]-ti[1])+ti[0]}function ke(tt,ti){for(var ta,tc,th,tf,td,tm,ty=!1,tg=0,t_=ti.length;tg<t_;tg++)for(var tv=ti[tg],tx=0,tb=tv.length;tx<tb-1;tx++){if((th=tt[0]-(ta=tv[tx])[0])*(tm=tt[1]-(tc=tv[tx+1])[1])-(td=tt[0]-tc[0])*(tf=tt[1]-ta[1])==0&&th*td<=0&&tf*tm<=0)return!1;Se(tt,tv[tx],tv[tx+1])&&(ty=!ty)}return ty}function Ie(tt,ti){for(var ta=0;ta<ti.length;ta++)if(ke(tt,ti[ta]))return!0;return!1}function ze(tt,ti,ta,tc){var th=tc[0]-ta[0],tf=tc[1]-ta[1],td=(tt[0]-ta[0])*tf-th*(tt[1]-ta[1]),tm=(ti[0]-ta[0])*tf-th*(ti[1]-ta[1]);return td>0&&tm<0||td<0&&tm>0}function Ce(tt,ti,ta){for(var tc,th,tf,td,tm=0;tm<ta.length;tm+=1)for(var ty=ta[tm],tg=0;tg<ty.length-1;++tg)if(0!=(tf=[(th=ty[tg+1])[0]-(tc=ty[tg])[0],th[1]-tc[1]])[0]*(td=[ti[0]-tt[0],ti[1]-tt[1]])[1]-tf[1]*td[0]&&ze(tt,ti,tc,th)&&ze(tc,th,tt,ti))return!0;return!1}function Ee(tt,ti){for(var ta=0;ta<tt.length;++ta)if(!ke(tt[ta],ti))return!1;for(var tc=0;tc<tt.length-1;++tc)if(Ce(tt[tc],tt[tc+1],ti))return!1;return!0}function Pe(tt,ti){for(var ta=0;ta<ti.length;ta++)if(Ee(tt,ti[ta]))return!0;return!1}function Me(tt,ti,ta){for(var tc=[],th=0;th<tt.length;th++){for(var tf=[],td=0;td<tt[th].length;td++){var tm=Ae(tt[th][td],ta);we(ti,tm),tf.push(tm)}tc.push(tf)}return tc}function Be(tt,ti,ta){for(var tc=[],th=0;th<tt.length;th++){var tf=Me(tt[th],ti,ta);tc.push(tf)}return tc}function Te(tt,ti,ta,tc){if(tt[0]<ta[0]||tt[0]>ta[2]){var th=.5*tc,tf=tt[0]-ta[0]>th?-tc:ta[0]-tt[0]>th?tc:0;0===tf&&(tf=tt[0]-ta[2]>th?-tc:ta[2]-tt[0]>th?tc:0),tt[0]+=tf}we(ti,tt)}function Ve(tt,ti,ta,tc){for(var th=8192*Math.pow(2,tc.z),tf=[8192*tc.x,8192*tc.y],td=[],tm=0;tm<tt.length;tm+=1)for(var ty=0,tg=tt[tm];ty<tg.length;ty+=1){var t_=tg[ty],tv=[t_.x+tf[0],t_.y+tf[1]];Te(tv,ti,ta,th),td.push(tv)}return td}function Fe(tt,ti,ta,tc){for(var th=8192*Math.pow(2,tc.z),tf=[8192*tc.x,8192*tc.y],td=[],tm=0;tm<tt.length;tm+=1){for(var ty=[],tg=0,t_=tt[tm];tg<t_.length;tg+=1){var tv=t_[tg],tx=[tv.x+tf[0],tv.y+tf[1]];we(ti,tx),ty.push(tx)}td.push(ty)}if(ti[2]-ti[0]<=th/2){ti[0]=ti[1]=1/0,ti[2]=ti[3]=-1/0;for(var tb=0;tb<td.length;tb+=1)for(var tw=0,tS=td[tb];tw<tS.length;tw+=1)Te(tS[tw],ti,ta,th)}return td}be.parse=function(tt,ti){if(2!==tt.length)return ti.error("Expected one argument.");var ta=tt[1];if("object"!=typeof ta||Array.isArray(ta))return ti.error("Collator options argument must be an object.");var tc=ti.parse(void 0!==ta["case-sensitive"]&&ta["case-sensitive"],1,t1);if(!tc)return null;var th=ti.parse(void 0!==ta["diacritic-sensitive"]&&ta["diacritic-sensitive"],1,t1);if(!th)return null;var tf=null;return!ta.locale||(tf=ti.parse(ta.locale,1,t0))?new be(tc,th,tf):null},be.prototype.evaluate=function(tt){return new ee(this.caseSensitive.evaluate(tt),this.diacriticSensitive.evaluate(tt),this.locale?this.locale.evaluate(tt):null)},be.prototype.eachChild=function(tt){tt(this.caseSensitive),tt(this.diacriticSensitive),this.locale&&tt(this.locale)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){var tt={};return tt["case-sensitive"]=this.caseSensitive.serialize(),tt["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(tt.locale=this.locale.serialize()),["collator",tt]};var De=function(tt,ti){this.type=t1,this.geojson=tt,this.geometries=ti};function Le(tt){if(tt instanceof xe&&("get"===tt.name&&1===tt.args.length||"feature-state"===tt.name||"has"===tt.name&&1===tt.args.length||"properties"===tt.name||"geometry-type"===tt.name||"id"===tt.name||/^filter-/.test(tt.name))||tt instanceof De)return!1;var ti=!0;return tt.eachChild(function(tt){ti&&!Le(tt)&&(ti=!1)}),ti}function Oe(tt){if(tt instanceof xe&&"feature-state"===tt.name)return!1;var ti=!0;return tt.eachChild(function(tt){ti&&!Oe(tt)&&(ti=!1)}),ti}function Re(tt,ti){if(tt instanceof xe&&ti.indexOf(tt.name)>=0)return!1;var ta=!0;return tt.eachChild(function(tt){ta&&!Re(tt,ti)&&(ta=!1)}),ta}De.parse=function(tt,ti){if(2!==tt.length)return ti.error("'within' expression requires exactly one argument, but found "+(tt.length-1)+" instead.");if(oe(tt[1])){var ta=tt[1];if("FeatureCollection"===ta.type)for(var tc=0;tc<ta.features.length;++tc){var th=ta.features[tc].geometry.type;if("Polygon"===th||"MultiPolygon"===th)return new De(ta,ta.features[tc].geometry)}else if("Feature"===ta.type){var tf=ta.geometry.type;if("Polygon"===tf||"MultiPolygon"===tf)return new De(ta,ta.geometry)}else if("Polygon"===ta.type||"MultiPolygon"===ta.type)return new De(ta,ta)}return ti.error("'within' expression requires valid geojson object that contains polygon geometry type.")},De.prototype.evaluate=function(tt){if(null!=tt.geometry()&&null!=tt.canonicalID()){if("Point"===tt.geometryType())return function(tt,ti){var ta=[1/0,1/0,-1/0,-1/0],tc=[1/0,1/0,-1/0,-1/0],th=tt.canonicalID();if("Polygon"===ti.type){var tf=Me(ti.coordinates,tc,th),td=Ve(tt.geometry(),ta,tc,th);if(!_e(ta,tc))return!1;for(var tm=0;tm<td.length;tm+=1)if(!ke(td[tm],tf))return!1}if("MultiPolygon"===ti.type){var ty=Be(ti.coordinates,tc,th),tg=Ve(tt.geometry(),ta,tc,th);if(!_e(ta,tc))return!1;for(var t_=0;t_<tg.length;t_+=1)if(!Ie(tg[t_],ty))return!1}return!0}(tt,this.geometries);if("LineString"===tt.geometryType())return function(tt,ti){var ta=[1/0,1/0,-1/0,-1/0],tc=[1/0,1/0,-1/0,-1/0],th=tt.canonicalID();if("Polygon"===ti.type){var tf=Me(ti.coordinates,tc,th),td=Fe(tt.geometry(),ta,tc,th);if(!_e(ta,tc))return!1;for(var tm=0;tm<td.length;tm+=1)if(!Ee(td[tm],tf))return!1}if("MultiPolygon"===ti.type){var ty=Be(ti.coordinates,tc,th),tg=Fe(tt.geometry(),ta,tc,th);if(!_e(ta,tc))return!1;for(var t_=0;t_<tg.length;t_+=1)if(!Pe(tg[t_],ty))return!1}return!0}(tt,this.geometries)}return!1},De.prototype.eachChild=function(){},De.prototype.outputDefined=function(){return!0},De.prototype.serialize=function(){return["within",this.geojson]};var Ue=function(tt,ti){this.type=ti.type,this.name=tt,this.boundExpression=ti};Ue.parse=function(tt,ti){if(2!==tt.length||"string"!=typeof tt[1])return ti.error("'var' expression requires exactly one string literal argument.");var ta=tt[1];return ti.scope.has(ta)?new Ue(ta,ti.scope.get(ta)):ti.error('Unknown variable "'+ta+'". Make sure "'+ta+'" has been bound in an enclosing "let" expression before using it.',1)},Ue.prototype.evaluate=function(tt){return this.boundExpression.evaluate(tt)},Ue.prototype.eachChild=function(){},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return["var",this.name]};var je=function(tt,ti,ta,tc,th){void 0===ti&&(ti=[]),void 0===tc&&(tc=new Dt),void 0===th&&(th=[]),this.registry=tt,this.path=ti,this.key=ti.map(function(tt){return"["+tt+"]"}).join(""),this.scope=tc,this.errors=th,this.expectedType=ta};function qe(tt,ti){for(var ta,tc=tt.length-1,th=0,tf=tc,td=0;th<=tf;)if((ta=tt[td=Math.floor((th+tf)/2)])<=ti){if(td===tc||ti<tt[td+1])return td;th=td+1}else{if(!(ta>ti))throw new pe("Input is not a number.");tf=td-1}return 0}je.prototype.parse=function(tt,ti,ta,tc,th){return void 0===th&&(th={}),ti?this.concat(ti,ta,tc)._parse(tt,th):this._parse(tt,th)},je.prototype._parse=function(tt,ti){function r(tt,ti,ta){return"assert"===ta?new he(ti,[tt]):"coerce"===ta?new me(ti,[tt]):tt}if(null!==tt&&"string"!=typeof tt&&"boolean"!=typeof tt&&"number"!=typeof tt||(tt=["literal",tt]),Array.isArray(tt)){if(0===tt.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var ta=tt[0];if("string"!=typeof ta)return this.error("Expression name must be a string, but found "+typeof ta+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var tc=this.registry[ta];if(tc){var th=tc.parse(tt,this);if(!th)return null;if(this.expectedType){var tf=this.expectedType,td=th.type;if("string"!==tf.kind&&"number"!==tf.kind&&"boolean"!==tf.kind&&"object"!==tf.kind&&"array"!==tf.kind||"value"!==td.kind){if("color"!==tf.kind&&"formatted"!==tf.kind&&"resolvedImage"!==tf.kind||"value"!==td.kind&&"string"!==td.kind){if(this.checkSubtype(tf,td))return null}else th=r(th,tf,ti.typeAnnotation||"coerce")}else th=r(th,tf,ti.typeAnnotation||"assert")}if(!(th instanceof le)&&"resolvedImage"!==th.type.kind&&function t(tt){if(tt instanceof Ue)return t(tt.boundExpression);if(tt instanceof xe&&"error"===tt.name||tt instanceof be||tt instanceof De)return!1;var ti=tt instanceof me||tt instanceof he,ta=!0;return tt.eachChild(function(tt){ta=ti?ta&&t(tt):ta&&tt instanceof le}),!!ta&&Le(tt)&&Re(tt,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(th)){var tm=new ge;try{th=new le(th.type,th.evaluate(tm))}catch(tt){return this.error(tt.message),null}}return th}return this.error('Unknown expression "'+ta+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===tt?"'undefined' value invalid. Use null instead.":"object"==typeof tt?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof tt+" instead.")},je.prototype.concat=function(tt,ti,ta){var tc="number"==typeof tt?this.path.concat(tt):this.path,th=ta?this.scope.concat(ta):this.scope;return new je(this.registry,tc,ti||null,th,this.errors)},je.prototype.error=function(tt){for(var ti=[],ta=arguments.length-1;ta-- >0;)ti[ta]=arguments[ta+1];var tc=""+this.key+ti.map(function(tt){return"["+tt+"]"}).join("");this.errors.push(new tH(tc,tt))},je.prototype.checkSubtype=function(tt,ti){var ta=Yt(tt,ti);return ta&&this.error(ta),ta};var Ne=function(tt,ti,ta){this.type=tt,this.input=ti,this.labels=[],this.outputs=[];for(var tc=0;tc<ta.length;tc+=1){var th=ta[tc],tf=th[1];this.labels.push(th[0]),this.outputs.push(tf)}};function Ke(tt,ti,ta){return tt*(1-ta)+ti*ta}Ne.parse=function(tt,ti){if(tt.length-1<4)return ti.error("Expected at least 4 arguments, but found only "+(tt.length-1)+".");if((tt.length-1)%2!=0)return ti.error("Expected an even number of arguments.");var ta=ti.parse(tt[1],1,tQ);if(!ta)return null;var tc=[],th=null;ti.expectedType&&"value"!==ti.expectedType.kind&&(th=ti.expectedType);for(var tf=1;tf<tt.length;tf+=2){var td=1===tf?-1/0:tt[tf],tm=tt[tf+1],ty=tf,tg=tf+1;if("number"!=typeof td)return ti.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ty);if(tc.length&&tc[tc.length-1][0]>=td)return ti.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ty);var t_=ti.parse(tm,tg,th);if(!t_)return null;th=th||t_.type,tc.push([td,t_])}return new Ne(th,ta,tc)},Ne.prototype.evaluate=function(tt){var ti=this.labels,ta=this.outputs;if(1===ti.length)return ta[0].evaluate(tt);var tc=this.input.evaluate(tt);if(tc<=ti[0])return ta[0].evaluate(tt);var th=ti.length;return tc>=ti[th-1]?ta[th-1].evaluate(tt):ta[qe(ti,tc)].evaluate(tt)},Ne.prototype.eachChild=function(tt){tt(this.input);for(var ti=0,ta=this.outputs;ti<ta.length;ti+=1)tt(ta[ti])},Ne.prototype.outputDefined=function(){return this.outputs.every(function(tt){return tt.outputDefined()})},Ne.prototype.serialize=function(){for(var tt=["step",this.input.serialize()],ti=0;ti<this.labels.length;ti++)ti>0&&tt.push(this.labels[ti]),tt.push(this.outputs[ti].serialize());return tt};var eh=Object.freeze({__proto__:null,number:Ke,color:function(tt,ti,ta){return new te(Ke(tt.r,ti.r,ta),Ke(tt.g,ti.g,ta),Ke(tt.b,ti.b,ta),Ke(tt.a,ti.a,ta))},array:function(tt,ti,ta){return tt.map(function(tt,tc){return Ke(tt,ti[tc],ta)})}}),ef=6/29*3*(6/29),ed=Math.PI/180,em=180/Math.PI;function He(tt){return tt>.008856451679035631?Math.pow(tt,1/3):tt/ef+4/29}function Ye(tt){return tt>6/29?tt*tt*tt:ef*(tt-4/29)}function $e(tt){return 255*(tt<=.0031308?12.92*tt:1.055*Math.pow(tt,1/2.4)-.055)}function We(tt){return(tt/=255)<=.04045?tt/12.92:Math.pow((tt+.055)/1.055,2.4)}function Qe(tt){var ti=We(tt.r),ta=We(tt.g),tc=We(tt.b),th=He((.4124564*ti+.3575761*ta+.1804375*tc)/.95047),tf=He((.2126729*ti+.7151522*ta+.072175*tc)/1);return{l:116*tf-16,a:500*(th-tf),b:200*(tf-He((.0193339*ti+.119192*ta+.9503041*tc)/1.08883)),alpha:tt.a}}function tr(tt){var ti=(tt.l+16)/116,ta=isNaN(tt.a)?ti:ti+tt.a/500,tc=isNaN(tt.b)?ti:ti-tt.b/200;return ti=1*Ye(ti),new te($e(3.2404542*(ta=.95047*Ye(ta))-1.5371385*ti-.4985314*(tc=1.08883*Ye(tc))),$e(-.969266*ta+1.8760108*ti+.041556*tc),$e(.0556434*ta-.2040259*ti+1.0572252*tc),tt.alpha)}function er(tt,ti,ta){var tc=ti-tt;return tt+ta*(tc>180||tc<-180?tc-360*Math.round(tc/360):tc)}var ey={forward:Qe,reverse:tr,interpolate:function(tt,ti,ta){return{l:Ke(tt.l,ti.l,ta),a:Ke(tt.a,ti.a,ta),b:Ke(tt.b,ti.b,ta),alpha:Ke(tt.alpha,ti.alpha,ta)}}},eg={forward:function(tt){var ti=Qe(tt),ta=ti.l,tc=ti.a,th=ti.b,tf=Math.atan2(th,tc)*em;return{h:tf<0?tf+360:tf,c:Math.sqrt(tc*tc+th*th),l:ta,alpha:tt.a}},reverse:function(tt){var ti=tt.h*ed,ta=tt.c;return tr({l:tt.l,a:Math.cos(ti)*ta,b:Math.sin(ti)*ta,alpha:tt.alpha})},interpolate:function(tt,ti,ta){return{h:er(tt.h,ti.h,ta),c:Ke(tt.c,ti.c,ta),l:Ke(tt.l,ti.l,ta),alpha:Ke(tt.alpha,ti.alpha,ta)}}},e_=Object.freeze({__proto__:null,lab:ey,hcl:eg}),ar=function(tt,ti,ta,tc,th){this.type=tt,this.operator=ti,this.interpolation=ta,this.input=tc,this.labels=[],this.outputs=[];for(var tf=0;tf<th.length;tf+=1){var td=th[tf],tm=td[1];this.labels.push(td[0]),this.outputs.push(tm)}};function or(tt,ti,ta,tc){var th=tc-ta,tf=tt-ta;return 0===th?0:1===ti?tf/th:(Math.pow(ti,tf)-1)/(Math.pow(ti,th)-1)}ar.interpolationFactor=function(tt,ti,ta,th){var tf=0;if("exponential"===tt.name)tf=or(ti,tt.base,ta,th);else if("linear"===tt.name)tf=or(ti,1,ta,th);else if("cubic-bezier"===tt.name){var td=tt.controlPoints;tf=new tc(td[0],td[1],td[2],td[3]).solve(or(ti,1,ta,th))}return tf},ar.parse=function(tt,ti){var ta=tt[0],tc=tt[1],th=tt[2],tf=tt.slice(3);if(!Array.isArray(tc)||0===tc.length)return ti.error("Expected an interpolation type expression.",1);if("linear"===tc[0])tc={name:"linear"};else if("exponential"===tc[0]){var td=tc[1];if("number"!=typeof td)return ti.error("Exponential interpolation requires a numeric base.",1,1);tc={name:"exponential",base:td}}else{if("cubic-bezier"!==tc[0])return ti.error("Unknown interpolation type "+String(tc[0]),1,0);var tm=tc.slice(1);if(4!==tm.length||tm.some(function(tt){return"number"!=typeof tt||tt<0||tt>1}))return ti.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);tc={name:"cubic-bezier",controlPoints:tm}}if(tt.length-1<4)return ti.error("Expected at least 4 arguments, but found only "+(tt.length-1)+".");if((tt.length-1)%2!=0)return ti.error("Expected an even number of arguments.");if(!(th=ti.parse(th,2,tQ)))return null;var ty=[],tg=null;"interpolate-hcl"===ta||"interpolate-lab"===ta?tg=t2:ti.expectedType&&"value"!==ti.expectedType.kind&&(tg=ti.expectedType);for(var t_=0;t_<tf.length;t_+=2){var tv=tf[t_],tx=tf[t_+1],tb=t_+3,tw=t_+4;if("number"!=typeof tv)return ti.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',tb);if(ty.length&&ty[ty.length-1][0]>=tv)return ti.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',tb);var tS=ti.parse(tx,tw,tg);if(!tS)return null;tg=tg||tS.type,ty.push([tv,tS])}return"number"===tg.kind||"color"===tg.kind||"array"===tg.kind&&"number"===tg.itemType.kind&&"number"==typeof tg.N?new ar(tg,ta,tc,th,ty):ti.error("Type "+Jt(tg)+" is not interpolatable.")},ar.prototype.evaluate=function(tt){var ti=this.labels,ta=this.outputs;if(1===ti.length)return ta[0].evaluate(tt);var tc=this.input.evaluate(tt);if(tc<=ti[0])return ta[0].evaluate(tt);var th=ti.length;if(tc>=ti[th-1])return ta[th-1].evaluate(tt);var tf=qe(ti,tc),td=ar.interpolationFactor(this.interpolation,tc,ti[tf],ti[tf+1]),tm=ta[tf].evaluate(tt),ty=ta[tf+1].evaluate(tt);return"interpolate"===this.operator?eh[this.type.kind.toLowerCase()](tm,ty,td):"interpolate-hcl"===this.operator?eg.reverse(eg.interpolate(eg.forward(tm),eg.forward(ty),td)):ey.reverse(ey.interpolate(ey.forward(tm),ey.forward(ty),td))},ar.prototype.eachChild=function(tt){tt(this.input);for(var ti=0,ta=this.outputs;ti<ta.length;ti+=1)tt(ta[ti])},ar.prototype.outputDefined=function(){return this.outputs.every(function(tt){return tt.outputDefined()})},ar.prototype.serialize=function(){var tt;tt="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var ti=[this.operator,tt,this.input.serialize()],ta=0;ta<this.labels.length;ta++)ti.push(this.labels[ta],this.outputs[ta].serialize());return ti};var sr=function(tt,ti){this.type=tt,this.args=ti};sr.parse=function(tt,ti){if(tt.length<2)return ti.error("Expectected at least one argument.");var ta=null,tc=ti.expectedType;tc&&"value"!==tc.kind&&(ta=tc);for(var th=[],tf=0,td=tt.slice(1);tf<td.length;tf+=1){var tm=ti.parse(td[tf],1+th.length,ta,void 0,{typeAnnotation:"omit"});if(!tm)return null;ta=ta||tm.type,th.push(tm)}return new sr(tc&&th.some(function(tt){return Yt(tc,tt.type)})?t4:ta,th)},sr.prototype.evaluate=function(tt){for(var ti,ta=null,tc=0,th=0,tf=this.args;th<tf.length&&(tc++,(ta=tf[th].evaluate(tt))&&ta instanceof ie&&!ta.available&&(ti||(ti=ta.name),ta=null,tc===this.args.length&&(ta=ti)),null===ta);th+=1);return ta},sr.prototype.eachChild=function(tt){this.args.forEach(tt)},sr.prototype.outputDefined=function(){return this.args.every(function(tt){return tt.outputDefined()})},sr.prototype.serialize=function(){var tt=["coalesce"];return this.eachChild(function(ti){tt.push(ti.serialize())}),tt};var ur=function(tt,ti){this.type=ti.type,this.bindings=[].concat(tt),this.result=ti};ur.prototype.evaluate=function(tt){return this.result.evaluate(tt)},ur.prototype.eachChild=function(tt){for(var ti=0,ta=this.bindings;ti<ta.length;ti+=1)tt(ta[ti][1]);tt(this.result)},ur.parse=function(tt,ti){if(tt.length<4)return ti.error("Expected at least 3 arguments, but found "+(tt.length-1)+" instead.");for(var ta=[],tc=1;tc<tt.length-1;tc+=2){var th=tt[tc];if("string"!=typeof th)return ti.error("Expected string, but found "+typeof th+" instead.",tc);if(/[^a-zA-Z0-9_]/.test(th))return ti.error("Variable names must contain only alphanumeric characters or '_'.",tc);var tf=ti.parse(tt[tc+1],tc+1);if(!tf)return null;ta.push([th,tf])}var td=ti.parse(tt[tt.length-1],tt.length-1,ti.expectedType,ta);return td?new ur(ta,td):null},ur.prototype.outputDefined=function(){return this.result.outputDefined()},ur.prototype.serialize=function(){for(var tt=["let"],ti=0,ta=this.bindings;ti<ta.length;ti+=1){var tc=ta[ti];tt.push(tc[0],tc[1].serialize())}return tt.push(this.result.serialize()),tt};var lr=function(tt,ti,ta){this.type=tt,this.index=ti,this.input=ta};lr.parse=function(tt,ti){if(3!==tt.length)return ti.error("Expected 2 arguments, but found "+(tt.length-1)+" instead.");var ta=ti.parse(tt[1],1,tQ),tc=ti.parse(tt[2],2,Xt(ti.expectedType||t4));return ta&&tc?new lr(tc.type.itemType,ta,tc):null},lr.prototype.evaluate=function(tt){var ti=this.index.evaluate(tt),ta=this.input.evaluate(tt);if(ti<0)throw new pe("Array index out of bounds: "+ti+" < 0.");if(ti>=ta.length)throw new pe("Array index out of bounds: "+ti+" > "+(ta.length-1)+".");if(ti!==Math.floor(ti))throw new pe("Array index must be an integer, but found "+ti+" instead.");return ta[ti]},lr.prototype.eachChild=function(tt){tt(this.index),tt(this.input)},lr.prototype.outputDefined=function(){return!1},lr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var pr=function(tt,ti){this.type=t1,this.needle=tt,this.haystack=ti};pr.parse=function(tt,ti){if(3!==tt.length)return ti.error("Expected 2 arguments, but found "+(tt.length-1)+" instead.");var ta=ti.parse(tt[1],1,t4),tc=ti.parse(tt[2],2,t4);return ta&&tc?$t(ta.type,[t1,t0,tQ,t$,t4])?new pr(ta,tc):ti.error("Expected first argument to be of type boolean, string, number or null, but found "+Jt(ta.type)+" instead"):null},pr.prototype.evaluate=function(tt){var ti=this.needle.evaluate(tt),ta=this.haystack.evaluate(tt);if(!ta)return!1;if(!Wt(ti,["boolean","string","number","null"]))throw new pe("Expected first argument to be of type boolean, string, number or null, but found "+Jt(se(ti))+" instead.");if(!Wt(ta,["string","array"]))throw new pe("Expected second argument to be of type array or string, but found "+Jt(se(ta))+" instead.");return ta.indexOf(ti)>=0},pr.prototype.eachChild=function(tt){tt(this.needle),tt(this.haystack)},pr.prototype.outputDefined=function(){return!0},pr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var cr=function(tt,ti,ta){this.type=tQ,this.needle=tt,this.haystack=ti,this.fromIndex=ta};cr.parse=function(tt,ti){if(tt.length<=2||tt.length>=5)return ti.error("Expected 3 or 4 arguments, but found "+(tt.length-1)+" instead.");var ta=ti.parse(tt[1],1,t4),tc=ti.parse(tt[2],2,t4);if(!ta||!tc)return null;if(!$t(ta.type,[t1,t0,tQ,t$,t4]))return ti.error("Expected first argument to be of type boolean, string, number or null, but found "+Jt(ta.type)+" instead");if(4===tt.length){var th=ti.parse(tt[3],3,tQ);return th?new cr(ta,tc,th):null}return new cr(ta,tc)},cr.prototype.evaluate=function(tt){var ti=this.needle.evaluate(tt),ta=this.haystack.evaluate(tt);if(!Wt(ti,["boolean","string","number","null"]))throw new pe("Expected first argument to be of type boolean, string, number or null, but found "+Jt(se(ti))+" instead.");if(!Wt(ta,["string","array"]))throw new pe("Expected second argument to be of type array or string, but found "+Jt(se(ta))+" instead.");if(this.fromIndex){var tc=this.fromIndex.evaluate(tt);return ta.indexOf(ti,tc)}return ta.indexOf(ti)},cr.prototype.eachChild=function(tt){tt(this.needle),tt(this.haystack),this.fromIndex&&tt(this.fromIndex)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var tt=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),tt]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var hr=function(tt,ti,ta,tc,th,tf){this.inputType=tt,this.type=ti,this.input=ta,this.cases=tc,this.outputs=th,this.otherwise=tf};hr.parse=function(tt,ti){if(tt.length<5)return ti.error("Expected at least 4 arguments, but found only "+(tt.length-1)+".");if(tt.length%2!=1)return ti.error("Expected an even number of arguments.");ti.expectedType&&"value"!==ti.expectedType.kind&&(tc=ti.expectedType);for(var ta,tc,th={},tf=[],td=2;td<tt.length-1;td+=2){var tm=tt[td],ty=tt[td+1];Array.isArray(tm)||(tm=[tm]);var tg=ti.concat(td);if(0===tm.length)return tg.error("Expected at least one branch label.");for(var t_=0,tv=tm;t_<tv.length;t_+=1){var tx=tv[t_];if("number"!=typeof tx&&"string"!=typeof tx)return tg.error("Branch labels must be numbers or strings.");if("number"==typeof tx&&Math.abs(tx)>Number.MAX_SAFE_INTEGER)return tg.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof tx&&Math.floor(tx)!==tx)return tg.error("Numeric branch labels must be integer values.");if(ta){if(tg.checkSubtype(ta,se(tx)))return null}else ta=se(tx);if(void 0!==th[String(tx)])return tg.error("Branch labels must be unique.");th[String(tx)]=tf.length}var tb=ti.parse(ty,td,tc);if(!tb)return null;tc=tc||tb.type,tf.push(tb)}var tw=ti.parse(tt[1],1,t4);if(!tw)return null;var tS=ti.parse(tt[tt.length-1],tt.length-1,tc);return tS?"value"!==tw.type.kind&&ti.concat(1).checkSubtype(ta,tw.type)?null:new hr(ta,tc,tw,th,tf,tS):null},hr.prototype.evaluate=function(tt){var ti=this.input.evaluate(tt);return(se(ti)===this.inputType&&this.outputs[this.cases[ti]]||this.otherwise).evaluate(tt)},hr.prototype.eachChild=function(tt){tt(this.input),this.outputs.forEach(tt),tt(this.otherwise)},hr.prototype.outputDefined=function(){return this.outputs.every(function(tt){return tt.outputDefined()})&&this.otherwise.outputDefined()},hr.prototype.serialize=function(){for(var tt=this,ti=["match",this.input.serialize()],ta=[],tc={},th=0,tf=Object.keys(this.cases).sort();th<tf.length;th+=1){var td=tf[th];void 0===(tg=tc[this.cases[td]])?(tc[this.cases[td]]=ta.length,ta.push([this.cases[td],[td]])):ta[tg][1].push(td)}for(var s=function(ti){return"number"===tt.inputType.kind?Number(ti):ti},tm=0;tm<ta.length;tm+=1){var ty=ta[tm],tg=ty[0],t_=ty[1];ti.push(1===t_.length?s(t_[0]):t_.map(s)),ti.push(this.outputs[outputIndex$1].serialize())}return ti.push(this.otherwise.serialize()),ti};var fr=function(tt,ti,ta){this.type=tt,this.branches=ti,this.otherwise=ta};fr.parse=function(tt,ti){if(tt.length<4)return ti.error("Expected at least 3 arguments, but found only "+(tt.length-1)+".");if(tt.length%2!=0)return ti.error("Expected an odd number of arguments.");ti.expectedType&&"value"!==ti.expectedType.kind&&(ta=ti.expectedType);for(var ta,tc=[],th=1;th<tt.length-1;th+=2){var tf=ti.parse(tt[th],th,t1);if(!tf)return null;var td=ti.parse(tt[th+1],th+1,ta);if(!td)return null;tc.push([tf,td]),ta=ta||td.type}var tm=ti.parse(tt[tt.length-1],tt.length-1,ta);return tm?new fr(ta,tc,tm):null},fr.prototype.evaluate=function(tt){for(var ti=0,ta=this.branches;ti<ta.length;ti+=1){var tc=ta[ti],th=tc[1];if(tc[0].evaluate(tt))return th.evaluate(tt)}return this.otherwise.evaluate(tt)},fr.prototype.eachChild=function(tt){for(var ti=0,ta=this.branches;ti<ta.length;ti+=1){var tc=ta[ti],th=tc[1];tt(tc[0]),tt(th)}tt(this.otherwise)},fr.prototype.outputDefined=function(){return this.branches.every(function(tt){return tt[1].outputDefined()})&&this.otherwise.outputDefined()},fr.prototype.serialize=function(){var tt=["case"];return this.eachChild(function(ti){tt.push(ti.serialize())}),tt};var yr=function(tt,ti,ta,tc){this.type=tt,this.input=ti,this.beginIndex=ta,this.endIndex=tc};function dr(tt,ti){return"=="===tt||"!="===tt?"boolean"===ti.kind||"string"===ti.kind||"number"===ti.kind||"null"===ti.kind||"value"===ti.kind:"string"===ti.kind||"number"===ti.kind||"value"===ti.kind}function mr(tt,ti,ta,tc){return 0===tc.compare(ti,ta)}function vr(tt,ti,ta){var tc="=="!==tt&&"!="!==tt;return function(){function i(tt,ti,ta){this.type=t1,this.lhs=tt,this.rhs=ti,this.collator=ta,this.hasUntypedArgument="value"===tt.type.kind||"value"===ti.type.kind}return i.parse=function(tt,ti){if(3!==tt.length&&4!==tt.length)return ti.error("Expected two or three arguments.");var ta=tt[0],th=ti.parse(tt[1],1,t4);if(!th)return null;if(!dr(ta,th.type))return ti.concat(1).error('"'+ta+"\" comparisons are not supported for type '"+Jt(th.type)+"'.");var tf=ti.parse(tt[2],2,t4);if(!tf)return null;if(!dr(ta,tf.type))return ti.concat(2).error('"'+ta+"\" comparisons are not supported for type '"+Jt(tf.type)+"'.");if(th.type.kind!==tf.type.kind&&"value"!==th.type.kind&&"value"!==tf.type.kind)return ti.error("Cannot compare types '"+Jt(th.type)+"' and '"+Jt(tf.type)+"'.");tc&&("value"===th.type.kind&&"value"!==tf.type.kind?th=new he(tf.type,[th]):"value"!==th.type.kind&&"value"===tf.type.kind&&(tf=new he(th.type,[tf])));var td=null;if(4===tt.length){if("string"!==th.type.kind&&"string"!==tf.type.kind&&"value"!==th.type.kind&&"value"!==tf.type.kind)return ti.error("Cannot use collator to compare non-string types.");if(!(td=ti.parse(tt[3],3,t3)))return null}return new i(th,tf,td)},i.prototype.evaluate=function(th){var tf=this.lhs.evaluate(th),td=this.rhs.evaluate(th);if(tc&&this.hasUntypedArgument){var tm=se(tf),ty=se(td);if(tm.kind!==ty.kind||"string"!==tm.kind&&"number"!==tm.kind)throw new pe('Expected arguments for "'+tt+'" to be (string, string) or (number, number), but found ('+tm.kind+", "+ty.kind+") instead.")}if(this.collator&&!tc&&this.hasUntypedArgument){var tg=se(tf),t_=se(td);if("string"!==tg.kind||"string"!==t_.kind)return ti(th,tf,td)}return this.collator?ta(th,tf,td,this.collator.evaluate(th)):ti(th,tf,td)},i.prototype.eachChild=function(tt){tt(this.lhs),tt(this.rhs),this.collator&&tt(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var ti=[tt];return this.eachChild(function(tt){ti.push(tt.serialize())}),ti},i}()}yr.parse=function(tt,ti){if(tt.length<=2||tt.length>=5)return ti.error("Expected 3 or 4 arguments, but found "+(tt.length-1)+" instead.");var ta=ti.parse(tt[1],1,t4),tc=ti.parse(tt[2],2,tQ);if(!ta||!tc)return null;if(!$t(ta.type,[Xt(t4),t0,t4]))return ti.error("Expected first argument to be of type array or string, but found "+Jt(ta.type)+" instead");if(4===tt.length){var th=ti.parse(tt[3],3,tQ);return th?new yr(ta.type,ta,tc,th):null}return new yr(ta.type,ta,tc)},yr.prototype.evaluate=function(tt){var ti=this.input.evaluate(tt),ta=this.beginIndex.evaluate(tt);if(!Wt(ti,["string","array"]))throw new pe("Expected first argument to be of type array or string, but found "+Jt(se(ti))+" instead.");if(this.endIndex){var tc=this.endIndex.evaluate(tt);return ti.slice(ta,tc)}return ti.slice(ta)},yr.prototype.eachChild=function(tt){tt(this.input),tt(this.beginIndex),this.endIndex&&tt(this.endIndex)},yr.prototype.outputDefined=function(){return!1},yr.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var tt=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),tt]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ev=vr("==",function(tt,ti,ta){return ti===ta},mr),ex=vr("!=",function(tt,ti,ta){return ti!==ta},function(tt,ti,ta,tc){return!mr(0,ti,ta,tc)}),eb=vr("<",function(tt,ti,ta){return ti<ta},function(tt,ti,ta,tc){return 0>tc.compare(ti,ta)}),ew=vr(">",function(tt,ti,ta){return ti>ta},function(tt,ti,ta,tc){return tc.compare(ti,ta)>0}),eS=vr("<=",function(tt,ti,ta){return ti<=ta},function(tt,ti,ta,tc){return 0>=tc.compare(ti,ta)}),eT=vr(">=",function(tt,ti,ta){return ti>=ta},function(tt,ti,ta,tc){return tc.compare(ti,ta)>=0}),Sr=function(tt,ti,ta,tc,th){this.type=t0,this.number=tt,this.locale=ti,this.currency=ta,this.minFractionDigits=tc,this.maxFractionDigits=th};Sr.parse=function(tt,ti){if(3!==tt.length)return ti.error("Expected two arguments.");var ta=ti.parse(tt[1],1,tQ);if(!ta)return null;var tc=tt[2];if("object"!=typeof tc||Array.isArray(tc))return ti.error("NumberFormat options argument must be an object.");var th=null;if(tc.locale&&!(th=ti.parse(tc.locale,1,t0)))return null;var tf=null;if(tc.currency&&!(tf=ti.parse(tc.currency,1,t0)))return null;var td=null;if(tc["min-fraction-digits"]&&!(td=ti.parse(tc["min-fraction-digits"],1,tQ)))return null;var tm=null;return!tc["max-fraction-digits"]||(tm=ti.parse(tc["max-fraction-digits"],1,tQ))?new Sr(ta,th,tf,td,tm):null},Sr.prototype.evaluate=function(tt){return new Intl.NumberFormat(this.locale?this.locale.evaluate(tt):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(tt):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(tt):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(tt):void 0}).format(this.number.evaluate(tt))},Sr.prototype.eachChild=function(tt){tt(this.number),this.locale&&tt(this.locale),this.currency&&tt(this.currency),this.minFractionDigits&&tt(this.minFractionDigits),this.maxFractionDigits&&tt(this.maxFractionDigits)},Sr.prototype.outputDefined=function(){return!1},Sr.prototype.serialize=function(){var tt={};return this.locale&&(tt.locale=this.locale.serialize()),this.currency&&(tt.currency=this.currency.serialize()),this.minFractionDigits&&(tt["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(tt["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),tt]};var kr=function(tt){this.type=tQ,this.input=tt};kr.parse=function(tt,ti){if(2!==tt.length)return ti.error("Expected 1 argument, but found "+(tt.length-1)+" instead.");var ta=ti.parse(tt[1],1);return ta?"array"!==ta.type.kind&&"string"!==ta.type.kind&&"value"!==ta.type.kind?ti.error("Expected argument of type string or array, but found "+Jt(ta.type)+" instead."):new kr(ta):null},kr.prototype.evaluate=function(tt){var ti=this.input.evaluate(tt);if("string"==typeof ti||Array.isArray(ti))return ti.length;throw new pe("Expected value to be of type string or array, but found "+Jt(se(ti))+" instead.")},kr.prototype.eachChild=function(tt){tt(this.input)},kr.prototype.outputDefined=function(){return!1},kr.prototype.serialize=function(){var tt=["length"];return this.eachChild(function(ti){tt.push(ti.serialize())}),tt};var eI={"==":ev,"!=":ex,">":ew,"<":eb,">=":eT,"<=":eS,array:he,at:lr,boolean:he,case:fr,coalesce:sr,collator:be,format:fe,image:ye,in:pr,"index-of":cr,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:kr,let:ur,literal:le,match:hr,number:he,"number-format":Sr,object:he,slice:yr,step:Ne,string:he,"to-boolean":me,"to-color":me,"to-number":me,"to-string":me,var:Ue,within:De};function zr(tt,ti){var ta=ti[0],tc=ti[1],th=ti[2],tf=ti[3];ta=ta.evaluate(tt),tc=tc.evaluate(tt),th=th.evaluate(tt);var td=tf?tf.evaluate(tt):1,tm=ae(ta,tc,th,td);if(tm)throw new pe(tm);return new te(ta/255*td,tc/255*td,th/255*td,td)}function Er(tt,ti){var ta=ti[tt];return void 0===ta?null:ta}function Pr(tt){return{type:tt}}function Mr(tt){return{result:"success",value:tt}}function Br(tt){return{result:"error",value:tt}}function Tr(tt){return"data-driven"===tt["property-type"]||"cross-faded-data-driven"===tt["property-type"]}function Vr(tt){return!!tt.expression&&tt.expression.parameters.indexOf("zoom")>-1}function Fr(tt){return!!tt.expression&&tt.expression.interpolated}function Dr(tt){return tt instanceof Number?"number":tt instanceof String?"string":tt instanceof Boolean?"boolean":Array.isArray(tt)?"array":null===tt?"null":typeof tt}function Lr(tt){return"object"==typeof tt&&null!==tt&&!Array.isArray(tt)}function Or(tt){return tt}function Rr(tt,ti,ta){return void 0!==tt?tt:void 0!==ti?ti:void 0!==ta?ta:void 0}function Ur(tt,ti,ta,tc,th){return Rr(typeof ta===th?tc[ta]:void 0,tt.default,ti.default)}function jr(tt,ti,ta){if("number"!==Dr(ta))return Rr(tt.default,ti.default);var tc=tt.stops.length;if(1===tc||ta<=tt.stops[0][0])return tt.stops[0][1];if(ta>=tt.stops[tc-1][0])return tt.stops[tc-1][1];var th=qe(tt.stops.map(function(tt){return tt[0]}),ta);return tt.stops[th][1]}function qr(tt,ti,ta){var tc,th,tf,td=void 0!==tt.base?tt.base:1;if("number"!==Dr(ta))return Rr(tt.default,ti.default);var tm=tt.stops.length;if(1===tm||ta<=tt.stops[0][0])return tt.stops[0][1];if(ta>=tt.stops[tm-1][0])return tt.stops[tm-1][1];var ty=qe(tt.stops.map(function(tt){return tt[0]}),ta),tg=(tc=tt.stops[ty][0],th=tt.stops[ty+1][0]-tc,tf=ta-tc,0===th?0:1===td?tf/th:(Math.pow(td,tf)-1)/(Math.pow(td,th)-1)),t_=tt.stops[ty][1],tv=tt.stops[ty+1][1],tx=eh[ti.type]||Or;if(tt.colorSpace&&"rgb"!==tt.colorSpace){var tb=e_[tt.colorSpace];tx=function(tt,ti){return tb.reverse(tb.interpolate(tb.forward(tt),tb.forward(ti),tg))}}return"function"==typeof t_.evaluate?{evaluate:function(){for(var tt=[],ti=arguments.length;ti--;)tt[ti]=arguments[ti];var ta=t_.evaluate.apply(void 0,tt),tc=tv.evaluate.apply(void 0,tt);if(void 0!==ta&&void 0!==tc)return tx(ta,tc,tg)}}:tx(t_,tv,tg)}function Nr(tt,ti,ta){return"color"===ti.type?ta=te.parse(ta):"formatted"===ti.type?ta=ne.fromString(ta.toString()):"resolvedImage"===ti.type?ta=ie.fromString(ta.toString()):Dr(ta)===ti.type||"enum"===ti.type&&ti.values[ta]||(ta=void 0),Rr(ta,tt.default,ti.default)}xe.register(eI,{error:[{kind:"error"},[t0],function(tt,ti){throw new pe(ti[0].evaluate(tt))}],typeof:[t0,[t4],function(tt,ti){return Jt(se(ti[0].evaluate(tt)))}],"to-rgba":[Xt(tQ,4),[t2],function(tt,ti){return ti[0].evaluate(tt).toArray()}],rgb:[t2,[tQ,tQ,tQ],zr],rgba:[t2,[tQ,tQ,tQ,tQ],zr],has:{type:t1,overloads:[[[t0],function(tt,ti){return ti[0].evaluate(tt) in tt.properties()}],[[t0,t5],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt) in ta.evaluate(tt)}]]},get:{type:t4,overloads:[[[t0],function(tt,ti){return Er(ti[0].evaluate(tt),tt.properties())}],[[t0,t5],function(tt,ti){var ta=ti[1];return Er(ti[0].evaluate(tt),ta.evaluate(tt))}]]},"feature-state":[t4,[t0],function(tt,ti){return Er(ti[0].evaluate(tt),tt.featureState||{})}],properties:[t5,[],function(tt){return tt.properties()}],"geometry-type":[t0,[],function(tt){return tt.geometryType()}],id:[t4,[],function(tt){return tt.id()}],zoom:[tQ,[],function(tt){return tt.globals.zoom}],"heatmap-density":[tQ,[],function(tt){return tt.globals.heatmapDensity||0}],"line-progress":[tQ,[],function(tt){return tt.globals.lineProgress||0}],accumulated:[t4,[],function(tt){return void 0===tt.globals.accumulated?null:tt.globals.accumulated}],"+":[tQ,Pr(tQ),function(tt,ti){for(var ta=0,tc=0;tc<ti.length;tc+=1)ta+=ti[tc].evaluate(tt);return ta}],"*":[tQ,Pr(tQ),function(tt,ti){for(var ta=1,tc=0;tc<ti.length;tc+=1)ta*=ti[tc].evaluate(tt);return ta}],"-":{type:tQ,overloads:[[[tQ,tQ],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt)-ta.evaluate(tt)}],[[tQ],function(tt,ti){return-ti[0].evaluate(tt)}]]},"/":[tQ,[tQ,tQ],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt)/ta.evaluate(tt)}],"%":[tQ,[tQ,tQ],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt)%ta.evaluate(tt)}],ln2:[tQ,[],function(){return Math.LN2}],pi:[tQ,[],function(){return Math.PI}],e:[tQ,[],function(){return Math.E}],"^":[tQ,[tQ,tQ],function(tt,ti){var ta=ti[1];return Math.pow(ti[0].evaluate(tt),ta.evaluate(tt))}],sqrt:[tQ,[tQ],function(tt,ti){return Math.sqrt(ti[0].evaluate(tt))}],log10:[tQ,[tQ],function(tt,ti){return Math.log(ti[0].evaluate(tt))/Math.LN10}],ln:[tQ,[tQ],function(tt,ti){return Math.log(ti[0].evaluate(tt))}],log2:[tQ,[tQ],function(tt,ti){return Math.log(ti[0].evaluate(tt))/Math.LN2}],sin:[tQ,[tQ],function(tt,ti){return Math.sin(ti[0].evaluate(tt))}],cos:[tQ,[tQ],function(tt,ti){return Math.cos(ti[0].evaluate(tt))}],tan:[tQ,[tQ],function(tt,ti){return Math.tan(ti[0].evaluate(tt))}],asin:[tQ,[tQ],function(tt,ti){return Math.asin(ti[0].evaluate(tt))}],acos:[tQ,[tQ],function(tt,ti){return Math.acos(ti[0].evaluate(tt))}],atan:[tQ,[tQ],function(tt,ti){return Math.atan(ti[0].evaluate(tt))}],min:[tQ,Pr(tQ),function(tt,ti){return Math.min.apply(Math,ti.map(function(ti){return ti.evaluate(tt)}))}],max:[tQ,Pr(tQ),function(tt,ti){return Math.max.apply(Math,ti.map(function(ti){return ti.evaluate(tt)}))}],abs:[tQ,[tQ],function(tt,ti){return Math.abs(ti[0].evaluate(tt))}],round:[tQ,[tQ],function(tt,ti){var ta=ti[0].evaluate(tt);return ta<0?-Math.round(-ta):Math.round(ta)}],floor:[tQ,[tQ],function(tt,ti){return Math.floor(ti[0].evaluate(tt))}],ceil:[tQ,[tQ],function(tt,ti){return Math.ceil(ti[0].evaluate(tt))}],"filter-==":[t1,[t0,t4],function(tt,ti){var ta=ti[0],tc=ti[1];return tt.properties()[ta.value]===tc.value}],"filter-id-==":[t1,[t4],function(tt,ti){var ta=ti[0];return tt.id()===ta.value}],"filter-type-==":[t1,[t0],function(tt,ti){var ta=ti[0];return tt.geometryType()===ta.value}],"filter-<":[t1,[t0,t4],function(tt,ti){var ta=ti[0],tc=ti[1],th=tt.properties()[ta.value],tf=tc.value;return typeof th==typeof tf&&th<tf}],"filter-id-<":[t1,[t4],function(tt,ti){var ta=ti[0],tc=tt.id(),th=ta.value;return typeof tc==typeof th&&tc<th}],"filter->":[t1,[t0,t4],function(tt,ti){var ta=ti[0],tc=ti[1],th=tt.properties()[ta.value],tf=tc.value;return typeof th==typeof tf&&th>tf}],"filter-id->":[t1,[t4],function(tt,ti){var ta=ti[0],tc=tt.id(),th=ta.value;return typeof tc==typeof th&&tc>th}],"filter-<=":[t1,[t0,t4],function(tt,ti){var ta=ti[0],tc=ti[1],th=tt.properties()[ta.value],tf=tc.value;return typeof th==typeof tf&&th<=tf}],"filter-id-<=":[t1,[t4],function(tt,ti){var ta=ti[0],tc=tt.id(),th=ta.value;return typeof tc==typeof th&&tc<=th}],"filter->=":[t1,[t0,t4],function(tt,ti){var ta=ti[0],tc=ti[1],th=tt.properties()[ta.value],tf=tc.value;return typeof th==typeof tf&&th>=tf}],"filter-id->=":[t1,[t4],function(tt,ti){var ta=ti[0],tc=tt.id(),th=ta.value;return typeof tc==typeof th&&tc>=th}],"filter-has":[t1,[t4],function(tt,ti){return ti[0].value in tt.properties()}],"filter-has-id":[t1,[],function(tt){return null!==tt.id()&&void 0!==tt.id()}],"filter-type-in":[t1,[Xt(t0)],function(tt,ti){return ti[0].value.indexOf(tt.geometryType())>=0}],"filter-id-in":[t1,[Xt(t4)],function(tt,ti){return ti[0].value.indexOf(tt.id())>=0}],"filter-in-small":[t1,[t0,Xt(t4)],function(tt,ti){var ta=ti[0];return ti[1].value.indexOf(tt.properties()[ta.value])>=0}],"filter-in-large":[t1,[t0,Xt(t4)],function(tt,ti){var ta=ti[0],tc=ti[1];return function(tt,ti,ta,tc){for(;ta<=tc;){var th=ta+tc>>1;if(ti[th]===tt)return!0;ti[th]>tt?tc=th-1:ta=th+1}return!1}(tt.properties()[ta.value],tc.value,0,tc.value.length-1)}],all:{type:t1,overloads:[[[t1,t1],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt)&&ta.evaluate(tt)}],[Pr(t1),function(tt,ti){for(var ta=0;ta<ti.length;ta+=1)if(!ti[ta].evaluate(tt))return!1;return!0}]]},any:{type:t1,overloads:[[[t1,t1],function(tt,ti){var ta=ti[1];return ti[0].evaluate(tt)||ta.evaluate(tt)}],[Pr(t1),function(tt,ti){for(var ta=0;ta<ti.length;ta+=1)if(ti[ta].evaluate(tt))return!0;return!1}]]},"!":[t1,[t1],function(tt,ti){return!ti[0].evaluate(tt)}],"is-supported-script":[t1,[t0],function(tt,ti){var ta=tt.globals&&tt.globals.isSupportedScript;return!ta||ta(ti[0].evaluate(tt))}],upcase:[t0,[t0],function(tt,ti){return ti[0].evaluate(tt).toUpperCase()}],downcase:[t0,[t0],function(tt,ti){return ti[0].evaluate(tt).toLowerCase()}],concat:[t0,Pr(t4),function(tt,ti){return ti.map(function(ti){return ue(ti.evaluate(tt))}).join("")}],"resolved-locale":[t0,[t3],function(tt,ti){return ti[0].evaluate(tt).resolvedLocale()}]});var Kr=function(tt,ti){this.expression=tt,this._warningHistory={},this._evaluator=new ge,this._defaultValue=ti?"color"===ti.type&&Lr(ti.default)?new te(0,0,0,0):"color"===ti.type?te.parse(ti.default)||null:void 0===ti.default?null:ti.default:null,this._enumValues=ti&&"enum"===ti.type?ti.values:null};function Gr(tt){return Array.isArray(tt)&&tt.length>0&&"string"==typeof tt[0]&&tt[0]in eI}function Zr(tt,ti){var ta,tc=new je(eI,[],ti?(ta={color:t2,string:t0,number:tQ,enum:t0,boolean:t1,formatted:t6,resolvedImage:t8},"array"===ti.type?Xt(ta[ti.value]||t4,ti.length):ta[ti.type]):void 0),th=tc.parse(tt,void 0,void 0,void 0,ti&&"string"===ti.type?{typeAnnotation:"coerce"}:void 0);return th?Mr(new Kr(th,ti)):Br(tc.errors)}Kr.prototype.evaluateWithoutErrorHandling=function(tt,ti,ta,tc,th,tf){return this._evaluator.globals=tt,this._evaluator.feature=ti,this._evaluator.featureState=ta,this._evaluator.canonical=tc,this._evaluator.availableImages=th||null,this._evaluator.formattedSection=tf,this.expression.evaluate(this._evaluator)},Kr.prototype.evaluate=function(tt,ti,ta,tc,th,tf){this._evaluator.globals=tt,this._evaluator.feature=ti||null,this._evaluator.featureState=ta||null,this._evaluator.canonical=tc,this._evaluator.availableImages=th||null,this._evaluator.formattedSection=tf||null;try{var td=this.expression.evaluate(this._evaluator);if(null==td||"number"==typeof td&&td!=td)return this._defaultValue;if(this._enumValues&&!(td in this._enumValues))throw new pe("Expected value to be one of "+Object.keys(this._enumValues).map(function(tt){return JSON.stringify(tt)}).join(", ")+", but found "+JSON.stringify(td)+" instead.");return td}catch(tt){return this._warningHistory[tt.message]||(this._warningHistory[tt.message]=!0,"undefined"!=typeof console&&console.warn(tt.message)),this._defaultValue}};var Xr=function(tt,ti){this.kind=tt,this._styleExpression=ti,this.isStateDependent="constant"!==tt&&!Oe(ti.expression)};Xr.prototype.evaluateWithoutErrorHandling=function(tt,ti,ta,tc,th,tf){return this._styleExpression.evaluateWithoutErrorHandling(tt,ti,ta,tc,th,tf)},Xr.prototype.evaluate=function(tt,ti,ta,tc,th,tf){return this._styleExpression.evaluate(tt,ti,ta,tc,th,tf)};var Jr=function(tt,ti,ta,tc){this.kind=tt,this.zoomStops=ta,this._styleExpression=ti,this.isStateDependent="camera"!==tt&&!Oe(ti.expression),this.interpolationType=tc};function Hr(tt,ti){if("error"===(tt=Zr(tt,ti)).result)return tt;var ta=tt.value.expression,tc=Le(ta);if(!tc&&!Tr(ti))return Br([new tH("","data expressions not supported")]);var th=Re(ta,["zoom"]);if(!th&&!Vr(ti))return Br([new tH("","zoom expressions not supported")]);var tf=function t(tt){var ti=null;if(tt instanceof ur)ti=t(tt.result);else if(tt instanceof sr)for(var ta=0,tc=tt.args;ta<tc.length&&!(ti=t(tc[ta]));ta+=1);else(tt instanceof Ne||tt instanceof ar)&&tt.input instanceof xe&&"zoom"===tt.input.name&&(ti=tt);return ti instanceof tH||tt.eachChild(function(tt){var ta=t(tt);ta instanceof tH?ti=ta:!ti&&ta?ti=new tH("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):ti&&ta&&ti!==ta&&(ti=new tH("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),ti}(ta);return tf||th?tf instanceof tH?Br([tf]):tf instanceof ar&&!Fr(ti)?Br([new tH("",'"interpolate" expressions cannot be used with this property')]):Mr(tf?new Jr(tc?"camera":"composite",tt.value,tf.labels,tf instanceof ar?tf.interpolation:void 0):new Xr(tc?"constant":"source",tt.value)):Br([new tH("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Jr.prototype.evaluateWithoutErrorHandling=function(tt,ti,ta,tc,th,tf){return this._styleExpression.evaluateWithoutErrorHandling(tt,ti,ta,tc,th,tf)},Jr.prototype.evaluate=function(tt,ti,ta,tc,th,tf){return this._styleExpression.evaluate(tt,ti,ta,tc,th,tf)},Jr.prototype.interpolationFactor=function(tt,ti,ta){return this.interpolationType?ar.interpolationFactor(this.interpolationType,tt,ti,ta):0};var Yr=function(tt,ti){this._parameters=tt,this._specification=ti,Bt(this,function t(tt,ti){var ta,tc,th,tf="color"===ti.type,td=tt.stops&&"object"==typeof tt.stops[0][0],tm=td||!(td||void 0!==tt.property),ty=tt.type||(Fr(ti)?"exponential":"interval");if(tf&&((tt=Bt({},tt)).stops&&(tt.stops=tt.stops.map(function(tt){return[tt[0],te.parse(tt[1])]})),tt.default=te.parse(tt.default?tt.default:ti.default)),tt.colorSpace&&"rgb"!==tt.colorSpace&&!e_[tt.colorSpace])throw Error("Unknown color space: "+tt.colorSpace);if("exponential"===ty)ta=qr;else if("interval"===ty)ta=jr;else if("categorical"===ty){ta=Ur,tc=Object.create(null);for(var tg=0,t_=tt.stops;tg<t_.length;tg+=1){var tv=t_[tg];tc[tv[0]]=tv[1]}th=typeof tt.stops[0][0]}else{if("identity"!==ty)throw Error('Unknown function type "'+ty+'"');ta=Nr}if(td){for(var tx={},tb=[],tw=0;tw<tt.stops.length;tw++){var tS=tt.stops[tw],tT=tS[0].zoom;void 0===tx[tT]&&(tx[tT]={zoom:tT,type:tt.type,property:tt.property,default:tt.default,stops:[]},tb.push(tT)),tx[tT].stops.push([tS[0].value,tS[1]])}for(var tI=[],tE=0;tE<tb.length;tE+=1){var tA=tb[tE];tI.push([tx[tA].zoom,t(tx[tA],ti)])}var tP={name:"linear"};return{kind:"composite",interpolationType:tP,interpolationFactor:ar.interpolationFactor.bind(void 0,tP),zoomStops:tI.map(function(tt){return tt[0]}),evaluate:function(ta,tc){var th=ta.zoom;return qr({stops:tI,base:tt.base},ti,th).evaluate(th,tc)}}}if(tm){var tz="exponential"===ty?{name:"exponential",base:void 0!==tt.base?tt.base:1}:null;return{kind:"camera",interpolationType:tz,interpolationFactor:ar.interpolationFactor.bind(void 0,tz),zoomStops:tt.stops.map(function(tt){return tt[0]}),evaluate:function(tf){return ta(tt,ti,tf.zoom,tc,th)}}}return{kind:"source",evaluate:function(tf,td){var tm=td&&td.properties?td.properties[tt.property]:void 0;return void 0===tm?Rr(tt.default,ti.default):ta(tt,ti,tm,tc,th)}}}(this._parameters,this._specification))};function $r(tt){var ti=tt.key,ta=tt.value,tc=tt.valueSpec||{},th=tt.objectElementValidators||{},tf=tt.style,td=tt.styleSpec,tm=[],ty=Dr(ta);if("object"!==ty)return[new Pt(ti,ta,"object expected, "+ty+" found")];for(var tg in ta){var t_=tg.split(".")[0],tv=tc[t_]||tc["*"],tx=void 0;if(th[t_])tx=th[t_];else if(tc[t_])tx=An;else if(th["*"])tx=th["*"];else{if(!tc["*"]){tm.push(new Pt(ti,ta[tg],'unknown property "'+tg+'"'));continue}tx=An}tm=tm.concat(tx({key:(ti?ti+".":ti)+tg,value:ta[tg],valueSpec:tv,style:tf,styleSpec:td,object:ta,objectKey:tg},ta))}for(var tb in tc)th[tb]||tc[tb].required&&void 0===tc[tb].default&&void 0===ta[tb]&&tm.push(new Pt(ti,ta,'missing required property "'+tb+'"'));return tm}function Wr(tt){var ti=tt.value,ta=tt.valueSpec,tc=tt.style,th=tt.styleSpec,tf=tt.key,td=tt.arrayElementValidator||An;if("array"!==Dr(ti))return[new Pt(tf,ti,"array expected, "+Dr(ti)+" found")];if(ta.length&&ti.length!==ta.length)return[new Pt(tf,ti,"array length "+ta.length+" expected, length "+ti.length+" found")];if(ta["min-length"]&&ti.length<ta["min-length"])return[new Pt(tf,ti,"array length at least "+ta["min-length"]+" expected, length "+ti.length+" found")];var tm={type:ta.value,values:ta.values};th.$version<7&&(tm.function=ta.function),"object"===Dr(ta.value)&&(tm=ta.value);for(var ty=[],tg=0;tg<ti.length;tg++)ty=ty.concat(td({array:ti,arrayIndex:tg,value:ti[tg],valueSpec:tm,style:tc,styleSpec:th,key:tf+"["+tg+"]"}));return ty}function Qr(tt){var ti=tt.key,ta=tt.value,tc=tt.valueSpec,th=Dr(ta);return"number"===th&&ta!=ta&&(th="NaN"),"number"!==th?[new Pt(ti,ta,"number expected, "+th+" found")]:"minimum"in tc&&ta<tc.minimum?[new Pt(ti,ta,ta+" is less than the minimum value "+tc.minimum)]:"maximum"in tc&&ta>tc.maximum?[new Pt(ti,ta,ta+" is greater than the maximum value "+tc.maximum)]:[]}function tn(tt){var ti,ta,tc,th=tt.valueSpec,tf=Tt(tt.value.type),td={},tm="categorical"!==tf&&void 0===tt.value.property,ty="array"===Dr(tt.value.stops)&&"array"===Dr(tt.value.stops[0])&&"object"===Dr(tt.value.stops[0][0]),tg=$r({key:tt.key,value:tt.value,valueSpec:tt.styleSpec.function,style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{stops:function(tt){if("identity"===tf)return[new Pt(tt.key,tt.value,'identity function may not have a "stops" property')];var ti=[],ta=tt.value;return ti=ti.concat(Wr({key:tt.key,value:ta,valueSpec:tt.valueSpec,style:tt.style,styleSpec:tt.styleSpec,arrayElementValidator:c})),"array"===Dr(ta)&&0===ta.length&&ti.push(new Pt(tt.key,ta,"array must have at least one stop")),ti},default:function(tt){return An({key:tt.key,value:tt.value,valueSpec:th,style:tt.style,styleSpec:tt.styleSpec})}}});return"identity"===tf&&tm&&tg.push(new Pt(tt.key,tt.value,'missing required property "property"')),"identity"===tf||tt.value.stops||tg.push(new Pt(tt.key,tt.value,'missing required property "stops"')),"exponential"===tf&&tt.valueSpec.expression&&!Fr(tt.valueSpec)&&tg.push(new Pt(tt.key,tt.value,"exponential functions not supported")),tt.styleSpec.$version>=8&&(tm||Tr(tt.valueSpec)?tm&&!Vr(tt.valueSpec)&&tg.push(new Pt(tt.key,tt.value,"zoom functions not supported")):tg.push(new Pt(tt.key,tt.value,"property functions not supported"))),("categorical"===tf||ty)&&void 0===tt.value.property&&tg.push(new Pt(tt.key,tt.value,'"property" property is required')),tg;function c(tt){var ti=[],tf=tt.value,tm=tt.key;if("array"!==Dr(tf))return[new Pt(tm,tf,"array expected, "+Dr(tf)+" found")];if(2!==tf.length)return[new Pt(tm,tf,"array length 2 expected, length "+tf.length+" found")];if(ty){if("object"!==Dr(tf[0]))return[new Pt(tm,tf,"object expected, "+Dr(tf[0])+" found")];if(void 0===tf[0].zoom)return[new Pt(tm,tf,"object stop key must have zoom")];if(void 0===tf[0].value)return[new Pt(tm,tf,"object stop key must have value")];if(tc&&tc>Tt(tf[0].zoom))return[new Pt(tm,tf[0].zoom,"stop zoom values must appear in ascending order")];Tt(tf[0].zoom)!==tc&&(tc=Tt(tf[0].zoom),ta=void 0,td={}),ti=ti.concat($r({key:tm+"[0]",value:tf[0],valueSpec:{zoom:{}},style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{zoom:Qr,value:h}}))}else ti=ti.concat(h({key:tm+"[0]",value:tf[0],valueSpec:{},style:tt.style,styleSpec:tt.styleSpec},tf));return Gr(Vt(tf[1]))?ti.concat([new Pt(tm+"[1]",tf[1],"expressions are not allowed in function stops.")]):ti.concat(An({key:tm+"[1]",value:tf[1],valueSpec:th,style:tt.style,styleSpec:tt.styleSpec}))}function h(tt,tc){var tm=Dr(tt.value),ty=Tt(tt.value),tg=null!==tt.value?tt.value:tc;if(ti){if(tm!==ti)return[new Pt(tt.key,tg,tm+" stop domain type must match previous stop domain type "+ti)]}else ti=tm;if("number"!==tm&&"string"!==tm&&"boolean"!==tm)return[new Pt(tt.key,tg,"stop domain value must be a number, string, or boolean")];if("number"!==tm&&"categorical"!==tf){var t_="number expected, "+tm+" found";return Tr(th)&&void 0===tf&&(t_+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(tt.key,tg,t_)]}return"categorical"!==tf||"number"!==tm||isFinite(ty)&&Math.floor(ty)===ty?"categorical"!==tf&&"number"===tm&&void 0!==ta&&ty<ta?[new Pt(tt.key,tg,"stop domain values must appear in ascending order")]:(ta=ty,"categorical"===tf&&ty in td?[new Pt(tt.key,tg,"stop domain values must be unique")]:(td[ty]=!0,[])):[new Pt(tt.key,tg,"integer expected, found "+ty)]}}function en(tt){var ti=("property"===tt.expressionContext?Hr:Zr)(Vt(tt.value),tt.valueSpec);if("error"===ti.result)return ti.value.map(function(ti){return new Pt(""+tt.key+ti.key,tt.value,ti.message)});var ta=ti.value.expression||ti.value._styleExpression.expression;if("property"===tt.expressionContext&&"text-font"===tt.propertyKey&&!ta.outputDefined())return[new Pt(tt.key,tt.value,'Invalid data expression for "'+tt.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===tt.expressionContext&&"layout"===tt.propertyType&&!Oe(ta))return[new Pt(tt.key,tt.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===tt.expressionContext&&!Oe(ta))return[new Pt(tt.key,tt.value,'"feature-state" data expressions are not supported with filters.')];if(tt.expressionContext&&0===tt.expressionContext.indexOf("cluster")){if(!Re(ta,["zoom","feature-state"]))return[new Pt(tt.key,tt.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===tt.expressionContext&&!Le(ta))return[new Pt(tt.key,tt.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rn(tt){var ti=tt.key,ta=tt.value,tc=tt.valueSpec,th=[];return Array.isArray(tc.values)?-1===tc.values.indexOf(Tt(ta))&&th.push(new Pt(ti,ta,"expected one of ["+tc.values.join(", ")+"], "+JSON.stringify(ta)+" found")):-1===Object.keys(tc.values).indexOf(Tt(ta))&&th.push(new Pt(ti,ta,"expected one of ["+Object.keys(tc.values).join(", ")+"], "+JSON.stringify(ta)+" found")),th}function nn(tt){if(!0===tt||!1===tt)return!0;if(!Array.isArray(tt)||0===tt.length)return!1;switch(tt[0]){case"has":return tt.length>=2&&"$id"!==tt[1]&&"$type"!==tt[1];case"in":return tt.length>=3&&("string"!=typeof tt[1]||Array.isArray(tt[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==tt.length||Array.isArray(tt[1])||Array.isArray(tt[2]);case"any":case"all":for(var ti=0,ta=tt.slice(1);ti<ta.length;ti+=1){var tc=ta[ti];if(!nn(tc)&&"boolean"!=typeof tc)return!1}return!0;default:return!0}}Yr.deserialize=function(tt){return new Yr(tt._parameters,tt._specification)},Yr.serialize=function(tt){return{_parameters:tt._parameters,_specification:tt._specification}};var eE={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function on(tt){if(null==tt)return{filter:function(){return!0},needGeometry:!1};nn(tt)||(tt=un(tt));var ti=Zr(tt,eE);if("error"===ti.result)throw Error(ti.value.map(function(tt){return tt.key+": "+tt.message}).join(", "));return{filter:function(tt,ta,tc){return ti.value.evaluate(tt,ta,{},tc)},needGeometry:function t(tt){if(!Array.isArray(tt))return!1;if("within"===tt[0])return!0;for(var ti=1;ti<tt.length;ti++)if(t(tt[ti]))return!0;return!1}(tt)}}function sn(tt,ti){return tt<ti?-1:tt>ti?1:0}function un(tt){if(!tt)return!0;var ti=tt[0];return tt.length<=1?"any"!==ti:"=="===ti?ln(tt[1],tt[2],"=="):"!="===ti?hn(ln(tt[1],tt[2],"==")):"<"===ti||">"===ti||"<="===ti||">="===ti?ln(tt[1],tt[2],ti):"any"===ti?["any"].concat(tt.slice(1).map(un)):"all"===ti?["all"].concat(tt.slice(1).map(un)):"none"===ti?["all"].concat(tt.slice(1).map(un).map(hn)):"in"===ti?pn(tt[1],tt.slice(2)):"!in"===ti?hn(pn(tt[1],tt.slice(2))):"has"===ti?cn(tt[1]):"!has"===ti?hn(cn(tt[1])):"within"!==ti||tt}function ln(tt,ti,ta){switch(tt){case"$type":return["filter-type-"+ta,ti];case"$id":return["filter-id-"+ta,ti];default:return["filter-"+ta,tt,ti]}}function pn(tt,ti){if(0===ti.length)return!1;switch(tt){case"$type":return["filter-type-in",["literal",ti]];case"$id":return["filter-id-in",["literal",ti]];default:return ti.length>200&&!ti.some(function(tt){return typeof tt!=typeof ti[0]})?["filter-in-large",tt,["literal",ti.sort(sn)]]:["filter-in-small",tt,["literal",ti]]}}function cn(tt){switch(tt){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",tt]}}function hn(tt){return["!",tt]}function fn(tt){return nn(Vt(tt.value))?en(Bt({},tt,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(tt){var ti=tt.value,ta=tt.key;if("array"!==Dr(ti))return[new Pt(ta,ti,"array expected, "+Dr(ti)+" found")];var tc,th=tt.styleSpec,tf=[];if(ti.length<1)return[new Pt(ta,ti,"filter array must have at least 1 element")];switch(tf=tf.concat(rn({key:ta+"[0]",value:ti[0],valueSpec:th.filter_operator,style:tt.style,styleSpec:tt.styleSpec})),Tt(ti[0])){case"<":case"<=":case">":case">=":ti.length>=2&&"$type"===Tt(ti[1])&&tf.push(new Pt(ta,ti,'"$type" cannot be use with operator "'+ti[0]+'"'));case"==":case"!=":3!==ti.length&&tf.push(new Pt(ta,ti,'filter array for operator "'+ti[0]+'" must have 3 elements'));case"in":case"!in":ti.length>=2&&"string"!==(tc=Dr(ti[1]))&&tf.push(new Pt(ta+"[1]",ti[1],"string expected, "+tc+" found"));for(var td=2;td<ti.length;td++)tc=Dr(ti[td]),"$type"===Tt(ti[1])?tf=tf.concat(rn({key:ta+"["+td+"]",value:ti[td],valueSpec:th.geometry_type,style:tt.style,styleSpec:tt.styleSpec})):"string"!==tc&&"number"!==tc&&"boolean"!==tc&&tf.push(new Pt(ta+"["+td+"]",ti[td],"string, number, or boolean expected, "+tc+" found"));break;case"any":case"all":case"none":for(var tm=1;tm<ti.length;tm++)tf=tf.concat(t({key:ta+"["+tm+"]",value:ti[tm],style:tt.style,styleSpec:tt.styleSpec}));break;case"has":case"!has":tc=Dr(ti[1]),2!==ti.length?tf.push(new Pt(ta,ti,'filter array for "'+ti[0]+'" operator must have 2 elements')):"string"!==tc&&tf.push(new Pt(ta+"[1]",ti[1],"string expected, "+tc+" found"));break;case"within":tc=Dr(ti[1]),2!==ti.length?tf.push(new Pt(ta,ti,'filter array for "'+ti[0]+'" operator must have 2 elements')):"object"!==tc&&tf.push(new Pt(ta+"[1]",ti[1],"object expected, "+tc+" found"))}return tf}(tt)}function yn(tt,ti){var ta=tt.key,tc=tt.style,th=tt.styleSpec,tf=tt.value,td=tt.objectKey,tm=th[ti+"_"+tt.layerType];if(!tm)return[];var ty=td.match(/^(.*)-transition$/);if("paint"===ti&&ty&&tm[ty[1]]&&tm[ty[1]].transition)return An({key:ta,value:tf,valueSpec:th.transition,style:tc,styleSpec:th});var tg,t_=tt.valueSpec||tm[td];if(!t_)return[new Pt(ta,tf,'unknown property "'+td+'"')];if("string"===Dr(tf)&&Tr(t_)&&!t_.tokens&&(tg=/^{([^}]+)}$/.exec(tf)))return[new Pt(ta,tf,'"'+td+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(tg[1])+" }`.")];var tv=[];return"symbol"===tt.layerType&&("text-field"===td&&tc&&!tc.glyphs&&tv.push(new Pt(ta,tf,'use of "text-field" requires a style "glyphs" property')),"text-font"===td&&Lr(Vt(tf))&&"identity"===Tt(tf.type)&&tv.push(new Pt(ta,tf,'"text-font" does not support identity functions'))),tv.concat(An({key:tt.key,value:tf,valueSpec:t_,style:tc,styleSpec:th,expressionContext:"property",propertyType:ti,propertyKey:td}))}function dn(tt){return yn(tt,"paint")}function mn(tt){return yn(tt,"layout")}function vn(tt){var ti=[],ta=tt.value,tc=tt.key,th=tt.style,tf=tt.styleSpec;ta.type||ta.ref||ti.push(new Pt(tc,ta,'either "type" or "ref" is required'));var td,tm=Tt(ta.type),ty=Tt(ta.ref);if(ta.id)for(var tg=Tt(ta.id),t_=0;t_<tt.arrayIndex;t_++){var tv=th.layers[t_];Tt(tv.id)===tg&&ti.push(new Pt(tc,ta.id,'duplicate layer id "'+ta.id+'", previously used at line '+tv.id.__line__))}if("ref"in ta)["type","source","source-layer","filter","layout"].forEach(function(tt){tt in ta&&ti.push(new Pt(tc,ta[tt],'"'+tt+'" is prohibited for ref layers'))}),th.layers.forEach(function(tt){Tt(tt.id)===ty&&(td=tt)}),td?td.ref?ti.push(new Pt(tc,ta.ref,"ref cannot reference another ref layer")):tm=Tt(td.type):ti.push(new Pt(tc,ta.ref,'ref layer "'+ty+'" not found'));else if("background"!==tm){if(ta.source){var tx=th.sources&&th.sources[ta.source],tb=tx&&Tt(tx.type);tx?"vector"===tb&&"raster"===tm?ti.push(new Pt(tc,ta.source,'layer "'+ta.id+'" requires a raster source')):"raster"===tb&&"raster"!==tm?ti.push(new Pt(tc,ta.source,'layer "'+ta.id+'" requires a vector source')):"vector"!==tb||ta["source-layer"]?"raster-dem"===tb&&"hillshade"!==tm?ti.push(new Pt(tc,ta.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===tm&&ta.paint&&ta.paint["line-gradient"]&&("geojson"!==tb||!tx.lineMetrics)&&ti.push(new Pt(tc,ta,'layer "'+ta.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):ti.push(new Pt(tc,ta,'layer "'+ta.id+'" must specify a "source-layer"')):ti.push(new Pt(tc,ta.source,'source "'+ta.source+'" not found'))}else ti.push(new Pt(tc,ta,'missing required property "source"'))}return ti=ti.concat($r({key:tc,value:ta,valueSpec:tf.layer,style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return An({key:tc+".type",value:ta.type,valueSpec:tf.layer.type,style:tt.style,styleSpec:tt.styleSpec,object:ta,objectKey:"type"})},filter:fn,layout:function(tt){return $r({layer:ta,key:tt.key,value:tt.value,style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{"*":function(tt){return mn(Bt({layerType:tm},tt))}}})},paint:function(tt){return $r({layer:ta,key:tt.key,value:tt.value,style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{"*":function(tt){return dn(Bt({layerType:tm},tt))}}})}}}))}function gn(tt){var ti=tt.value,ta=tt.key,tc=Dr(ti);return"string"!==tc?[new Pt(ta,ti,"string expected, "+tc+" found")]:[]}var eA={promoteId:function(tt){var ti=tt.key,ta=tt.value;if("string"===Dr(ta))return gn({key:ti,value:ta});var tc=[];for(var th in ta)tc.push.apply(tc,gn({key:ti+"."+th,value:ta[th]}));return tc}};function bn(tt){var ti=tt.value,ta=tt.key,tc=tt.styleSpec,th=tt.style;if(!ti.type)return[new Pt(ta,ti,'"type" is required')];var tf,td=Tt(ti.type);switch(td){case"vector":case"raster":case"raster-dem":return $r({key:ta,value:ti,valueSpec:tc["source_"+td.replace("-","_")],style:tt.style,styleSpec:tc,objectElementValidators:eA});case"geojson":if(tf=$r({key:ta,value:ti,valueSpec:tc.source_geojson,style:th,styleSpec:tc,objectElementValidators:eA}),ti.cluster)for(var tm in ti.clusterProperties){var ty=ti.clusterProperties[tm],tg=ty[0],t_="string"==typeof tg?[tg,["accumulated"],["get",tm]]:tg;tf.push.apply(tf,en({key:ta+"."+tm+".map",value:ty[1],expressionContext:"cluster-map"})),tf.push.apply(tf,en({key:ta+"."+tm+".reduce",value:t_,expressionContext:"cluster-reduce"}))}return tf;case"video":return $r({key:ta,value:ti,valueSpec:tc.source_video,style:th,styleSpec:tc});case"image":return $r({key:ta,value:ti,valueSpec:tc.source_image,style:th,styleSpec:tc});case"canvas":return[new Pt(ta,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rn({key:ta+".type",value:ti.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:th,styleSpec:tc})}}function wn(tt){var ti=tt.value,ta=tt.styleSpec,tc=ta.light,th=tt.style,tf=[],td=Dr(ti);if(void 0===ti)return tf;if("object"!==td)return tf.concat([new Pt("light",ti,"object expected, "+td+" found")]);for(var tm in ti){var ty=tm.match(/^(.*)-transition$/);tf=tf.concat(ty&&tc[ty[1]]&&tc[ty[1]].transition?An({key:tm,value:ti[tm],valueSpec:ta.transition,style:th,styleSpec:ta}):tc[tm]?An({key:tm,value:ti[tm],valueSpec:tc[tm],style:th,styleSpec:ta}):[new Pt(tm,ti[tm],'unknown property "'+tm+'"')])}return tf}var eP={"*":function(){return[]},array:Wr,boolean:function(tt){var ti=tt.value,ta=tt.key,tc=Dr(ti);return"boolean"!==tc?[new Pt(ta,ti,"boolean expected, "+tc+" found")]:[]},number:Qr,color:function(tt){var ti=tt.key,ta=tt.value,tc=Dr(ta);return"string"!==tc?[new Pt(ti,ta,"color expected, "+tc+" found")]:null===t7(ta)?[new Pt(ti,ta,'color expected, "'+ta+'" found')]:[]},constants:Mt,enum:rn,filter:fn,function:tn,layer:vn,object:$r,source:bn,light:wn,string:gn,formatted:function(tt){return 0===gn(tt).length?[]:en(tt)},resolvedImage:function(tt){return 0===gn(tt).length?[]:en(tt)}};function An(tt){var ti=tt.value,ta=tt.valueSpec,tc=tt.styleSpec;return ta.expression&&Lr(Tt(ti))?tn(tt):ta.expression&&Gr(Vt(ti))?en(tt):ta.type&&eP[ta.type]?eP[ta.type](tt):$r(Bt({},tt,{valueSpec:ta.type?tc[ta.type]:ta}))}function Sn(tt){var ti=tt.value,ta=tt.key,tc=gn(tt);return tc.length||(-1===ti.indexOf("{fontstack}")&&tc.push(new Pt(ta,ti,'"glyphs" url must include a "{fontstack}" token')),-1===ti.indexOf("{range}")&&tc.push(new Pt(ta,ti,'"glyphs" url must include a "{range}" token'))),tc}function kn(tt,ti){void 0===ti&&(ti=tY);var ta=[];return ta=ta.concat(An({key:"",value:tt,valueSpec:ti.$root,styleSpec:ti,style:tt,objectElementValidators:{glyphs:Sn,"*":function(){return[]}}})),tt.constants&&(ta=ta.concat(Mt({key:"constants",value:tt.constants,style:tt,styleSpec:ti}))),In(ta)}function In(tt){return[].concat(tt).sort(function(tt,ti){return tt.line-ti.line})}function zn(tt){return function(){for(var ti=[],ta=arguments.length;ta--;)ti[ta]=arguments[ta];return In(tt.apply(this,ti))}}kn.source=zn(bn),kn.light=zn(wn),kn.layer=zn(vn),kn.filter=zn(fn),kn.paintProperty=zn(dn),kn.layoutProperty=zn(mn);var ez=kn,eC=ez.light,ek=ez.paintProperty,eM=ez.layoutProperty;function Bn(tt,ti){var ta=!1;if(ti&&ti.length)for(var tc=0;tc<ti.length;tc+=1)tt.fire(new tJ(Error(ti[tc].message))),ta=!0;return ta}var eD=Vn;function Vn(tt,ti,ta){var tc=this.cells=[];if(tt instanceof ArrayBuffer){this.arrayBuffer=tt;var th=new Int32Array(this.arrayBuffer);tt=th[0],this.d=(ti=th[1])+2*(ta=th[2]);for(var tf=0;tf<this.d*this.d;tf++){var td=th[3+tf],tm=th[3+tf+1];tc.push(td===tm?null:th.subarray(td,tm))}var ty=th[3+tc.length+1];this.keys=th.subarray(th[3+tc.length],ty),this.bboxes=th.subarray(ty),this.insert=this._insertReadonly}else{this.d=ti+2*ta;for(var tg=0;tg<this.d*this.d;tg++)tc.push([]);this.keys=[],this.bboxes=[]}this.n=ti,this.extent=tt,this.padding=ta,this.scale=ti/tt,this.uid=0;var t_=ta/ti*tt;this.min=-t_,this.max=tt+t_}Vn.prototype.insert=function(tt,ti,ta,tc,th){this._forEachCell(ti,ta,tc,th,this._insertCell,this.uid++),this.keys.push(tt),this.bboxes.push(ti),this.bboxes.push(ta),this.bboxes.push(tc),this.bboxes.push(th)},Vn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Vn.prototype._insertCell=function(tt,ti,ta,tc,th,tf){this.cells[th].push(tf)},Vn.prototype.query=function(tt,ti,ta,tc,th){var tf=this.min,td=this.max;if(tt<=tf&&ti<=tf&&td<=ta&&td<=tc&&!th)return Array.prototype.slice.call(this.keys);var tm=[];return this._forEachCell(tt,ti,ta,tc,this._queryCell,tm,{},th),tm},Vn.prototype._queryCell=function(tt,ti,ta,tc,th,tf,td,tm){var ty=this.cells[th];if(null!==ty)for(var tg=this.keys,t_=this.bboxes,tv=0;tv<ty.length;tv++){var tx=ty[tv];if(void 0===td[tx]){var tb=4*tx;(tm?tm(t_[tb+0],t_[tb+1],t_[tb+2],t_[tb+3]):tt<=t_[tb+2]&&ti<=t_[tb+3]&&ta>=t_[tb+0]&&tc>=t_[tb+1])?(td[tx]=!0,tf.push(tg[tx])):td[tx]=!1}}},Vn.prototype._forEachCell=function(tt,ti,ta,tc,th,tf,td,tm){for(var ty=this._convertToCellCoord(tt),tg=this._convertToCellCoord(ti),t_=this._convertToCellCoord(ta),tv=this._convertToCellCoord(tc),tx=ty;tx<=t_;tx++)for(var tb=tg;tb<=tv;tb++){var tw=this.d*tb+tx;if((!tm||tm(this._convertFromCellCoord(tx),this._convertFromCellCoord(tb),this._convertFromCellCoord(tx+1),this._convertFromCellCoord(tb+1)))&&th.call(this,tt,ti,ta,tc,tw,tf,td,tm))return}},Vn.prototype._convertFromCellCoord=function(tt){return(tt-this.padding)/this.scale},Vn.prototype._convertToCellCoord=function(tt){return Math.max(0,Math.min(this.d-1,Math.floor(tt*this.scale)+this.padding))},Vn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var tt=this.cells,ti=3+this.cells.length+1+1,ta=0,tc=0;tc<this.cells.length;tc++)ta+=this.cells[tc].length;var th=new Int32Array(ti+ta+this.keys.length+this.bboxes.length);th[0]=this.extent,th[1]=this.n,th[2]=this.padding;for(var tf=ti,td=0;td<tt.length;td++){var tm=tt[td];th[3+td]=tf,th.set(tm,tf),tf+=tm.length}return th[3+tt.length]=tf,th.set(this.keys,tf),th[3+tt.length+1]=tf+=this.keys.length,th.set(this.bboxes,tf),tf+=this.bboxes.length,th.buffer};var eL=tf.ImageData,eB=tf.ImageBitmap,eR={};function On(tt,ti,ta){void 0===ta&&(ta={}),Object.defineProperty(ti,"_classRegistryKey",{value:tt,writeable:!1}),eR[tt]={klass:ti,omit:ta.omit||[],shallow:ta.shallow||[]}}for(var eO in On("Object",Object),eD.serialize=function(tt,ti){var ta=tt.toArrayBuffer();return ti&&ti.push(ta),{buffer:ta}},eD.deserialize=function(tt){return new eD(tt.buffer)},On("Grid",eD),On("Color",te),On("Error",Error),On("ResolvedImage",ie),On("StylePropertyFunction",Yr),On("StyleExpression",Kr,{omit:["_evaluator"]}),On("ZoomDependentExpression",Jr),On("ZoomConstantExpression",Xr),On("CompoundExpression",xe,{omit:["_evaluate"]}),eI)eI[eO]._classRegistryKey||On("Expression_"+eO,eI[eO]);function Un(tt){return tt&&"undefined"!=typeof ArrayBuffer&&(tt instanceof ArrayBuffer||tt.constructor&&"ArrayBuffer"===tt.constructor.name)}function jn(tt){return eB&&tt instanceof eB}function qn(tt,ti){if(null==tt||"boolean"==typeof tt||"number"==typeof tt||"string"==typeof tt||tt instanceof Boolean||tt instanceof Number||tt instanceof String||tt instanceof Date||tt instanceof RegExp)return tt;if(Un(tt)||jn(tt))return ti&&ti.push(tt),tt;if(ArrayBuffer.isView(tt))return ti&&ti.push(tt.buffer),tt;if(tt instanceof eL)return ti&&ti.push(tt.data.buffer),tt;if(Array.isArray(tt)){for(var ta=[],tc=0;tc<tt.length;tc+=1)ta.push(qn(tt[tc],ti));return ta}if("object"==typeof tt){var th=tt.constructor,tf=th._classRegistryKey;if(!tf)throw Error("can't serialize object of unregistered class");var td=th.serialize?th.serialize(tt,ti):{};if(!th.serialize){for(var tm in tt)if(tt.hasOwnProperty(tm)&&!(eR[tf].omit.indexOf(tm)>=0)){var ty=tt[tm];td[tm]=eR[tf].shallow.indexOf(tm)>=0?ty:qn(ty,ti)}tt instanceof Error&&(td.message=tt.message)}if(td.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==tf&&(td.$name=tf),td}throw Error("can't serialize object of type "+typeof tt)}function Nn(tt){if(null==tt||"boolean"==typeof tt||"number"==typeof tt||"string"==typeof tt||tt instanceof Boolean||tt instanceof Number||tt instanceof String||tt instanceof Date||tt instanceof RegExp||Un(tt)||jn(tt)||ArrayBuffer.isView(tt)||tt instanceof eL)return tt;if(Array.isArray(tt))return tt.map(Nn);if("object"==typeof tt){var ti=tt.$name||"Object",ta=eR[ti].klass;if(!ta)throw Error("can't deserialize unregistered class "+ti);if(ta.deserialize)return ta.deserialize(tt);for(var tc=Object.create(ta.prototype),th=0,tf=Object.keys(tt);th<tf.length;th+=1){var td=tf[th];if("$name"!==td){var tm=tt[td];tc[td]=eR[ti].shallow.indexOf(td)>=0?tm:Nn(tm)}}return tc}throw Error("can't deserialize object of type "+typeof tt)}var Kn=function(){this.first=!0};Kn.prototype.update=function(tt,ti){var ta=Math.floor(tt);return this.first?(this.first=!1,this.lastIntegerZoom=ta,this.lastIntegerZoomTime=0,this.lastZoom=tt,this.lastFloorZoom=ta,!0):(this.lastFloorZoom>ta?(this.lastIntegerZoom=ta+1,this.lastIntegerZoomTime=ti):this.lastFloorZoom<ta&&(this.lastIntegerZoom=ta,this.lastIntegerZoomTime=ti),tt!==this.lastZoom&&(this.lastZoom=tt,this.lastFloorZoom=ta,!0))};var eF={"Latin-1 Supplement":function(tt){return tt>=128&&tt<=255},Arabic:function(tt){return tt>=1536&&tt<=1791},"Arabic Supplement":function(tt){return tt>=1872&&tt<=1919},"Arabic Extended-A":function(tt){return tt>=2208&&tt<=2303},"Hangul Jamo":function(tt){return tt>=4352&&tt<=4607},"Unified Canadian Aboriginal Syllabics":function(tt){return tt>=5120&&tt<=5759},Khmer:function(tt){return tt>=6016&&tt<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(tt){return tt>=6320&&tt<=6399},"General Punctuation":function(tt){return tt>=8192&&tt<=8303},"Letterlike Symbols":function(tt){return tt>=8448&&tt<=8527},"Number Forms":function(tt){return tt>=8528&&tt<=8591},"Miscellaneous Technical":function(tt){return tt>=8960&&tt<=9215},"Control Pictures":function(tt){return tt>=9216&&tt<=9279},"Optical Character Recognition":function(tt){return tt>=9280&&tt<=9311},"Enclosed Alphanumerics":function(tt){return tt>=9312&&tt<=9471},"Geometric Shapes":function(tt){return tt>=9632&&tt<=9727},"Miscellaneous Symbols":function(tt){return tt>=9728&&tt<=9983},"Miscellaneous Symbols and Arrows":function(tt){return tt>=11008&&tt<=11263},"CJK Radicals Supplement":function(tt){return tt>=11904&&tt<=12031},"Kangxi Radicals":function(tt){return tt>=12032&&tt<=12255},"Ideographic Description Characters":function(tt){return tt>=12272&&tt<=12287},"CJK Symbols and Punctuation":function(tt){return tt>=12288&&tt<=12351},Hiragana:function(tt){return tt>=12352&&tt<=12447},Katakana:function(tt){return tt>=12448&&tt<=12543},Bopomofo:function(tt){return tt>=12544&&tt<=12591},"Hangul Compatibility Jamo":function(tt){return tt>=12592&&tt<=12687},Kanbun:function(tt){return tt>=12688&&tt<=12703},"Bopomofo Extended":function(tt){return tt>=12704&&tt<=12735},"CJK Strokes":function(tt){return tt>=12736&&tt<=12783},"Katakana Phonetic Extensions":function(tt){return tt>=12784&&tt<=12799},"Enclosed CJK Letters and Months":function(tt){return tt>=12800&&tt<=13055},"CJK Compatibility":function(tt){return tt>=13056&&tt<=13311},"CJK Unified Ideographs Extension A":function(tt){return tt>=13312&&tt<=19903},"Yijing Hexagram Symbols":function(tt){return tt>=19904&&tt<=19967},"CJK Unified Ideographs":function(tt){return tt>=19968&&tt<=40959},"Yi Syllables":function(tt){return tt>=40960&&tt<=42127},"Yi Radicals":function(tt){return tt>=42128&&tt<=42191},"Hangul Jamo Extended-A":function(tt){return tt>=43360&&tt<=43391},"Hangul Syllables":function(tt){return tt>=44032&&tt<=55215},"Hangul Jamo Extended-B":function(tt){return tt>=55216&&tt<=55295},"Private Use Area":function(tt){return tt>=57344&&tt<=63743},"CJK Compatibility Ideographs":function(tt){return tt>=63744&&tt<=64255},"Arabic Presentation Forms-A":function(tt){return tt>=64336&&tt<=65023},"Vertical Forms":function(tt){return tt>=65040&&tt<=65055},"CJK Compatibility Forms":function(tt){return tt>=65072&&tt<=65103},"Small Form Variants":function(tt){return tt>=65104&&tt<=65135},"Arabic Presentation Forms-B":function(tt){return tt>=65136&&tt<=65279},"Halfwidth and Fullwidth Forms":function(tt){return tt>=65280&&tt<=65519}};function Zn(tt){for(var ti=0;ti<tt.length;ti+=1)if(Xn(tt[ti].charCodeAt(0)))return!0;return!1}function Xn(tt){return!(746!==tt&&747!==tt&&(tt<4352||!(eF["Bopomofo Extended"](tt)||eF.Bopomofo(tt)||eF["CJK Compatibility Forms"](tt)&&!(tt>=65097&&tt<=65103)||eF["CJK Compatibility Ideographs"](tt)||eF["CJK Compatibility"](tt)||eF["CJK Radicals Supplement"](tt)||eF["CJK Strokes"](tt)||!(!eF["CJK Symbols and Punctuation"](tt)||tt>=12296&&tt<=12305||tt>=12308&&tt<=12319||12336===tt)||eF["CJK Unified Ideographs Extension A"](tt)||eF["CJK Unified Ideographs"](tt)||eF["Enclosed CJK Letters and Months"](tt)||eF["Hangul Compatibility Jamo"](tt)||eF["Hangul Jamo Extended-A"](tt)||eF["Hangul Jamo Extended-B"](tt)||eF["Hangul Jamo"](tt)||eF["Hangul Syllables"](tt)||eF.Hiragana(tt)||eF["Ideographic Description Characters"](tt)||eF.Kanbun(tt)||eF["Kangxi Radicals"](tt)||eF["Katakana Phonetic Extensions"](tt)||eF.Katakana(tt)&&12540!==tt||!(!eF["Halfwidth and Fullwidth Forms"](tt)||65288===tt||65289===tt||65293===tt||tt>=65306&&tt<=65310||65339===tt||65341===tt||65343===tt||tt>=65371&&tt<=65503||65507===tt||tt>=65512&&tt<=65519)||!(!eF["Small Form Variants"](tt)||tt>=65112&&tt<=65118||tt>=65123&&tt<=65126)||eF["Unified Canadian Aboriginal Syllabics"](tt)||eF["Unified Canadian Aboriginal Syllabics Extended"](tt)||eF["Vertical Forms"](tt)||eF["Yijing Hexagram Symbols"](tt)||eF["Yi Syllables"](tt)||eF["Yi Radicals"](tt))))}function Jn(tt){return!(Xn(tt)||eF["Latin-1 Supplement"](tt)&&(167===tt||169===tt||174===tt||177===tt||188===tt||189===tt||190===tt||215===tt||247===tt)||eF["General Punctuation"](tt)&&(8214===tt||8224===tt||8225===tt||8240===tt||8241===tt||8251===tt||8252===tt||8258===tt||8263===tt||8264===tt||8265===tt||8273===tt)||eF["Letterlike Symbols"](tt)||eF["Number Forms"](tt)||eF["Miscellaneous Technical"](tt)&&(tt>=8960&&tt<=8967||tt>=8972&&tt<=8991||tt>=8996&&tt<=9e3||9003===tt||tt>=9085&&tt<=9114||tt>=9150&&tt<=9165||9167===tt||tt>=9169&&tt<=9179||tt>=9186&&tt<=9215)||eF["Control Pictures"](tt)&&9251!==tt||eF["Optical Character Recognition"](tt)||eF["Enclosed Alphanumerics"](tt)||eF["Geometric Shapes"](tt)||eF["Miscellaneous Symbols"](tt)&&!(tt>=9754&&tt<=9759)||eF["Miscellaneous Symbols and Arrows"](tt)&&(tt>=11026&&tt<=11055||tt>=11088&&tt<=11097||tt>=11192&&tt<=11243)||eF["CJK Symbols and Punctuation"](tt)||eF.Katakana(tt)||eF["Private Use Area"](tt)||eF["CJK Compatibility Forms"](tt)||eF["Small Form Variants"](tt)||eF["Halfwidth and Fullwidth Forms"](tt)||8734===tt||8756===tt||8757===tt||tt>=9984&&tt<=10087||tt>=10102&&tt<=10131||65532===tt||65533===tt)}function Hn(tt){return tt>=1424&&tt<=2303||eF["Arabic Presentation Forms-A"](tt)||eF["Arabic Presentation Forms-B"](tt)}function Yn(tt,ti){return!(!ti&&Hn(tt)||tt>=2304&&tt<=3583||tt>=3840&&tt<=4255||eF.Khmer(tt))}function $n(tt){for(var ti=0;ti<tt.length;ti+=1)if(Hn(tt[ti].charCodeAt(0)))return!0;return!1}var eU=null,eV="unavailable",eN=null,ei=function(tt){tt&&"string"==typeof tt&&tt.indexOf("NetworkError")>-1&&(eV="error"),eU&&eU(tt)};function ri(){ej.fire(new It("pluginStateChange",{pluginStatus:eV,pluginURL:eN}))}var ej=new Ct,ii=function(){return eV},ai=function(){if("deferred"!==eV||!eN)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");eV="loading",ri(),eN&&bt({url:eN},function(tt){tt?ei(tt):(eV="loaded",ri())})},eq={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===eV||null!=eq.applyArabicShaping},isLoading:function(){return"loading"===eV},setState:function(tt){eV=tt.pluginStatus,eN=tt.pluginURL},isParsed:function(){return null!=eq.applyArabicShaping&&null!=eq.processBidirectionalText&&null!=eq.processStyledBidirectionalText},getPluginURL:function(){return eN}},si=function(tt,ti){this.zoom=tt,ti?(this.now=ti.now,this.fadeDuration=ti.fadeDuration,this.zoomHistory=ti.zoomHistory,this.transition=ti.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kn,this.transition={})};si.prototype.isSupportedScript=function(tt){return function(tt,ti){for(var ta=0;ta<tt.length;ta+=1)if(!Yn(tt[ta].charCodeAt(0),ti))return!1;return!0}(tt,eq.isLoaded())},si.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},si.prototype.getCrossfadeParameters=function(){var tt=this.zoom,ti=tt-Math.floor(tt),ta=this.crossFadingFactor();return tt>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:ti+(1-ti)*ta}:{fromScale:.5,toScale:1,t:1-(1-ta)*ti}};var ui=function(tt,ti){this.property=tt,this.value=ti,this.expression=function(tt,ti){if(Lr(tt))return new Yr(tt,ti);if(Gr(tt)){var ta=Hr(tt,ti);if("error"===ta.result)throw Error(ta.value.map(function(tt){return tt.key+": "+tt.message}).join(", "));return ta.value}var tc=tt;return"string"==typeof tt&&"color"===ti.type&&(tc=te.parse(tt)),{kind:"constant",evaluate:function(){return tc}}}(void 0===ti?tt.specification.default:ti,tt.specification)};ui.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ui.prototype.possiblyEvaluate=function(tt,ti,ta){return this.property.possiblyEvaluate(this,tt,ti,ta)};var li=function(tt){this.property=tt,this.value=new ui(tt,void 0)};li.prototype.transitioned=function(tt,ti){return new ci(this.property,this.value,ti,h({},tt.transition,this.transition),tt.now)},li.prototype.untransitioned=function(){return new ci(this.property,this.value,null,{},0)};var pi=function(tt){this._properties=tt,this._values=Object.create(tt.defaultTransitionablePropertyValues)};pi.prototype.getValue=function(tt){return w(this._values[tt].value.value)},pi.prototype.setValue=function(tt,ti){this._values.hasOwnProperty(tt)||(this._values[tt]=new li(this._values[tt].property)),this._values[tt].value=new ui(this._values[tt].property,null===ti?void 0:w(ti))},pi.prototype.getTransition=function(tt){return w(this._values[tt].transition)},pi.prototype.setTransition=function(tt,ti){this._values.hasOwnProperty(tt)||(this._values[tt]=new li(this._values[tt].property)),this._values[tt].transition=w(ti)||void 0},pi.prototype.serialize=function(){for(var tt={},ti=0,ta=Object.keys(this._values);ti<ta.length;ti+=1){var tc=ta[ti],th=this.getValue(tc);void 0!==th&&(tt[tc]=th);var tf=this.getTransition(tc);void 0!==tf&&(tt[tc+"-transition"]=tf)}return tt},pi.prototype.transitioned=function(tt,ti){for(var ta=new hi(this._properties),tc=0,th=Object.keys(this._values);tc<th.length;tc+=1){var tf=th[tc];ta._values[tf]=this._values[tf].transitioned(tt,ti._values[tf])}return ta},pi.prototype.untransitioned=function(){for(var tt=new hi(this._properties),ti=0,ta=Object.keys(this._values);ti<ta.length;ti+=1){var tc=ta[ti];tt._values[tc]=this._values[tc].untransitioned()}return tt};var ci=function(tt,ti,ta,tc,th){this.property=tt,this.value=ti,this.begin=th+tc.delay||0,this.end=this.begin+tc.duration||0,tt.specification.transition&&(tc.delay||tc.duration)&&(this.prior=ta)};ci.prototype.possiblyEvaluate=function(tt,ti,ta){var tc=tt.now||0,th=this.value.possiblyEvaluate(tt,ti,ta),tf=this.prior;if(tf){if(tc>this.end||this.value.isDataDriven())return this.prior=null,th;if(tc<this.begin)return tf.possiblyEvaluate(tt,ti,ta);var td=(tc-this.begin)/(this.end-this.begin);return this.property.interpolate(tf.possiblyEvaluate(tt,ti,ta),th,function(tt){if(tt<=0)return 0;if(tt>=1)return 1;var ti=tt*tt,ta=ti*tt;return 4*(tt<.5?ta:3*(tt-ti)+ta-.75)}(td))}return th};var hi=function(tt){this._properties=tt,this._values=Object.create(tt.defaultTransitioningPropertyValues)};hi.prototype.possiblyEvaluate=function(tt,ti,ta){for(var tc=new di(this._properties),th=0,tf=Object.keys(this._values);th<tf.length;th+=1){var td=tf[th];tc._values[td]=this._values[td].possiblyEvaluate(tt,ti,ta)}return tc},hi.prototype.hasTransition=function(){for(var tt=0,ti=Object.keys(this._values);tt<ti.length;tt+=1)if(this._values[ti[tt]].prior)return!0;return!1};var fi=function(tt){this._properties=tt,this._values=Object.create(tt.defaultPropertyValues)};fi.prototype.getValue=function(tt){return w(this._values[tt].value)},fi.prototype.setValue=function(tt,ti){this._values[tt]=new ui(this._values[tt].property,null===ti?void 0:w(ti))},fi.prototype.serialize=function(){for(var tt={},ti=0,ta=Object.keys(this._values);ti<ta.length;ti+=1){var tc=ta[ti],th=this.getValue(tc);void 0!==th&&(tt[tc]=th)}return tt},fi.prototype.possiblyEvaluate=function(tt,ti,ta){for(var tc=new di(this._properties),th=0,tf=Object.keys(this._values);th<tf.length;th+=1){var td=tf[th];tc._values[td]=this._values[td].possiblyEvaluate(tt,ti,ta)}return tc};var yi=function(tt,ti,ta){this.property=tt,this.value=ti,this.parameters=ta};yi.prototype.isConstant=function(){return"constant"===this.value.kind},yi.prototype.constantOr=function(tt){return"constant"===this.value.kind?this.value.value:tt},yi.prototype.evaluate=function(tt,ti,ta,tc){return this.property.evaluate(this.value,this.parameters,tt,ti,ta,tc)};var di=function(tt){this._properties=tt,this._values=Object.create(tt.defaultPossiblyEvaluatedValues)};di.prototype.get=function(tt){return this._values[tt]};var mi=function(tt){this.specification=tt};mi.prototype.possiblyEvaluate=function(tt,ti){return tt.expression.evaluate(ti)},mi.prototype.interpolate=function(tt,ti,ta){var tc=eh[this.specification.type];return tc?tc(tt,ti,ta):tt};var vi=function(tt,ti){this.specification=tt,this.overrides=ti};vi.prototype.possiblyEvaluate=function(tt,ti,ta,tc){return new yi(this,"constant"===tt.expression.kind||"camera"===tt.expression.kind?{kind:"constant",value:tt.expression.evaluate(ti,null,{},ta,tc)}:tt.expression,ti)},vi.prototype.interpolate=function(tt,ti,ta){if("constant"!==tt.value.kind||"constant"!==ti.value.kind)return tt;if(void 0===tt.value.value||void 0===ti.value.value)return new yi(this,{kind:"constant",value:void 0},tt.parameters);var tc=eh[this.specification.type];return tc?new yi(this,{kind:"constant",value:tc(tt.value.value,ti.value.value,ta)},tt.parameters):tt},vi.prototype.evaluate=function(tt,ti,ta,tc,th,tf){return"constant"===tt.kind?tt.value:tt.evaluate(ti,ta,tc,th,tf)};var eZ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(tt,ti,ta,tc){if(void 0===tt.value)return new yi(this,{kind:"constant",value:void 0},ti);if("constant"===tt.expression.kind){var th=tt.expression.evaluate(ti,null,{},ta,tc),tf="resolvedImage"===tt.property.specification.type&&"string"!=typeof th?th.name:th;return new yi(this,{kind:"constant",value:this._calculate(tf,tf,tf,ti)},ti)}return"camera"===tt.expression.kind?new yi(this,{kind:"constant",value:this._calculate(tt.expression.evaluate({zoom:ti.zoom-1}),tt.expression.evaluate({zoom:ti.zoom}),tt.expression.evaluate({zoom:ti.zoom+1}),ti)},ti):new yi(this,tt.expression,ti)},e.prototype.evaluate=function(tt,ti,ta,tc,th,tf){if("source"===tt.kind){var td=tt.evaluate(ti,ta,tc,th,tf);return this._calculate(td,td,td,ti)}return"composite"===tt.kind?this._calculate(tt.evaluate({zoom:Math.floor(ti.zoom)-1},ta,tc),tt.evaluate({zoom:Math.floor(ti.zoom)},ta,tc),tt.evaluate({zoom:Math.floor(ti.zoom)+1},ta,tc),ti):tt.value},e.prototype._calculate=function(tt,ti,ta,tc){return tc.zoom>tc.zoomHistory.lastIntegerZoom?{from:tt,to:ti}:{from:ta,to:ti}},e.prototype.interpolate=function(tt){return tt},e}(vi),xi=function(tt){this.specification=tt};xi.prototype.possiblyEvaluate=function(tt,ti,ta,tc){if(void 0!==tt.value){if("constant"===tt.expression.kind){var th=tt.expression.evaluate(ti,null,{},ta,tc);return this._calculate(th,th,th,ti)}return this._calculate(tt.expression.evaluate(new si(Math.floor(ti.zoom-1),ti)),tt.expression.evaluate(new si(Math.floor(ti.zoom),ti)),tt.expression.evaluate(new si(Math.floor(ti.zoom+1),ti)),ti)}},xi.prototype._calculate=function(tt,ti,ta,tc){return tc.zoom>tc.zoomHistory.lastIntegerZoom?{from:tt,to:ti}:{from:ta,to:ti}},xi.prototype.interpolate=function(tt){return tt};var bi=function(tt){this.specification=tt};bi.prototype.possiblyEvaluate=function(tt,ti,ta,tc){return!!tt.expression.evaluate(ti,null,{},ta,tc)},bi.prototype.interpolate=function(){return!1};var wi=function(tt){for(var ti in this.properties=tt,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],tt){var ta=tt[ti];ta.specification.overridable&&this.overridableProperties.push(ti);var tc=this.defaultPropertyValues[ti]=new ui(ta,void 0),th=this.defaultTransitionablePropertyValues[ti]=new li(ta);this.defaultTransitioningPropertyValues[ti]=th.untransitioned(),this.defaultPossiblyEvaluatedValues[ti]=tc.possiblyEvaluate({})}};On("DataDrivenProperty",vi),On("DataConstantProperty",mi),On("CrossFadedDataDrivenProperty",eZ),On("CrossFadedProperty",xi),On("ColorRampProperty",bi);var eG=function(tt){function e(ti,ta){if(tt.call(this),this.id=ti.id,this.type=ti.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==ti.type&&(this.metadata=ti.metadata,this.minzoom=ti.minzoom,this.maxzoom=ti.maxzoom,"background"!==ti.type&&(this.source=ti.source,this.sourceLayer=ti["source-layer"],this.filter=ti.filter),ta.layout&&(this._unevaluatedLayout=new fi(ta.layout)),ta.paint)){for(var tc in this._transitionablePaint=new pi(ta.paint),ti.paint)this.setPaintProperty(tc,ti.paint[tc],{validate:!1});for(var th in ti.layout)this.setLayoutProperty(th,ti.layout[th],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new di(ta.paint)}}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(tt){return"visibility"===tt?this.visibility:this._unevaluatedLayout.getValue(tt)},e.prototype.setLayoutProperty=function(tt,ti,ta){void 0===ta&&(ta={}),null!=ti&&this._validate(eM,"layers."+this.id+".layout."+tt,tt,ti,ta)||("visibility"!==tt?this._unevaluatedLayout.setValue(tt,ti):this.visibility=ti)},e.prototype.getPaintProperty=function(tt){return g(tt,"-transition")?this._transitionablePaint.getTransition(tt.slice(0,-11)):this._transitionablePaint.getValue(tt)},e.prototype.setPaintProperty=function(tt,ti,ta){if(void 0===ta&&(ta={}),null!=ti&&this._validate(ek,"layers."+this.id+".paint."+tt,tt,ti,ta))return!1;if(g(tt,"-transition"))return this._transitionablePaint.setTransition(tt.slice(0,-11),ti||void 0),!1;var tc=this._transitionablePaint._values[tt],th="cross-faded-data-driven"===tc.property.specification["property-type"],tf=tc.value.isDataDriven(),td=tc.value;this._transitionablePaint.setValue(tt,ti),this._handleSpecialPaintPropertyUpdate(tt);var tm=this._transitionablePaint._values[tt].value;return tm.isDataDriven()||tf||th||this._handleOverridablePaintPropertyUpdate(tt,td,tm)},e.prototype._handleSpecialPaintPropertyUpdate=function(tt){},e.prototype._handleOverridablePaintPropertyUpdate=function(tt,ti,ta){return!1},e.prototype.isHidden=function(tt){return!!(this.minzoom&&tt<this.minzoom)||!!(this.maxzoom&&tt>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(tt){this._transitioningPaint=this._transitionablePaint.transitioned(tt,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(tt,ti){tt.getCrossfadeParameters&&(this._crossfadeParameters=tt.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(tt,void 0,ti)),this.paint=this._transitioningPaint.possiblyEvaluate(tt,void 0,ti)},e.prototype.serialize=function(){var tt={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(tt.layout=tt.layout||{},tt.layout.visibility=this.visibility),b(tt,function(tt,ti){return!(void 0===tt||"layout"===ti&&!Object.keys(tt).length||"paint"===ti&&!Object.keys(tt).length)})},e.prototype._validate=function(tt,ti,ta,tc,th){return void 0===th&&(th={}),(!th||!1!==th.validate)&&Bn(this,tt.call(ez,{key:ti,layerType:this.type,objectKey:ta,value:tc,styleSpec:tY,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var tt in this.paint._values){var ti=this.paint.get(tt);if(ti instanceof yi&&Tr(ti.property.specification)&&("source"===ti.value.kind||"composite"===ti.value.kind)&&ti.value.isStateDependent)return!0}return!1},e}(Ct),eX={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Si=function(tt,ti){this._structArray=tt,this._pos1=ti*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ii(tt,ti){void 0===ti&&(ti=1);var ta=0,tc=0;return{members:tt.map(function(tt){var th=eX[tt.type].BYTES_PER_ELEMENT,tf=ta=zi(ta,Math.max(ti,th)),td=tt.components||1;return tc=Math.max(tc,th),ta+=th*td,{name:tt.name,type:tt.type,components:td,offset:tf}}),size:zi(ta,Math.max(tc,ti)),alignment:ti}}function zi(tt,ti){return Math.ceil(tt/ti)*ti}ki.serialize=function(tt,ti){return tt._trim(),ti&&(tt.isTransferred=!0,ti.push(tt.arrayBuffer)),{length:tt.length,arrayBuffer:tt.arrayBuffer}},ki.deserialize=function(tt){var ti=Object.create(this.prototype);return ti.arrayBuffer=tt.arrayBuffer,ti.length=tt.length,ti.capacity=tt.arrayBuffer.byteLength/ti.bytesPerElement,ti._refreshViews(),ti},ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ki.prototype.clear=function(){this.length=0},ki.prototype.resize=function(tt){this.reserve(tt),this.length=tt},ki.prototype.reserve=function(tt){if(tt>this.capacity){this.capacity=Math.max(tt,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var ti=this.uint8;this._refreshViews(),ti&&this.uint8.set(ti)}},ki.prototype._refreshViews=function(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")};var eW=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti){var ta=this.length;return this.resize(ta+1),this.emplace(ta,tt,ti)},e.prototype.emplace=function(tt,ti,ta){var tc=2*tt;return this.int16[tc+0]=ti,this.int16[tc+1]=ta,tt},e}(ki);eW.prototype.bytesPerElement=4,On("StructArrayLayout2i4",eW);var eK=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc){var th=this.length;return this.resize(th+1),this.emplace(th,tt,ti,ta,tc)},e.prototype.emplace=function(tt,ti,ta,tc,th){var tf=4*tt;return this.int16[tf+0]=ti,this.int16[tf+1]=ta,this.int16[tf+2]=tc,this.int16[tf+3]=th,tt},e}(ki);eK.prototype.bytesPerElement=8,On("StructArrayLayout4i8",eK);var eJ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf){var td=this.length;return this.resize(td+1),this.emplace(td,tt,ti,ta,tc,th,tf)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td){var tm=6*tt;return this.int16[tm+0]=ti,this.int16[tm+1]=ta,this.int16[tm+2]=tc,this.int16[tm+3]=th,this.int16[tm+4]=tf,this.int16[tm+5]=td,tt},e}(ki);eJ.prototype.bytesPerElement=12,On("StructArrayLayout2i4i12",eJ);var eY=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf){var td=this.length;return this.resize(td+1),this.emplace(td,tt,ti,ta,tc,th,tf)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td){var tm=4*tt,ty=8*tt;return this.int16[tm+0]=ti,this.int16[tm+1]=ta,this.uint8[ty+4]=tc,this.uint8[ty+5]=th,this.uint8[ty+6]=tf,this.uint8[ty+7]=td,tt},e}(ki);eY.prototype.bytesPerElement=8,On("StructArrayLayout2i4ub8",eY);var eH=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti){var ta=this.length;return this.resize(ta+1),this.emplace(ta,tt,ti)},e.prototype.emplace=function(tt,ti,ta){var tc=2*tt;return this.float32[tc+0]=ti,this.float32[tc+1]=ta,tt},e}(ki);eH.prototype.bytesPerElement=8,On("StructArrayLayout2f8",eH);var e$=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg){var t_=this.length;return this.resize(t_+1),this.emplace(t_,tt,ti,ta,tc,th,tf,td,tm,ty,tg)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_){var tv=10*tt;return this.uint16[tv+0]=ti,this.uint16[tv+1]=ta,this.uint16[tv+2]=tc,this.uint16[tv+3]=th,this.uint16[tv+4]=tf,this.uint16[tv+5]=td,this.uint16[tv+6]=tm,this.uint16[tv+7]=ty,this.uint16[tv+8]=tg,this.uint16[tv+9]=t_,tt},e}(ki);e$.prototype.bytesPerElement=20,On("StructArrayLayout10ui20",e$);var eQ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv){var tx=this.length;return this.resize(tx+1),this.emplace(tx,tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx){var tb=12*tt;return this.int16[tb+0]=ti,this.int16[tb+1]=ta,this.int16[tb+2]=tc,this.int16[tb+3]=th,this.uint16[tb+4]=tf,this.uint16[tb+5]=td,this.uint16[tb+6]=tm,this.uint16[tb+7]=ty,this.int16[tb+8]=tg,this.int16[tb+9]=t_,this.int16[tb+10]=tv,this.int16[tb+11]=tx,tt},e}(ki);eQ.prototype.bytesPerElement=24,On("StructArrayLayout4i4ui4i24",eQ);var e0=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta){var tc=this.length;return this.resize(tc+1),this.emplace(tc,tt,ti,ta)},e.prototype.emplace=function(tt,ti,ta,tc){var th=3*tt;return this.float32[th+0]=ti,this.float32[th+1]=ta,this.float32[th+2]=tc,tt},e}(ki);e0.prototype.bytesPerElement=12,On("StructArrayLayout3f12",e0);var e1=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt){var ti=this.length;return this.resize(ti+1),this.emplace(ti,tt)},e.prototype.emplace=function(tt,ti){return this.uint32[1*tt+0]=ti,tt},e}(ki);e1.prototype.bytesPerElement=4,On("StructArrayLayout1ul4",e1);var e2=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf,td,tm,ty){var tg=this.length;return this.resize(tg+1),this.emplace(tg,tt,ti,ta,tc,th,tf,td,tm,ty)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg){var t_=10*tt;return this.int16[t_+0]=ti,this.int16[t_+1]=ta,this.int16[t_+2]=tc,this.int16[t_+3]=th,this.int16[t_+4]=tf,this.int16[t_+5]=td,this.uint32[5*tt+3]=tm,this.uint16[t_+8]=ty,this.uint16[t_+9]=tg,tt},e}(ki);e2.prototype.bytesPerElement=20,On("StructArrayLayout6i1ul2ui20",e2);var e5=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf){var td=this.length;return this.resize(td+1),this.emplace(td,tt,ti,ta,tc,th,tf)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td){var tm=6*tt;return this.int16[tm+0]=ti,this.int16[tm+1]=ta,this.int16[tm+2]=tc,this.int16[tm+3]=th,this.int16[tm+4]=tf,this.int16[tm+5]=td,tt},e}(ki);e5.prototype.bytesPerElement=12,On("StructArrayLayout2i2i2i12",e5);var e4=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th){var tf=this.length;return this.resize(tf+1),this.emplace(tf,tt,ti,ta,tc,th)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf){var td=4*tt,tm=8*tt;return this.float32[td+0]=ti,this.float32[td+1]=ta,this.float32[td+2]=tc,this.int16[tm+6]=th,this.int16[tm+7]=tf,tt},e}(ki);e4.prototype.bytesPerElement=16,On("StructArrayLayout2f1f2i16",e4);var e3=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc){var th=this.length;return this.resize(th+1),this.emplace(th,tt,ti,ta,tc)},e.prototype.emplace=function(tt,ti,ta,tc,th){var tf=12*tt,td=3*tt;return this.uint8[tf+0]=ti,this.uint8[tf+1]=ta,this.float32[td+1]=tc,this.float32[td+2]=th,tt},e}(ki);e3.prototype.bytesPerElement=12,On("StructArrayLayout2ub2f12",e3);var e6=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta){var tc=this.length;return this.resize(tc+1),this.emplace(tc,tt,ti,ta)},e.prototype.emplace=function(tt,ti,ta,tc){var th=3*tt;return this.uint16[th+0]=ti,this.uint16[th+1]=ta,this.uint16[th+2]=tc,tt},e}(ki);e6.prototype.bytesPerElement=6,On("StructArrayLayout3ui6",e6);var e8=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT){var tI=this.length;return this.resize(tI+1),this.emplace(tI,tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT,tI){var tE=24*tt,tA=12*tt,tP=48*tt;return this.int16[tE+0]=ti,this.int16[tE+1]=ta,this.uint16[tE+2]=tc,this.uint16[tE+3]=th,this.uint32[tA+2]=tf,this.uint32[tA+3]=td,this.uint32[tA+4]=tm,this.uint16[tE+10]=ty,this.uint16[tE+11]=tg,this.uint16[tE+12]=t_,this.float32[tA+7]=tv,this.float32[tA+8]=tx,this.uint8[tP+36]=tb,this.uint8[tP+37]=tw,this.uint8[tP+38]=tS,this.uint32[tA+10]=tT,this.int16[tE+22]=tI,tt},e}(ki);e8.prototype.bytesPerElement=48,On("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",e8);var e9=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT,tI,tE,tA,tP,tz,tC,tk,tM,tD,tL,tB){var tR=this.length;return this.resize(tR+1),this.emplace(tR,tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT,tI,tE,tA,tP,tz,tC,tk,tM,tD,tL,tB)},e.prototype.emplace=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT,tI,tE,tA,tP,tz,tC,tk,tM,tD,tL,tB,tR){var tO=34*tt,tF=17*tt;return this.int16[tO+0]=ti,this.int16[tO+1]=ta,this.int16[tO+2]=tc,this.int16[tO+3]=th,this.int16[tO+4]=tf,this.int16[tO+5]=td,this.int16[tO+6]=tm,this.int16[tO+7]=ty,this.uint16[tO+8]=tg,this.uint16[tO+9]=t_,this.uint16[tO+10]=tv,this.uint16[tO+11]=tx,this.uint16[tO+12]=tb,this.uint16[tO+13]=tw,this.uint16[tO+14]=tS,this.uint16[tO+15]=tT,this.uint16[tO+16]=tI,this.uint16[tO+17]=tE,this.uint16[tO+18]=tA,this.uint16[tO+19]=tP,this.uint16[tO+20]=tz,this.uint16[tO+21]=tC,this.uint16[tO+22]=tk,this.uint32[tF+12]=tM,this.float32[tF+13]=tD,this.float32[tF+14]=tL,this.float32[tF+15]=tB,this.float32[tF+16]=tR,tt},e}(ki);e9.prototype.bytesPerElement=68,On("StructArrayLayout8i15ui1ul4f68",e9);var e7=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt){var ti=this.length;return this.resize(ti+1),this.emplace(ti,tt)},e.prototype.emplace=function(tt,ti){return this.float32[1*tt+0]=ti,tt},e}(ki);e7.prototype.bytesPerElement=4,On("StructArrayLayout1f4",e7);var it=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta){var tc=this.length;return this.resize(tc+1),this.emplace(tc,tt,ti,ta)},e.prototype.emplace=function(tt,ti,ta,tc){var th=3*tt;return this.int16[th+0]=ti,this.int16[th+1]=ta,this.int16[th+2]=tc,tt},e}(ki);it.prototype.bytesPerElement=6,On("StructArrayLayout3i6",it);var ia=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta){var tc=this.length;return this.resize(tc+1),this.emplace(tc,tt,ti,ta)},e.prototype.emplace=function(tt,ti,ta,tc){var th=4*tt;return this.uint32[2*tt+0]=ti,this.uint16[th+2]=ta,this.uint16[th+3]=tc,tt},e}(ki);ia.prototype.bytesPerElement=8,On("StructArrayLayout1ul2ui8",ia);var il=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti){var ta=this.length;return this.resize(ta+1),this.emplace(ta,tt,ti)},e.prototype.emplace=function(tt,ti,ta){var tc=2*tt;return this.uint16[tc+0]=ti,this.uint16[tc+1]=ta,tt},e}(ki);il.prototype.bytesPerElement=4,On("StructArrayLayout2ui4",il);var ic=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt){var ti=this.length;return this.resize(ti+1),this.emplace(ti,tt)},e.prototype.emplace=function(tt,ti){return this.uint16[1*tt+0]=ti,tt},e}(ki);ic.prototype.bytesPerElement=2,On("StructArrayLayout1ui2",ic);var ih=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(tt,ti,ta,tc){var th=this.length;return this.resize(th+1),this.emplace(th,tt,ti,ta,tc)},e.prototype.emplace=function(tt,ti,ta,tc,th){var tf=4*tt;return this.float32[tf+0]=ti,this.float32[tf+1]=ta,this.float32[tf+2]=tc,this.float32[tf+3]=th,tt},e}(ki);ih.prototype.bytesPerElement=16,On("StructArrayLayout4f16",ih);var id=function(tt){function e(){tt.apply(this,arguments)}tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e;var ti={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return ti.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},ti.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},ti.x1.get=function(){return this._structArray.int16[this._pos2+2]},ti.y1.get=function(){return this._structArray.int16[this._pos2+3]},ti.x2.get=function(){return this._structArray.int16[this._pos2+4]},ti.y2.get=function(){return this._structArray.int16[this._pos2+5]},ti.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},ti.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},ti.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},ti.anchorPoint.get=function(){return new th(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,ti),e}(Si);id.prototype.size=20;var im=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.get=function(tt){return new id(this,tt)},e}(e2);On("CollisionBoxArray",im);var iy=function(tt){function e(){tt.apply(this,arguments)}tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e;var ti={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return ti.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},ti.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},ti.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},ti.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},ti.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},ti.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},ti.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},ti.segment.get=function(){return this._structArray.uint16[this._pos2+10]},ti.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},ti.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},ti.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},ti.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},ti.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},ti.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},ti.placedOrientation.set=function(tt){this._structArray.uint8[this._pos1+37]=tt},ti.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},ti.hidden.set=function(tt){this._structArray.uint8[this._pos1+38]=tt},ti.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},ti.crossTileID.set=function(tt){this._structArray.uint32[this._pos4+10]=tt},ti.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,ti),e}(Si);iy.prototype.size=48;var ig=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.get=function(tt){return new iy(this,tt)},e}(e8);On("PlacedSymbolArray",ig);var i_=function(tt){function e(){tt.apply(this,arguments)}tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e;var ti={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return ti.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},ti.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},ti.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},ti.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},ti.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},ti.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},ti.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},ti.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},ti.key.get=function(){return this._structArray.uint16[this._pos2+8]},ti.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},ti.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},ti.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},ti.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},ti.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},ti.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},ti.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},ti.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},ti.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},ti.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},ti.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},ti.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},ti.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},ti.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},ti.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},ti.crossTileID.set=function(tt){this._structArray.uint32[this._pos4+12]=tt},ti.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},ti.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},ti.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},ti.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,ti),e}(Si);i_.prototype.size=68;var iv=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.get=function(tt){return new i_(this,tt)},e}(e9);On("SymbolInstanceArray",iv);var ix=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getoffsetX=function(tt){return this.float32[1*tt+0]},e}(e7);On("GlyphOffsetArray",ix);var ib=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getx=function(tt){return this.int16[3*tt+0]},e.prototype.gety=function(tt){return this.int16[3*tt+1]},e.prototype.gettileUnitDistanceFromAnchor=function(tt){return this.int16[3*tt+2]},e}(it);On("SymbolLineVertexArray",ib);var iw=function(tt){function e(){tt.apply(this,arguments)}tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e;var ti={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return ti.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},ti.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},ti.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,ti),e}(Si);iw.prototype.size=8;var iS=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.get=function(tt){return new iw(this,tt)},e}(ia);On("FeatureIndexArray",iS);var iT=Ii([{name:"a_pos",components:2,type:"Int16"}],4).members,sa=function(tt){void 0===tt&&(tt=[]),this.segments=tt};function ua(tt,ti){return 256*(tt=p(Math.floor(tt),0,255))+p(Math.floor(ti),0,255)}sa.prototype.prepareSegment=function(tt,ti,ta,tc){var th=this.segments[this.segments.length-1];return tt>sa.MAX_VERTEX_ARRAY_LENGTH&&A("Max vertices per segment is "+sa.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+tt),(!th||th.vertexLength+tt>sa.MAX_VERTEX_ARRAY_LENGTH||th.sortKey!==tc)&&(th={vertexOffset:ti.length,primitiveOffset:ta.length,vertexLength:0,primitiveLength:0},void 0!==tc&&(th.sortKey=tc),this.segments.push(th)),th},sa.prototype.get=function(){return this.segments},sa.prototype.destroy=function(){for(var tt=0,ti=this.segments;tt<ti.length;tt+=1){var ta=ti[tt];for(var tc in ta.vaos)ta.vaos[tc].destroy()}},sa.simpleSegment=function(tt,ti,ta,tc){return new sa([{vertexOffset:tt,primitiveOffset:ti,vertexLength:ta,primitiveLength:tc,vaos:{},sortKey:0}])},sa.MAX_VERTEX_ARRAY_LENGTH=65535,On("SegmentVector",sa);var iI=Ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),iE=e(function(tt){tt.exports=function(tt,ti){var ta,tc,th,tf,td,tm;for(tc=tt.length-(ta=3&tt.length),th=ti,tm=0;tm<tc;)td=255&tt.charCodeAt(tm)|(255&tt.charCodeAt(++tm))<<8|(255&tt.charCodeAt(++tm))<<16|(255&tt.charCodeAt(++tm))<<24,++tm,th=27492+(65535&(tf=5*(65535&(th=(th^=td=(65535&(td=(td=(65535&td)*3432918353+(((td>>>16)*3432918353&65535)<<16)&4294967295)<<15|td>>>17))*461845907+(((td>>>16)*461845907&65535)<<16)&4294967295)<<13|th>>>19))+((5*(th>>>16)&65535)<<16)&4294967295))+((58964+(tf>>>16)&65535)<<16);switch(td=0,ta){case 3:td^=(255&tt.charCodeAt(tm+2))<<16;case 2:td^=(255&tt.charCodeAt(tm+1))<<8;case 1:th^=td=(65535&(td=(td=(65535&(td^=255&tt.charCodeAt(tm)))*3432918353+(((td>>>16)*3432918353&65535)<<16)&4294967295)<<15|td>>>17))*461845907+(((td>>>16)*461845907&65535)<<16)&4294967295}return th^=tt.length,th=2246822507*(65535&(th^=th>>>16))+((2246822507*(th>>>16)&65535)<<16)&4294967295,th=3266489909*(65535&(th^=th>>>13))+((3266489909*(th>>>16)&65535)<<16)&4294967295,(th^=th>>>16)>>>0}}),iA=e(function(tt){tt.exports=function(tt,ti){for(var ta,tc=tt.length,th=ti^tc,tf=0;tc>=4;)ta=1540483477*(65535&(ta=255&tt.charCodeAt(tf)|(255&tt.charCodeAt(++tf))<<8|(255&tt.charCodeAt(++tf))<<16|(255&tt.charCodeAt(++tf))<<24))+((1540483477*(ta>>>16)&65535)<<16),th=1540483477*(65535&th)+((1540483477*(th>>>16)&65535)<<16)^(ta=1540483477*(65535&(ta^=ta>>>24))+((1540483477*(ta>>>16)&65535)<<16)),tc-=4,++tf;switch(tc){case 3:th^=(255&tt.charCodeAt(tf+2))<<16;case 2:th^=(255&tt.charCodeAt(tf+1))<<8;case 1:th=1540483477*(65535&(th^=255&tt.charCodeAt(tf)))+((1540483477*(th>>>16)&65535)<<16)}return th=1540483477*(65535&(th^=th>>>13))+((1540483477*(th>>>16)&65535)<<16),(th^=th>>>15)>>>0}});iE.murmur3=iE,iE.murmur2=iA;var ya=function(){this.ids=[],this.positions=[],this.indexed=!1};function ma(tt){var ti=+tt;return!isNaN(ti)&&ti<=9007199254740991?ti:iE(String(tt))}function va(tt,ti,ta){var tc=tt[ti];tt[ti]=tt[ta],tt[ta]=tc}ya.prototype.add=function(tt,ti,ta,tc){this.ids.push(ma(tt)),this.positions.push(ti,ta,tc)},ya.prototype.getPositions=function(tt){for(var ti=ma(tt),ta=0,tc=this.ids.length-1;ta<tc;){var th=ta+tc>>1;this.ids[th]>=ti?tc=th:ta=th+1}for(var tf=[];this.ids[ta]===ti;)tf.push({index:this.positions[3*ta],start:this.positions[3*ta+1],end:this.positions[3*ta+2]}),ta++;return tf},ya.serialize=function(tt,ti){var ta=new Float64Array(tt.ids),tc=new Uint32Array(tt.positions);return function t(tt,ti,ta,tc){for(;ta<tc;){for(var th=tt[ta+tc>>1],tf=ta-1,td=tc+1;;){do tf++;while(tt[tf]<th);do td--;while(tt[td]>th);if(tf>=td)break;va(tt,tf,td),va(ti,3*tf,3*td),va(ti,3*tf+1,3*td+1),va(ti,3*tf+2,3*td+2)}td-ta<tc-td?(t(tt,ti,ta,td),ta=td+1):(t(tt,ti,td+1,tc),tc=td)}}(ta,tc,0,ta.length-1),ti&&ti.push(ta.buffer,tc.buffer),{ids:ta,positions:tc}},ya.deserialize=function(tt){var ti=new ya;return ti.ids=tt.ids,ti.positions=tt.positions,ti.indexed=!0,ti},On("FeaturePositionMap",ya);var ga=function(tt,ti){this.gl=tt.gl,this.location=ti},iP=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=0}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){this.current!==tt&&(this.current=tt,this.gl.uniform1i(this.location,tt))},e}(ga),iz=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=0}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){this.current!==tt&&(this.current=tt,this.gl.uniform1f(this.location,tt))},e}(ga),iC=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=[0,0]}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){tt[0]===this.current[0]&&tt[1]===this.current[1]||(this.current=tt,this.gl.uniform2f(this.location,tt[0],tt[1]))},e}(ga),ik=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=[0,0,0]}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){tt[0]===this.current[0]&&tt[1]===this.current[1]&&tt[2]===this.current[2]||(this.current=tt,this.gl.uniform3f(this.location,tt[0],tt[1],tt[2]))},e}(ga),iM=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=[0,0,0,0]}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){tt[0]===this.current[0]&&tt[1]===this.current[1]&&tt[2]===this.current[2]&&tt[3]===this.current[3]||(this.current=tt,this.gl.uniform4f(this.location,tt[0],tt[1],tt[2],tt[3]))},e}(ga),iD=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=te.transparent}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){tt.r===this.current.r&&tt.g===this.current.g&&tt.b===this.current.b&&tt.a===this.current.a||(this.current=tt,this.gl.uniform4f(this.location,tt.r,tt.g,tt.b,tt.a))},e}(ga),iL=new Float32Array(16),iB=function(tt){function e(ti,ta){tt.call(this,ti,ta),this.current=iL}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){if(tt[12]!==this.current[12]||tt[0]!==this.current[0])return this.current=tt,void this.gl.uniformMatrix4fv(this.location,!1,tt);for(var ti=1;ti<16;ti++)if(tt[ti]!==this.current[ti]){this.current=tt,this.gl.uniformMatrix4fv(this.location,!1,tt);break}},e}(ga);function za(tt){return[ua(255*tt.r,255*tt.g),ua(255*tt.b,255*tt.a)]}var Ca=function(tt,ti,ta){this.value=tt,this.uniformNames=ti.map(function(tt){return"u_"+tt}),this.type=ta};Ca.prototype.setUniform=function(tt,ti,ta){tt.set(ta.constantOr(this.value))},Ca.prototype.getBinding=function(tt,ti,ta){return"color"===this.type?new iD(tt,ti):new iz(tt,ti)};var Ea=function(tt,ti){this.uniformNames=ti.map(function(tt){return"u_"+tt}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ea.prototype.setConstantPatternPositions=function(tt,ti){this.pixelRatioFrom=ti.pixelRatio,this.pixelRatioTo=tt.pixelRatio,this.patternFrom=ti.tlbr,this.patternTo=tt.tlbr},Ea.prototype.setUniform=function(tt,ti,ta,tc){var th="u_pattern_to"===tc?this.patternTo:"u_pattern_from"===tc?this.patternFrom:"u_pixel_ratio_to"===tc?this.pixelRatioTo:"u_pixel_ratio_from"===tc?this.pixelRatioFrom:null;th&&tt.set(th)},Ea.prototype.getBinding=function(tt,ti,ta){return"u_pattern"===ta.substr(0,9)?new iM(tt,ti):new iz(tt,ti)};var Pa=function(tt,ti,ta,tc){this.expression=tt,this.type=ta,this.maxValue=0,this.paintVertexAttributes=ti.map(function(tt){return{name:"a_"+tt,type:"Float32",components:"color"===ta?2:1,offset:0}}),this.paintVertexArray=new tc};Pa.prototype.populatePaintArray=function(tt,ti,ta,tc,th){var tf=this.paintVertexArray.length,td=this.expression.evaluate(new si(0),ti,{},tc,[],th);this.paintVertexArray.resize(tt),this._setPaintValue(tf,tt,td)},Pa.prototype.updatePaintArray=function(tt,ti,ta,tc){var th=this.expression.evaluate({zoom:0},ta,tc);this._setPaintValue(tt,ti,th)},Pa.prototype._setPaintValue=function(tt,ti,ta){if("color"===this.type)for(var tc=za(ta),th=tt;th<ti;th++)this.paintVertexArray.emplace(th,tc[0],tc[1]);else{for(var tf=tt;tf<ti;tf++)this.paintVertexArray.emplace(tf,ta);this.maxValue=Math.max(this.maxValue,Math.abs(ta))}},Pa.prototype.upload=function(tt){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=tt.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Pa.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ma=function(tt,ti,ta,tc,th,tf){this.expression=tt,this.uniformNames=ti.map(function(tt){return"u_"+tt+"_t"}),this.type=ta,this.useIntegerZoom=tc,this.zoom=th,this.maxValue=0,this.paintVertexAttributes=ti.map(function(tt){return{name:"a_"+tt,type:"Float32",components:"color"===ta?4:2,offset:0}}),this.paintVertexArray=new tf};Ma.prototype.populatePaintArray=function(tt,ti,ta,tc,th){var tf=this.expression.evaluate(new si(this.zoom),ti,{},tc,[],th),td=this.expression.evaluate(new si(this.zoom+1),ti,{},tc,[],th),tm=this.paintVertexArray.length;this.paintVertexArray.resize(tt),this._setPaintValue(tm,tt,tf,td)},Ma.prototype.updatePaintArray=function(tt,ti,ta,tc){var th=this.expression.evaluate({zoom:this.zoom},ta,tc),tf=this.expression.evaluate({zoom:this.zoom+1},ta,tc);this._setPaintValue(tt,ti,th,tf)},Ma.prototype._setPaintValue=function(tt,ti,ta,tc){if("color"===this.type)for(var th=za(ta),tf=za(tc),td=tt;td<ti;td++)this.paintVertexArray.emplace(td,th[0],th[1],tf[0],tf[1]);else{for(var tm=tt;tm<ti;tm++)this.paintVertexArray.emplace(tm,ta,tc);this.maxValue=Math.max(this.maxValue,Math.abs(ta),Math.abs(tc))}},Ma.prototype.upload=function(tt){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=tt.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ma.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ma.prototype.setUniform=function(tt,ti){var ta=this.useIntegerZoom?Math.floor(ti.zoom):ti.zoom,tc=p(this.expression.interpolationFactor(ta,this.zoom,this.zoom+1),0,1);tt.set(tc)},Ma.prototype.getBinding=function(tt,ti,ta){return new iz(tt,ti)};var Ba=function(tt,ti,ta,tc,th,tf){this.expression=tt,this.type=ti,this.useIntegerZoom=ta,this.zoom=tc,this.layerId=tf,this.zoomInPaintVertexArray=new th,this.zoomOutPaintVertexArray=new th};Ba.prototype.populatePaintArray=function(tt,ti,ta){var tc=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(tt),this.zoomOutPaintVertexArray.resize(tt),this._setPaintValues(tc,tt,ti.patterns&&ti.patterns[this.layerId],ta)},Ba.prototype.updatePaintArray=function(tt,ti,ta,tc,th){this._setPaintValues(tt,ti,ta.patterns&&ta.patterns[this.layerId],th)},Ba.prototype._setPaintValues=function(tt,ti,ta,tc){if(tc&&ta){var th=tc[ta.min],tf=tc[ta.mid],td=tc[ta.max];if(th&&tf&&td)for(var tm=tt;tm<ti;tm++)this.zoomInPaintVertexArray.emplace(tm,tf.tl[0],tf.tl[1],tf.br[0],tf.br[1],th.tl[0],th.tl[1],th.br[0],th.br[1],tf.pixelRatio,th.pixelRatio),this.zoomOutPaintVertexArray.emplace(tm,tf.tl[0],tf.tl[1],tf.br[0],tf.br[1],td.tl[0],td.tl[1],td.br[0],td.br[1],tf.pixelRatio,td.pixelRatio)}},Ba.prototype.upload=function(tt){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=tt.createVertexBuffer(this.zoomInPaintVertexArray,iI.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=tt.createVertexBuffer(this.zoomOutPaintVertexArray,iI.members,this.expression.isStateDependent))},Ba.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ta=function(tt,ti,ta){this.binders={},this._buffers=[];var tc=[];for(var th in tt.paint._values)if(ta(th)){var tf=tt.paint.get(th);if(tf instanceof yi&&Tr(tf.property.specification)){var td=Fa(th,tt.type),tm=tf.value,ty=tf.property.specification.type,tg=tf.property.useIntegerZoom,t_=tf.property.specification["property-type"],tv="cross-faded"===t_||"cross-faded-data-driven"===t_;if("constant"===tm.kind)this.binders[th]=tv?new Ea(tm.value,td):new Ca(tm.value,td,ty),tc.push("/u_"+th);else if("source"===tm.kind||tv){var tx=Da(th,ty,"source");this.binders[th]=tv?new Ba(tm,ty,tg,ti,tx,tt.id):new Pa(tm,td,ty,tx),tc.push("/a_"+th)}else{var tb=Da(th,ty,"composite");this.binders[th]=new Ma(tm,td,ty,tg,ti,tb),tc.push("/z_"+th)}}}this.cacheKey=tc.sort().join("")};Ta.prototype.getMaxValue=function(tt){var ti=this.binders[tt];return ti instanceof Pa||ti instanceof Ma?ti.maxValue:0},Ta.prototype.populatePaintArrays=function(tt,ti,ta,tc,th){for(var tf in this.binders){var td=this.binders[tf];(td instanceof Pa||td instanceof Ma||td instanceof Ba)&&td.populatePaintArray(tt,ti,ta,tc,th)}},Ta.prototype.setConstantPatternPositions=function(tt,ti){for(var ta in this.binders){var tc=this.binders[ta];tc instanceof Ea&&tc.setConstantPatternPositions(tt,ti)}},Ta.prototype.updatePaintArrays=function(tt,ti,ta,tc,th){var tf=!1;for(var td in tt)for(var tm=0,ty=ti.getPositions(td);tm<ty.length;tm+=1){var tg=ty[tm],t_=ta.feature(tg.index);for(var tv in this.binders){var tx=this.binders[tv];if((tx instanceof Pa||tx instanceof Ma||tx instanceof Ba)&&!0===tx.expression.isStateDependent){var tb=tc.paint.get(tv);tx.expression=tb.value,tx.updatePaintArray(tg.start,tg.end,t_,tt[td],th),tf=!0}}}return tf},Ta.prototype.defines=function(){var tt=[];for(var ti in this.binders){var ta=this.binders[ti];(ta instanceof Ca||ta instanceof Ea)&&tt.push.apply(tt,ta.uniformNames.map(function(tt){return"#define HAS_UNIFORM_"+tt}))}return tt},Ta.prototype.getBinderAttributes=function(){var tt=[];for(var ti in this.binders){var ta=this.binders[ti];if(ta instanceof Pa||ta instanceof Ma)for(var tc=0;tc<ta.paintVertexAttributes.length;tc++)tt.push(ta.paintVertexAttributes[tc].name);else if(ta instanceof Ba)for(var th=0;th<iI.members.length;th++)tt.push(iI.members[th].name)}return tt},Ta.prototype.getBinderUniforms=function(){var tt=[];for(var ti in this.binders){var ta=this.binders[ti];if(ta instanceof Ca||ta instanceof Ea||ta instanceof Ma)for(var tc=0,th=ta.uniformNames;tc<th.length;tc+=1)tt.push(th[tc])}return tt},Ta.prototype.getPaintVertexBuffers=function(){return this._buffers},Ta.prototype.getUniforms=function(tt,ti){var ta=[];for(var tc in this.binders){var th=this.binders[tc];if(th instanceof Ca||th instanceof Ea||th instanceof Ma)for(var tf=0,td=th.uniformNames;tf<td.length;tf+=1){var tm=td[tf];if(ti[tm]){var ty=th.getBinding(tt,ti[tm],tm);ta.push({name:tm,property:tc,binding:ty})}}}return ta},Ta.prototype.setUniforms=function(tt,ti,ta,tc){for(var th=0;th<ti.length;th+=1){var tf=ti[th],td=tf.name,tm=tf.property;this.binders[tm].setUniform(tf.binding,tc,ta.get(tm),td)}},Ta.prototype.updatePaintBuffers=function(tt){for(var ti in this._buffers=[],this.binders){var ta=this.binders[ti];if(tt&&ta instanceof Ba){var tc=2===tt.fromScale?ta.zoomInPaintVertexBuffer:ta.zoomOutPaintVertexBuffer;tc&&this._buffers.push(tc)}else(ta instanceof Pa||ta instanceof Ma)&&ta.paintVertexBuffer&&this._buffers.push(ta.paintVertexBuffer)}},Ta.prototype.upload=function(tt){for(var ti in this.binders){var ta=this.binders[ti];(ta instanceof Pa||ta instanceof Ma||ta instanceof Ba)&&ta.upload(tt)}this.updatePaintBuffers()},Ta.prototype.destroy=function(){for(var tt in this.binders){var ti=this.binders[tt];(ti instanceof Pa||ti instanceof Ma||ti instanceof Ba)&&ti.destroy()}};var Va=function(tt,ti,ta){void 0===ta&&(ta=function(){return!0}),this.programConfigurations={};for(var tc=0;tc<tt.length;tc+=1){var th=tt[tc];this.programConfigurations[th.id]=new Ta(th,ti,ta)}this.needsUpload=!1,this._featureMap=new ya,this._bufferOffset=0};function Fa(tt,ti){return({"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]})[tt]||[tt.replace(ti+"-","").replace(/-/g,"_")]}function Da(tt,ti,ta){var tc={"line-pattern":{source:e$,composite:e$},"fill-pattern":{source:e$,composite:e$},"fill-extrusion-pattern":{source:e$,composite:e$}}[tt];return tc&&tc[ta]||({color:{source:eH,composite:ih},number:{source:e7,composite:eH}})[ti][ta]}Va.prototype.populatePaintArrays=function(tt,ti,ta,tc,th,tf){for(var td in this.programConfigurations)this.programConfigurations[td].populatePaintArrays(tt,ti,tc,th,tf);void 0!==ti.id&&this._featureMap.add(ti.id,ta,this._bufferOffset,tt),this._bufferOffset=tt,this.needsUpload=!0},Va.prototype.updatePaintArrays=function(tt,ti,ta,tc){for(var th=0;th<ta.length;th+=1){var tf=ta[th];this.needsUpload=this.programConfigurations[tf.id].updatePaintArrays(tt,this._featureMap,ti,tf,tc)||this.needsUpload}},Va.prototype.get=function(tt){return this.programConfigurations[tt]},Va.prototype.upload=function(tt){if(this.needsUpload){for(var ti in this.programConfigurations)this.programConfigurations[ti].upload(tt);this.needsUpload=!1}},Va.prototype.destroy=function(){for(var tt in this.programConfigurations)this.programConfigurations[tt].destroy()},On("ConstantBinder",Ca),On("CrossFadedConstantBinder",Ea),On("SourceExpressionBinder",Pa),On("CrossFadedCompositeBinder",Ba),On("CompositeExpressionBinder",Ma),On("ProgramConfiguration",Ta,{omit:["_buffers"]}),On("ProgramConfigurationSet",Va);var iR=-16383-1;function Ra(tt){for(var ti=8192/tt.extent,ta=tt.loadGeometry(),tc=0;tc<ta.length;tc++)for(var th=ta[tc],tf=0;tf<th.length;tf++){var td=th[tf],tm=Math.round(td.x*ti),ty=Math.round(td.y*ti);td.x=p(tm,iR,16383),td.y=p(ty,iR,16383),(tm<td.x||tm>td.x+1||ty<td.y||ty>td.y+1)&&A("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return ta}function Ua(tt,ti){return{type:tt.type,id:tt.id,properties:tt.properties,geometry:ti?Ra(tt):[]}}function ja(tt,ti,ta,tc,th){tt.emplaceBack(2*ti+(tc+1)/2,2*ta+(th+1)/2)}var qa=function(tt){this.zoom=tt.zoom,this.overscaling=tt.overscaling,this.layers=tt.layers,this.layerIds=this.layers.map(function(tt){return tt.id}),this.index=tt.index,this.hasPattern=!1,this.layoutVertexArray=new eW,this.indexArray=new e6,this.segments=new sa,this.programConfigurations=new Va(tt.layers,tt.zoom),this.stateDependentLayerIds=this.layers.filter(function(tt){return tt.isStateDependent()}).map(function(tt){return tt.id})};function Na(tt,ti){for(var ta=0;ta<tt.length;ta++)if(Wa(ti,tt[ta]))return!0;for(var tc=0;tc<ti.length;tc++)if(Wa(tt,ti[tc]))return!0;return!!Xa(tt,ti)}function Ka(tt,ti,ta){return!!Wa(tt,ti)||!!Ha(ti,tt,ta)}function Ga(tt,ti){if(1===tt.length)return $a(ti,tt[0]);for(var ta=0;ta<ti.length;ta++)for(var tc=ti[ta],th=0;th<tc.length;th++)if(Wa(tt,tc[th]))return!0;for(var tf=0;tf<tt.length;tf++)if($a(ti,tt[tf]))return!0;for(var td=0;td<ti.length;td++)if(Xa(tt,ti[td]))return!0;return!1}function Za(tt,ti,ta){if(tt.length>1){if(Xa(tt,ti))return!0;for(var tc=0;tc<ti.length;tc++)if(Ha(ti[tc],tt,ta))return!0}for(var th=0;th<tt.length;th++)if(Ha(tt[th],ti,ta))return!0;return!1}function Xa(tt,ti){if(0===tt.length||0===ti.length)return!1;for(var ta=0;ta<tt.length-1;ta++)for(var tc=tt[ta],th=tt[ta+1],tf=0;tf<ti.length-1;tf++)if(Ja(tc,th,ti[tf],ti[tf+1]))return!0;return!1}function Ja(tt,ti,ta,tc){return S(tt,ta,tc)!==S(ti,ta,tc)&&S(tt,ti,ta)!==S(tt,ti,tc)}function Ha(tt,ti,ta){var tc=ta*ta;if(1===ti.length)return tt.distSqr(ti[0])<tc;for(var th=1;th<ti.length;th++)if(Ya(tt,ti[th-1],ti[th])<tc)return!0;return!1}function Ya(tt,ti,ta){var tc=ti.distSqr(ta);if(0===tc)return tt.distSqr(ti);var th=((tt.x-ti.x)*(ta.x-ti.x)+(tt.y-ti.y)*(ta.y-ti.y))/tc;return tt.distSqr(th<0?ti:th>1?ta:ta.sub(ti)._mult(th)._add(ti))}function $a(tt,ti){for(var ta,tc,th,tf=!1,td=0;td<tt.length;td++)for(var tm=0,ty=(ta=tt[td]).length-1;tm<ta.length;ty=tm++)(tc=ta[tm]).y>ti.y!=(th=ta[ty]).y>ti.y&&ti.x<(th.x-tc.x)*(ti.y-tc.y)/(th.y-tc.y)+tc.x&&(tf=!tf);return tf}function Wa(tt,ti){for(var ta=!1,tc=0,th=tt.length-1;tc<tt.length;th=tc++){var tf=tt[tc],td=tt[th];tf.y>ti.y!=td.y>ti.y&&ti.x<(td.x-tf.x)*(ti.y-tf.y)/(td.y-tf.y)+tf.x&&(ta=!ta)}return ta}function Qa(tt,ti,ta){var tc=ta[0],th=ta[2];if(tt.x<tc.x&&ti.x<tc.x||tt.x>th.x&&ti.x>th.x||tt.y<tc.y&&ti.y<tc.y||tt.y>th.y&&ti.y>th.y)return!1;var tf=S(tt,ti,ta[0]);return tf!==S(tt,ti,ta[1])||tf!==S(tt,ti,ta[2])||tf!==S(tt,ti,ta[3])}function to(tt,ti,ta){var tc=ti.paint.get(tt).value;return"constant"===tc.kind?tc.value:ta.programConfigurations.get(ti.id).getMaxValue(tt)}function eo(tt){return Math.sqrt(tt[0]*tt[0]+tt[1]*tt[1])}function ro(tt,ti,ta,tc,tf){if(!ti[0]&&!ti[1])return tt;var td=th.convert(ti)._mult(tf);"viewport"===ta&&td._rotate(-tc);for(var tm=[],ty=0;ty<tt.length;ty++)tm.push(tt[ty].sub(td));return tm}qa.prototype.populate=function(tt,ti,ta){var tc=this.layers[0],th=[],tf=null;"circle"===tc.type&&(tf=tc.layout.get("circle-sort-key"));for(var td=0;td<tt.length;td+=1){var tm=tt[td],ty=tm.feature,tg=tm.id,t_=tm.index,tv=tm.sourceLayerIndex,tx=this.layers[0]._featureFilter.needGeometry,tb=Ua(ty,tx);if(this.layers[0]._featureFilter.filter(new si(this.zoom),tb,ta)){var tw=tf?tf.evaluate(tb,{},ta):void 0,tS={id:tg,properties:ty.properties,type:ty.type,sourceLayerIndex:tv,index:t_,geometry:tx?tb.geometry:Ra(ty),patterns:{},sortKey:tw};th.push(tS)}}tf&&th.sort(function(tt,ti){return tt.sortKey-ti.sortKey});for(var tT=0;tT<th.length;tT+=1){var tI=th[tT],tE=tI.geometry,tA=tI.index,tP=tI.sourceLayerIndex,tz=tt[tA].feature;this.addFeature(tI,tE,tA,ta),ti.featureIndex.insert(tz,tE,tA,tP,this.index)}},qa.prototype.update=function(tt,ti,ta){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(tt,ti,this.stateDependentLayers,ta)},qa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},qa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qa.prototype.upload=function(tt){this.uploaded||(this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,iT),this.indexBuffer=tt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(tt),this.uploaded=!0},qa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qa.prototype.addFeature=function(tt,ti,ta,tc){for(var th=0;th<ti.length;th+=1)for(var tf=0,td=ti[th];tf<td.length;tf+=1){var tm=td[tf],ty=tm.x,tg=tm.y;if(!(ty<0||ty>=8192||tg<0||tg>=8192)){var t_=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,tt.sortKey),tv=t_.vertexLength;ja(this.layoutVertexArray,ty,tg,-1,-1),ja(this.layoutVertexArray,ty,tg,1,-1),ja(this.layoutVertexArray,ty,tg,1,1),ja(this.layoutVertexArray,ty,tg,-1,1),this.indexArray.emplaceBack(tv,tv+1,tv+2),this.indexArray.emplaceBack(tv,tv+3,tv+2),t_.vertexLength+=4,t_.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,tt,ta,{},tc)},On("CircleBucket",qa,{omit:["layers"]});var iO=new wi({"circle-sort-key":new vi(tY.layout_circle["circle-sort-key"])}),iF={paint:new wi({"circle-radius":new vi(tY.paint_circle["circle-radius"]),"circle-color":new vi(tY.paint_circle["circle-color"]),"circle-blur":new vi(tY.paint_circle["circle-blur"]),"circle-opacity":new vi(tY.paint_circle["circle-opacity"]),"circle-translate":new mi(tY.paint_circle["circle-translate"]),"circle-translate-anchor":new mi(tY.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mi(tY.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mi(tY.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vi(tY.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vi(tY.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vi(tY.paint_circle["circle-stroke-opacity"])}),layout:iO},iU="undefined"!=typeof Float32Array?Float32Array:Array;function oo(tt){return tt[0]=1,tt[1]=0,tt[2]=0,tt[3]=0,tt[4]=0,tt[5]=1,tt[6]=0,tt[7]=0,tt[8]=0,tt[9]=0,tt[10]=1,tt[11]=0,tt[12]=0,tt[13]=0,tt[14]=0,tt[15]=1,tt}function so(tt,ti,ta){var tc=ti[0],th=ti[1],tf=ti[2],td=ti[3],tm=ti[4],ty=ti[5],tg=ti[6],t_=ti[7],tv=ti[8],tx=ti[9],tb=ti[10],tw=ti[11],tS=ti[12],tT=ti[13],tI=ti[14],tE=ti[15],tA=ta[0],tP=ta[1],tz=ta[2],tC=ta[3];return tt[0]=tA*tc+tP*tm+tz*tv+tC*tS,tt[1]=tA*th+tP*ty+tz*tx+tC*tT,tt[2]=tA*tf+tP*tg+tz*tb+tC*tI,tt[3]=tA*td+tP*t_+tz*tw+tC*tE,tt[4]=(tA=ta[4])*tc+(tP=ta[5])*tm+(tz=ta[6])*tv+(tC=ta[7])*tS,tt[5]=tA*th+tP*ty+tz*tx+tC*tT,tt[6]=tA*tf+tP*tg+tz*tb+tC*tI,tt[7]=tA*td+tP*t_+tz*tw+tC*tE,tt[8]=(tA=ta[8])*tc+(tP=ta[9])*tm+(tz=ta[10])*tv+(tC=ta[11])*tS,tt[9]=tA*th+tP*ty+tz*tx+tC*tT,tt[10]=tA*tf+tP*tg+tz*tb+tC*tI,tt[11]=tA*td+tP*t_+tz*tw+tC*tE,tt[12]=(tA=ta[12])*tc+(tP=ta[13])*tm+(tz=ta[14])*tv+(tC=ta[15])*tS,tt[13]=tA*th+tP*ty+tz*tx+tC*tT,tt[14]=tA*tf+tP*tg+tz*tb+tC*tI,tt[15]=tA*td+tP*t_+tz*tw+tC*tE,tt}Math.hypot||(Math.hypot=function(){for(var tt=arguments,ti=0,ta=arguments.length;ta--;)ti+=tt[ta]*tt[ta];return Math.sqrt(ti)});var iV,iN=so;function po(tt,ti,ta){var tc=ti[0],th=ti[1],tf=ti[2],td=ti[3];return tt[0]=ta[0]*tc+ta[4]*th+ta[8]*tf+ta[12]*td,tt[1]=ta[1]*tc+ta[5]*th+ta[9]*tf+ta[13]*td,tt[2]=ta[2]*tc+ta[6]*th+ta[10]*tf+ta[14]*td,tt[3]=ta[3]*tc+ta[7]*th+ta[11]*tf+ta[15]*td,tt}iV=new iU(3),iU!=Float32Array&&(iV[0]=0,iV[1]=0,iV[2]=0),ti=new iU(4),iU!=Float32Array&&(ti[0]=0,ti[1]=0,ti[2]=0,ti[3]=0);var ij=(ta=new iU(2),iU!=Float32Array&&(ta[0]=0,ta[1]=0),function(tt){function e(ti){tt.call(this,ti,iF)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.createBucket=function(tt){return new qa(tt)},e.prototype.queryRadius=function(tt){return to("circle-radius",this,tt)+to("circle-stroke-width",this,tt)+eo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(tt,ti,ta,tc,th,tf,td,tm){for(var ty=ro(tt,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),tf.angle,td),tg=this.paint.get("circle-radius").evaluate(ti,ta)+this.paint.get("circle-stroke-width").evaluate(ti,ta),t_="map"===this.paint.get("circle-pitch-alignment"),tv=t_?ty:ty.map(function(tt){return ho(tt,tm)}),tx=t_?tg*td:tg,tb=0;tb<tc.length;tb+=1)for(var tw=0,tS=tc[tb];tw<tS.length;tw+=1){var tT=tS[tw],tI=t_?tT:ho(tT,tm),tE=tx,tA=po([],[tT.x,tT.y,0,1],tm);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?tE*=tA[3]/tf.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(tE*=tf.cameraToCenterDistance/tA[3]),Ka(tv,tI,tE))return!0}return!1},e}(eG));function ho(tt,ti){var ta=po([],[tt.x,tt.y,0,1],ti);return new th(ta[0]/ta[3],ta[1]/ta[3])}var iq=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(qa);function yo(tt,ti,ta,tc){var th=ti.width,tf=ti.height;if(tc){if(tc instanceof Uint8ClampedArray)tc=new Uint8Array(tc.buffer);else if(tc.length!==th*tf*ta)throw RangeError("mismatched image size")}else tc=new Uint8Array(th*tf*ta);return tt.width=th,tt.height=tf,tt.data=tc,tt}function mo(tt,ti,ta){var tc=ti.width,th=ti.height;if(tc!==tt.width||th!==tt.height){var tf=yo({},{width:tc,height:th},ta);vo(tt,tf,{x:0,y:0},{x:0,y:0},{width:Math.min(tt.width,tc),height:Math.min(tt.height,th)},ta),tt.width=tc,tt.height=th,tt.data=tf.data}}function vo(tt,ti,ta,tc,th,tf){if(0===th.width||0===th.height)return ti;if(th.width>tt.width||th.height>tt.height||ta.x>tt.width-th.width||ta.y>tt.height-th.height)throw RangeError("out of range source coordinates for image copy");if(th.width>ti.width||th.height>ti.height||tc.x>ti.width-th.width||tc.y>ti.height-th.height)throw RangeError("out of range destination coordinates for image copy");for(var td=tt.data,tm=ti.data,ty=0;ty<th.height;ty++)for(var tg=((ta.y+ty)*tt.width+ta.x)*tf,t_=((tc.y+ty)*ti.width+tc.x)*tf,tv=0;tv<th.width*tf;tv++)tm[t_+tv]=td[tg+tv];return ti}On("HeatmapBucket",iq,{omit:["layers"]});var go=function(tt,ti){yo(this,tt,1,ti)};go.prototype.resize=function(tt){mo(this,tt,1)},go.prototype.clone=function(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))},go.copy=function(tt,ti,ta,tc,th){vo(tt,ti,ta,tc,th,1)};var xo=function(tt,ti){yo(this,tt,4,ti)};xo.prototype.resize=function(tt){mo(this,tt,4)},xo.prototype.replace=function(tt,ti){ti?this.data.set(tt):this.data=tt instanceof Uint8ClampedArray?new Uint8Array(tt.buffer):tt},xo.prototype.clone=function(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))},xo.copy=function(tt,ti,ta,tc,th){vo(tt,ti,ta,tc,th,4)},On("AlphaImage",go),On("RGBAImage",xo);var iZ={paint:new wi({"heatmap-radius":new vi(tY.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vi(tY.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mi(tY.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bi(tY.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mi(tY.paint_heatmap["heatmap-opacity"])})};function wo(tt){var ti={},ta=tt.resolution||256,tc=tt.clips?tt.clips.length:1,th=tt.image||new xo({width:ta,height:tc}),a=function(ta,tc,tf){ti[tt.evaluationKey]=tf;var td=tt.expression.evaluate(ti);th.data[ta+tc+0]=Math.floor(255*td.r/td.a),th.data[ta+tc+1]=Math.floor(255*td.g/td.a),th.data[ta+tc+2]=Math.floor(255*td.b/td.a),th.data[ta+tc+3]=Math.floor(255*td.a)};if(tt.clips)for(var tf=0,td=0;tf<tc;++tf,td+=4*ta)for(var tm=0,ty=0;tm<ta;tm++,ty+=4){var tg=tm/(ta-1),t_=tt.clips[tf];a(td,ty,t_.start*(1-tg)+t_.end*tg)}else for(var tv=0,tx=0;tv<ta;tv++,tx+=4)a(0,tx,tv/(ta-1));return th}var iG=function(tt){function e(ti){tt.call(this,ti,iZ),this._updateColorRamp()}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.createBucket=function(tt){return new iq(tt)},e.prototype._handleSpecialPaintPropertyUpdate=function(tt){"heatmap-color"===tt&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=wo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(eG),iX={paint:new wi({"hillshade-illumination-direction":new mi(tY.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mi(tY.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mi(tY.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mi(tY.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mi(tY.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mi(tY.paint_hillshade["hillshade-accent-color"])})},iW=function(tt){function e(ti){tt.call(this,ti,iX)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(eG),iK=Ii([{name:"a_pos",components:2,type:"Int16"}],4).members,iJ=Co,iY=Co;function Co(tt,ti,ta){ta=ta||2;var tc,th,tf,td,tm,ty,tg,t_=ti&&ti.length,tv=t_?ti[0]*ta:tt.length,tx=Eo(tt,0,tv,ta,!0),tb=[];if(!tx||tx.next===tx.prev)return tb;if(t_&&(tx=function(tt,ti,ta,tc){var th,tf,td,tm=[];for(th=0,tf=ti.length;th<tf;th++)(td=Eo(tt,ti[th]*tc,th<tf-1?ti[th+1]*tc:tt.length,tc,!1))===td.next&&(td.steiner=!0),tm.push(Uo(td));for(tm.sort(Do),th=0;th<tm.length;th++)Lo(tm[th],ta),ta=Po(ta,ta.next);return ta}(tt,ti,tx,ta)),tt.length>80*ta){tc=tf=tt[0],th=td=tt[1];for(var tw=ta;tw<tv;tw+=ta)(tm=tt[tw])<tc&&(tc=tm),(ty=tt[tw+1])<th&&(th=ty),tm>tf&&(tf=tm),ty>td&&(td=ty);tg=0!==(tg=Math.max(tf-tc,td-th))?1/tg:0}return Mo(tx,tb,ta,tc,th,tg),tb}function Eo(tt,ti,ta,tc,th){var tf,td;if(th===Qo(tt,ti,ta,tc)>0)for(tf=ti;tf<ta;tf+=tc)td=Yo(tf,tt[tf],tt[tf+1],td);else for(tf=ta-tc;tf>=ti;tf-=tc)td=Yo(tf,tt[tf],tt[tf+1],td);return td&&Ko(td,td.next)&&($o(td),td=td.next),td}function Po(tt,ti){if(!tt)return tt;ti||(ti=tt);var ta,tc=tt;do if(ta=!1,tc.steiner||!Ko(tc,tc.next)&&0!==No(tc.prev,tc,tc.next))tc=tc.next;else{if($o(tc),(tc=ti=tc.prev)===tc.next)break;ta=!0}while(ta||tc!==ti);return ti}function Mo(tt,ti,ta,tc,th,tf,td){if(tt){!td&&tf&&function(tt,ti,ta,tc){var th=tt;do null===th.z&&(th.z=Ro(th.x,th.y,ti,ta,tc)),th.prevZ=th.prev,th.nextZ=th.next,th=th.next;while(th!==tt);th.prevZ.nextZ=null,th.prevZ=null,function(tt){var ti,ta,tc,th,tf,td,tm,ty,tg=1;do{for(ta=tt,tt=null,tf=null,td=0;ta;){for(td++,tc=ta,tm=0,ti=0;ti<tg&&(tm++,tc=tc.nextZ);ti++);for(ty=tg;tm>0||ty>0&&tc;)0!==tm&&(0===ty||!tc||ta.z<=tc.z)?(th=ta,ta=ta.nextZ,tm--):(th=tc,tc=tc.nextZ,ty--),tf?tf.nextZ=th:tt=th,th.prevZ=tf,tf=th;ta=tc}tf.nextZ=null,tg*=2}while(td>1)}(th)}(tt,tc,th,tf);for(var tm,ty,tg=tt;tt.prev!==tt.next;)if(tm=tt.prev,ty=tt.next,tf?To(tt,tc,th,tf):Bo(tt))ti.push(tm.i/ta),ti.push(tt.i/ta),ti.push(ty.i/ta),$o(tt),tt=ty.next,tg=ty.next;else if((tt=ty)===tg){td?1===td?Mo(tt=Vo(Po(tt),ti,ta),ti,ta,tc,th,tf,2):2===td&&Fo(tt,ti,ta,tc,th,tf):Mo(Po(tt),ti,ta,tc,th,tf,1);break}}}function Bo(tt){var ti=tt.prev,ta=tt.next;if(No(ti,tt,ta)>=0)return!1;for(var tc=tt.next.next;tc!==tt.prev;){if(jo(ti.x,ti.y,tt.x,tt.y,ta.x,ta.y,tc.x,tc.y)&&No(tc.prev,tc,tc.next)>=0)return!1;tc=tc.next}return!0}function To(tt,ti,ta,tc){var th=tt.prev,tf=tt.next;if(No(th,tt,tf)>=0)return!1;for(var td=th.x>tt.x?th.x>tf.x?th.x:tf.x:tt.x>tf.x?tt.x:tf.x,tm=th.y>tt.y?th.y>tf.y?th.y:tf.y:tt.y>tf.y?tt.y:tf.y,ty=Ro(th.x<tt.x?th.x<tf.x?th.x:tf.x:tt.x<tf.x?tt.x:tf.x,th.y<tt.y?th.y<tf.y?th.y:tf.y:tt.y<tf.y?tt.y:tf.y,ti,ta,tc),tg=Ro(td,tm,ti,ta,tc),t_=tt.prevZ,tv=tt.nextZ;t_&&t_.z>=ty&&tv&&tv.z<=tg;){if(t_!==tt.prev&&t_!==tt.next&&jo(th.x,th.y,tt.x,tt.y,tf.x,tf.y,t_.x,t_.y)&&No(t_.prev,t_,t_.next)>=0||(t_=t_.prevZ,tv!==tt.prev&&tv!==tt.next&&jo(th.x,th.y,tt.x,tt.y,tf.x,tf.y,tv.x,tv.y)&&No(tv.prev,tv,tv.next)>=0))return!1;tv=tv.nextZ}for(;t_&&t_.z>=ty;){if(t_!==tt.prev&&t_!==tt.next&&jo(th.x,th.y,tt.x,tt.y,tf.x,tf.y,t_.x,t_.y)&&No(t_.prev,t_,t_.next)>=0)return!1;t_=t_.prevZ}for(;tv&&tv.z<=tg;){if(tv!==tt.prev&&tv!==tt.next&&jo(th.x,th.y,tt.x,tt.y,tf.x,tf.y,tv.x,tv.y)&&No(tv.prev,tv,tv.next)>=0)return!1;tv=tv.nextZ}return!0}function Vo(tt,ti,ta){var tc=tt;do{var th=tc.prev,tf=tc.next.next;!Ko(th,tf)&&Go(th,tc,tc.next,tf)&&Jo(th,tf)&&Jo(tf,th)&&(ti.push(th.i/ta),ti.push(tc.i/ta),ti.push(tf.i/ta),$o(tc),$o(tc.next),tc=tt=tf),tc=tc.next}while(tc!==tt);return Po(tc)}function Fo(tt,ti,ta,tc,th,tf){var td=tt;do{for(var tm=td.next.next;tm!==td.prev;){if(td.i!==tm.i&&qo(td,tm)){var ty=Ho(td,tm);return td=Po(td,td.next),ty=Po(ty,ty.next),Mo(td,ti,ta,tc,th,tf),void Mo(ty,ti,ta,tc,th,tf)}tm=tm.next}td=td.next}while(td!==tt)}function Do(tt,ti){return tt.x-ti.x}function Lo(tt,ti){if(ti=function(tt,ti){var ta,tc=ti,th=tt.x,tf=tt.y,td=-1/0;do{if(tf<=tc.y&&tf>=tc.next.y&&tc.next.y!==tc.y){var tm=tc.x+(tf-tc.y)*(tc.next.x-tc.x)/(tc.next.y-tc.y);if(tm<=th&&tm>td){if(td=tm,tm===th){if(tf===tc.y)return tc;if(tf===tc.next.y)return tc.next}ta=tc.x<tc.next.x?tc:tc.next}}tc=tc.next}while(tc!==ti);if(!ta)return null;if(th===td)return ta;var ty,tg=ta,t_=ta.x,tv=ta.y,tx=1/0;tc=ta;do th>=tc.x&&tc.x>=t_&&th!==tc.x&&jo(tf<tv?th:td,tf,t_,tv,tf<tv?td:th,tf,tc.x,tc.y)&&(ty=Math.abs(tf-tc.y)/(th-tc.x),Jo(tc,tt)&&(ty<tx||ty===tx&&(tc.x>ta.x||tc.x===ta.x&&Oo(ta,tc)))&&(ta=tc,tx=ty)),tc=tc.next;while(tc!==tg);return ta}(tt,ti)){var ta=Ho(ti,tt);Po(ti,ti.next),Po(ta,ta.next)}}function Oo(tt,ti){return 0>No(tt.prev,tt,ti.prev)&&0>No(ti.next,tt,tt.next)}function Ro(tt,ti,ta,tc,th){return(tt=1431655765&((tt=858993459&((tt=252645135&((tt=16711935&((tt=32767*(tt-ta)*th)|tt<<8))|tt<<4))|tt<<2))|tt<<1))|(ti=1431655765&((ti=858993459&((ti=252645135&((ti=16711935&((ti=32767*(ti-tc)*th)|ti<<8))|ti<<4))|ti<<2))|ti<<1))<<1}function Uo(tt){var ti=tt,ta=tt;do(ti.x<ta.x||ti.x===ta.x&&ti.y<ta.y)&&(ta=ti),ti=ti.next;while(ti!==tt);return ta}function jo(tt,ti,ta,tc,th,tf,td,tm){return(th-td)*(ti-tm)-(tt-td)*(tf-tm)>=0&&(tt-td)*(tc-tm)-(ta-td)*(ti-tm)>=0&&(ta-td)*(tf-tm)-(th-td)*(tc-tm)>=0}function qo(tt,ti){return tt.next.i!==ti.i&&tt.prev.i!==ti.i&&!function(tt,ti){var ta=tt;do{if(ta.i!==tt.i&&ta.next.i!==tt.i&&ta.i!==ti.i&&ta.next.i!==ti.i&&Go(ta,ta.next,tt,ti))return!0;ta=ta.next}while(ta!==tt);return!1}(tt,ti)&&(Jo(tt,ti)&&Jo(ti,tt)&&function(tt,ti){var ta=tt,tc=!1,th=(tt.x+ti.x)/2,tf=(tt.y+ti.y)/2;do ta.y>tf!=ta.next.y>tf&&ta.next.y!==ta.y&&th<(ta.next.x-ta.x)*(tf-ta.y)/(ta.next.y-ta.y)+ta.x&&(tc=!tc),ta=ta.next;while(ta!==tt);return tc}(tt,ti)&&(No(tt.prev,tt,ti.prev)||No(tt,ti.prev,ti))||Ko(tt,ti)&&No(tt.prev,tt,tt.next)>0&&No(ti.prev,ti,ti.next)>0)}function No(tt,ti,ta){return(ti.y-tt.y)*(ta.x-ti.x)-(ti.x-tt.x)*(ta.y-ti.y)}function Ko(tt,ti){return tt.x===ti.x&&tt.y===ti.y}function Go(tt,ti,ta,tc){var th=Xo(No(tt,ti,ta)),tf=Xo(No(tt,ti,tc)),td=Xo(No(ta,tc,tt)),tm=Xo(No(ta,tc,ti));return th!==tf&&td!==tm||!(0!==th||!Zo(tt,ta,ti))||!(0!==tf||!Zo(tt,tc,ti))||!(0!==td||!Zo(ta,tt,tc))||!(0!==tm||!Zo(ta,ti,tc))}function Zo(tt,ti,ta){return ti.x<=Math.max(tt.x,ta.x)&&ti.x>=Math.min(tt.x,ta.x)&&ti.y<=Math.max(tt.y,ta.y)&&ti.y>=Math.min(tt.y,ta.y)}function Xo(tt){return tt>0?1:tt<0?-1:0}function Jo(tt,ti){return 0>No(tt.prev,tt,tt.next)?No(tt,ti,tt.next)>=0&&No(tt,tt.prev,ti)>=0:0>No(tt,ti,tt.prev)||0>No(tt,tt.next,ti)}function Ho(tt,ti){var ta=new Wo(tt.i,tt.x,tt.y),tc=new Wo(ti.i,ti.x,ti.y),th=tt.next,tf=ti.prev;return tt.next=ti,ti.prev=tt,ta.next=th,th.prev=ta,tc.next=ta,ta.prev=tc,tf.next=tc,tc.prev=tf,tc}function Yo(tt,ti,ta,tc){var th=new Wo(tt,ti,ta);return tc?(th.next=tc.next,th.prev=tc,tc.next.prev=th,tc.next=th):(th.prev=th,th.next=th),th}function $o(tt){tt.next.prev=tt.prev,tt.prev.next=tt.next,tt.prevZ&&(tt.prevZ.nextZ=tt.nextZ),tt.nextZ&&(tt.nextZ.prevZ=tt.prevZ)}function Wo(tt,ti,ta){this.i=tt,this.x=ti,this.y=ta,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qo(tt,ti,ta,tc){for(var th=0,tf=ti,td=ta-tc;tf<ta;tf+=tc)th+=(tt[td]-tt[tf])*(tt[tf+1]+tt[td+1]),td=tf;return th}function ts(tt,ti,ta,tc,th){!function t(tt,ti,ta,tc,th){for(;tc>ta;){if(tc-ta>600){var tf=tc-ta+1,td=ti-ta+1,tm=Math.log(tf),ty=.5*Math.exp(2*tm/3),tg=.5*Math.sqrt(tm*ty*(tf-ty)/tf)*(td-tf/2<0?-1:1);t(tt,ti,Math.max(ta,Math.floor(ti-td*ty/tf+tg)),Math.min(tc,Math.floor(ti+(tf-td)*ty/tf+tg)),th)}var t_=tt[ti],tv=ta,tx=tc;for(es(tt,ta,ti),th(tt[tc],t_)>0&&es(tt,ta,tc);tv<tx;){for(es(tt,tv,tx),tv++,tx--;0>th(tt[tv],t_);)tv++;for(;th(tt[tx],t_)>0;)tx--}0===th(tt[ta],t_)?es(tt,ta,tx):es(tt,++tx,tc),tx<=ti&&(ta=tx+1),ti<=tx&&(tc=tx-1)}}(tt,ti,ta||0,tc||tt.length-1,th||rs)}function es(tt,ti,ta){var tc=tt[ti];tt[ti]=tt[ta],tt[ta]=tc}function rs(tt,ti){return tt<ti?-1:tt>ti?1:0}function ns(tt,ti){var ta=tt.length;if(ta<=1)return[tt];for(var tc,th,tf=[],td=0;td<ta;td++){var tm=k(tt[td]);0!==tm&&(tt[td].area=Math.abs(tm),void 0===th&&(th=tm<0),th===tm<0?(tc&&tf.push(tc),tc=[tt[td]]):tc.push(tt[td]))}if(tc&&tf.push(tc),ti>1)for(var ty=0;ty<tf.length;ty++)tf[ty].length<=ti||(ts(tf[ty],ti,1,tf[ty].length-1,is),tf[ty]=tf[ty].slice(0,ti));return tf}function is(tt,ti){return ti.area-tt.area}function as(tt,ti,ta){for(var tc=ta.patternDependencies,th=!1,tf=0;tf<ti.length;tf+=1){var td=ti[tf].paint.get(tt+"-pattern");td.isConstant()||(th=!0);var tm=td.constantOr(null);tm&&(th=!0,tc[tm.to]=!0,tc[tm.from]=!0)}return th}function os(tt,ti,ta,tc,th){for(var tf=th.patternDependencies,td=0;td<ti.length;td+=1){var tm=ti[td],ty=tm.paint.get(tt+"-pattern").value;if("constant"!==ty.kind){var tg=ty.evaluate({zoom:tc-1},ta,{},th.availableImages),t_=ty.evaluate({zoom:tc},ta,{},th.availableImages),tv=ty.evaluate({zoom:tc+1},ta,{},th.availableImages);t_=t_&&t_.name?t_.name:t_,tv=tv&&tv.name?tv.name:tv,tf[tg=tg&&tg.name?tg.name:tg]=!0,tf[t_]=!0,tf[tv]=!0,ta.patterns[tm.id]={min:tg,mid:t_,max:tv}}}return ta}Co.deviation=function(tt,ti,ta,tc){var th=ti&&ti.length,tf=Math.abs(Qo(tt,0,th?ti[0]*ta:tt.length,ta));if(th)for(var td=0,tm=ti.length;td<tm;td++)tf-=Math.abs(Qo(tt,ti[td]*ta,td<tm-1?ti[td+1]*ta:tt.length,ta));var ty=0;for(td=0;td<tc.length;td+=3){var tg=tc[td]*ta,t_=tc[td+1]*ta,tv=tc[td+2]*ta;ty+=Math.abs((tt[tg]-tt[tv])*(tt[t_+1]-tt[tg+1])-(tt[tg]-tt[t_])*(tt[tv+1]-tt[tg+1]))}return 0===tf&&0===ty?0:Math.abs((ty-tf)/tf)},Co.flatten=function(tt){for(var ti=tt[0][0].length,ta={vertices:[],holes:[],dimensions:ti},tc=0,th=0;th<tt.length;th++){for(var tf=0;tf<tt[th].length;tf++)for(var td=0;td<ti;td++)ta.vertices.push(tt[th][tf][td]);th>0&&ta.holes.push(tc+=tt[th-1].length)}return ta},iJ.default=iY;var ss=function(tt){this.zoom=tt.zoom,this.overscaling=tt.overscaling,this.layers=tt.layers,this.layerIds=this.layers.map(function(tt){return tt.id}),this.index=tt.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new eW,this.indexArray=new e6,this.indexArray2=new il,this.programConfigurations=new Va(tt.layers,tt.zoom),this.segments=new sa,this.segments2=new sa,this.stateDependentLayerIds=this.layers.filter(function(tt){return tt.isStateDependent()}).map(function(tt){return tt.id})};ss.prototype.populate=function(tt,ti,ta){this.hasPattern=as("fill",this.layers,ti);for(var tc=this.layers[0].layout.get("fill-sort-key"),th=[],tf=0;tf<tt.length;tf+=1){var td=tt[tf],tm=td.feature,ty=td.id,tg=td.index,t_=td.sourceLayerIndex,tv=this.layers[0]._featureFilter.needGeometry,tx=Ua(tm,tv);if(this.layers[0]._featureFilter.filter(new si(this.zoom),tx,ta)){var tb=tc?tc.evaluate(tx,{},ta,ti.availableImages):void 0,tw={id:ty,properties:tm.properties,type:tm.type,sourceLayerIndex:t_,index:tg,geometry:tv?tx.geometry:Ra(tm),patterns:{},sortKey:tb};th.push(tw)}}tc&&th.sort(function(tt,ti){return tt.sortKey-ti.sortKey});for(var tS=0;tS<th.length;tS+=1){var tT=th[tS],tI=tT.geometry,tE=tT.index,tA=tT.sourceLayerIndex;if(this.hasPattern){var tP=os("fill",this.layers,tT,this.zoom,ti);this.patternFeatures.push(tP)}else this.addFeature(tT,tI,tE,ta,{});ti.featureIndex.insert(tt[tE].feature,tI,tE,tA,this.index)}},ss.prototype.update=function(tt,ti,ta){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(tt,ti,this.stateDependentLayers,ta)},ss.prototype.addFeatures=function(tt,ti,ta){for(var tc=0,th=this.patternFeatures;tc<th.length;tc+=1){var tf=th[tc];this.addFeature(tf,tf.geometry,tf.index,ti,ta)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(tt){this.uploaded||(this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,iK),this.indexBuffer=tt.createIndexBuffer(this.indexArray),this.indexBuffer2=tt.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(tt),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(tt,ti,ta,tc,th){for(var tf=0,td=ns(ti,500);tf<td.length;tf+=1){for(var tm=td[tf],ty=0,tg=0;tg<tm.length;tg+=1)ty+=tm[tg].length;for(var t_=this.segments.prepareSegment(ty,this.layoutVertexArray,this.indexArray),tv=t_.vertexLength,tx=[],tb=[],tw=0;tw<tm.length;tw+=1){var tS=tm[tw];if(0!==tS.length){tS!==tm[0]&&tb.push(tx.length/2);var tT=this.segments2.prepareSegment(tS.length,this.layoutVertexArray,this.indexArray2),tI=tT.vertexLength;this.layoutVertexArray.emplaceBack(tS[0].x,tS[0].y),this.indexArray2.emplaceBack(tI+tS.length-1,tI),tx.push(tS[0].x),tx.push(tS[0].y);for(var tE=1;tE<tS.length;tE++)this.layoutVertexArray.emplaceBack(tS[tE].x,tS[tE].y),this.indexArray2.emplaceBack(tI+tE-1,tI+tE),tx.push(tS[tE].x),tx.push(tS[tE].y);tT.vertexLength+=tS.length,tT.primitiveLength+=tS.length}}for(var tA=iJ(tx,tb),tP=0;tP<tA.length;tP+=3)this.indexArray.emplaceBack(tv+tA[tP],tv+tA[tP+1],tv+tA[tP+2]);t_.vertexLength+=ty,t_.primitiveLength+=tA.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,tt,ta,th,tc)},On("FillBucket",ss,{omit:["layers","patternFeatures"]});var iH=new wi({"fill-sort-key":new vi(tY.layout_fill["fill-sort-key"])}),i$={paint:new wi({"fill-antialias":new mi(tY.paint_fill["fill-antialias"]),"fill-opacity":new vi(tY.paint_fill["fill-opacity"]),"fill-color":new vi(tY.paint_fill["fill-color"]),"fill-outline-color":new vi(tY.paint_fill["fill-outline-color"]),"fill-translate":new mi(tY.paint_fill["fill-translate"]),"fill-translate-anchor":new mi(tY.paint_fill["fill-translate-anchor"]),"fill-pattern":new eZ(tY.paint_fill["fill-pattern"])}),layout:iH},iQ=function(tt){function e(ti){tt.call(this,ti,i$)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.recalculate=function(ti,ta){tt.prototype.recalculate.call(this,ti,ta);var tc=this.paint._values["fill-outline-color"];"constant"===tc.value.kind&&void 0===tc.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(tt){return new ss(tt)},e.prototype.queryRadius=function(){return eo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(tt,ti,ta,tc,th,tf,td){return Ga(ro(tt,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),tf.angle,td),tc)},e.prototype.isTileClipped=function(){return!0},e}(eG),i0=Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,i1=fs;function fs(tt,ti,ta,tc,th){this.properties={},this.extent=ta,this.type=0,this._pbf=tt,this._geometry=-1,this._keys=tc,this._values=th,tt.readFields(ys,this,ti)}function ys(tt,ti,ta){1==tt?ti.id=ta.readVarint():2==tt?function(tt,ti){for(var ta=tt.readVarint()+tt.pos;tt.pos<ta;){var tc=ti._keys[tt.readVarint()],th=ti._values[tt.readVarint()];ti.properties[tc]=th}}(ta,ti):3==tt?ti.type=ta.readVarint():4==tt&&(ti._geometry=ta.pos)}function ds(tt){for(var ti,ta,tc=0,th=0,tf=tt.length,td=tf-1;th<tf;td=th++)tc+=((ta=tt[td]).x-(ti=tt[th]).x)*(ti.y+ta.y);return tc}fs.types=["Unknown","Point","LineString","Polygon"],fs.prototype.loadGeometry=function(){var tt=this._pbf;tt.pos=this._geometry;for(var ti,ta=tt.readVarint()+tt.pos,tc=1,tf=0,td=0,tm=0,ty=[];tt.pos<ta;){if(tf<=0){var tg=tt.readVarint();tc=7&tg,tf=tg>>3}if(tf--,1===tc||2===tc)td+=tt.readSVarint(),tm+=tt.readSVarint(),1===tc&&(ti&&ty.push(ti),ti=[]),ti.push(new th(td,tm));else{if(7!==tc)throw Error("unknown command "+tc);ti&&ti.push(ti[0].clone())}}return ti&&ty.push(ti),ty},fs.prototype.bbox=function(){var tt=this._pbf;tt.pos=this._geometry;for(var ti=tt.readVarint()+tt.pos,ta=1,tc=0,th=0,tf=0,td=1/0,tm=-1/0,ty=1/0,tg=-1/0;tt.pos<ti;){if(tc<=0){var t_=tt.readVarint();ta=7&t_,tc=t_>>3}if(tc--,1===ta||2===ta)(th+=tt.readSVarint())<td&&(td=th),th>tm&&(tm=th),(tf+=tt.readSVarint())<ty&&(ty=tf),tf>tg&&(tg=tf);else if(7!==ta)throw Error("unknown command "+ta)}return[td,ty,tm,tg]},fs.prototype.toGeoJSON=function(tt,ti,ta){var tc,th,tf=this.extent*Math.pow(2,ta),td=this.extent*tt,tm=this.extent*ti,ty=this.loadGeometry(),tg=fs.types[this.type];function p(tt){for(var ti=0;ti<tt.length;ti++){var ta=tt[ti];tt[ti]=[360*(ta.x+td)/tf-180,360/Math.PI*Math.atan(Math.exp((180-360*(ta.y+tm)/tf)*Math.PI/180))-90]}}switch(this.type){case 1:var t_=[];for(tc=0;tc<ty.length;tc++)t_[tc]=ty[tc][0];p(ty=t_);break;case 2:for(tc=0;tc<ty.length;tc++)p(ty[tc]);break;case 3:for(ty=function(tt){var ti=tt.length;if(ti<=1)return[tt];for(var ta,tc,th=[],tf=0;tf<ti;tf++){var td=ds(tt[tf]);0!==td&&(void 0===tc&&(tc=td<0),tc===td<0?(ta&&th.push(ta),ta=[tt[tf]]):ta.push(tt[tf]))}return ta&&th.push(ta),th}(ty),tc=0;tc<ty.length;tc++)for(th=0;th<ty[tc].length;th++)p(ty[tc][th])}1===ty.length?ty=ty[0]:tg="Multi"+tg;var tv={type:"Feature",geometry:{type:tg,coordinates:ty},properties:this.properties};return"id"in this&&(tv.id=this.id),tv};var i2=vs;function vs(tt,ti){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=tt,this._keys=[],this._values=[],this._features=[],tt.readFields(gs,this,ti),this.length=this._features.length}function gs(tt,ti,ta){15===tt?ti.version=ta.readVarint():1===tt?ti.name=ta.readString():5===tt?ti.extent=ta.readVarint():2===tt?ti._features.push(ta.pos):3===tt?ti._keys.push(ta.readString()):4===tt&&ti._values.push(function(tt){for(var ti=null,ta=tt.readVarint()+tt.pos;tt.pos<ta;){var tc=tt.readVarint()>>3;ti=1===tc?tt.readString():2===tc?tt.readFloat():3===tc?tt.readDouble():4===tc?tt.readVarint64():5===tc?tt.readVarint():6===tc?tt.readSVarint():7===tc?tt.readBoolean():null}return ti}(ta))}function xs(tt,ti,ta){if(3===tt){var tc=new i2(ta,ta.readVarint()+ta.pos);tc.length&&(ti[tc.name]=tc)}}vs.prototype.feature=function(tt){if(tt<0||tt>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[tt];var ti=this._pbf.readVarint()+this._pbf.pos;return new i1(this._pbf,ti,this.extent,this._keys,this._values)};var i5={VectorTile:function(tt,ti){this.layers=tt.readFields(xs,{},ti)},VectorTileFeature:i1,VectorTileLayer:i2},i4=i5.VectorTileFeature.types;function As(tt,ti,ta,tc,th,tf,td,tm){tt.emplaceBack(ti,ta,2*Math.floor(8192*tc)+td,16384*th,16384*tf,Math.round(tm))}var Ss=function(tt){this.zoom=tt.zoom,this.overscaling=tt.overscaling,this.layers=tt.layers,this.layerIds=this.layers.map(function(tt){return tt.id}),this.index=tt.index,this.hasPattern=!1,this.layoutVertexArray=new eJ,this.indexArray=new e6,this.programConfigurations=new Va(tt.layers,tt.zoom),this.segments=new sa,this.stateDependentLayerIds=this.layers.filter(function(tt){return tt.isStateDependent()}).map(function(tt){return tt.id})};function ks(tt,ti){return tt.x===ti.x&&(tt.x<0||tt.x>8192)||tt.y===ti.y&&(tt.y<0||tt.y>8192)}Ss.prototype.populate=function(tt,ti,ta){this.features=[],this.hasPattern=as("fill-extrusion",this.layers,ti);for(var tc=0;tc<tt.length;tc+=1){var th=tt[tc],tf=th.feature,td=th.id,tm=th.index,ty=th.sourceLayerIndex,tg=this.layers[0]._featureFilter.needGeometry,t_=Ua(tf,tg);if(this.layers[0]._featureFilter.filter(new si(this.zoom),t_,ta)){var tv={id:td,sourceLayerIndex:ty,index:tm,geometry:tg?t_.geometry:Ra(tf),properties:tf.properties,type:tf.type,patterns:{}};this.hasPattern?this.features.push(os("fill-extrusion",this.layers,tv,this.zoom,ti)):this.addFeature(tv,tv.geometry,tm,ta,{}),ti.featureIndex.insert(tf,tv.geometry,tm,ty,this.index,!0)}}},Ss.prototype.addFeatures=function(tt,ti,ta){for(var tc=0,th=this.features;tc<th.length;tc+=1){var tf=th[tc];this.addFeature(tf,tf.geometry,tf.index,ti,ta)}},Ss.prototype.update=function(tt,ti,ta){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(tt,ti,this.stateDependentLayers,ta)},Ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(tt){this.uploaded||(this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,i0),this.indexBuffer=tt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(tt),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(tt,ti,ta,tc,th){for(var tf=0,td=ns(ti,500);tf<td.length;tf+=1){for(var tm=td[tf],ty=0,tg=0;tg<tm.length;tg+=1)ty+=tm[tg].length;for(var t_=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),tv=0;tv<tm.length;tv+=1){var tx=tm[tv];if(0!==tx.length&&!(tx.every(function(tt){return tt.x<0})||tx.every(function(tt){return tt.x>8192})||tx.every(function(tt){return tt.y<0})||tx.every(function(tt){return tt.y>8192})))for(var tb=0,tw=0;tw<tx.length;tw++){var tS=tx[tw];if(tw>=1){var tT=tx[tw-1];if(!ks(tS,tT)){t_.vertexLength+4>sa.MAX_VERTEX_ARRAY_LENGTH&&(t_=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var tI=tS.sub(tT)._perp()._unit(),tE=tT.dist(tS);tb+tE>32768&&(tb=0),As(this.layoutVertexArray,tS.x,tS.y,tI.x,tI.y,0,0,tb),As(this.layoutVertexArray,tS.x,tS.y,tI.x,tI.y,0,1,tb),As(this.layoutVertexArray,tT.x,tT.y,tI.x,tI.y,0,0,tb+=tE),As(this.layoutVertexArray,tT.x,tT.y,tI.x,tI.y,0,1,tb);var tA=t_.vertexLength;this.indexArray.emplaceBack(tA,tA+2,tA+1),this.indexArray.emplaceBack(tA+1,tA+2,tA+3),t_.vertexLength+=4,t_.primitiveLength+=2}}}}if(t_.vertexLength+ty>sa.MAX_VERTEX_ARRAY_LENGTH&&(t_=this.segments.prepareSegment(ty,this.layoutVertexArray,this.indexArray)),"Polygon"===i4[tt.type]){for(var tP=[],tz=[],tC=t_.vertexLength,tk=0;tk<tm.length;tk+=1){var tM=tm[tk];if(0!==tM.length){tM!==tm[0]&&tz.push(tP.length/2);for(var tD=0;tD<tM.length;tD++){var tL=tM[tD];As(this.layoutVertexArray,tL.x,tL.y,0,0,1,1,0),tP.push(tL.x),tP.push(tL.y)}}}for(var tB=iJ(tP,tz),tR=0;tR<tB.length;tR+=3)this.indexArray.emplaceBack(tC+tB[tR],tC+tB[tR+2],tC+tB[tR+1]);t_.primitiveLength+=tB.length/3,t_.vertexLength+=ty}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,tt,ta,th,tc)},On("FillExtrusionBucket",Ss,{omit:["layers","features"]});var i3={paint:new wi({"fill-extrusion-opacity":new mi(tY["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vi(tY["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mi(tY["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mi(tY["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new eZ(tY["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vi(tY["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vi(tY["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mi(tY["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},i6=function(tt){function e(ti){tt.call(this,ti,i3)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.createBucket=function(tt){return new Ss(tt)},e.prototype.queryRadius=function(){return eo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(tt,ti,ta,tc,tf,td,tm,ty){var tg=ro(tt,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),td.angle,tm),t_=this.paint.get("fill-extrusion-height").evaluate(ti,ta),tv=this.paint.get("fill-extrusion-base").evaluate(ti,ta),tx=function(tt,ti,ta,tc){for(var tf=[],td=0;td<tt.length;td+=1){var tm=tt[td],ty=[tm.x,tm.y,0,1];po(ty,ty,ti),tf.push(new th(ty[0]/ty[3],ty[1]/ty[3]))}return tf}(tg,ty),tb=function(tt,ti,ta,tc){for(var tf=[],td=[],tm=tc[8]*ti,ty=tc[9]*ti,tg=tc[10]*ti,t_=tc[11]*ti,tv=tc[8]*ta,tx=tc[9]*ta,tb=tc[10]*ta,tw=tc[11]*ta,tS=0;tS<tt.length;tS+=1){for(var tT=[],tI=[],tE=0,tA=tt[tS];tE<tA.length;tE+=1){var tP=tA[tE],tz=tP.x,tC=tP.y,tk=tc[0]*tz+tc[4]*tC+tc[12],tM=tc[1]*tz+tc[5]*tC+tc[13],tD=tc[2]*tz+tc[6]*tC+tc[14],tL=tc[3]*tz+tc[7]*tC+tc[15],tB=tD+tg,tR=tL+t_,tO=tk+tv,tF=tM+tx,tU=tD+tb,tV=tL+tw,tN=new th((tk+tm)/tR,(tM+ty)/tR);tN.z=tB/tR,tT.push(tN);var tj=new th(tO/tV,tF/tV);tj.z=tU/tV,tI.push(tj)}tf.push(tT),td.push(tI)}return[tf,td]}(tc,tv,t_,ty);return function(tt,ti,ta){var tc=1/0;Ga(ta,ti)&&(tc=Es(ta,ti[0]));for(var th=0;th<ti.length;th++)for(var tf=ti[th],td=tt[th],tm=0;tm<tf.length-1;tm++){var ty=tf[tm],tg=[ty,tf[tm+1],td[tm+1],td[tm],ty];Na(ta,tg)&&(tc=Math.min(tc,Es(ta,tg)))}return tc!==1/0&&tc}(tb[0],tb[1],tx)},e}(eG);function Cs(tt,ti){return tt.x*ti.x+tt.y*ti.y}function Es(tt,ti){if(1===tt.length){for(var ta,tc=0,th=ti[tc++];!ta||th.equals(ta);)if(!(ta=ti[tc++]))return 1/0;for(;tc<ti.length;tc++){var tf=ti[tc],td=tt[0],tm=ta.sub(th),ty=tf.sub(th),tg=td.sub(th),t_=Cs(tm,tm),tv=Cs(tm,ty),tx=Cs(ty,ty),tb=Cs(tg,tm),tw=Cs(tg,ty),tS=t_*tx-tv*tv,tT=(tx*tb-tv*tw)/tS,tI=(t_*tw-tv*tb)/tS,tE=th.z*(1-tT-tI)+ta.z*tT+tf.z*tI;if(isFinite(tE))return tE}return 1/0}for(var tA=1/0,tP=0;tP<ti.length;tP+=1)tA=Math.min(tA,ti[tP].z);return tA}var i8=Ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,i9=Ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,i7=i5.VectorTileFeature.types,rt=Math.cos(Math.PI/180*37.5),Fs=function(tt){var ti=this;this.zoom=tt.zoom,this.overscaling=tt.overscaling,this.layers=tt.layers,this.layerIds=this.layers.map(function(tt){return tt.id}),this.index=tt.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(tt){ti.gradients[tt.id]={}}),this.layoutVertexArray=new eY,this.layoutVertexArray2=new eH,this.indexArray=new e6,this.programConfigurations=new Va(tt.layers,tt.zoom),this.segments=new sa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(tt){return tt.isStateDependent()}).map(function(tt){return tt.id})};Fs.prototype.populate=function(tt,ti,ta){this.hasPattern=as("line",this.layers,ti);for(var tc=this.layers[0].layout.get("line-sort-key"),th=[],tf=0;tf<tt.length;tf+=1){var td=tt[tf],tm=td.feature,ty=td.id,tg=td.index,t_=td.sourceLayerIndex,tv=this.layers[0]._featureFilter.needGeometry,tx=Ua(tm,tv);if(this.layers[0]._featureFilter.filter(new si(this.zoom),tx,ta)){var tb=tc?tc.evaluate(tx,{},ta):void 0,tw={id:ty,properties:tm.properties,type:tm.type,sourceLayerIndex:t_,index:tg,geometry:tv?tx.geometry:Ra(tm),patterns:{},sortKey:tb};th.push(tw)}}tc&&th.sort(function(tt,ti){return tt.sortKey-ti.sortKey});for(var tS=0;tS<th.length;tS+=1){var tT=th[tS],tI=tT.geometry,tE=tT.index,tA=tT.sourceLayerIndex;if(this.hasPattern){var tP=os("line",this.layers,tT,this.zoom,ti);this.patternFeatures.push(tP)}else this.addFeature(tT,tI,tE,ta,{});ti.featureIndex.insert(tt[tE].feature,tI,tE,tA,this.index)}},Fs.prototype.update=function(tt,ti,ta){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(tt,ti,this.stateDependentLayers,ta)},Fs.prototype.addFeatures=function(tt,ti,ta){for(var tc=0,th=this.patternFeatures;tc<th.length;tc+=1){var tf=th[tc];this.addFeature(tf,tf.geometry,tf.index,ti,ta)}},Fs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fs.prototype.upload=function(tt){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=tt.createVertexBuffer(this.layoutVertexArray2,i9)),this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,i8),this.indexBuffer=tt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(tt),this.uploaded=!0},Fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fs.prototype.lineFeatureClips=function(tt){if(tt.properties&&tt.properties.hasOwnProperty("mapbox_clip_start")&&tt.properties.hasOwnProperty("mapbox_clip_end"))return{start:+tt.properties.mapbox_clip_start,end:+tt.properties.mapbox_clip_end}},Fs.prototype.addFeature=function(tt,ti,ta,tc,th){var tf=this.layers[0].layout,td=tf.get("line-join").evaluate(tt,{}),tm=tf.get("line-cap"),ty=tf.get("line-miter-limit"),tg=tf.get("line-round-limit");this.lineClips=this.lineFeatureClips(tt);for(var t_=0;t_<ti.length;t_+=1)this.addLine(ti[t_],tt,td,tm,ty,tg);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,tt,ta,th,tc)},Fs.prototype.addLine=function(tt,ti,ta,tc,th,tf){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var td=0;td<tt.length-1;td++)this.totalDistance+=tt[td].dist(tt[td+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var tm="Polygon"===i7[ti.type],ty=tt.length;ty>=2&&tt[ty-1].equals(tt[ty-2]);)ty--;for(var tg=0;tg<ty-1&&tt[tg].equals(tt[tg+1]);)tg++;if(!(ty<(tm?3:2))){"bevel"===ta&&(th=1.05);var t_,tv=this.overscaling<=16?122880/(512*this.overscaling):0,tx=this.segments.prepareSegment(10*ty,this.layoutVertexArray,this.indexArray),tb=void 0,tw=void 0,tS=void 0,tT=void 0;this.e1=this.e2=-1,tm&&(tT=tt[tg].sub(t_=tt[ty-2])._unit()._perp());for(var tI=tg;tI<ty;tI++)if(!(tw=tI===ty-1?tm?tt[tg+1]:void 0:tt[tI+1])||!tt[tI].equals(tw)){tT&&(tS=tT),t_&&(tb=t_),t_=tt[tI],tT=tw?tw.sub(t_)._unit()._perp():tS;var tE=(tS=tS||tT).add(tT);0===tE.x&&0===tE.y||tE._unit();var tA=tS.x*tT.x+tS.y*tT.y,tP=tE.x*tT.x+tE.y*tT.y,tz=0!==tP?1/tP:1/0,tC=2*Math.sqrt(2-2*tP),tk=tP<rt&&tb&&tw,tM=tS.x*tT.y-tS.y*tT.x>0;if(tk&&tI>tg){var tD=t_.dist(tb);if(tD>2*tv){var tL=t_.sub(t_.sub(tb)._mult(tv/tD)._round());this.updateDistance(tb,tL),this.addCurrentVertex(tL,tS,0,0,tx),tb=tL}}var tB=tb&&tw,tR=tB?ta:tm?"butt":tc;if(tB&&"round"===tR&&(tz<tf?tR="miter":tz<=2&&(tR="fakeround")),"miter"===tR&&tz>th&&(tR="bevel"),"bevel"===tR&&(tz>2&&(tR="flipbevel"),tz<th&&(tR="miter")),tb&&this.updateDistance(tb,t_),"miter"===tR)tE._mult(tz),this.addCurrentVertex(t_,tE,0,0,tx);else if("flipbevel"===tR){if(tz>100)tE=tT.mult(-1);else{var tO=tz*tS.add(tT).mag()/tS.sub(tT).mag();tE._perp()._mult(tO*(tM?-1:1))}this.addCurrentVertex(t_,tE,0,0,tx),this.addCurrentVertex(t_,tE.mult(-1),0,0,tx)}else if("bevel"===tR||"fakeround"===tR){var tF=-Math.sqrt(tz*tz-1),tU=tM?tF:0,tV=tM?0:tF;if(tb&&this.addCurrentVertex(t_,tS,tU,tV,tx),"fakeround"===tR)for(var tN=Math.round(180*tC/Math.PI/20),tj=1;tj<tN;tj++){var tq=tj/tN;if(.5!==tq){var tZ=tq-.5;tq+=tq*tZ*(tq-1)*((1.0904+tA*(tA*(3.55645-1.43519*tA)-3.2452))*tZ*tZ+(.848013+tA*(.215638*tA-1.06021)))}var tG=tT.sub(tS)._mult(tq)._add(tS)._unit()._mult(tM?-1:1);this.addHalfVertex(t_,tG.x,tG.y,!1,tM,0,tx)}tw&&this.addCurrentVertex(t_,tT,-tU,-tV,tx)}else if("butt"===tR)this.addCurrentVertex(t_,tE,0,0,tx);else if("square"===tR){var tX=tb?1:-1;this.addCurrentVertex(t_,tE,tX,tX,tx)}else"round"===tR&&(tb&&(this.addCurrentVertex(t_,tS,0,0,tx),this.addCurrentVertex(t_,tS,1,1,tx,!0)),tw&&(this.addCurrentVertex(t_,tT,-1,-1,tx,!0),this.addCurrentVertex(t_,tT,0,0,tx)));if(tk&&tI<ty-1){var tW=t_.dist(tw);if(tW>2*tv){var tK=t_.add(tw.sub(t_)._mult(tv/tW)._round());this.updateDistance(t_,tK),this.addCurrentVertex(tK,tT,0,0,tx),t_=tK}}}}},Fs.prototype.addCurrentVertex=function(tt,ti,ta,tc,th,tf){void 0===tf&&(tf=!1);var td=ti.y*tc-ti.x,tm=-ti.y-ti.x*tc;this.addHalfVertex(tt,ti.x+ti.y*ta,ti.y-ti.x*ta,tf,!1,ta,th),this.addHalfVertex(tt,td,tm,tf,!0,-tc,th),this.distance>16384&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(tt,ti,ta,tc,th,tf))},Fs.prototype.addHalfVertex=function(tt,ti,ta,tc,th,tf,td){var tm=.5*(this.lineClips?32767*this.scaledDistance:this.scaledDistance);this.layoutVertexArray.emplaceBack((tt.x<<1)+(tc?1:0),(tt.y<<1)+(th?1:0),Math.round(63*ti)+128,Math.round(63*ta)+128,1+(0===tf?0:tf<0?-1:1)|(63&tm)<<2,tm>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var ty=td.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ty),td.primitiveLength++),th?this.e2=ty:this.e1=ty},Fs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Fs.prototype.updateDistance=function(tt,ti){this.distance+=tt.dist(ti),this.updateScaledDistance()},On("LineBucket",Fs,{omit:["layers","patternFeatures"]});var rr=new wi({"line-cap":new mi(tY.layout_line["line-cap"]),"line-join":new vi(tY.layout_line["line-join"]),"line-miter-limit":new mi(tY.layout_line["line-miter-limit"]),"line-round-limit":new mi(tY.layout_line["line-round-limit"]),"line-sort-key":new vi(tY.layout_line["line-sort-key"])}),ra={paint:new wi({"line-opacity":new vi(tY.paint_line["line-opacity"]),"line-color":new vi(tY.paint_line["line-color"]),"line-translate":new mi(tY.paint_line["line-translate"]),"line-translate-anchor":new mi(tY.paint_line["line-translate-anchor"]),"line-width":new vi(tY.paint_line["line-width"]),"line-gap-width":new vi(tY.paint_line["line-gap-width"]),"line-offset":new vi(tY.paint_line["line-offset"]),"line-blur":new vi(tY.paint_line["line-blur"]),"line-dasharray":new xi(tY.paint_line["line-dasharray"]),"line-pattern":new eZ(tY.paint_line["line-pattern"]),"line-gradient":new bi(tY.paint_line["line-gradient"])}),layout:rr},rc=new(function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(ti,ta){return ta=new si(Math.floor(ta.zoom),{now:ta.now,fadeDuration:ta.fadeDuration,zoomHistory:ta.zoomHistory,transition:ta.transition}),tt.prototype.possiblyEvaluate.call(this,ti,ta)},e.prototype.evaluate=function(ti,ta,tc,th){return ta=h({},ta,{zoom:Math.floor(ta.zoom)}),tt.prototype.evaluate.call(this,ti,ta,tc,th)},e}(vi))(ra.paint.properties["line-width"].specification);rc.useIntegerZoom=!0;var rh=function(tt){function e(ti){tt.call(this,ti,ra),this.gradientVersion=0}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(tt){"line-gradient"===tt&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ne,this.gradientVersion=(this.gradientVersion+1)%9007199254740991)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(ti,ta){tt.prototype.recalculate.call(this,ti,ta),this.paint._values["line-floorwidth"]=rc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,ti)},e.prototype.createBucket=function(tt){return new Fs(tt)},e.prototype.queryRadius=function(tt){var ti,ta;return ti=to("line-width",this,tt),((ta=to("line-gap-width",this,tt))>0?ta+2*ti:ti)/2+Math.abs(to("line-offset",this,tt))+eo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(tt,ti,ta,tc,tf,td,tm){var ty,tg,t_=ro(tt,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),td.angle,tm),tv=tm/2*(ty=this.paint.get("line-width").evaluate(ti,ta),(tg=this.paint.get("line-gap-width").evaluate(ti,ta))>0?tg+2*ty:ty),tx=this.paint.get("line-offset").evaluate(ti,ta);return tx&&(tc=function(tt,ti){for(var ta=[],tc=new th(0,0),tf=0;tf<tt.length;tf++){for(var td=tt[tf],tm=[],ty=0;ty<td.length;ty++){var tg=td[ty],t_=td[ty+1],tv=0===ty?tc:tg.sub(td[ty-1])._unit()._perp(),tx=ty===td.length-1?tc:t_.sub(tg)._unit()._perp(),tb=tv._add(tx)._unit();tb._mult(1/(tb.x*tx.x+tb.y*tx.y)),tm.push(tb._mult(ti)._add(tg))}ta.push(tm)}return ta}(tc,tx*tm)),function(tt,ti,ta){for(var tc=0;tc<ti.length;tc++){var th=ti[tc];if(tt.length>=3){for(var tf=0;tf<th.length;tf++)if(Wa(tt,th[tf]))return!0}if(Za(tt,th,ta))return!0}return!1}(t_,tc,tv)},e.prototype.isTileClipped=function(){return!0},e}(eG),rf=Ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rd=Ii([{name:"a_projected_pos",components:3,type:"Float32"}],4),rm=(Ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ry=(Ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),rg=Ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zs(tt,ti,ta){return tt.sections.forEach(function(tt){var tc,th;tt.text=(tc=tt.text,"uppercase"===(th=ti.layout.get("text-transform").evaluate(ta,{}))?tc=tc.toLocaleUpperCase():"lowercase"===th&&(tc=tc.toLocaleLowerCase()),eq.applyArabicShaping&&(tc=eq.applyArabicShaping(tc)),tc)}),tt}Ii([{name:"triangle",components:3,type:"Uint16"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ii([{type:"Float32",name:"offsetX"}]),Ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var r_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","\xa2":"￠","\xa3":"￡","\xa5":"￥","\xa6":"￤","\xac":"￢","\xaf":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Js=function(tt,ti,ta,tc,th){var tf,td,tm=8*th-tc-1,ty=(1<<tm)-1,tg=ty>>1,t_=-7,tv=ta?th-1:0,tx=ta?-1:1,tb=tt[ti+tv];for(tv+=tx,tf=tb&(1<<-t_)-1,tb>>=-t_,t_+=tm;t_>0;tf=256*tf+tt[ti+tv],tv+=tx,t_-=8);for(td=tf&(1<<-t_)-1,tf>>=-t_,t_+=tc;t_>0;td=256*td+tt[ti+tv],tv+=tx,t_-=8);if(0===tf)tf=1-tg;else{if(tf===ty)return td?NaN:1/0*(tb?-1:1);td+=Math.pow(2,tc),tf-=tg}return(tb?-1:1)*td*Math.pow(2,tf-tc)},Hs=function(tt,ti,ta,tc,th,tf){var td,tm,ty,tg=8*tf-th-1,t_=(1<<tg)-1,tv=t_>>1,tx=23===th?5960464477539062e-23:0,tb=tc?0:tf-1,tw=tc?1:-1,tS=ti<0||0===ti&&1/ti<0?1:0;for(isNaN(ti=Math.abs(ti))||ti===1/0?(tm=isNaN(ti)?1:0,td=t_):(td=Math.floor(Math.log(ti)/Math.LN2),ti*(ty=Math.pow(2,-td))<1&&(td--,ty*=2),(ti+=td+tv>=1?tx/ty:tx*Math.pow(2,1-tv))*ty>=2&&(td++,ty/=2),td+tv>=t_?(tm=0,td=t_):td+tv>=1?(tm=(ti*ty-1)*Math.pow(2,th),td+=tv):(tm=ti*Math.pow(2,tv-1)*Math.pow(2,th),td=0));th>=8;tt[ta+tb]=255&tm,tb+=tw,tm/=256,th-=8);for(td=td<<th|tm,tg+=th;tg>0;tt[ta+tb]=255&td,tb+=tw,td/=256,tg-=8);tt[ta+tb-tw]|=128*tS},rv=$s;function $s(tt){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(tt)?tt:new Uint8Array(tt||0),this.pos=0,this.type=0,this.length=this.buf.length}$s.Varint=0,$s.Fixed64=1,$s.Bytes=2,$s.Fixed32=5;var rx="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Qs(tt){return tt.type===$s.Bytes?tt.readVarint()+tt.pos:tt.pos+1}function tu(tt,ti,ta){return ta?4294967296*ti+(tt>>>0):4294967296*(ti>>>0)+(tt>>>0)}function eu(tt,ti,ta){var tc=ti<=16383?1:ti<=2097151?2:ti<=268435455?3:Math.floor(Math.log(ti)/(7*Math.LN2));ta.realloc(tc);for(var th=ta.pos-1;th>=tt;th--)ta.buf[th+tc]=ta.buf[th]}function ru(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeVarint(tt[ta])}function nu(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeSVarint(tt[ta])}function iu(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeFloat(tt[ta])}function au(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeDouble(tt[ta])}function ou(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeBoolean(tt[ta])}function su(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeFixed32(tt[ta])}function uu(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeSFixed32(tt[ta])}function lu(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeFixed64(tt[ta])}function pu(tt,ti){for(var ta=0;ta<tt.length;ta++)ti.writeSFixed64(tt[ta])}function cu(tt,ti){return(tt[ti]|tt[ti+1]<<8|tt[ti+2]<<16)+16777216*tt[ti+3]}function hu(tt,ti,ta){tt[ta]=ti,tt[ta+1]=ti>>>8,tt[ta+2]=ti>>>16,tt[ta+3]=ti>>>24}function fu(tt,ti){return(tt[ti]|tt[ti+1]<<8|tt[ti+2]<<16)+(tt[ti+3]<<24)}function yu(tt,ti,ta){1===tt&&ta.readMessage(du,ti)}function du(tt,ti,ta){if(3===tt){var tc=ta.readMessage(mu,{}),th=tc.width,tf=tc.height,td=tc.left,tm=tc.top,ty=tc.advance;ti.push({id:tc.id,bitmap:new go({width:th+6,height:tf+6},tc.bitmap),metrics:{width:th,height:tf,left:td,top:tm,advance:ty}})}}function mu(tt,ti,ta){1===tt?ti.id=ta.readVarint():2===tt?ti.bitmap=ta.readBytes():3===tt?ti.width=ta.readVarint():4===tt?ti.height=ta.readVarint():5===tt?ti.left=ta.readSVarint():6===tt?ti.top=ta.readSVarint():7===tt&&(ti.advance=ta.readVarint())}function vu(tt){for(var ti=0,ta=0,tc=0;tc<tt.length;tc+=1){var th=tt[tc];ti+=th.w*th.h,ta=Math.max(ta,th.w)}tt.sort(function(tt,ti){return ti.h-tt.h});for(var tf=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(ti/.95)),ta),h:1/0}],td=0,tm=0,ty=0;ty<tt.length;ty+=1)for(var tg=tt[ty],t_=tf.length-1;t_>=0;t_--){var tv=tf[t_];if(!(tg.w>tv.w||tg.h>tv.h)){if(tg.x=tv.x,tg.y=tv.y,tm=Math.max(tm,tg.y+tg.h),td=Math.max(td,tg.x+tg.w),tg.w===tv.w&&tg.h===tv.h){var tx=tf.pop();t_<tf.length&&(tf[t_]=tx)}else tg.h===tv.h?(tv.x+=tg.w,tv.w-=tg.w):(tg.w===tv.w||tf.push({x:tv.x+tg.w,y:tv.y,w:tv.w-tg.w,h:tg.h}),tv.y+=tg.h,tv.h-=tg.h);break}}return{w:td,h:tm,fill:ti/(td*tm)||0}}$s.prototype={destroy:function(){this.buf=null},readFields:function(tt,ti,ta){for(ta=ta||this.length;this.pos<ta;){var tc=this.readVarint(),th=tc>>3,tf=this.pos;this.type=7&tc,tt(th,ti,this),this.pos===tf&&this.skip(tc)}return ti},readMessage:function(tt,ti){return this.readFields(tt,ti,this.readVarint()+this.pos)},readFixed32:function(){var tt=cu(this.buf,this.pos);return this.pos+=4,tt},readSFixed32:function(){var tt=fu(this.buf,this.pos);return this.pos+=4,tt},readFixed64:function(){var tt=cu(this.buf,this.pos)+4294967296*cu(this.buf,this.pos+4);return this.pos+=8,tt},readSFixed64:function(){var tt=cu(this.buf,this.pos)+4294967296*fu(this.buf,this.pos+4);return this.pos+=8,tt},readFloat:function(){var tt=Js(this.buf,this.pos,!0,23,4);return this.pos+=4,tt},readDouble:function(){var tt=Js(this.buf,this.pos,!0,52,8);return this.pos+=8,tt},readVarint:function(tt){var ti,ta,tc=this.buf;return ti=127&(ta=tc[this.pos++]),ta<128?ti:(ti|=(127&(ta=tc[this.pos++]))<<7,ta<128?ti:(ti|=(127&(ta=tc[this.pos++]))<<14,ta<128?ti:(ti|=(127&(ta=tc[this.pos++]))<<21,ta<128?ti:function(tt,ti,ta){var tc,th,tf=ta.buf;if(tc=(112&(th=tf[ta.pos++]))>>4,th<128||(tc|=(127&(th=tf[ta.pos++]))<<3,th<128)||(tc|=(127&(th=tf[ta.pos++]))<<10,th<128)||(tc|=(127&(th=tf[ta.pos++]))<<17,th<128)||(tc|=(127&(th=tf[ta.pos++]))<<24,th<128)||(tc|=(1&(th=tf[ta.pos++]))<<31,th<128))return tu(tt,tc,ti);throw Error("Expected varint not more than 10 bytes")}(ti|=(15&(ta=tc[this.pos]))<<28,tt,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var tt=this.readVarint();return tt%2==1?-((tt+1)/2):tt/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var tt,ti=this.readVarint()+this.pos,ta=this.pos;return this.pos=ti,ti-ta>=12&&rx?(tt=this.buf,rx.decode(tt.subarray(ta,ti))):function(tt,ti,ta){for(var tc="",th=ti;th<ta;){var tf,td,tm,ty=tt[th],tg=null,t_=ty>239?4:ty>223?3:ty>191?2:1;if(th+t_>ta)break;1===t_?ty<128&&(tg=ty):2===t_?128==(192&(tf=tt[th+1]))&&(tg=(31&ty)<<6|63&tf)<=127&&(tg=null):3===t_?(td=tt[th+2],128==(192&(tf=tt[th+1]))&&128==(192&td)&&((tg=(15&ty)<<12|(63&tf)<<6|63&td)<=2047||tg>=55296&&tg<=57343)&&(tg=null)):4===t_&&(td=tt[th+2],tm=tt[th+3],128==(192&(tf=tt[th+1]))&&128==(192&td)&&128==(192&tm)&&((tg=(15&ty)<<18|(63&tf)<<12|(63&td)<<6|63&tm)<=65535||tg>=1114112)&&(tg=null)),null===tg?(tg=65533,t_=1):tg>65535&&(tg-=65536,tc+=String.fromCharCode(tg>>>10&1023|55296),tg=56320|1023&tg),tc+=String.fromCharCode(tg),th+=t_}return tc}(this.buf,ta,ti)},readBytes:function(){var tt=this.readVarint()+this.pos,ti=this.buf.subarray(this.pos,tt);return this.pos=tt,ti},readPackedVarint:function(tt,ti){if(this.type!==$s.Bytes)return tt.push(this.readVarint(ti));var ta=Qs(this);for(tt=tt||[];this.pos<ta;)tt.push(this.readVarint(ti));return tt},readPackedSVarint:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readSVarint());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readSVarint());return tt},readPackedBoolean:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readBoolean());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readBoolean());return tt},readPackedFloat:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readFloat());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readFloat());return tt},readPackedDouble:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readDouble());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readDouble());return tt},readPackedFixed32:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readFixed32());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readFixed32());return tt},readPackedSFixed32:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readSFixed32());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readSFixed32());return tt},readPackedFixed64:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readFixed64());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readFixed64());return tt},readPackedSFixed64:function(tt){if(this.type!==$s.Bytes)return tt.push(this.readSFixed64());var ti=Qs(this);for(tt=tt||[];this.pos<ti;)tt.push(this.readSFixed64());return tt},skip:function(tt){var ti=7&tt;if(ti===$s.Varint)for(;this.buf[this.pos++]>127;);else if(ti===$s.Bytes)this.pos=this.readVarint()+this.pos;else if(ti===$s.Fixed32)this.pos+=4;else{if(ti!==$s.Fixed64)throw Error("Unimplemented type: "+ti);this.pos+=8}},writeTag:function(tt,ti){this.writeVarint(tt<<3|ti)},realloc:function(tt){for(var ti=this.length||16;ti<this.pos+tt;)ti*=2;if(ti!==this.length){var ta=new Uint8Array(ti);ta.set(this.buf),this.buf=ta,this.length=ti}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(tt){this.realloc(4),hu(this.buf,tt,this.pos),this.pos+=4},writeSFixed32:function(tt){this.realloc(4),hu(this.buf,tt,this.pos),this.pos+=4},writeFixed64:function(tt){this.realloc(8),hu(this.buf,-1&tt,this.pos),hu(this.buf,Math.floor(tt*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(tt){this.realloc(8),hu(this.buf,-1&tt,this.pos),hu(this.buf,Math.floor(tt*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(tt){(tt=+tt||0)>268435455||tt<0?function(tt,ti){var ta,tc,th,tf,td;if(tt>=0?(ta=tt%4294967296|0,tc=tt/4294967296|0):(tc=~(-tt/4294967296),4294967295^(ta=~(-tt%4294967296))?ta=ta+1|0:(ta=0,tc=tc+1|0)),tt>=18446744073709552e3||tt<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");ti.realloc(10),th=ta,ti.buf[ti.pos++]=127&th|128,th>>>=7,ti.buf[ti.pos++]=127&th|128,th>>>=7,ti.buf[ti.pos++]=127&th|128,th>>>=7,ti.buf[ti.pos++]=127&th|128,ti.buf[ti.pos]=127&(th>>>=7),td=(7&(tf=tc))<<4,ti.buf[ti.pos++]|=td|((tf>>>=3)?128:0),tf&&(ti.buf[ti.pos++]=127&tf|((tf>>>=7)?128:0),tf&&(ti.buf[ti.pos++]=127&tf|((tf>>>=7)?128:0),tf&&(ti.buf[ti.pos++]=127&tf|((tf>>>=7)?128:0),tf&&(ti.buf[ti.pos++]=127&tf|((tf>>>=7)?128:0),tf&&(ti.buf[ti.pos++]=127&tf)))))}(tt,this):(this.realloc(4),this.buf[this.pos++]=127&tt|(tt>127?128:0),tt<=127||(this.buf[this.pos++]=127&(tt>>>=7)|(tt>127?128:0),tt<=127||(this.buf[this.pos++]=127&(tt>>>=7)|(tt>127?128:0),tt<=127||(this.buf[this.pos++]=tt>>>7&127))))},writeSVarint:function(tt){this.writeVarint(tt<0?-(2*tt)-1:2*tt)},writeBoolean:function(tt){this.writeVarint(!!tt)},writeString:function(tt){tt=String(tt),this.realloc(4*tt.length),this.pos++;var ti=this.pos;this.pos=function(tt,ti,ta){for(var tc,th,tf=0;tf<ti.length;tf++){if((tc=ti.charCodeAt(tf))>55295&&tc<57344){if(!th){tc>56319||tf+1===ti.length?(tt[ta++]=239,tt[ta++]=191,tt[ta++]=189):th=tc;continue}if(tc<56320){tt[ta++]=239,tt[ta++]=191,tt[ta++]=189,th=tc;continue}tc=th-55296<<10|tc-56320|65536,th=null}else th&&(tt[ta++]=239,tt[ta++]=191,tt[ta++]=189,th=null);tc<128?tt[ta++]=tc:(tc<2048?tt[ta++]=tc>>6|192:(tc<65536?tt[ta++]=tc>>12|224:(tt[ta++]=tc>>18|240,tt[ta++]=tc>>12&63|128),tt[ta++]=tc>>6&63|128),tt[ta++]=63&tc|128)}return ta}(this.buf,tt,this.pos);var ta=this.pos-ti;ta>=128&&eu(ti,ta,this),this.pos=ti-1,this.writeVarint(ta),this.pos+=ta},writeFloat:function(tt){this.realloc(4),Hs(this.buf,tt,this.pos,!0,23,4),this.pos+=4},writeDouble:function(tt){this.realloc(8),Hs(this.buf,tt,this.pos,!0,52,8),this.pos+=8},writeBytes:function(tt){var ti=tt.length;this.writeVarint(ti),this.realloc(ti);for(var ta=0;ta<ti;ta++)this.buf[this.pos++]=tt[ta]},writeRawMessage:function(tt,ti){this.pos++;var ta=this.pos;tt(ti,this);var tc=this.pos-ta;tc>=128&&eu(ta,tc,this),this.pos=ta-1,this.writeVarint(tc),this.pos+=tc},writeMessage:function(tt,ti,ta){this.writeTag(tt,$s.Bytes),this.writeRawMessage(ti,ta)},writePackedVarint:function(tt,ti){ti.length&&this.writeMessage(tt,ru,ti)},writePackedSVarint:function(tt,ti){ti.length&&this.writeMessage(tt,nu,ti)},writePackedBoolean:function(tt,ti){ti.length&&this.writeMessage(tt,ou,ti)},writePackedFloat:function(tt,ti){ti.length&&this.writeMessage(tt,iu,ti)},writePackedDouble:function(tt,ti){ti.length&&this.writeMessage(tt,au,ti)},writePackedFixed32:function(tt,ti){ti.length&&this.writeMessage(tt,su,ti)},writePackedSFixed32:function(tt,ti){ti.length&&this.writeMessage(tt,uu,ti)},writePackedFixed64:function(tt,ti){ti.length&&this.writeMessage(tt,lu,ti)},writePackedSFixed64:function(tt,ti){ti.length&&this.writeMessage(tt,pu,ti)},writeBytesField:function(tt,ti){this.writeTag(tt,$s.Bytes),this.writeBytes(ti)},writeFixed32Field:function(tt,ti){this.writeTag(tt,$s.Fixed32),this.writeFixed32(ti)},writeSFixed32Field:function(tt,ti){this.writeTag(tt,$s.Fixed32),this.writeSFixed32(ti)},writeFixed64Field:function(tt,ti){this.writeTag(tt,$s.Fixed64),this.writeFixed64(ti)},writeSFixed64Field:function(tt,ti){this.writeTag(tt,$s.Fixed64),this.writeSFixed64(ti)},writeVarintField:function(tt,ti){this.writeTag(tt,$s.Varint),this.writeVarint(ti)},writeSVarintField:function(tt,ti){this.writeTag(tt,$s.Varint),this.writeSVarint(ti)},writeStringField:function(tt,ti){this.writeTag(tt,$s.Bytes),this.writeString(ti)},writeFloatField:function(tt,ti){this.writeTag(tt,$s.Fixed32),this.writeFloat(ti)},writeDoubleField:function(tt,ti){this.writeTag(tt,$s.Fixed64),this.writeDouble(ti)},writeBooleanField:function(tt,ti){this.writeVarintField(tt,!!ti)}};var gu=function(tt,ti){var ta=ti.pixelRatio,tc=ti.version,th=ti.stretchX,tf=ti.stretchY,td=ti.content;this.paddedRect=tt,this.pixelRatio=ta,this.stretchX=th,this.stretchY=tf,this.content=td,this.version=tc},rb={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};rb.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},rb.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},rb.tlbr.get=function(){return this.tl.concat(this.br)},rb.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gu.prototype,rb);var bu=function(tt,ti){var ta={},tc={};this.haveRenderCallbacks=[];var th=[];this.addImages(tt,ta,th),this.addImages(ti,tc,th);var tf=vu(th),td=new xo({width:tf.w||1,height:tf.h||1});for(var tm in tt){var ty=tt[tm],tg=ta[tm].paddedRect;xo.copy(ty.data,td,{x:0,y:0},{x:tg.x+1,y:tg.y+1},ty.data)}for(var t_ in ti){var tv=ti[t_],tx=tc[t_].paddedRect,tb=tx.x+1,tw=tx.y+1,tS=tv.data.width,tT=tv.data.height;xo.copy(tv.data,td,{x:0,y:0},{x:tb,y:tw},tv.data),xo.copy(tv.data,td,{x:0,y:tT-1},{x:tb,y:tw-1},{width:tS,height:1}),xo.copy(tv.data,td,{x:0,y:0},{x:tb,y:tw+tT},{width:tS,height:1}),xo.copy(tv.data,td,{x:tS-1,y:0},{x:tb-1,y:tw},{width:1,height:tT}),xo.copy(tv.data,td,{x:0,y:0},{x:tb+tS,y:tw},{width:1,height:tT})}this.image=td,this.iconPositions=ta,this.patternPositions=tc};bu.prototype.addImages=function(tt,ti,ta){for(var tc in tt){var th=tt[tc],tf={x:0,y:0,w:th.data.width+2,h:th.data.height+2};ta.push(tf),ti[tc]=new gu(tf,th),th.hasRenderCallback&&this.haveRenderCallbacks.push(tc)}},bu.prototype.patchUpdatedImages=function(tt,ti){for(var ta in tt.dispatchRenderCallbacks(this.haveRenderCallbacks),tt.updatedImages)this.patchUpdatedImage(this.iconPositions[ta],tt.getImage(ta),ti),this.patchUpdatedImage(this.patternPositions[ta],tt.getImage(ta),ti)},bu.prototype.patchUpdatedImage=function(tt,ti,ta){if(tt&&ti&&tt.version!==ti.version){tt.version=ti.version;var tc=tt.tl;ta.update(ti.data,void 0,{x:tc[0],y:tc[1]})}},On("ImagePosition",gu),On("ImageAtlas",bu);var rw={horizontal:1,vertical:2,horizontalOnly:3},_u=function(){this.scale=1,this.fontStack="",this.imageName=null};_u.forText=function(tt,ti){var ta=new _u;return ta.scale=tt||1,ta.fontStack=ti,ta},_u.forImage=function(tt){var ti=new _u;return ti.imageName=tt,ti};var Au=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Su(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS){var tT,tI=Au.fromFeature(tt,th);tv===rw.vertical&&tI.verticalizePunctuation();var tE=eq.processBidirectionalText,tA=eq.processStyledBidirectionalText;if(tE&&1===tI.sections.length){tT=[];for(var tP=0,tz=tE(tI.toString(),Mu(tI,tg,tf,ti,tc,tb,tw));tP<tz.length;tP+=1){var tC=tz[tP],tk=new Au;tk.text=tC,tk.sections=tI.sections;for(var tM=0;tM<tC.length;tM++)tk.sectionIndex.push(0);tT.push(tk)}}else if(tA){tT=[];for(var tD=0,tL=tA(tI.text,tI.sectionIndex,Mu(tI,tg,tf,ti,tc,tb,tw));tD<tL.length;tD+=1){var tB=tL[tD],tR=new Au;tR.text=tB[0],tR.sectionIndex=tB[1],tR.sections=tI.sections,tT.push(tR)}}else tT=function(tt,ti){for(var ta=[],tc=tt.text,th=0,tf=0;tf<ti.length;tf+=1){var td=ti[tf];ta.push(tt.substring(th,td)),th=td}return th<tc.length&&ta.push(tt.substring(th,tc.length)),ta}(tI,Mu(tI,tg,tf,ti,tc,tb,tw));var tO=[],tF={positionedLines:tO,text:tI.toString(),top:t_[1],bottom:t_[1],left:t_[0],right:t_[0],writingMode:tv,iconsInText:!1,verticalizable:!1};return function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv){for(var tx=0,tb=-17,tw=0,tS=0,tT="right"===tm?1:"left"===tm?0:.5,tI=0,tE=0;tE<th.length;tE+=1){var tA=th[tE];tA.trim();var tP=tA.getMaxScale(),tz=24*(tP-1),tC={positionedGlyphs:[],lineOffset:0};tt.positionedLines[tI]=tC;var tk=tC.positionedGlyphs,tM=0;if(tA.length()){for(var tD=0;tD<tA.length();tD++){var tL=tA.getSection(tD),tB=tA.getSectionIndex(tD),tR=tA.getCharCode(tD),tO=0,tF=null,tU=null,tV=null,tN=24,tj=!(ty===rw.horizontal||!t_&&!Xn(tR)||t_&&(rS[tR]||eF.Arabic(tR)||eF["Arabic Supplement"](tR)||eF["Arabic Extended-A"](tR)||eF["Arabic Presentation Forms-A"](tR)||eF["Arabic Presentation Forms-B"](tR)));if(tL.imageName){var tq=tc[tL.imageName];if(!tq)continue;tV=tL.imageName,tt.iconsInText=tt.iconsInText||!0,tU=tq.paddedRect;var tZ=tq.displaySize;tL.scale=24*tL.scale/tv,tO=tz+(24-tZ[1]*tL.scale),tN=(tF={width:tZ[0],height:tZ[1],left:1,top:-3,advance:tj?tZ[1]:tZ[0]}).advance;var tG=tj?tZ[0]*tL.scale-24*tP:tZ[1]*tL.scale-24*tP;tG>0&&tG>tM&&(tM=tG)}else{var tX=ta[tL.fontStack],tW=tX&&tX[tR];if(tW&&tW.rect)tU=tW.rect,tF=tW.metrics;else{var tK=ti[tL.fontStack],tJ=tK&&tK[tR];if(!tJ)continue;tF=tJ.metrics}tO=24*(tP-tL.scale)}tj?(tt.verticalizable=!0,tk.push({glyph:tR,imageName:tV,x:tx,y:tb+tO,vertical:tj,scale:tL.scale,fontStack:tL.fontStack,sectionIndex:tB,metrics:tF,rect:tU}),tx+=tN*tL.scale+tg):(tk.push({glyph:tR,imageName:tV,x:tx,y:tb+tO,vertical:tj,scale:tL.scale,fontStack:tL.fontStack,sectionIndex:tB,metrics:tF,rect:tU}),tx+=tF.advance*tL.scale+tg)}0!==tk.length&&(tw=Math.max(tx-tg,tw),Tu(tk,0,tk.length-1,tT,tM)),tx=0;var tY=tf*tP+tM;tC.lineOffset=Math.max(tM,tz),tb+=tY,tS=Math.max(tY,tS),++tI}else tb+=tf,++tI}var tH=tb- -17,t$=Bu(td),tQ=t$.horizontalAlign,t0=t$.verticalAlign;(function(tt,ti,ta,tc,th,tf,td,tm,ty){var tg,t_=(ti-ta)*th;tg=tf!==td?-tm*tc- -17:(-tc*ty+.5)*td;for(var tv=0;tv<tt.length;tv+=1)for(var tx=0,tb=tt[tv].positionedGlyphs;tx<tb.length;tx+=1){var tw=tb[tx];tw.x+=t_,tw.y+=tg}})(tt.positionedLines,tT,tQ,t0,tw,tS,tf,tH,th.length),tt.top+=-t0*tH,tt.bottom=tt.top+tH,tt.left+=-tQ*tw,tt.right=tt.left+tw}(tF,ti,ta,tc,tT,td,tm,ty,tv,tg,tx,tS),!function(tt){for(var ti=0;ti<tt.length;ti+=1)if(0!==tt[ti].positionedGlyphs.length)return!1;return!0}(tO)&&tF}Au.fromFeature=function(tt,ti){for(var ta=new Au,tc=0;tc<tt.sections.length;tc++){var th=tt.sections[tc];th.image?ta.addImageSection(th):ta.addTextSection(th,ti)}return ta},Au.prototype.length=function(){return this.text.length},Au.prototype.getSection=function(tt){return this.sections[this.sectionIndex[tt]]},Au.prototype.getSectionIndex=function(tt){return this.sectionIndex[tt]},Au.prototype.getCharCode=function(tt){return this.text.charCodeAt(tt)},Au.prototype.verticalizePunctuation=function(){this.text=function(tt){for(var ti="",ta=0;ta<tt.length;ta++){var tc=tt.charCodeAt(ta+1)||null,th=tt.charCodeAt(ta-1)||null;ti+=tc&&Jn(tc)&&!r_[tt[ta+1]]||th&&Jn(th)&&!r_[tt[ta-1]]||!r_[tt[ta]]?tt[ta]:r_[tt[ta]]}return ti}(this.text)},Au.prototype.trim=function(){for(var tt=0,ti=0;ti<this.text.length&&rS[this.text.charCodeAt(ti)];ti++)tt++;for(var ta=this.text.length,tc=this.text.length-1;tc>=0&&tc>=tt&&rS[this.text.charCodeAt(tc)];tc--)ta--;this.text=this.text.substring(tt,ta),this.sectionIndex=this.sectionIndex.slice(tt,ta)},Au.prototype.substring=function(tt,ti){var ta=new Au;return ta.text=this.text.substring(tt,ti),ta.sectionIndex=this.sectionIndex.slice(tt,ti),ta.sections=this.sections,ta},Au.prototype.toString=function(){return this.text},Au.prototype.getMaxScale=function(){var tt=this;return this.sectionIndex.reduce(function(ti,ta){return Math.max(ti,tt.sections[ta].scale)},0)},Au.prototype.addTextSection=function(tt,ti){this.text+=tt.text,this.sections.push(_u.forText(tt.scale,tt.fontStack||ti));for(var ta=this.sections.length-1,tc=0;tc<tt.text.length;++tc)this.sectionIndex.push(ta)},Au.prototype.addImageSection=function(tt){var ti=tt.image?tt.image.name:"";if(0!==ti.length){var ta=this.getNextImageSectionCharCode();ta?(this.text+=String.fromCharCode(ta),this.sections.push(_u.forImage(ti)),this.sectionIndex.push(this.sections.length-1)):A("Reached maximum number of images 6401")}else A("Can't add FormattedSection with an empty image.")},Au.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var rS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rT={};function zu(tt,ti,ta,tc,th,tf){if(ti.imageName){var td=tc[ti.imageName];return td?td.displaySize[0]*ti.scale*24/tf+th:0}var tm=ta[ti.fontStack],ty=tm&&tm[tt];return ty?ty.metrics.advance*ti.scale+th:0}function Cu(tt,ti,ta,tc){var th=Math.pow(tt-ti,2);return tc?tt<ti?th/2:2*th:th+Math.abs(ta)*ta}function Eu(tt,ti,ta){var tc=0;return 10===tt&&(tc-=1e4),ta&&(tc+=150),40!==tt&&65288!==tt||(tc+=50),41!==ti&&65289!==ti||(tc+=50),tc}function Pu(tt,ti,ta,tc,th,tf){for(var td=null,tm=Cu(ti,ta,th,tf),ty=0;ty<tc.length;ty+=1){var tg=tc[ty],t_=Cu(ti-tg.x,ta,th,tf)+tg.badness;t_<=tm&&(td=tg,tm=t_)}return{index:tt,x:ti,priorBreak:td,badness:tm}}function Mu(tt,ti,ta,tc,th,tf,td){if("point"!==tf||!tt)return[];for(var tm=[],ty=function(tt,ti,ta,tc,th,tf){for(var td=0,tm=0;tm<tt.length();tm++){var ty=tt.getSection(tm);td+=zu(tt.getCharCode(tm),ty,tc,th,ti,tf)}return td/Math.max(1,Math.ceil(td/ta))}(tt,ti,ta,tc,th,td),tg=tt.text.indexOf("​")>=0,t_=0,tv=0;tv<tt.length();tv++){var tx=tt.getSection(tv),tb=tt.getCharCode(tv);if(rS[tb]||(t_+=zu(tb,tx,tc,th,ti,td)),tv<tt.length()-1){var tw=!(tb<11904||!(eF["Bopomofo Extended"](tb)||eF.Bopomofo(tb)||eF["CJK Compatibility Forms"](tb)||eF["CJK Compatibility Ideographs"](tb)||eF["CJK Compatibility"](tb)||eF["CJK Radicals Supplement"](tb)||eF["CJK Strokes"](tb)||eF["CJK Symbols and Punctuation"](tb)||eF["CJK Unified Ideographs Extension A"](tb)||eF["CJK Unified Ideographs"](tb)||eF["Enclosed CJK Letters and Months"](tb)||eF["Halfwidth and Fullwidth Forms"](tb)||eF.Hiragana(tb)||eF["Ideographic Description Characters"](tb)||eF["Kangxi Radicals"](tb)||eF["Katakana Phonetic Extensions"](tb)||eF.Katakana(tb)||eF["Vertical Forms"](tb)||eF["Yi Radicals"](tb)||eF["Yi Syllables"](tb)));(rT[tb]||tw||tx.imageName)&&tm.push(Pu(tv+1,t_,ty,tm,Eu(tb,tt.getCharCode(tv+1),tw&&tg),!1))}}return function t(tt){return tt?t(tt.priorBreak).concat(tt.index):[]}(Pu(tt.length(),t_,ty,tm,0,!0))}function Bu(tt){var ti=.5,ta=.5;switch(tt){case"right":case"top-right":case"bottom-right":ti=1;break;case"left":case"top-left":case"bottom-left":ti=0}switch(tt){case"bottom":case"bottom-right":case"bottom-left":ta=1;break;case"top":case"top-right":case"top-left":ta=0}return{horizontalAlign:ti,verticalAlign:ta}}function Tu(tt,ti,ta,tc,th){if(tc||th)for(var tf=tt[ta],td=(tt[ta].x+tf.metrics.advance*tf.scale)*tc,tm=ti;tm<=ta;tm++)tt[tm].x-=td,tt[tm].y+=th}function Vu(tt,ti,ta,tc,th,tf){var td,tm=tt.image;if(tm.content){var ty=tm.content,tg=tm.pixelRatio||1;td=[ty[0]/tg,ty[1]/tg,tm.displaySize[0]-ty[2]/tg,tm.displaySize[1]-ty[3]/tg]}var t_,tv,tx,tb,tw=ti.left*tf,tS=ti.right*tf;"width"===ta||"both"===ta?(tb=th[0]+tw-tc[3],tv=th[0]+tS+tc[1]):tv=(tb=th[0]+(tw+tS-tm.displaySize[0])/2)+tm.displaySize[0];var tT=ti.top*tf,tI=ti.bottom*tf;return"height"===ta||"both"===ta?(t_=th[1]+tT-tc[0],tx=th[1]+tI+tc[2]):tx=(t_=th[1]+(tT+tI-tm.displaySize[1])/2)+tm.displaySize[1],{image:tm,top:t_,right:tv,bottom:tx,left:tb,collisionPadding:td}}rT[10]=!0,rT[32]=!0,rT[38]=!0,rT[40]=!0,rT[41]=!0,rT[43]=!0,rT[45]=!0,rT[47]=!0,rT[173]=!0,rT[183]=!0,rT[8203]=!0,rT[8208]=!0,rT[8211]=!0,rT[8231]=!0;var rI=function(tt){function e(ti,ta,tc,th){tt.call(this,ti,ta),this.angle=tc,void 0!==th&&(this.segment=th)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(th);function Du(tt,ti){var ta=ti.expression;if("constant"===ta.kind)return{kind:"constant",layoutSize:ta.evaluate(new si(tt+1))};if("source"===ta.kind)return{kind:"source"};for(var tc=ta.zoomStops,th=ta.interpolationType,tf=0;tf<tc.length&&tc[tf]<=tt;)tf++;for(var td=tf=Math.max(0,tf-1);td<tc.length&&tc[td]<tt+1;)td++;td=Math.min(tc.length-1,td);var tm=tc[tf],ty=tc[td];return"composite"===ta.kind?{kind:"composite",minZoom:tm,maxZoom:ty,interpolationType:th}:{kind:"camera",minZoom:tm,maxZoom:ty,minSize:ta.evaluate(new si(tm)),maxSize:ta.evaluate(new si(ty)),interpolationType:th}}function Lu(tt,ti,ta){var tc=ti.uSize,th=ta.lowerSize;return"source"===tt.kind?th/128:"composite"===tt.kind?Ke(th/128,ta.upperSize/128,ti.uSizeT):tc}function Ou(tt,ti){var ta=0,tc=0;if("constant"===tt.kind)tc=tt.layoutSize;else if("source"!==tt.kind){var th=tt.interpolationType,tf=th?p(ar.interpolationFactor(th,ti,tt.minZoom,tt.maxZoom),0,1):0;"camera"===tt.kind?tc=Ke(tt.minSize,tt.maxSize,tf):ta=tf}return{uSizeT:ta,uSize:tc}}On("Anchor",rI);var rE=Object.freeze({__proto__:null,getSizeData:Du,evaluateSizeForFeature:Lu,evaluateSizeForZoom:Ou,SIZE_PACK_FACTOR:128});function Uu(tt,ti,ta,tc,th){if(void 0===ti.segment)return!0;for(var tf=ti,td=ti.segment+1,tm=0;tm>-ta/2;){if(--td<0)return!1;tm-=tt[td].dist(tf),tf=tt[td]}tm+=tt[td].dist(tt[td+1]),td++;for(var ty=[],tg=0;tm<ta/2;){var t_=tt[td],tv=tt[td+1];if(!tv)return!1;var tx=tt[td-1].angleTo(t_)-t_.angleTo(tv);for(tx=Math.abs((tx+3*Math.PI)%(2*Math.PI)-Math.PI),ty.push({distance:tm,angleDelta:tx}),tg+=tx;tm-ty[0].distance>tc;)tg-=ty.shift().angleDelta;if(tg>th)return!1;td++,tm+=t_.dist(tv)}return!0}function ju(tt){for(var ti=0,ta=0;ta<tt.length-1;ta++)ti+=tt[ta].dist(tt[ta+1]);return ti}function Nu(tt,ti){return Math.max(tt?tt.right-tt.left:0,ti?ti.right-ti.left:0)}function Ku(tt,ti,ta,tc,th,tf){for(var td=ta?.6*th*tf:0,tm=Nu(ta,tc)*tf,ty=0,tg=ju(tt)/2,t_=0;t_<tt.length-1;t_++){var tv=tt[t_],tx=tt[t_+1],tb=tv.dist(tx);if(ty+tb>tg){var tw=(tg-ty)/tb,tS=new rI(Ke(tv.x,tx.x,tw),Ke(tv.y,tx.y,tw),tx.angleTo(tv),t_);return tS._round(),!td||Uu(tt,tS,tm,td,ti)?tS:void 0}ty+=tb}}function Gu(tt,ti,ta,tc,th,tf,td,tm,ty){var tg=tc?.6*tf*td:0,t_=Nu(tc,th),tv=t_*td,tx=0===tt[0].x||tt[0].x===ty||0===tt[0].y||tt[0].y===ty;return ti-tv<ti/4&&(ti=tv+ti/4),function t(tt,ti,ta,tc,th,tf,td,tm,ty){for(var tg=tf/2,t_=ju(tt),tv=0,tx=ti-ta,tb=[],tw=0;tw<tt.length-1;tw++){for(var tS=tt[tw],tT=tt[tw+1],tI=tS.dist(tT),tE=tT.angleTo(tS);tx+ta<tv+tI;){var tA=((tx+=ta)-tv)/tI,tP=Ke(tS.x,tT.x,tA),tz=Ke(tS.y,tT.y,tA);if(tP>=0&&tP<ty&&tz>=0&&tz<ty&&tx-tg>=0&&tx+tg<=t_){var tC=new rI(tP,tz,tE,tw);tC._round(),tc&&!Uu(tt,tC,tf,tc,th)||tb.push(tC)}}tv+=tI}return tm||tb.length||td||(tb=t(tt,tv/2,ta,tc,th,tf,td,!0,ty)),tb}(tt,tx?ti/2*tm%ti:(t_/2+2*tf)*td*tm%ti,ti,tg,ta,tv,tx,!1,ty)}function Zu(tt,ti,ta,tc,tf){for(var td=[],tm=0;tm<tt.length;tm++)for(var ty=tt[tm],tg=void 0,t_=0;t_<ty.length-1;t_++){var tv=ty[t_],tx=ty[t_+1];tv.x<ti&&tx.x<ti||(tv.x<ti?tv=new th(ti,tv.y+(ti-tv.x)/(tx.x-tv.x)*(tx.y-tv.y))._round():tx.x<ti&&(tx=new th(ti,tv.y+(ti-tv.x)/(tx.x-tv.x)*(tx.y-tv.y))._round()),tv.y<ta&&tx.y<ta||(tv.y<ta?tv=new th(tv.x+(ta-tv.y)/(tx.y-tv.y)*(tx.x-tv.x),ta)._round():tx.y<ta&&(tx=new th(tv.x+(ta-tv.y)/(tx.y-tv.y)*(tx.x-tv.x),ta)._round()),tv.x>=tc&&tx.x>=tc||(tv.x>=tc?tv=new th(tc,tv.y+(tc-tv.x)/(tx.x-tv.x)*(tx.y-tv.y))._round():tx.x>=tc&&(tx=new th(tc,tv.y+(tc-tv.x)/(tx.x-tv.x)*(tx.y-tv.y))._round()),tv.y>=tf&&tx.y>=tf||(tv.y>=tf?tv=new th(tv.x+(tf-tv.y)/(tx.y-tv.y)*(tx.x-tv.x),tf)._round():tx.y>=tf&&(tx=new th(tv.x+(tf-tv.y)/(tx.y-tv.y)*(tx.x-tv.x),tf)._round()),tg&&tv.equals(tg[tg.length-1])||td.push(tg=[tv]),tg.push(tx)))))}return td}function Xu(tt,ti,ta,tc){var tf=[],td=tt.image,tm=td.pixelRatio,ty=td.paddedRect.w-2,tg=td.paddedRect.h-2,t_=tt.right-tt.left,tv=tt.bottom-tt.top,tx=td.stretchX||[[0,ty]],tb=td.stretchY||[[0,tg]],y=function(tt,ti){return tt+ti[1]-ti[0]},tw=tx.reduce(y,0),tS=tb.reduce(y,0),tT=ty-tw,tI=tg-tS,tE=0,tA=tw,tP=0,tz=tS,tC=0,tk=tT,tM=0,tD=tI;if(td.content&&tc){var tL=td.content;tE=Ju(tx,0,tL[0]),tP=Ju(tb,0,tL[1]),tA=Ju(tx,tL[0],tL[2]),tz=Ju(tb,tL[1],tL[3]),tC=tL[0]-tE,tM=tL[1]-tP,tk=tL[2]-tL[0]-tA,tD=tL[3]-tL[1]-tz}var C=function(tc,tf,ty,tg){var tx,tb,tT,tI,tL,tB,tR,tO,tF,tU,tV,tN,tj=(tc.stretch-tE)/tA*t_+tt.left,tq=(tT=tc.fixed-tC,tT-tk*tc.stretch/tw),tZ=(tf.stretch-tP)/tz*tv+tt.top,tG=(tB=tf.fixed-tM,tB-tD*tf.stretch/tS),tX=(ty.stretch-tE)/tA*t_+tt.left,tW=(tF=ty.fixed-tC,tF-tk*ty.stretch/tw),tK=(tg.stretch-tP)/tz*tv+tt.top,tJ=(tN=tg.fixed-tM,tN-tD*tg.stretch/tS),tY=new th(tj,tZ),tH=new th(tX,tZ),t$=new th(tX,tK),tQ=new th(tj,tK),t0=new th(tq/tm,tG/tm),t1=new th(tW/tm,tJ/tm),t2=ti*Math.PI/180;if(t2){var t5=Math.sin(t2),t4=Math.cos(t2),t3=[t4,-t5,t5,t4];tY._matMult(t3),tH._matMult(t3),tQ._matMult(t3),t$._matMult(t3)}var t6=tc.stretch+tc.fixed,t8=tf.stretch+tf.fixed;return{tl:tY,tr:tH,bl:tQ,br:t$,tex:{x:td.paddedRect.x+1+t6,y:td.paddedRect.y+1+t8,w:ty.stretch+ty.fixed-t6,h:tg.stretch+tg.fixed-t8},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:t0,pixelOffsetBR:t1,minFontScaleX:tk/tm/t_,minFontScaleY:tD/tm/tv,isSDF:ta}};if(tc&&(td.stretchX||td.stretchY))for(var tB=Hu(tx,tT,tw),tR=Hu(tb,tI,tS),tO=0;tO<tB.length-1;tO++)for(var tF=tB[tO],tU=tB[tO+1],tV=0;tV<tR.length-1;tV++)tf.push(C(tF,tR[tV],tU,tR[tV+1]));else tf.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ty+1},{fixed:0,stretch:tg+1}));return tf}function Ju(tt,ti,ta){for(var tc=0,th=0;th<tt.length;th+=1){var tf=tt[th];tc+=Math.max(ti,Math.min(ta,tf[1]))-Math.max(ti,Math.min(ta,tf[0]))}return tc}function Hu(tt,ti,ta){for(var tc=[{fixed:-1,stretch:0}],th=0;th<tt.length;th+=1){var tf=tt[th],td=tf[0],tm=tf[1],ty=tc[tc.length-1];tc.push({fixed:td-ty.stretch,stretch:ty.stretch}),tc.push({fixed:td-ty.stretch,stretch:ty.stretch+(tm-td)})}return tc.push({fixed:ti+1,stretch:ta}),tc}var Wu=function(tt,ti,ta,tc,tf,td,tm,ty,tg,t_){if(this.boxStartIndex=tt.length,tg){var tv=td.top,tx=td.bottom,tb=td.collisionPadding;tb&&(tv-=tb[1],tx+=tb[3]);var tw=tx-tv;tw>0&&(tw=Math.max(10,tw),this.circleDiameter=tw)}else{var tS=td.top*tm-ty,tT=td.bottom*tm+ty,tI=td.left*tm-ty,tE=td.right*tm+ty,tA=td.collisionPadding;if(tA&&(tI-=tA[0]*tm,tS-=tA[1]*tm,tE+=tA[2]*tm,tT+=tA[3]*tm),t_){var tP=new th(tI,tS),tz=new th(tE,tS),tC=new th(tI,tT),tk=new th(tE,tT),tM=t_*Math.PI/180;tP._rotate(tM),tz._rotate(tM),tC._rotate(tM),tk._rotate(tM),tI=Math.min(tP.x,tz.x,tC.x,tk.x),tE=Math.max(tP.x,tz.x,tC.x,tk.x),tS=Math.min(tP.y,tz.y,tC.y,tk.y),tT=Math.max(tP.y,tz.y,tC.y,tk.y)}tt.emplaceBack(ti.x,ti.y,tI,tS,tE,tT,ta,tc,tf)}this.boxEndIndex=tt.length},Qu=function(tt,ti){if(void 0===tt&&(tt=[]),void 0===ti&&(ti=tl),this.data=tt,this.length=this.data.length,this.compare=ti,this.length>0)for(var ta=(this.length>>1)-1;ta>=0;ta--)this._down(ta)};function tl(tt,ti){return tt<ti?-1:tt>ti?1:0}function el(tt,ti,ta){void 0===ti&&(ti=1),void 0===ta&&(ta=!1);for(var tc=1/0,tf=1/0,td=-1/0,tm=-1/0,ty=tt[0],tg=0;tg<ty.length;tg++){var t_=ty[tg];(!tg||t_.x<tc)&&(tc=t_.x),(!tg||t_.y<tf)&&(tf=t_.y),(!tg||t_.x>td)&&(td=t_.x),(!tg||t_.y>tm)&&(tm=t_.y)}var tv=Math.min(td-tc,tm-tf),tx=tv/2,tb=new Qu([],rl);if(0===tv)return new th(tc,tf);for(var tw=tc;tw<td;tw+=tv)for(var tS=tf;tS<tm;tS+=tv)tb.push(new nl(tw+tx,tS+tx,tx,tt));for(var tT=function(tt){for(var ti=0,ta=0,tc=0,th=tt[0],tf=0,td=th.length,tm=td-1;tf<td;tm=tf++){var ty=th[tf],tg=th[tm],t_=ty.x*tg.y-tg.x*ty.y;ta+=(ty.x+tg.x)*t_,tc+=(ty.y+tg.y)*t_,ti+=3*t_}return new nl(ta/ti,tc/ti,0,tt)}(tt),tI=tb.length;tb.length;){var tE=tb.pop();(tE.d>tT.d||!tT.d)&&(tT=tE,ta&&console.log("found best %d after %d probes",Math.round(1e4*tE.d)/1e4,tI)),tE.max-tT.d<=ti||(tb.push(new nl(tE.p.x-(tx=tE.h/2),tE.p.y-tx,tx,tt)),tb.push(new nl(tE.p.x+tx,tE.p.y-tx,tx,tt)),tb.push(new nl(tE.p.x-tx,tE.p.y+tx,tx,tt)),tb.push(new nl(tE.p.x+tx,tE.p.y+tx,tx,tt)),tI+=4)}return ta&&(console.log("num probes: "+tI),console.log("best distance: "+tT.d)),tT.p}function rl(tt,ti){return ti.max-tt.max}function nl(tt,ti,ta,tc){this.p=new th(tt,ti),this.h=ta,this.d=function(tt,ti){for(var ta=!1,tc=1/0,th=0;th<ti.length;th++)for(var tf=ti[th],td=0,tm=tf.length,ty=tm-1;td<tm;ty=td++){var tg=tf[td],t_=tf[ty];tg.y>tt.y!=t_.y>tt.y&&tt.x<(t_.x-tg.x)*(tt.y-tg.y)/(t_.y-tg.y)+tg.x&&(ta=!ta),tc=Math.min(tc,Ya(tt,tg,t_))}return(ta?1:-1)*Math.sqrt(tc)}(this.p,tc),this.max=this.d+this.h*Math.SQRT2}Qu.prototype.push=function(tt){this.data.push(tt),this.length++,this._up(this.length-1)},Qu.prototype.pop=function(){if(0!==this.length){var tt=this.data[0],ti=this.data.pop();return this.length--,this.length>0&&(this.data[0]=ti,this._down(0)),tt}},Qu.prototype.peek=function(){return this.data[0]},Qu.prototype._up=function(tt){for(var ti=this.data,ta=this.compare,tc=ti[tt];tt>0;){var th=tt-1>>1,tf=ti[th];if(ta(tc,tf)>=0)break;ti[tt]=tf,tt=th}ti[tt]=tc},Qu.prototype._down=function(tt){for(var ti=this.data,ta=this.compare,tc=this.length>>1,th=ti[tt];tt<tc;){var tf=1+(tt<<1),td=ti[tf],tm=tf+1;if(tm<this.length&&0>ta(ti[tm],td)&&(tf=tm,td=ti[tm]),ta(td,th)>=0)break;ti[tt]=td,tt=tf}ti[tt]=th};var rA=Number.POSITIVE_INFINITY;function al(tt,ti){return ti[1]!==rA?function(tt,ti,ta){var tc=0,th=0;switch(ti=Math.abs(ti),ta=Math.abs(ta),tt){case"top-right":case"top-left":case"top":th=ta-7;break;case"bottom-right":case"bottom-left":case"bottom":th=7-ta}switch(tt){case"top-right":case"bottom-right":case"right":tc=-ti;break;case"top-left":case"bottom-left":case"left":tc=ti}return[tc,th]}(tt,ti[0],ti[1]):function(tt,ti){var ta=0,tc=0;ti<0&&(ti=0);var th=ti/Math.sqrt(2);switch(tt){case"top-right":case"top-left":tc=th-7;break;case"bottom-right":case"bottom-left":tc=7-th;break;case"bottom":tc=7-ti;break;case"top":tc=ti-7}switch(tt){case"top-right":case"bottom-right":ta=-th;break;case"top-left":case"bottom-left":ta=th;break;case"left":ta=ti;break;case"right":ta=-ti}return[ta,tc]}(tt,ti[0])}function ol(tt){switch(tt){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sl(tt,ti,ta,tc,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS){var tT=function(tt,ti,ta,tc,tf,td,tm,ty){for(var tg=tc.layout.get("text-rotate").evaluate(td,{})*Math.PI/180,t_=[],tv=0,tx=ti.positionedLines;tv<tx.length;tv+=1)for(var tb=tx[tv],tw=0,tS=tb.positionedGlyphs;tw<tS.length;tw+=1){var tT=tS[tw];if(tT.rect){var tI=tT.rect||{},tE=4,tA=!0,tP=1,tz=0,tC=(tf||ty)&&tT.vertical,tk=tT.metrics.advance*tT.scale/2;if(ty&&ti.verticalizable&&(tz=tb.lineOffset/2-(tT.imageName?-(24-tT.metrics.width*tT.scale)/2:24*(tT.scale-1))),tT.imageName){var tM=tm[tT.imageName];tA=tM.sdf,tE=1/(tP=tM.pixelRatio)}var tD=tf?[tT.x+tk,tT.y]:[0,0],tL=tf?[0,0]:[tT.x+tk+ta[0],tT.y+ta[1]-tz],tB=[0,0];tC&&(tB=tL,tL=[0,0]);var tR=(tT.metrics.left-tE)*tT.scale-tk+tL[0],tO=(-tT.metrics.top-tE)*tT.scale+tL[1],tF=tR+tI.w*tT.scale/tP,tU=tO+tI.h*tT.scale/tP,tV=new th(tR,tO),tN=new th(tF,tO),tj=new th(tR,tU),tq=new th(tF,tU);if(tC){var tZ=new th(-tk,tk- -17),tG=-Math.PI/2,tX=12-tk,tW=new th(22-tX,-(tT.imageName?tX:0)),tK=new(Function.prototype.bind.apply(th,[null].concat(tB)));tV._rotateAround(tG,tZ)._add(tW)._add(tK),tN._rotateAround(tG,tZ)._add(tW)._add(tK),tj._rotateAround(tG,tZ)._add(tW)._add(tK),tq._rotateAround(tG,tZ)._add(tW)._add(tK)}if(tg){var tJ=Math.sin(tg),tY=Math.cos(tg),tH=[tY,-tJ,tJ,tY];tV._matMult(tH),tN._matMult(tH),tj._matMult(tH),tq._matMult(tH)}var t$=new th(0,0),tQ=new th(0,0);t_.push({tl:tV,tr:tN,bl:tj,br:tq,tex:tI,writingMode:ti.writingMode,glyphOffset:tD,sectionIndex:tT.sectionIndex,isSDF:tA,pixelOffsetTL:t$,pixelOffsetBR:tQ,minFontScaleX:0,minFontScaleY:0})}}return t_}(0,ta,ty,tf,td,tm,tc,tt.allowVerticalPlacement),tI=tt.textSizeData,tE=null;"source"===tI.kind?(tE=[128*tf.layout.get("text-size").evaluate(tm,{})])[0]>32640&&A(tt.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===tI.kind&&((tE=[128*tw.compositeTextSizes[0].evaluate(tm,{},tS),128*tw.compositeTextSizes[1].evaluate(tm,{},tS)])[0]>32640||tE[1]>32640)&&A(tt.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),tt.addSymbols(tt.text,tT,tE,ty,td,tm,t_,ti,tg.lineStartIndex,tg.lineLength,tb,tS);for(var tA=0;tA<tv.length;tA+=1)tx[tv[tA]]=tt.text.placedSymbolArray.length-1;return 4*tT.length}function ul(tt){for(var ti in tt)return tt[ti];return null}function ll(tt,ti,ta,tc){var th=tt.compareText;if(ti in th){for(var tf=th[ti],td=tf.length-1;td>=0;td--)if(tc.dist(tf[td])<ta)return!0}else th[ti]=[];return th[ti].push(tc),!1}var rP=i5.VectorTileFeature.types,rz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hl(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx){var tb=tm?Math.min(32640,Math.round(tm[0])):0,tw=tm?Math.min(32640,Math.round(tm[1])):0;tt.emplaceBack(ti,ta,Math.round(32*tc),Math.round(32*th),tf,td,(tb<<1)+(ty?1:0),tw,16*tg,16*t_,256*tv,256*tx)}function fl(tt,ti,ta){tt.emplaceBack(ti.x,ti.y,ta),tt.emplaceBack(ti.x,ti.y,ta),tt.emplaceBack(ti.x,ti.y,ta),tt.emplaceBack(ti.x,ti.y,ta)}function yl(tt){for(var ti=0,ta=tt.sections;ti<ta.length;ti+=1)if($n(ta[ti].text))return!0;return!1}var dl=function(tt){this.layoutVertexArray=new eQ,this.indexArray=new e6,this.programConfigurations=tt,this.segments=new sa,this.dynamicLayoutVertexArray=new e0,this.opacityVertexArray=new e1,this.placedSymbolArray=new ig};dl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},dl.prototype.upload=function(tt,ti,ta,tc){this.isEmpty()||(ta&&(this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,rf.members),this.indexBuffer=tt.createIndexBuffer(this.indexArray,ti),this.dynamicLayoutVertexBuffer=tt.createVertexBuffer(this.dynamicLayoutVertexArray,rd.members,!0),this.opacityVertexBuffer=tt.createVertexBuffer(this.opacityVertexArray,rz,!0),this.opacityVertexBuffer.itemSize=1),(ta||tc)&&this.programConfigurations.upload(tt))},dl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},On("SymbolBuffers",dl);var ml=function(tt,ti,ta){this.layoutVertexArray=new tt,this.layoutAttributes=ti,this.indexArray=new ta,this.segments=new sa,this.collisionVertexArray=new e3};ml.prototype.upload=function(tt){this.layoutVertexBuffer=tt.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=tt.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=tt.createVertexBuffer(this.collisionVertexArray,rm.members,!0)},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},On("CollisionBuffers",ml);var vl=function(tt){this.collisionBoxArray=tt.collisionBoxArray,this.zoom=tt.zoom,this.overscaling=tt.overscaling,this.layers=tt.layers,this.layerIds=this.layers.map(function(tt){return tt.id}),this.index=tt.index,this.pixelRatio=tt.pixelRatio,this.sourceLayerIndex=tt.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);var ti=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Du(this.zoom,ti["text-size"]),this.iconSizeData=Du(this.zoom,ti["icon-size"]);var ta=this.layers[0].layout,tc=ta.get("symbol-sort-key"),th=ta.get("symbol-z-order");this.canOverlap=ta.get("text-allow-overlap")||ta.get("icon-allow-overlap")||ta.get("text-ignore-placement")||ta.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==th&&void 0!==tc.constantOr(1),this.sortFeaturesByY=("viewport-y"===th||"auto"===th&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===ta.get("symbol-placement")&&(this.writingModes=ta.get("text-writing-mode").map(function(tt){return rw[tt]})),this.stateDependentLayerIds=this.layers.filter(function(tt){return tt.isStateDependent()}).map(function(tt){return tt.id}),this.sourceID=tt.sourceID};vl.prototype.createArrays=function(){this.text=new dl(new Va(this.layers,this.zoom,function(tt){return/^text/.test(tt)})),this.icon=new dl(new Va(this.layers,this.zoom,function(tt){return/^icon/.test(tt)})),this.glyphOffsetArray=new ix,this.lineVertexArray=new ib,this.symbolInstances=new iv},vl.prototype.calculateGlyphDependencies=function(tt,ti,ta,tc,th){for(var tf=0;tf<tt.length;tf++)if(ti[tt.charCodeAt(tf)]=!0,(ta||tc)&&th){var td=r_[tt.charAt(tf)];td&&(ti[td.charCodeAt(0)]=!0)}},vl.prototype.populate=function(tt,ti,ta){var tc=this.layers[0],th=tc.layout,tf=th.get("text-font"),td=th.get("text-field"),tm=th.get("icon-image"),ty=("constant"!==td.value.kind||td.value.value instanceof ne&&!td.value.value.isEmpty()||td.value.value.toString().length>0)&&("constant"!==tf.value.kind||tf.value.value.length>0),tg="constant"!==tm.value.kind||!!tm.value.value||Object.keys(tm.parameters).length>0,t_=th.get("symbol-sort-key");if(this.features=[],ty||tg){for(var tv=ti.iconDependencies,tx=ti.glyphDependencies,tb=ti.availableImages,tw=new si(this.zoom),tS=0;tS<tt.length;tS+=1){var tT=tt[tS],tI=tT.feature,tE=tT.id,tA=tT.index,tP=tT.sourceLayerIndex,tz=tc._featureFilter.needGeometry,tC=Ua(tI,tz);if(tc._featureFilter.filter(tw,tC,ta)){tz||(tC.geometry=Ra(tI));var tk=void 0;if(ty){var tM=tc.getValueAndResolveTokens("text-field",tC,ta,tb),tD=ne.factory(tM);yl(tD)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&eq.isParsed())&&(tk=Zs(tD,tc,tC))}var tL=void 0;if(tg){var tB=tc.getValueAndResolveTokens("icon-image",tC,ta,tb);tL=tB instanceof ie?tB:ie.fromString(tB)}if(tk||tL){var tR=this.sortFeaturesByKey?t_.evaluate(tC,{},ta):void 0;if(this.features.push({id:tE,text:tk,icon:tL,index:tA,sourceLayerIndex:tP,geometry:tC.geometry,properties:tI.properties,type:rP[tI.type],sortKey:tR}),tL&&(tv[tL.name]=!0),tk){var tO=tf.evaluate(tC,{},ta).join(","),tF="map"===th.get("text-rotation-alignment")&&"point"!==th.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rw.vertical)>=0;for(var tU=0,tV=tk.sections;tU<tV.length;tU+=1){var tN=tV[tU];if(tN.image)tv[tN.image.name]=!0;else{var tj=Zn(tk.toString()),tq=tN.fontStack||tO,tZ=tx[tq]=tx[tq]||{};this.calculateGlyphDependencies(tN.text,tZ,tF,this.allowVerticalPlacement,tj)}}}}}}"line"===th.get("symbol-placement")&&(this.features=function(tt){var ti={},ta={},tc=[],th=0;function a(ti){tc.push(tt[ti]),th++}function o(tt,ti,th){var tf=ta[tt];return delete ta[tt],ta[ti]=tf,tc[tf].geometry[0].pop(),tc[tf].geometry[0]=tc[tf].geometry[0].concat(th[0]),tf}function s(tt,ta,th){var tf=ti[ta];return delete ti[ta],ti[tt]=tf,tc[tf].geometry[0].shift(),tc[tf].geometry[0]=th[0].concat(tc[tf].geometry[0]),tf}function u(tt,ti,ta){var tc=ta?ti[0][ti[0].length-1]:ti[0][0];return tt+":"+tc.x+":"+tc.y}for(var tf=0;tf<tt.length;tf++){var td=tt[tf],tm=td.geometry,ty=td.text?td.text.toString():null;if(ty){var tg=u(ty,tm),t_=u(ty,tm,!0);if(tg in ta&&t_ in ti&&ta[tg]!==ti[t_]){var tv=s(tg,t_,tm),tx=o(tg,t_,tc[tv].geometry);delete ti[tg],delete ta[t_],ta[u(ty,tc[tx].geometry,!0)]=tx,tc[tv].geometry=null}else tg in ta?o(tg,t_,tm):t_ in ti?s(tg,t_,tm):(a(tf),ti[tg]=th-1,ta[t_]=th-1)}else a(tf)}return tc.filter(function(tt){return tt.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(tt,ti){return tt.sortKey-ti.sortKey})}},vl.prototype.update=function(tt,ti,ta){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(tt,ti,this.layers,ta),this.icon.programConfigurations.updatePaintArrays(tt,ti,this.layers,ta))},vl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},vl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},vl.prototype.upload=function(tt){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(tt),this.iconCollisionBox.upload(tt)),this.text.upload(tt,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(tt,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},vl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},vl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},vl.prototype.addToLineVertexArray=function(tt,ti){var ta=this.lineVertexArray.length;if(void 0!==tt.segment){for(var tc=tt.dist(ti[tt.segment+1]),th=tt.dist(ti[tt.segment]),tf={},td=tt.segment+1;td<ti.length;td++)tf[td]={x:ti[td].x,y:ti[td].y,tileUnitDistanceFromAnchor:tc},td<ti.length-1&&(tc+=ti[td+1].dist(ti[td]));for(var tm=tt.segment||0;tm>=0;tm--)tf[tm]={x:ti[tm].x,y:ti[tm].y,tileUnitDistanceFromAnchor:th},tm>0&&(th+=ti[tm-1].dist(ti[tm]));for(var ty=0;ty<ti.length;ty++){var tg=tf[ty];this.lineVertexArray.emplaceBack(tg.x,tg.y,tg.tileUnitDistanceFromAnchor)}}return{lineStartIndex:ta,lineLength:this.lineVertexArray.length-ta}},vl.prototype.addSymbols=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv){for(var tx=tt.indexArray,tb=tt.layoutVertexArray,tw=tt.segments.prepareSegment(4*ti.length,tb,tx,this.canOverlap?tf.sortKey:void 0),tS=this.glyphOffsetArray.length,tT=tw.vertexLength,tI=this.allowVerticalPlacement&&td===rw.vertical?Math.PI/2:0,tE=tf.text&&tf.text.sections,tA=0;tA<ti.length;tA++){var tP=ti[tA],tz=tP.tl,tC=tP.tr,tk=tP.bl,tM=tP.br,tD=tP.tex,tL=tP.pixelOffsetTL,tB=tP.pixelOffsetBR,tR=tP.minFontScaleX,tO=tP.minFontScaleY,tF=tP.glyphOffset,tU=tP.isSDF,tV=tP.sectionIndex,tN=tw.vertexLength,tj=tF[1];hl(tb,tm.x,tm.y,tz.x,tj+tz.y,tD.x,tD.y,ta,tU,tL.x,tL.y,tR,tO),hl(tb,tm.x,tm.y,tC.x,tj+tC.y,tD.x+tD.w,tD.y,ta,tU,tB.x,tL.y,tR,tO),hl(tb,tm.x,tm.y,tk.x,tj+tk.y,tD.x,tD.y+tD.h,ta,tU,tL.x,tB.y,tR,tO),hl(tb,tm.x,tm.y,tM.x,tj+tM.y,tD.x+tD.w,tD.y+tD.h,ta,tU,tB.x,tB.y,tR,tO),fl(tt.dynamicLayoutVertexArray,tm,tI),tx.emplaceBack(tN,tN+1,tN+2),tx.emplaceBack(tN+1,tN+2,tN+3),tw.vertexLength+=4,tw.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tF[0]),tA!==ti.length-1&&tV===ti[tA+1].sectionIndex||tt.programConfigurations.populatePaintArrays(tb.length,tf,tf.index,{},tv,tE&&tE[tV])}tt.placedSymbolArray.emplaceBack(tm.x,tm.y,tS,this.glyphOffsetArray.length-tS,tT,ty,tg,tm.segment,ta?ta[0]:0,ta?ta[1]:0,tc[0],tc[1],td,0,!1,0,t_)},vl.prototype._addCollisionDebugVertex=function(tt,ti,ta,tc,th,tf){return ti.emplaceBack(0,0),tt.emplaceBack(ta.x,ta.y,tc,th,Math.round(tf.x),Math.round(tf.y))},vl.prototype.addCollisionDebugVertices=function(tt,ti,ta,tc,tf,td,tm){var ty=tf.segments.prepareSegment(4,tf.layoutVertexArray,tf.indexArray),tg=ty.vertexLength,t_=tf.layoutVertexArray,tv=tf.collisionVertexArray,tx=tm.anchorX,tb=tm.anchorY;this._addCollisionDebugVertex(t_,tv,td,tx,tb,new th(tt,ti)),this._addCollisionDebugVertex(t_,tv,td,tx,tb,new th(ta,ti)),this._addCollisionDebugVertex(t_,tv,td,tx,tb,new th(ta,tc)),this._addCollisionDebugVertex(t_,tv,td,tx,tb,new th(tt,tc)),ty.vertexLength+=4;var tw=tf.indexArray;tw.emplaceBack(tg,tg+1),tw.emplaceBack(tg+1,tg+2),tw.emplaceBack(tg+2,tg+3),tw.emplaceBack(tg+3,tg),ty.primitiveLength+=4},vl.prototype.addDebugCollisionBoxes=function(tt,ti,ta,tc){for(var th=tt;th<ti;th++){var tf=this.collisionBoxArray.get(th);this.addCollisionDebugVertices(tf.x1,tf.y1,tf.x2,tf.y2,tc?this.textCollisionBox:this.iconCollisionBox,tf.anchorPoint,ta)}},vl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ml(e5,ry.members,il),this.iconCollisionBox=new ml(e5,ry.members,il);for(var tt=0;tt<this.symbolInstances.length;tt++){var ti=this.symbolInstances.get(tt);this.addDebugCollisionBoxes(ti.textBoxStartIndex,ti.textBoxEndIndex,ti,!0),this.addDebugCollisionBoxes(ti.verticalTextBoxStartIndex,ti.verticalTextBoxEndIndex,ti,!0),this.addDebugCollisionBoxes(ti.iconBoxStartIndex,ti.iconBoxEndIndex,ti,!1),this.addDebugCollisionBoxes(ti.verticalIconBoxStartIndex,ti.verticalIconBoxEndIndex,ti,!1)}},vl.prototype._deserializeCollisionBoxesForSymbol=function(tt,ti,ta,tc,th,tf,td,tm,ty){for(var tg={},t_=ti;t_<ta;t_++){var tv=tt.get(t_);tg.textBox={x1:tv.x1,y1:tv.y1,x2:tv.x2,y2:tv.y2,anchorPointX:tv.anchorPointX,anchorPointY:tv.anchorPointY},tg.textFeatureIndex=tv.featureIndex;break}for(var tx=tc;tx<th;tx++){var tb=tt.get(tx);tg.verticalTextBox={x1:tb.x1,y1:tb.y1,x2:tb.x2,y2:tb.y2,anchorPointX:tb.anchorPointX,anchorPointY:tb.anchorPointY},tg.verticalTextFeatureIndex=tb.featureIndex;break}for(var tw=tf;tw<td;tw++){var tS=tt.get(tw);tg.iconBox={x1:tS.x1,y1:tS.y1,x2:tS.x2,y2:tS.y2,anchorPointX:tS.anchorPointX,anchorPointY:tS.anchorPointY},tg.iconFeatureIndex=tS.featureIndex;break}for(var tT=tm;tT<ty;tT++){var tI=tt.get(tT);tg.verticalIconBox={x1:tI.x1,y1:tI.y1,x2:tI.x2,y2:tI.y2,anchorPointX:tI.anchorPointX,anchorPointY:tI.anchorPointY},tg.verticalIconFeatureIndex=tI.featureIndex;break}return tg},vl.prototype.deserializeCollisionBoxes=function(tt){this.collisionArrays=[];for(var ti=0;ti<this.symbolInstances.length;ti++){var ta=this.symbolInstances.get(ti);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(tt,ta.textBoxStartIndex,ta.textBoxEndIndex,ta.verticalTextBoxStartIndex,ta.verticalTextBoxEndIndex,ta.iconBoxStartIndex,ta.iconBoxEndIndex,ta.verticalIconBoxStartIndex,ta.verticalIconBoxEndIndex))}},vl.prototype.hasTextData=function(){return this.text.segments.get().length>0},vl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},vl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},vl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},vl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},vl.prototype.addIndicesForPlacedSymbol=function(tt,ti){for(var ta=tt.placedSymbolArray.get(ti),tc=ta.vertexStartIndex+4*ta.numGlyphs,th=ta.vertexStartIndex;th<tc;th+=4)tt.indexArray.emplaceBack(th,th+1,th+2),tt.indexArray.emplaceBack(th+1,th+2,th+3)},vl.prototype.getSortedSymbolIndexes=function(tt){if(this.sortedAngle===tt&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var ti=Math.sin(tt),ta=Math.cos(tt),tc=[],th=[],tf=[],td=0;td<this.symbolInstances.length;++td){tf.push(td);var tm=this.symbolInstances.get(td);tc.push(0|Math.round(ti*tm.anchorX+ta*tm.anchorY)),th.push(tm.featureIndex)}return tf.sort(function(tt,ti){return tc[tt]-tc[ti]||th[ti]-th[tt]}),tf},vl.prototype.addToSortKeyRanges=function(tt,ti){var ta=this.sortKeyRanges[this.sortKeyRanges.length-1];ta&&ta.sortKey===ti?ta.symbolInstanceEnd=tt+1:this.sortKeyRanges.push({sortKey:ti,symbolInstanceStart:tt,symbolInstanceEnd:tt+1})},vl.prototype.sortFeatures=function(tt){var ti=this;if(this.sortFeaturesByY&&this.sortedAngle!==tt&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(tt),this.sortedAngle=tt,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var ta=0,tc=this.symbolInstanceIndexes;ta<tc.length;ta+=1){var th=this.symbolInstances.get(tc[ta]);this.featureSortOrder.push(th.featureIndex),[th.rightJustifiedTextSymbolIndex,th.centerJustifiedTextSymbolIndex,th.leftJustifiedTextSymbolIndex].forEach(function(tt,ta,tc){tt>=0&&tc.indexOf(tt)===ta&&ti.addIndicesForPlacedSymbol(ti.text,tt)}),th.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,th.verticalPlacedTextSymbolIndex),th.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,th.placedIconSymbolIndex),th.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,th.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},On("SymbolBucket",vl,{omit:["layers","collisionBoxArray","features","compareText"]}),vl.MAX_GLYPHS=65535,vl.addDynamicAttributes=fl;var rC=new wi({"symbol-placement":new mi(tY.layout_symbol["symbol-placement"]),"symbol-spacing":new mi(tY.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mi(tY.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vi(tY.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mi(tY.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mi(tY.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mi(tY.layout_symbol["icon-ignore-placement"]),"icon-optional":new mi(tY.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mi(tY.layout_symbol["icon-rotation-alignment"]),"icon-size":new vi(tY.layout_symbol["icon-size"]),"icon-text-fit":new mi(tY.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mi(tY.layout_symbol["icon-text-fit-padding"]),"icon-image":new vi(tY.layout_symbol["icon-image"]),"icon-rotate":new vi(tY.layout_symbol["icon-rotate"]),"icon-padding":new mi(tY.layout_symbol["icon-padding"]),"icon-keep-upright":new mi(tY.layout_symbol["icon-keep-upright"]),"icon-offset":new vi(tY.layout_symbol["icon-offset"]),"icon-anchor":new vi(tY.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mi(tY.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mi(tY.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mi(tY.layout_symbol["text-rotation-alignment"]),"text-field":new vi(tY.layout_symbol["text-field"]),"text-font":new vi(tY.layout_symbol["text-font"]),"text-size":new vi(tY.layout_symbol["text-size"]),"text-max-width":new vi(tY.layout_symbol["text-max-width"]),"text-line-height":new mi(tY.layout_symbol["text-line-height"]),"text-letter-spacing":new vi(tY.layout_symbol["text-letter-spacing"]),"text-justify":new vi(tY.layout_symbol["text-justify"]),"text-radial-offset":new vi(tY.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mi(tY.layout_symbol["text-variable-anchor"]),"text-anchor":new vi(tY.layout_symbol["text-anchor"]),"text-max-angle":new mi(tY.layout_symbol["text-max-angle"]),"text-writing-mode":new mi(tY.layout_symbol["text-writing-mode"]),"text-rotate":new vi(tY.layout_symbol["text-rotate"]),"text-padding":new mi(tY.layout_symbol["text-padding"]),"text-keep-upright":new mi(tY.layout_symbol["text-keep-upright"]),"text-transform":new vi(tY.layout_symbol["text-transform"]),"text-offset":new vi(tY.layout_symbol["text-offset"]),"text-allow-overlap":new mi(tY.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mi(tY.layout_symbol["text-ignore-placement"]),"text-optional":new mi(tY.layout_symbol["text-optional"])}),rk={paint:new wi({"icon-opacity":new vi(tY.paint_symbol["icon-opacity"]),"icon-color":new vi(tY.paint_symbol["icon-color"]),"icon-halo-color":new vi(tY.paint_symbol["icon-halo-color"]),"icon-halo-width":new vi(tY.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vi(tY.paint_symbol["icon-halo-blur"]),"icon-translate":new mi(tY.paint_symbol["icon-translate"]),"icon-translate-anchor":new mi(tY.paint_symbol["icon-translate-anchor"]),"text-opacity":new vi(tY.paint_symbol["text-opacity"]),"text-color":new vi(tY.paint_symbol["text-color"],{runtimeType:t2,getOverride:function(tt){return tt.textColor},hasOverride:function(tt){return!!tt.textColor}}),"text-halo-color":new vi(tY.paint_symbol["text-halo-color"]),"text-halo-width":new vi(tY.paint_symbol["text-halo-width"]),"text-halo-blur":new vi(tY.paint_symbol["text-halo-blur"]),"text-translate":new mi(tY.paint_symbol["text-translate"]),"text-translate-anchor":new mi(tY.paint_symbol["text-translate-anchor"])}),layout:rC},bl=function(tt){this.type=tt.property.overrides?tt.property.overrides.runtimeType:t$,this.defaultValue=tt};bl.prototype.evaluate=function(tt){if(tt.formattedSection){var ti=this.defaultValue.property.overrides;if(ti&&ti.hasOverride(tt.formattedSection))return ti.getOverride(tt.formattedSection)}return tt.feature&&tt.featureState?this.defaultValue.evaluate(tt.feature,tt.featureState):this.defaultValue.property.specification.default},bl.prototype.eachChild=function(tt){this.defaultValue.isConstant()||tt(this.defaultValue.value._styleExpression.expression)},bl.prototype.outputDefined=function(){return!1},bl.prototype.serialize=function(){return null},On("FormatSectionOverride",bl,{omit:["defaultValue"]});var rM=function(tt){function e(ti){tt.call(this,ti,rk)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.recalculate=function(ti,ta){if(tt.prototype.recalculate.call(this,ti,ta),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var tc=this.layout.get("text-writing-mode");if(tc){for(var th=[],tf=0;tf<tc.length;tf+=1){var td=tc[tf];0>th.indexOf(td)&&th.push(td)}this.layout._values["text-writing-mode"]=th}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(tt,ti,ta,tc){var th,tf=this.layout.get(tt).evaluate(ti,{},ta,tc),td=this._unevaluatedLayout._values[tt];return td.isDataDriven()||Gr(td.value)||!tf?tf:(th=ti.properties,tf.replace(/{([^{}]+)}/g,function(tt,ti){return ti in th?String(th[ti]):""}))},e.prototype.createBucket=function(tt){return new vl(tt)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var tt=0,ti=rk.paint.overridableProperties;tt<ti.length;tt+=1){var ta=ti[tt];if(e.hasPaintOverride(this.layout,ta)){var tc,th=this.paint.get(ta),tf=new Kr(new bl(th),th.property.specification);tc="constant"===th.value.kind||"source"===th.value.kind?new Xr("source",tf):new Jr("composite",tf,th.value.zoomStops,th.value._interpolationType),this.paint._values[ta]=new yi(th.property,tc,th.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(tt,ti,ta){return!(!this.layout||ti.isDataDriven()||ta.isDataDriven())&&e.hasPaintOverride(this.layout,tt)},e.hasPaintOverride=function(tt,ti){var ta=tt.get("text-field"),tc=rk.paint.properties[ti],th=!1,a=function(tt){for(var ti=0;ti<tt.length;ti+=1)if(tc.overrides&&tc.overrides.hasOverride(tt[ti]))return void(th=!0)};if("constant"===ta.value.kind&&ta.value.value instanceof ne)a(ta.value.value.sections);else if("source"===ta.value.kind){var o=function(tt){th||(tt instanceof le&&se(tt.value)===t6?a(tt.value.sections):tt instanceof fe?a(tt.sections):tt.eachChild(o))},tf=ta.value;tf._styleExpression&&o(tf._styleExpression.expression)}return th},e}(eG),rD={paint:new wi({"background-color":new mi(tY.paint_background["background-color"]),"background-pattern":new xi(tY.paint_background["background-pattern"]),"background-opacity":new mi(tY.paint_background["background-opacity"])})},rL=function(tt){function e(ti){tt.call(this,ti,rD)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(eG),rB={paint:new wi({"raster-opacity":new mi(tY.paint_raster["raster-opacity"]),"raster-hue-rotate":new mi(tY.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mi(tY.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mi(tY.paint_raster["raster-brightness-max"]),"raster-saturation":new mi(tY.paint_raster["raster-saturation"]),"raster-contrast":new mi(tY.paint_raster["raster-contrast"]),"raster-resampling":new mi(tY.paint_raster["raster-resampling"]),"raster-fade-duration":new mi(tY.paint_raster["raster-fade-duration"])})},rR=function(tt){function e(ti){tt.call(this,ti,rB)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(eG),rO=function(tt){function e(ti){tt.call(this,ti,{}),this.implementation=ti}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(tt){this.implementation.onAdd&&this.implementation.onAdd(tt,tt.painter.context.gl)},e.prototype.onRemove=function(tt){this.implementation.onRemove&&this.implementation.onRemove(tt,tt.painter.context.gl)},e}(eG),rF={circle:ij,heatmap:iG,hillshade:iW,fill:iQ,"fill-extrusion":i6,line:rh,symbol:rM,background:rL,raster:rR},rU=tf.HTMLImageElement,rV=tf.HTMLCanvasElement,rN=tf.HTMLVideoElement,rj=tf.ImageData,rq=tf.ImageBitmap,Tl=function(tt,ti,ta,tc){this.context=tt,this.format=ta,this.texture=tt.gl.createTexture(),this.update(ti,tc)};Tl.prototype.update=function(tt,ti,ta){var tc=tt.width,th=tt.height,tf=!(this.size&&this.size[0]===tc&&this.size[1]===th||ta),td=this.context,tm=td.gl;if(this.useMipmap=!!(ti&&ti.useMipmap),tm.bindTexture(tm.TEXTURE_2D,this.texture),td.pixelStoreUnpackFlipY.set(!1),td.pixelStoreUnpack.set(1),td.pixelStoreUnpackPremultiplyAlpha.set(this.format===tm.RGBA&&(!ti||!1!==ti.premultiply)),tf)this.size=[tc,th],tt instanceof rU||tt instanceof rV||tt instanceof rN||tt instanceof rj||rq&&tt instanceof rq?tm.texImage2D(tm.TEXTURE_2D,0,this.format,this.format,tm.UNSIGNED_BYTE,tt):tm.texImage2D(tm.TEXTURE_2D,0,this.format,tc,th,0,this.format,tm.UNSIGNED_BYTE,tt.data);else{var ty=ta||{x:0,y:0},tg=ty.x,t_=ty.y;tt instanceof rU||tt instanceof rV||tt instanceof rN||tt instanceof rj||rq&&tt instanceof rq?tm.texSubImage2D(tm.TEXTURE_2D,0,tg,t_,tm.RGBA,tm.UNSIGNED_BYTE,tt):tm.texSubImage2D(tm.TEXTURE_2D,0,tg,t_,tc,th,tm.RGBA,tm.UNSIGNED_BYTE,tt.data)}this.useMipmap&&this.isSizePowerOfTwo()&&tm.generateMipmap(tm.TEXTURE_2D)},Tl.prototype.bind=function(tt,ti,ta){var tc=this.context.gl;tc.bindTexture(tc.TEXTURE_2D,this.texture),ta!==tc.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(ta=tc.LINEAR),tt!==this.filter&&(tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_MAG_FILTER,tt),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_MIN_FILTER,ta||tt),this.filter=tt),ti!==this.wrap&&(tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_WRAP_S,ti),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_WRAP_T,ti),this.wrap=ti)},Tl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Tl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Vl=function(tt){var ti=this;this._callback=tt,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){ti._triggered=!1,ti._callback()})};Vl.prototype.trigger=function(){var tt=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){tt._triggered=!1,tt._callback()},0))},Vl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Fl=function(tt,ti,ta){this.target=tt,this.parent=ti,this.mapId=ta,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},v(["receive","process"],this),this.invoker=new Vl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=I()?tt:tf};function Dl(tt,ti,ta){var tc=2*Math.PI*6378137/256/Math.pow(2,ta);return[tt*tc-2*Math.PI*6378137/2,ti*tc-2*Math.PI*6378137/2]}Fl.prototype.send=function(tt,ti,ta,tc,th){var tf=this;void 0===th&&(th=!1);var td=Math.round(1e18*Math.random()).toString(36).substring(0,10);ta&&(this.callbacks[td]=ta);var tm=E(this.globalScope)?void 0:[];return this.target.postMessage({id:td,type:tt,hasCallback:!!ta,targetMapId:tc,mustQueue:th,sourceMapId:this.mapId,data:qn(ti,tm)},tm),{cancel:function(){ta&&delete tf.callbacks[td],tf.target.postMessage({id:td,type:"<cancel>",targetMapId:tc,sourceMapId:tf.mapId})}}},Fl.prototype.receive=function(tt){var ti=tt.data,ta=ti.id;if(ta&&(!ti.targetMapId||this.mapId===ti.targetMapId)){if("<cancel>"===ti.type){delete this.tasks[ta];var tc=this.cancelCallbacks[ta];delete this.cancelCallbacks[ta],tc&&tc()}else I()||ti.mustQueue?(this.tasks[ta]=ti,this.taskQueue.push(ta),this.invoker.trigger()):this.processTask(ta,ti)}},Fl.prototype.process=function(){if(this.taskQueue.length){var tt=this.taskQueue.shift(),ti=this.tasks[tt];delete this.tasks[tt],this.taskQueue.length&&this.invoker.trigger(),ti&&this.processTask(tt,ti)}},Fl.prototype.processTask=function(tt,ti){var ta=this;if("<response>"===ti.type){var tc=this.callbacks[tt];delete this.callbacks[tt],tc&&(ti.error?tc(Nn(ti.error)):tc(null,Nn(ti.data)))}else{var th=!1,tf=E(this.globalScope)?void 0:[],td=ti.hasCallback?function(ti,tc){th=!0,delete ta.cancelCallbacks[tt],ta.target.postMessage({id:tt,type:"<response>",sourceMapId:ta.mapId,error:ti?qn(ti):null,data:qn(tc,tf)},tf)}:function(tt){th=!0},tm=null,ty=Nn(ti.data);if(this.parent[ti.type])tm=this.parent[ti.type](ti.sourceMapId,ty,td);else if(this.parent.getWorkerSource){var tg=ti.type.split(".");tm=this.parent.getWorkerSource(ti.sourceMapId,tg[0],ty.source)[tg[1]](ty,td)}else td(Error("Could not find function "+ti.type));!th&&tm&&tm.cancel&&(this.cancelCallbacks[tt]=tm.cancel)}},Fl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ll=function(tt,ti){tt&&(ti?this.setSouthWest(tt).setNorthEast(ti):4===tt.length?this.setSouthWest([tt[0],tt[1]]).setNorthEast([tt[2],tt[3]]):this.setSouthWest(tt[0]).setNorthEast(tt[1]))};Ll.prototype.setNorthEast=function(tt){return this._ne=tt instanceof Ol?new Ol(tt.lng,tt.lat):Ol.convert(tt),this},Ll.prototype.setSouthWest=function(tt){return this._sw=tt instanceof Ol?new Ol(tt.lng,tt.lat):Ol.convert(tt),this},Ll.prototype.extend=function(tt){var ti,ta,tc=this._sw,th=this._ne;if(tt instanceof Ol)ti=tt,ta=tt;else{if(!(tt instanceof Ll))return Array.isArray(tt)?4===tt.length||tt.every(Array.isArray)?this.extend(Ll.convert(tt)):this.extend(Ol.convert(tt)):this;if(ta=tt._ne,!(ti=tt._sw)||!ta)return this}return tc||th?(tc.lng=Math.min(ti.lng,tc.lng),tc.lat=Math.min(ti.lat,tc.lat),th.lng=Math.max(ta.lng,th.lng),th.lat=Math.max(ta.lat,th.lat)):(this._sw=new Ol(ti.lng,ti.lat),this._ne=new Ol(ta.lng,ta.lat)),this},Ll.prototype.getCenter=function(){return new Ol((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ll.prototype.getSouthWest=function(){return this._sw},Ll.prototype.getNorthEast=function(){return this._ne},Ll.prototype.getNorthWest=function(){return new Ol(this.getWest(),this.getNorth())},Ll.prototype.getSouthEast=function(){return new Ol(this.getEast(),this.getSouth())},Ll.prototype.getWest=function(){return this._sw.lng},Ll.prototype.getSouth=function(){return this._sw.lat},Ll.prototype.getEast=function(){return this._ne.lng},Ll.prototype.getNorth=function(){return this._ne.lat},Ll.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ll.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ll.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ll.prototype.contains=function(tt){var ti=Ol.convert(tt),ta=ti.lng,tc=ti.lat,th=this._sw.lng<=ta&&ta<=this._ne.lng;return this._sw.lng>this._ne.lng&&(th=this._sw.lng>=ta&&ta>=this._ne.lng),this._sw.lat<=tc&&tc<=this._ne.lat&&th},Ll.convert=function(tt){return!tt||tt instanceof Ll?tt:new Ll(tt)};var Ol=function(tt,ti){if(isNaN(tt)||isNaN(ti))throw Error("Invalid LngLat object: ("+tt+", "+ti+")");if(this.lng=+tt,this.lat=+ti,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")};Ol.prototype.wrap=function(){return new Ol(c(this.lng,-180,180),this.lat)},Ol.prototype.toArray=function(){return[this.lng,this.lat]},Ol.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ol.prototype.distanceTo=function(tt){var ti=Math.PI/180,ta=this.lat*ti,tc=tt.lat*ti;return 6371008.8*Math.acos(Math.min(Math.sin(ta)*Math.sin(tc)+Math.cos(ta)*Math.cos(tc)*Math.cos((tt.lng-this.lng)*ti),1))},Ol.prototype.toBounds=function(tt){void 0===tt&&(tt=0);var ti=360*tt/40075017,ta=ti/Math.cos(Math.PI/180*this.lat);return new Ll(new Ol(this.lng-ta,this.lat-ti),new Ol(this.lng+ta,this.lat+ti))},Ol.convert=function(tt){if(tt instanceof Ol)return tt;if(Array.isArray(tt)&&(2===tt.length||3===tt.length))return new Ol(Number(tt[0]),Number(tt[1]));if(!Array.isArray(tt)&&"object"==typeof tt&&null!==tt)return new Ol(Number("lng"in tt?tt.lng:tt.lon),Number(tt.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var rZ=2*Math.PI*6371008.8;function Ul(tt){return rZ*Math.cos(tt*Math.PI/180)}function jl(tt){return(180+tt)/360}function ql(tt){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+tt*Math.PI/360)))/360}function Nl(tt,ti){return tt/Ul(ti)}function Kl(tt){return 360/Math.PI*Math.atan(Math.exp((180-360*tt)*Math.PI/180))-90}var Gl=function(tt,ti,ta){void 0===ta&&(ta=0),this.x=+tt,this.y=+ti,this.z=+ta};Gl.fromLngLat=function(tt,ti){void 0===ti&&(ti=0);var ta=Ol.convert(tt);return new Gl(jl(ta.lng),ql(ta.lat),ti/Ul(ta.lat))},Gl.prototype.toLngLat=function(){return new Ol(360*this.x-180,Kl(this.y))},Gl.prototype.toAltitude=function(){return this.z*Ul(Kl(this.y))},Gl.prototype.meterInMercatorCoordinateUnits=function(){return 1/rZ*(1/Math.cos(Kl(this.y)*Math.PI/180))};var Zl=function(tt,ti,ta){this.z=tt,this.x=ti,this.y=ta,this.key=Hl(0,tt,tt,ti,ta)};Zl.prototype.equals=function(tt){return this.z===tt.z&&this.x===tt.x&&this.y===tt.y},Zl.prototype.url=function(tt,ti){var ta,tc,th,tf,td,tm=(tc=this.y,th=this.z,tf=Dl(256*(ta=this.x),256*(tc=Math.pow(2,th)-tc-1),th),td=Dl(256*(ta+1),256*(tc+1),th),tf[0]+","+tf[1]+","+td[0]+","+td[1]),ty=function(tt,ti,ta){for(var tc,th="",tf=tt;tf>0;tf--)th+=(ti&(tc=1<<tf-1)?1:0)+(ta&tc?2:0);return th}(this.z,this.x,this.y);return tt[(this.x+this.y)%tt.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===ti?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",ty).replace("{bbox-epsg-3857}",tm)},Zl.prototype.getTilePoint=function(tt){var ti=Math.pow(2,this.z);return new th(8192*(tt.x*ti-this.x),8192*(tt.y*ti-this.y))},Zl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xl=function(tt,ti){this.wrap=tt,this.canonical=ti,this.key=Hl(tt,ti.z,ti.z,ti.x,ti.y)},Jl=function(tt,ti,ta,tc,th){this.overscaledZ=tt,this.wrap=ti,this.canonical=new Zl(ta,+tc,+th),this.key=Hl(ti,tt,ta,tc,th)};function Hl(tt,ti,ta,tc,th){(tt*=2)<0&&(tt=-1*tt-1);var tf=1<<ta;return(tf*tf*tt+tf*th+tc).toString(36)+ta.toString(36)+ti.toString(36)}Jl.prototype.equals=function(tt){return this.overscaledZ===tt.overscaledZ&&this.wrap===tt.wrap&&this.canonical.equals(tt.canonical)},Jl.prototype.scaledTo=function(tt){var ti=this.canonical.z-tt;return tt>this.canonical.z?new Jl(tt,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jl(tt,this.wrap,tt,this.canonical.x>>ti,this.canonical.y>>ti)},Jl.prototype.calculateScaledKey=function(tt,ti){var ta=this.canonical.z-tt;return tt>this.canonical.z?Hl(this.wrap*+ti,tt,this.canonical.z,this.canonical.x,this.canonical.y):Hl(this.wrap*+ti,tt,tt,this.canonical.x>>ta,this.canonical.y>>ta)},Jl.prototype.isChildOf=function(tt){if(tt.wrap!==this.wrap)return!1;var ti=this.canonical.z-tt.canonical.z;return 0===tt.overscaledZ||tt.overscaledZ<this.overscaledZ&&tt.canonical.x===this.canonical.x>>ti&&tt.canonical.y===this.canonical.y>>ti},Jl.prototype.children=function(tt){if(this.overscaledZ>=tt)return[new Jl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var ti=this.canonical.z+1,ta=2*this.canonical.x,tc=2*this.canonical.y;return[new Jl(ti,this.wrap,ti,ta,tc),new Jl(ti,this.wrap,ti,ta+1,tc),new Jl(ti,this.wrap,ti,ta,tc+1),new Jl(ti,this.wrap,ti,ta+1,tc+1)]},Jl.prototype.isLessThan=function(tt){return this.wrap<tt.wrap||!(this.wrap>tt.wrap)&&(this.overscaledZ<tt.overscaledZ||!(this.overscaledZ>tt.overscaledZ)&&(this.canonical.x<tt.canonical.x||!(this.canonical.x>tt.canonical.x)&&this.canonical.y<tt.canonical.y))},Jl.prototype.wrapped=function(){return new Jl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Jl.prototype.unwrapTo=function(tt){return new Jl(this.overscaledZ,tt,this.canonical.z,this.canonical.x,this.canonical.y)},Jl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Jl.prototype.toUnwrapped=function(){return new Xl(this.wrap,this.canonical)},Jl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Jl.prototype.getTilePoint=function(tt){return this.canonical.getTilePoint(new Gl(tt.x-this.wrap,tt.y))},On("CanonicalTileID",Zl),On("OverscaledTileID",Jl,{omit:["posMatrix"]});var Yl=function(tt,ti,ta){if(this.uid=tt,ti.height!==ti.width)throw RangeError("DEM tiles must be square");if(ta&&"mapbox"!==ta&&"terrarium"!==ta)return A('"'+ta+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=ti.height;var tc=this.dim=ti.height-2;this.data=new Uint32Array(ti.data.buffer),this.encoding=ta||"mapbox";for(var th=0;th<tc;th++)this.data[this._idx(-1,th)]=this.data[this._idx(0,th)],this.data[this._idx(tc,th)]=this.data[this._idx(tc-1,th)],this.data[this._idx(th,-1)]=this.data[this._idx(th,0)],this.data[this._idx(th,tc)]=this.data[this._idx(th,tc-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(tc,-1)]=this.data[this._idx(tc-1,0)],this.data[this._idx(-1,tc)]=this.data[this._idx(0,tc-1)],this.data[this._idx(tc,tc)]=this.data[this._idx(tc-1,tc-1)]};Yl.prototype.get=function(tt,ti){var ta=new Uint8Array(this.data.buffer),tc=4*this._idx(tt,ti);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(ta[tc],ta[tc+1],ta[tc+2])},Yl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yl.prototype._idx=function(tt,ti){if(tt<-1||tt>=this.dim+1||ti<-1||ti>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(ti+1)*this.stride+(tt+1)},Yl.prototype._unpackMapbox=function(tt,ti,ta){return(256*tt*256+256*ti+ta)/10-1e4},Yl.prototype._unpackTerrarium=function(tt,ti,ta){return 256*tt+ti+ta/256-32768},Yl.prototype.getPixels=function(){return new xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yl.prototype.backfillBorder=function(tt,ti,ta){if(this.dim!==tt.dim)throw Error("dem dimension mismatch");var tc=ti*this.dim,th=ti*this.dim+this.dim,tf=ta*this.dim,td=ta*this.dim+this.dim;switch(ti){case -1:tc=th-1;break;case 1:th=tc+1}switch(ta){case -1:tf=td-1;break;case 1:td=tf+1}for(var tm=-ti*this.dim,ty=-ta*this.dim,tg=tf;tg<td;tg++)for(var t_=tc;t_<th;t_++)this.data[this._idx(t_,tg)]=tt.data[this._idx(t_+tm,tg+ty)]},On("DEMData",Yl);var $l=function(tt){this._stringToNumber={},this._numberToString=[];for(var ti=0;ti<tt.length;ti++){var ta=tt[ti];this._stringToNumber[ta]=ti,this._numberToString[ti]=ta}};$l.prototype.encode=function(tt){return this._stringToNumber[tt]},$l.prototype.decode=function(tt){return this._numberToString[tt]};var Wl=function(tt,ti,ta,tc,th){this.type="Feature",this._vectorTileFeature=tt,tt._z=ti,tt._x=ta,tt._y=tc,this.properties=tt.properties,this.id=th},rG={geometry:{configurable:!0}};rG.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},rG.geometry.set=function(tt){this._geometry=tt},Wl.prototype.toJSON=function(){var tt={geometry:this.geometry};for(var ti in this)"_geometry"!==ti&&"_vectorTileFeature"!==ti&&(tt[ti]=this[ti]);return tt},Object.defineProperties(Wl.prototype,rG);var tp=function(){this.state={},this.stateChanges={},this.deletedStates={}};tp.prototype.updateState=function(tt,ti,ta){var tc=String(ti);if(this.stateChanges[tt]=this.stateChanges[tt]||{},this.stateChanges[tt][tc]=this.stateChanges[tt][tc]||{},h(this.stateChanges[tt][tc],ta),null===this.deletedStates[tt])for(var th in this.deletedStates[tt]={},this.state[tt])th!==tc&&(this.deletedStates[tt][th]=null);else if(this.deletedStates[tt]&&null===this.deletedStates[tt][tc])for(var tf in this.deletedStates[tt][tc]={},this.state[tt][tc])ta[tf]||(this.deletedStates[tt][tc][tf]=null);else for(var td in ta)this.deletedStates[tt]&&this.deletedStates[tt][tc]&&null===this.deletedStates[tt][tc][td]&&delete this.deletedStates[tt][tc][td]},tp.prototype.removeFeatureState=function(tt,ti,ta){if(null!==this.deletedStates[tt]){var tc=String(ti);if(this.deletedStates[tt]=this.deletedStates[tt]||{},ta&&void 0!==ti)null!==this.deletedStates[tt][tc]&&(this.deletedStates[tt][tc]=this.deletedStates[tt][tc]||{},this.deletedStates[tt][tc][ta]=null);else if(void 0!==ti){if(this.stateChanges[tt]&&this.stateChanges[tt][tc])for(ta in this.deletedStates[tt][tc]={},this.stateChanges[tt][tc])this.deletedStates[tt][tc][ta]=null;else this.deletedStates[tt][tc]=null}else this.deletedStates[tt]=null}},tp.prototype.getState=function(tt,ti){var ta=String(ti),tc=h({},(this.state[tt]||{})[ta],(this.stateChanges[tt]||{})[ta]);if(null===this.deletedStates[tt])return{};if(this.deletedStates[tt]){var th=this.deletedStates[tt][ti];if(null===th)return{};for(var tf in th)delete tc[tf]}return tc},tp.prototype.initializeTileState=function(tt,ti){tt.setFeatureState(this.state,ti)},tp.prototype.coalesceChanges=function(tt,ti){var ta={};for(var tc in this.stateChanges){this.state[tc]=this.state[tc]||{};var th={};for(var tf in this.stateChanges[tc])this.state[tc][tf]||(this.state[tc][tf]={}),h(this.state[tc][tf],this.stateChanges[tc][tf]),th[tf]=this.state[tc][tf];ta[tc]=th}for(var td in this.deletedStates){this.state[td]=this.state[td]||{};var tm={};if(null===this.deletedStates[td])for(var ty in this.state[td])tm[ty]={},this.state[td][ty]={};else for(var tg in this.deletedStates[td]){if(null===this.deletedStates[td][tg])this.state[td][tg]={};else for(var t_=0,tv=Object.keys(this.deletedStates[td][tg]);t_<tv.length;t_+=1)delete this.state[td][tg][tv[t_]];tm[tg]=this.state[td][tg]}ta[td]=ta[td]||{},h(ta[td],tm)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(ta).length)for(var tx in tt)tt[tx].setFeatureState(ta,ti)};var ep=function(tt,ti){this.tileID=tt,this.x=tt.canonical.x,this.y=tt.canonical.y,this.z=tt.canonical.z,this.grid=new eD(8192,16,0),this.grid3D=new eD(8192,16,0),this.featureIndexArray=new iS,this.promoteId=ti};function rp(tt,ti,ta,tc,th){return x(tt,function(tt,tf){var td=ti instanceof di?ti.get(tf):null;return td&&td.evaluate?td.evaluate(ta,tc,th):td})}function np(tt){for(var ti=1/0,ta=1/0,tc=-1/0,th=-1/0,tf=0;tf<tt.length;tf+=1){var td=tt[tf];ti=Math.min(ti,td.x),ta=Math.min(ta,td.y),tc=Math.max(tc,td.x),th=Math.max(th,td.y)}return{minX:ti,minY:ta,maxX:tc,maxY:th}}function ip(tt,ti){return ti-tt}ep.prototype.insert=function(tt,ti,ta,tc,th,tf){var td=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(ta,tc,th);for(var tm=tf?this.grid3D:this.grid,ty=0;ty<ti.length;ty++){for(var tg=ti[ty],t_=[1/0,1/0,-1/0,-1/0],tv=0;tv<tg.length;tv++){var tx=tg[tv];t_[0]=Math.min(t_[0],tx.x),t_[1]=Math.min(t_[1],tx.y),t_[2]=Math.max(t_[2],tx.x),t_[3]=Math.max(t_[3],tx.y)}t_[0]<8192&&t_[1]<8192&&t_[2]>=0&&t_[3]>=0&&tm.insert(td,t_[0],t_[1],t_[2],t_[3])}},ep.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new i5.VectorTile(new rv(this.rawTileData)).layers,this.sourceLayerCoder=new $l(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ep.prototype.query=function(tt,ti,ta,tc){var tf=this;this.loadVTLayers();for(var td=tt.params||{},tm=8192/tt.tileSize/tt.scale,ty=on(td.filter),tg=tt.queryGeometry,t_=tt.queryPadding*tm,tv=np(tg),tx=this.grid.query(tv.minX-t_,tv.minY-t_,tv.maxX+t_,tv.maxY+t_),tb=np(tt.cameraQueryGeometry),tw=this.grid3D.query(tb.minX-t_,tb.minY-t_,tb.maxX+t_,tb.maxY+t_,function(ti,ta,tc,tf){return function(tt,ti,ta,tc,tf){for(var td=0;td<tt.length;td+=1){var tm=tt[td];if(ti<=tm.x&&ta<=tm.y&&tc>=tm.x&&tf>=tm.y)return!0}var ty=[new th(ti,ta),new th(ti,tf),new th(tc,tf),new th(tc,ta)];if(tt.length>2){for(var tg=0;tg<ty.length;tg+=1)if(Wa(tt,ty[tg]))return!0}for(var t_=0;t_<tt.length-1;t_++)if(Qa(tt[t_],tt[t_+1],ty))return!0;return!1}(tt.cameraQueryGeometry,ti-t_,ta-t_,tc+t_,tf+t_)}),tS=0;tS<tw.length;tS+=1)tx.push(tw[tS]);tx.sort(ip);for(var tT,tI={},tE=0;tE<tx.length;tE++)(function(th){var t_=tx[th];if(t_!==tT){tT=t_;var tv=tf.featureIndexArray.get(t_),tb=null;tf.loadMatchingFeature(tI,tv.bucketIndex,tv.sourceLayerIndex,tv.featureIndex,ty,td.layers,td.availableImages,ti,ta,tc,function(ti,ta,tc){return tb||(tb=Ra(ti)),ta.queryIntersectsFeature(tg,ti,tc,tb,tf.z,tt.transform,tm,tt.pixelPosMatrix)})}})(tE);return tI},ep.prototype.loadMatchingFeature=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_){var tv=this.bucketLayerIDs[ti];if(!tf||function(tt,ti){for(var ta=0;ta<tt.length;ta++)if(ti.indexOf(tt[ta])>=0)return!0;return!1}(tf,tv)){var tx=this.sourceLayerCoder.decode(ta),tb=this.vtLayers[tx].feature(tc);if(th.needGeometry){var tw=Ua(tb,!0);if(!th.filter(new si(this.tileID.overscaledZ),tw,this.tileID.canonical))return}else if(!th.filter(new si(this.tileID.overscaledZ),tb))return;for(var tS=this.getId(tb,tx),tT=0;tT<tv.length;tT++){var tI=tv[tT];if(!(tf&&0>tf.indexOf(tI))){var tE=tm[tI];if(tE){var tA={};void 0!==tS&&tg&&(tA=tg.getState(tE.sourceLayer||"_geojsonTileLayer",tS));var tP=h({},ty[tI]);tP.paint=rp(tP.paint,tE.paint,tb,tA,td),tP.layout=rp(tP.layout,tE.layout,tb,tA,td);var tz=!t_||t_(tb,tE,tA);if(tz){var tC=new Wl(tb,this.z,this.x,this.y,tS);tC.layer=tP;var tk=tt[tI];void 0===tk&&(tk=tt[tI]=[]),tk.push({featureIndex:tc,feature:tC,intersectionZ:tz})}}}}}},ep.prototype.lookupSymbolFeatures=function(tt,ti,ta,tc,th,tf,td,tm){var ty={};this.loadVTLayers();for(var tg=on(th),t_=0;t_<tt.length;t_+=1)this.loadMatchingFeature(ty,ta,tc,tt[t_],tg,tf,td,tm,ti);return ty},ep.prototype.hasLayer=function(tt){for(var ti=0,ta=this.bucketLayerIDs;ti<ta.length;ti+=1)for(var tc=0,th=ta[ti];tc<th.length;tc+=1)if(tt===th[tc])return!0;return!1},ep.prototype.getId=function(tt,ti){var ta=tt.id;return this.promoteId&&"boolean"==typeof(ta=tt.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[ti]])&&(ta=Number(ta)),ta},On("FeatureIndex",ep,{omit:["rawTileData","sourceLayerCoder"]});var ap=function(tt,ti){this.tileID=tt,this.uid=y(),this.uses=0,this.tileSize=ti,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ap.prototype.registerFadeDuration=function(tt){var ti=tt+this.timeAdded;ti<tI.now()||this.fadeEndTime&&ti<this.fadeEndTime||(this.fadeEndTime=ti)},ap.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},ap.prototype.loadVectorData=function(tt,ti,ta){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",tt){for(var tc in tt.featureIndex&&(this.latestFeatureIndex=tt.featureIndex,tt.rawTileData?(this.latestRawTileData=tt.rawTileData,this.latestFeatureIndex.rawTileData=tt.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=tt.collisionBoxArray,this.buckets=function(tt,ti){var ta={};if(!ti)return ta;for(var n=function(){var tt=th[tc],tf=tt.layerIds.map(function(tt){return ti.getLayer(tt)}).filter(Boolean);if(0!==tf.length){tt.layers=tf,tt.stateDependentLayerIds&&(tt.stateDependentLayers=tt.stateDependentLayerIds.map(function(tt){return tf.filter(function(ti){return ti.id===tt})[0]}));for(var td=0,tm=tf;td<tm.length;td+=1)ta[tm[td].id]=tt}},tc=0,th=tt;tc<th.length;tc+=1)n();return ta}(tt.buckets,ti.style),this.hasSymbolBuckets=!1,this.buckets){var th=this.buckets[tc];if(th instanceof vl){if(this.hasSymbolBuckets=!0,!ta)break;th.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var tf in this.buckets){var td=this.buckets[tf];if(td instanceof vl&&td.hasRTLText){this.hasRTLText=!0,eq.isLoading()||eq.isLoaded()||"deferred"!==ii()||ai();break}}for(var tm in this.queryPadding=0,this.buckets){var ty=this.buckets[tm];this.queryPadding=Math.max(this.queryPadding,ti.style.getLayer(tm).queryRadius(ty))}tt.imageAtlas&&(this.imageAtlas=tt.imageAtlas),tt.glyphAtlasImage&&(this.glyphAtlasImage=tt.glyphAtlasImage)}else this.collisionBoxArray=new im},ap.prototype.unloadVectorData=function(){for(var tt in this.buckets)this.buckets[tt].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ap.prototype.getBucket=function(tt){return this.buckets[tt.id]},ap.prototype.upload=function(tt){for(var ti in this.buckets){var ta=this.buckets[ti];ta.uploadPending()&&ta.upload(tt)}var tc=tt.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Tl(tt,this.imageAtlas.image,tc.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Tl(tt,this.glyphAtlasImage,tc.ALPHA),this.glyphAtlasImage=null)},ap.prototype.prepare=function(tt){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(tt,this.imageAtlasTexture)},ap.prototype.queryRenderedFeatures=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:tc,cameraQueryGeometry:th,scale:tf,tileSize:this.tileSize,pixelPosMatrix:tg,transform:tm,params:td,queryPadding:this.queryPadding*ty},tt,ti,ta):{}},ap.prototype.querySourceFeatures=function(tt,ti){var ta=this.latestFeatureIndex;if(ta&&ta.rawTileData){var tc=ta.loadVTLayers(),th=ti?ti.sourceLayer:"",tf=tc._geojsonTileLayer||tc[th];if(tf)for(var td=on(ti&&ti.filter),tm=this.tileID.canonical,ty=tm.z,tg=tm.x,t_=tm.y,tv={z:ty,x:tg,y:t_},tx=0;tx<tf.length;tx++){var tb=tf.feature(tx);if(td.needGeometry){var tw=Ua(tb,!0);if(!td.filter(new si(this.tileID.overscaledZ),tw,this.tileID.canonical))continue}else if(!td.filter(new si(this.tileID.overscaledZ),tb))continue;var tS=ta.getId(tb,th),tT=new Wl(tb,ty,tg,t_,tS);tT.tile=tv,tt.push(tT)}}},ap.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},ap.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ap.prototype.setExpiryData=function(tt){var ti=this.expirationTime;if(tt.cacheControl){var ta=z(tt.cacheControl);ta["max-age"]&&(this.expirationTime=Date.now()+1e3*ta["max-age"])}else tt.expires&&(this.expirationTime=new Date(tt.expires).getTime());if(this.expirationTime){var tc=Date.now(),th=!1;if(this.expirationTime>tc)th=!1;else if(ti){if(this.expirationTime<ti)th=!0;else{var tf=this.expirationTime-ti;tf?this.expirationTime=tc+Math.max(tf,3e4):th=!0}}else th=!0;th?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ap.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)},ap.prototype.setFeatureState=function(tt,ti){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(tt).length){var ta=this.latestFeatureIndex.loadVTLayers();for(var tc in this.buckets)if(ti.style.hasLayer(tc)){var th=this.buckets[tc],tf=th.layers[0].sourceLayer||"_geojsonTileLayer",td=ta[tf],tm=tt[tf];if(td&&tm&&0!==Object.keys(tm).length){th.update(tm,td,this.imageAtlas&&this.imageAtlas.patternPositions||{});var ty=ti&&ti.style&&ti.style.getLayer(tc);ty&&(this.queryPadding=Math.max(this.queryPadding,ty.queryRadius(th)))}}}},ap.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},ap.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tI.now()},ap.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ap.prototype.setHoldDuration=function(tt){this.symbolFadeHoldUntil=tI.now()+tt},ap.prototype.setDependencies=function(tt,ti){for(var ta={},tc=0;tc<ti.length;tc+=1)ta[ti[tc]]=!0;this.dependencies[tt]=ta},ap.prototype.hasDependency=function(tt,ti){for(var ta=0;ta<tt.length;ta+=1){var tc=this.dependencies[tt[ta]];if(tc){for(var th=0;th<ti.length;th+=1)if(tc[ti[th]])return!0}}return!1};var rX=tf.performance,sp=function(tt){this._marks={start:[tt.url,"start"].join("#"),end:[tt.url,"end"].join("#"),measure:tt.url.toString()},rX.mark(this._marks.start)};sp.prototype.finish=function(){rX.mark(this._marks.end);var tt=rX.getEntriesByName(this._marks.measure);return 0===tt.length&&(rX.measure(this._marks.measure,this._marks.start,this._marks.end),tt=rX.getEntriesByName(this._marks.measure),rX.clearMarks(this._marks.start),rX.clearMarks(this._marks.end),rX.clearMeasures(this._marks.measure)),tt},tt.Actor=Fl,tt.AlphaImage=go,tt.CanonicalTileID=Zl,tt.CollisionBoxArray=im,tt.Color=te,tt.DEMData=Yl,tt.DataConstantProperty=mi,tt.DictionaryCoder=$l,tt.EXTENT=8192,tt.ErrorEvent=tJ,tt.EvaluationParameters=si,tt.Event=It,tt.Evented=Ct,tt.FeatureIndex=ep,tt.FillBucket=ss,tt.FillExtrusionBucket=Ss,tt.ImageAtlas=bu,tt.ImagePosition=gu,tt.LineBucket=Fs,tt.LngLat=Ol,tt.LngLatBounds=Ll,tt.MercatorCoordinate=Gl,tt.ONE_EM=24,tt.OverscaledTileID=Jl,tt.Point=th,tt.Point$1=th,tt.Properties=wi,tt.Protobuf=rv,tt.RGBAImage=xo,tt.RequestManager=G,tt.RequestPerformance=sp,tt.ResourceType=tq,tt.SegmentVector=sa,tt.SourceFeatureState=tp,tt.StructArrayLayout1ui2=ic,tt.StructArrayLayout2f1f2i16=e4,tt.StructArrayLayout2i4=eW,tt.StructArrayLayout3ui6=e6,tt.StructArrayLayout4i8=eK,tt.SymbolBucket=vl,tt.Texture=Tl,tt.Tile=ap,tt.Transitionable=pi,tt.Uniform1f=iz,tt.Uniform1i=iP,tt.Uniform2f=iC,tt.Uniform3f=ik,tt.Uniform4f=iM,tt.UniformColor=iD,tt.UniformMatrix4f=iB,tt.UnwrappedTileID=Xl,tt.ValidationError=Pt,tt.WritingMode=rw,tt.ZoomHistory=Kn,tt.add=function(tt,ti,ta){return tt[0]=ti[0]+ta[0],tt[1]=ti[1]+ta[1],tt[2]=ti[2]+ta[2],tt},tt.addDynamicAttributes=fl,tt.asyncAll=function(tt,ti,ta){if(!tt.length)return ta(null,[]);var tc=tt.length,th=Array(tt.length),tf=null;tt.forEach(function(tt,td){ti(tt,function(tt,ti){tt&&(tf=tt),th[td]=ti,0==--tc&&ta(tf,th)})})},tt.bezier=u,tt.bindAll=v,tt.browser=tI,tt.cacheEntryPossiblyAdded=function(tt){++tj>tV&&(tt.getActor().send("enforceCacheSizeLimit",tU),tj=0)},tt.clamp=p,tt.clearTileCache=function(tt){var ti=tf.caches.delete("mapbox-tiles");tt&&ti.catch(tt).then(function(){return tt()})},tt.clipLine=Zu,tt.clone=function(tt){var ti=new iU(16);return ti[0]=tt[0],ti[1]=tt[1],ti[2]=tt[2],ti[3]=tt[3],ti[4]=tt[4],ti[5]=tt[5],ti[6]=tt[6],ti[7]=tt[7],ti[8]=tt[8],ti[9]=tt[9],ti[10]=tt[10],ti[11]=tt[11],ti[12]=tt[12],ti[13]=tt[13],ti[14]=tt[14],ti[15]=tt[15],ti},tt.clone$1=w,tt.clone$2=function(tt){var ti=new iU(3);return ti[0]=tt[0],ti[1]=tt[1],ti[2]=tt[2],ti},tt.collisionCircleLayout=rg,tt.config=tE,tt.create=function(){var tt=new iU(16);return iU!=Float32Array&&(tt[1]=0,tt[2]=0,tt[3]=0,tt[4]=0,tt[6]=0,tt[7]=0,tt[8]=0,tt[9]=0,tt[11]=0,tt[12]=0,tt[13]=0,tt[14]=0),tt[0]=1,tt[5]=1,tt[10]=1,tt[15]=1,tt},tt.create$1=function(){var tt=new iU(9);return iU!=Float32Array&&(tt[1]=0,tt[2]=0,tt[3]=0,tt[5]=0,tt[6]=0,tt[7]=0),tt[0]=1,tt[4]=1,tt[8]=1,tt},tt.create$2=function(){var tt=new iU(4);return iU!=Float32Array&&(tt[1]=0,tt[2]=0),tt[0]=1,tt[3]=1,tt},tt.createCommonjsModule=e,tt.createExpression=Zr,tt.createLayout=Ii,tt.createStyleLayer=function(tt){return"custom"===tt.type?new rO(tt):new rF[tt.type](tt)},tt.cross=function(tt,ti,ta){var tc=ti[0],th=ti[1],tf=ti[2],td=ta[0],tm=ta[1],ty=ta[2];return tt[0]=th*ty-tf*tm,tt[1]=tf*td-tc*ty,tt[2]=tc*tm-th*td,tt},tt.deepEqual=function t(tt,ti){if(Array.isArray(tt)){if(!Array.isArray(ti)||tt.length!==ti.length)return!1;for(var ta=0;ta<tt.length;ta++)if(!t(tt[ta],ti[ta]))return!1;return!0}if("object"==typeof tt&&null!==tt&&null!==ti){if("object"!=typeof ti||Object.keys(tt).length!==Object.keys(ti).length)return!1;for(var tc in tt)if(!t(tt[tc],ti[tc]))return!1;return!0}return tt===ti},tt.dot=function(tt,ti){return tt[0]*ti[0]+tt[1]*ti[1]+tt[2]*ti[2]},tt.dot$1=function(tt,ti){return tt[0]*ti[0]+tt[1]*ti[1]+tt[2]*ti[2]+tt[3]*ti[3]},tt.ease=td,tt.emitValidationErrors=Bn,tt.endsWith=g,tt.enforceCacheSizeLimit=function(tt){lt(),tM&&tM.then(function(ti){ti.keys().then(function(ta){for(var tc=0;tc<ta.length-tt;tc++)ti.delete(ta[tc])})})},tt.evaluateSizeForFeature=Lu,tt.evaluateSizeForZoom=Ou,tt.evaluateVariableOffset=al,tt.evented=ej,tt.extend=h,tt.featureFilter=on,tt.filterObject=b,tt.fromRotation=function(tt,ti){var ta=Math.sin(ti),tc=Math.cos(ti);return tt[0]=tc,tt[1]=ta,tt[2]=0,tt[3]=-ta,tt[4]=tc,tt[5]=0,tt[6]=0,tt[7]=0,tt[8]=1,tt},tt.getAnchorAlignment=Bu,tt.getAnchorJustification=ol,tt.getArrayBuffer=bt,tt.getImage=At,tt.getJSON=function(tt,ti){return xt(h(tt,{type:"json"}),ti)},tt.getRTLTextPluginStatus=ii,tt.getReferrer=tW,tt.getVideo=function(tt,ti){var ta,tc,th=tf.document.createElement("video");th.muted=!0,th.onloadstart=function(){ti(null,th)};for(var td=0;td<tt.length;td++){var tm=tf.document.createElement("source");ta=tt[td],tc=void 0,(tc=tf.document.createElement("a")).href=ta,(tc.protocol!==tf.document.location.protocol||tc.host!==tf.document.location.host)&&(th.crossOrigin="Anonymous"),tm.src=tt[td],th.appendChild(tm)}return{cancel:function(){}}},tt.identity=oo,tt.invert=function(tt,ti){var ta=ti[0],tc=ti[1],th=ti[2],tf=ti[3],td=ti[4],tm=ti[5],ty=ti[6],tg=ti[7],t_=ti[8],tv=ti[9],tx=ti[10],tb=ti[11],tw=ti[12],tS=ti[13],tT=ti[14],tI=ti[15],tE=ta*tm-tc*td,tA=ta*ty-th*td,tP=ta*tg-tf*td,tz=tc*ty-th*tm,tC=tc*tg-tf*tm,tk=th*tg-tf*ty,tM=t_*tS-tv*tw,tD=t_*tT-tx*tw,tL=t_*tI-tb*tw,tB=tv*tT-tx*tS,tR=tv*tI-tb*tS,tO=tx*tI-tb*tT,tF=tE*tO-tA*tR+tP*tB+tz*tL-tC*tD+tk*tM;return tF?(tt[0]=(tm*tO-ty*tR+tg*tB)*(tF=1/tF),tt[1]=(th*tR-tc*tO-tf*tB)*tF,tt[2]=(tS*tk-tT*tC+tI*tz)*tF,tt[3]=(tx*tC-tv*tk-tb*tz)*tF,tt[4]=(ty*tL-td*tO-tg*tD)*tF,tt[5]=(ta*tO-th*tL+tf*tD)*tF,tt[6]=(tT*tP-tw*tk-tI*tA)*tF,tt[7]=(t_*tk-tx*tP+tb*tA)*tF,tt[8]=(td*tR-tm*tL+tg*tM)*tF,tt[9]=(tc*tL-ta*tR-tf*tM)*tF,tt[10]=(tw*tC-tS*tP+tI*tE)*tF,tt[11]=(tv*tP-t_*tC-tb*tE)*tF,tt[12]=(tm*tD-td*tB-ty*tM)*tF,tt[13]=(ta*tB-tc*tD+th*tM)*tF,tt[14]=(tS*tA-tw*tz-tT*tE)*tF,tt[15]=(t_*tz-tv*tA+tx*tE)*tF,tt):null},tt.isChar=eF,tt.isMapboxURL=Z,tt.keysDifference=function(tt,ti){var ta=[];for(var tc in tt)tc in ti||ta.push(tc);return ta},tt.makeRequest=xt,tt.mapObject=x,tt.mercatorXfromLng=jl,tt.mercatorYfromLat=ql,tt.mercatorZfromAltitude=Nl,tt.mul=iN,tt.multiply=so,tt.mvt=i5,tt.nextPowerOfTwo=function(tt){return tt<=1?1:Math.pow(2,Math.ceil(Math.log(tt)/Math.LN2))},tt.normalize=function(tt,ti){var ta=ti[0],tc=ti[1],th=ti[2],tf=ta*ta+tc*tc+th*th;return tf>0&&(tf=1/Math.sqrt(tf)),tt[0]=ti[0]*tf,tt[1]=ti[1]*tf,tt[2]=ti[2]*tf,tt},tt.number=Ke,tt.offscreenCanvasSupported=ft,tt.ortho=function(tt,ti,ta,tc,th,tf,td){var tm=1/(ti-ta),ty=1/(tc-th),tg=1/(tf-td);return tt[0]=-2*tm,tt[1]=0,tt[2]=0,tt[3]=0,tt[4]=0,tt[5]=-2*ty,tt[6]=0,tt[7]=0,tt[8]=0,tt[9]=0,tt[10]=2*tg,tt[11]=0,tt[12]=(ti+ta)*tm,tt[13]=(th+tc)*ty,tt[14]=(td+tf)*tg,tt[15]=1,tt},tt.parseGlyphPBF=function(tt){return new rv(tt).readFields(yu,[])},tt.pbf=rv,tt.performSymbolLayout=function(tt,ti,ta,tc,th,tf,td){tt.createArrays(),tt.tilePixelRatio=8192/(512*tt.overscaling),tt.compareText={},tt.iconsNeedLinear=!1;var tm=tt.layers[0].layout,ty=tt.layers[0]._unevaluatedLayout._values,tg={};if("composite"===tt.textSizeData.kind){var t_=tt.textSizeData,tv=t_.maxZoom;tg.compositeTextSizes=[ty["text-size"].possiblyEvaluate(new si(t_.minZoom),td),ty["text-size"].possiblyEvaluate(new si(tv),td)]}if("composite"===tt.iconSizeData.kind){var tx=tt.iconSizeData,tb=tx.maxZoom;tg.compositeIconSizes=[ty["icon-size"].possiblyEvaluate(new si(tx.minZoom),td),ty["icon-size"].possiblyEvaluate(new si(tb),td)]}tg.layoutTextSize=ty["text-size"].possiblyEvaluate(new si(tt.zoom+1),td),tg.layoutIconSize=ty["icon-size"].possiblyEvaluate(new si(tt.zoom+1),td),tg.textMaxSize=ty["text-size"].possiblyEvaluate(new si(18));for(var tw=24*tm.get("text-line-height"),tS="map"===tm.get("text-rotation-alignment")&&"point"!==tm.get("symbol-placement"),tT=tm.get("text-keep-upright"),tI=tm.get("text-size"),tE=0,tA=tt.features;tE<tA.length;tE+=1)(function(){var tf=tA[tE],ty=tm.get("text-font").evaluate(tf,{},td).join(","),t_=tI.evaluate(tf,{},td),tv=tg.layoutTextSize.evaluate(tf,{},td),tx=tg.layoutIconSize.evaluate(tf,{},td),tb={horizontal:{},vertical:void 0},tP=tf.text,tz=[0,0];if(tP){var tC=tP.toString(),tk=24*tm.get("text-letter-spacing").evaluate(tf,{},td),tM=!function(tt){for(var ti,ta=0;ta<tt.length;ta+=1)if(ti=tt[ta].charCodeAt(0),eF.Arabic(ti)||eF["Arabic Supplement"](ti)||eF["Arabic Extended-A"](ti)||eF["Arabic Presentation Forms-A"](ti)||eF["Arabic Presentation Forms-B"](ti))return!1;return!0}(tC)?0:tk,tD=tm.get("text-anchor").evaluate(tf,{},td),tL=tm.get("text-variable-anchor");if(!tL){var tB=tm.get("text-radial-offset").evaluate(tf,{},td);tz=tB?al(tD,[24*tB,rA]):tm.get("text-offset").evaluate(tf,{},td).map(function(tt){return 24*tt})}var tR=tS?"center":tm.get("text-justify").evaluate(tf,{},td),tO=tm.get("symbol-placement"),tF="point"===tO?24*tm.get("text-max-width").evaluate(tf,{},td):0,B=function(){tt.allowVerticalPlacement&&Zn(tC)&&(tb.vertical=Su(tP,ti,ta,th,ty,tF,tw,tD,"left",tM,tz,rw.vertical,!0,tO,tv,t_))};if(!tS&&tL){for(var tU="auto"===tR?tL.map(function(tt){return ol(tt)}):[tR],tV=!1,tN=0;tN<tU.length;tN++){var tj=tU[tN];if(!tb.horizontal[tj]){if(tV)tb.horizontal[tj]=tb.horizontal[0];else{var tq=Su(tP,ti,ta,th,ty,tF,tw,"center",tj,tM,tz,rw.horizontal,!1,tO,tv,t_);tq&&(tb.horizontal[tj]=tq,tV=1===tq.positionedLines.length)}}}B()}else{"auto"===tR&&(tR=ol(tD));var tZ=Su(tP,ti,ta,th,ty,tF,tw,tD,tR,tM,tz,rw.horizontal,!1,tO,tv,t_);tZ&&(tb.horizontal[tR]=tZ),B(),Zn(tC)&&tS&&tT&&(tb.vertical=Su(tP,ti,ta,th,ty,tF,tw,tD,tR,tM,tz,rw.vertical,!1,tO,tv,t_))}}var tG=void 0,tX=!1;if(tf.icon&&tf.icon.name){var tW,tK,tJ,tY,tH,t$=tc[tf.icon.name];t$&&(tW=th[tf.icon.name],tK=tm.get("icon-offset").evaluate(tf,{},td),tJ=Bu(tm.get("icon-anchor").evaluate(tf,{},td)),tY=tK[0]-tW.displaySize[0]*tJ.horizontalAlign,tH=tK[1]-tW.displaySize[1]*tJ.verticalAlign,tG={image:tW,top:tH,bottom:tH+tW.displaySize[1],left:tY,right:tY+tW.displaySize[0]},tX=t$.sdf,void 0===tt.sdfIcons?tt.sdfIcons=t$.sdf:tt.sdfIcons!==t$.sdf&&A("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t$.pixelRatio!==tt.pixelRatio||0!==tm.get("icon-rotate").constantOr(1))&&(tt.iconsNeedLinear=!0))}var tQ=ul(tb.horizontal)||tb.vertical;tt.iconsInText=!!tQ&&tQ.iconsInText,(tQ||tG)&&function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_){var tv=tf.textMaxSize.evaluate(ti,{});void 0===tv&&(tv=td);var tx,tb=tt.layers[0].layout,tw=tb.get("icon-offset").evaluate(ti,{},t_),tS=ul(ta.horizontal),tT=td/24,tI=tt.tilePixelRatio*tT,tE=tt.tilePixelRatio*tv/24,tA=tt.tilePixelRatio*tm,tP=tt.tilePixelRatio*tb.get("symbol-spacing"),tz=tb.get("text-padding")*tt.tilePixelRatio,tC=tb.get("icon-padding")*tt.tilePixelRatio,tk=tb.get("text-max-angle")/180*Math.PI,tM="map"===tb.get("text-rotation-alignment")&&"point"!==tb.get("symbol-placement"),tD="map"===tb.get("icon-rotation-alignment")&&"point"!==tb.get("symbol-placement"),tL=tb.get("symbol-placement"),tB=tP/2,tR=tb.get("icon-text-fit");tc&&"none"!==tR&&(tt.allowVerticalPlacement&&ta.vertical&&(tx=Vu(tc,ta.vertical,tR,tb.get("icon-text-fit-padding"),tw,tT)),tS&&(tc=Vu(tc,tS,tR,tb.get("icon-text-fit-padding"),tw,tT)));var P=function(tm,tv){tv.x<0||tv.x>=8192||tv.y<0||tv.y>=8192||function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS,tT,tI,tE,tA,tP,tz,tC,tk,tM){var tD,tL,tB,tR,tO,tF=tt.addToLineVertexArray(ti,ta),tU=0,tV=0,tN=0,tj=0,tq=-1,tZ=-1,tG={},tX=iE(""),tW=0,tK=0;if(void 0===tm._unevaluatedLayout.getValue("text-radial-offset")?(tW=(tD=tm.layout.get("text-offset").evaluate(tP,{},tk).map(function(tt){return 24*tt}))[0],tK=tD[1]):(tW=24*tm.layout.get("text-radial-offset").evaluate(tP,{},tk),tK=rA),tt.allowVerticalPlacement&&tc.vertical){var tJ=tm.layout.get("text-rotate").evaluate(tP,{},tk)+90;tR=new Wu(ty,ti,tg,t_,tv,tc.vertical,tx,tb,tw,tJ),td&&(tO=new Wu(ty,ti,tg,t_,tv,td,tT,tI,tw,tJ))}if(th){var tY=tm.layout.get("icon-rotate").evaluate(tP,{}),tH="none"!==tm.layout.get("icon-text-fit"),t$=Xu(th,tY,tC,tH),tQ=td?Xu(td,tY,tC,tH):void 0;tB=new Wu(ty,ti,tg,t_,tv,th,tT,tI,!1,tY),tU=4*t$.length;var t0=tt.iconSizeData,t1=null;"source"===t0.kind?(t1=[128*tm.layout.get("icon-size").evaluate(tP,{})])[0]>32640&&A(tt.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===t0.kind&&((t1=[128*tz.compositeIconSizes[0].evaluate(tP,{},tk),128*tz.compositeIconSizes[1].evaluate(tP,{},tk)])[0]>32640||t1[1]>32640)&&A(tt.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),tt.addSymbols(tt.icon,t$,t1,tA,tE,tP,!1,ti,tF.lineStartIndex,tF.lineLength,-1,tk),tq=tt.icon.placedSymbolArray.length-1,tQ&&(tV=4*tQ.length,tt.addSymbols(tt.icon,tQ,t1,tA,tE,tP,rw.vertical,ti,tF.lineStartIndex,tF.lineLength,-1,tk),tZ=tt.icon.placedSymbolArray.length-1)}for(var t2 in tc.horizontal){var t5=tc.horizontal[t2];tL||(tX=iE(t5.text),tL=new Wu(ty,ti,tg,t_,tv,t5,tx,tb,tw,tm.layout.get("text-rotate").evaluate(tP,{},tk)));var t4=1===t5.positionedLines.length;if(tN+=sl(tt,ti,t5,tf,tm,tw,tP,tS,tF,tc.vertical?rw.horizontal:rw.horizontalOnly,t4?Object.keys(tc.horizontal):[t2],tG,tq,tz,tk),t4)break}tc.vertical&&(tj+=sl(tt,ti,tc.vertical,tf,tm,tw,tP,tS,tF,rw.vertical,["vertical"],tG,tZ,tz,tk));var t3=tL?tL.boxStartIndex:tt.collisionBoxArray.length,t6=tL?tL.boxEndIndex:tt.collisionBoxArray.length,t8=tR?tR.boxStartIndex:tt.collisionBoxArray.length,t9=tR?tR.boxEndIndex:tt.collisionBoxArray.length,t7=tB?tB.boxStartIndex:tt.collisionBoxArray.length,et=tB?tB.boxEndIndex:tt.collisionBoxArray.length,ea=tO?tO.boxStartIndex:tt.collisionBoxArray.length,ec=tO?tO.boxEndIndex:tt.collisionBoxArray.length,eh=-1,ut=function(tt,ti){return tt&&tt.circleDiameter?Math.max(tt.circleDiameter,ti):ti};eh=ut(tL,-1),eh=ut(tR,eh),eh=ut(tB,eh);var ef=(eh=ut(tO,eh))>-1?1:0;ef&&(eh*=tM/24),tt.glyphOffsetArray.length>=vl.MAX_GLYPHS&&A("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==tP.sortKey&&tt.addToSortKeyRanges(tt.symbolInstances.length,tP.sortKey),tt.symbolInstances.emplaceBack(ti.x,ti.y,tG.right>=0?tG.right:-1,tG.center>=0?tG.center:-1,tG.left>=0?tG.left:-1,tG.vertical||-1,tq,tZ,tX,t3,t6,t8,t9,t7,et,ea,ec,tg,tN,tj,tU,tV,ef,0,tx,tW,tK,eh)}(tt,tv,tm,ta,tc,th,tx,tt.layers[0],tt.collisionBoxArray,ti.index,ti.sourceLayerIndex,tt.index,tI,tz,tM,ty,tA,tC,tD,tw,ti,tf,tg,t_,td)};if("line"===tL)for(var tO=0,tF=Zu(ti.geometry,0,0,8192,8192);tO<tF.length;tO+=1)for(var tU=tF[tO],tV=0,tN=Gu(tU,tP,tk,ta.vertical||tS,tc,24,tE,tt.overscaling,8192);tV<tN.length;tV+=1){var tj=tN[tV];tS&&ll(tt,tS.text,tB,tj)||P(tU,tj)}else if("line-center"===tL)for(var tq=0,tZ=ti.geometry;tq<tZ.length;tq+=1){var tG=tZ[tq];if(tG.length>1){var tX=Ku(tG,tk,ta.vertical||tS,tc,24,tE);tX&&P(tG,tX)}}else if("Polygon"===ti.type)for(var tW=0,tK=ns(ti.geometry,0);tW<tK.length;tW+=1){var tJ=tK[tW],tY=el(tJ,16);P(tJ[0],new rI(tY.x,tY.y,0))}else if("LineString"===ti.type)for(var tH=0,t$=ti.geometry;tH<t$.length;tH+=1){var tQ=t$[tH];P(tQ,new rI(tQ[0].x,tQ[0].y,0))}else if("Point"===ti.type)for(var t0=0,t1=ti.geometry;t0<t1.length;t0+=1)for(var t2=0,t5=t1[t0];t2<t5.length;t2+=1){var t4=t5[t2];P([t4],new rI(t4.x,t4.y,0))}}(tt,tf,tb,tG,tc,tg,tv,tx,tz,tX,td)})();tf&&tt.generateCollisionDebugBuffers()},tt.perspective=function(tt,ti,ta,tc,th){var tf,td=1/Math.tan(ti/2);return tt[0]=td/ta,tt[1]=0,tt[2]=0,tt[3]=0,tt[4]=0,tt[5]=td,tt[6]=0,tt[7]=0,tt[8]=0,tt[9]=0,tt[11]=-1,tt[12]=0,tt[13]=0,tt[15]=0,null!=th&&th!==1/0?(tt[10]=(th+tc)*(tf=1/(tc-th)),tt[14]=2*th*tc*tf):(tt[10]=-1,tt[14]=-2*tc),tt},tt.pick=function(tt,ti){for(var ta={},tc=0;tc<ti.length;tc++){var th=ti[tc];th in tt&&(ta[th]=tt[th])}return ta},tt.plugin=eq,tt.polygonIntersectsPolygon=Na,tt.postMapLoadEvent=tF,tt.postTurnstileEvent=tR,tt.potpack=vu,tt.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],tt.register=On,tt.registerForPluginStateChange=function(tt){return tt({pluginStatus:eV,pluginURL:eN}),ej.on("pluginStateChange",tt),tt},tt.renderColorRamp=wo,tt.rotate=function(tt,ti,ta){var tc=ti[0],th=ti[1],tf=ti[2],td=ti[3],tm=Math.sin(ta),ty=Math.cos(ta);return tt[0]=tc*ty+tf*tm,tt[1]=th*ty+td*tm,tt[2]=-(tc*tm)+tf*ty,tt[3]=-(th*tm)+td*ty,tt},tt.rotateX=function(tt,ti,ta){var tc=Math.sin(ta),th=Math.cos(ta),tf=ti[4],td=ti[5],tm=ti[6],ty=ti[7],tg=ti[8],t_=ti[9],tv=ti[10],tx=ti[11];return ti!==tt&&(tt[0]=ti[0],tt[1]=ti[1],tt[2]=ti[2],tt[3]=ti[3],tt[12]=ti[12],tt[13]=ti[13],tt[14]=ti[14],tt[15]=ti[15]),tt[4]=tf*th+tg*tc,tt[5]=td*th+t_*tc,tt[6]=tm*th+tv*tc,tt[7]=ty*th+tx*tc,tt[8]=tg*th-tf*tc,tt[9]=t_*th-td*tc,tt[10]=tv*th-tm*tc,tt[11]=tx*th-ty*tc,tt},tt.rotateZ=function(tt,ti,ta){var tc=Math.sin(ta),th=Math.cos(ta),tf=ti[0],td=ti[1],tm=ti[2],ty=ti[3],tg=ti[4],t_=ti[5],tv=ti[6],tx=ti[7];return ti!==tt&&(tt[8]=ti[8],tt[9]=ti[9],tt[10]=ti[10],tt[11]=ti[11],tt[12]=ti[12],tt[13]=ti[13],tt[14]=ti[14],tt[15]=ti[15]),tt[0]=tf*th+tg*tc,tt[1]=td*th+t_*tc,tt[2]=tm*th+tv*tc,tt[3]=ty*th+tx*tc,tt[4]=tg*th-tf*tc,tt[5]=t_*th-td*tc,tt[6]=tv*th-tm*tc,tt[7]=tx*th-ty*tc,tt},tt.scale=function(tt,ti,ta){var tc=ta[0],th=ta[1],tf=ta[2];return tt[0]=ti[0]*tc,tt[1]=ti[1]*tc,tt[2]=ti[2]*tc,tt[3]=ti[3]*tc,tt[4]=ti[4]*th,tt[5]=ti[5]*th,tt[6]=ti[6]*th,tt[7]=ti[7]*th,tt[8]=ti[8]*tf,tt[9]=ti[9]*tf,tt[10]=ti[10]*tf,tt[11]=ti[11]*tf,tt[12]=ti[12],tt[13]=ti[13],tt[14]=ti[14],tt[15]=ti[15],tt},tt.scale$1=function(tt,ti,ta){return tt[0]=ti[0]*ta,tt[1]=ti[1]*ta,tt[2]=ti[2]*ta,tt[3]=ti[3]*ta,tt},tt.scale$2=function(tt,ti,ta){return tt[0]=ti[0]*ta,tt[1]=ti[1]*ta,tt[2]=ti[2]*ta,tt},tt.setCacheLimits=function(tt,ti){tU=tt,tV=ti},tt.setRTLTextPlugin=function(tt,ti,ta){if(void 0===ta&&(ta=!1),"deferred"===eV||"loading"===eV||"loaded"===eV)throw Error("setRTLTextPlugin cannot be called multiple times.");eN=tI.resolveURL(tt),eV="deferred",eU=ti,ri(),ta||ai()},tt.sphericalToCartesian=function(tt){var ti=tt[0],ta=tt[1],tc=tt[2];return ta+=90,{x:ti*Math.cos(ta*=Math.PI/180)*Math.sin(tc*=Math.PI/180),y:ti*Math.sin(ta)*Math.sin(tc),z:ti*Math.cos(tc)}},tt.sqrLen=function(tt){var ti=tt[0],ta=tt[1];return ti*ti+ta*ta},tt.styleSpec=tY,tt.sub=function(tt,ti,ta){return tt[0]=ti[0]-ta[0],tt[1]=ti[1]-ta[1],tt[2]=ti[2]-ta[2],tt},tt.symbolSize=rE,tt.transformMat3=function(tt,ti,ta){var tc=ti[0],th=ti[1],tf=ti[2];return tt[0]=tc*ta[0]+th*ta[3]+tf*ta[6],tt[1]=tc*ta[1]+th*ta[4]+tf*ta[7],tt[2]=tc*ta[2]+th*ta[5]+tf*ta[8],tt},tt.transformMat4=po,tt.translate=function(tt,ti,ta){var tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS=ta[0],tT=ta[1],tI=ta[2];return ti===tt?(tt[12]=ti[0]*tS+ti[4]*tT+ti[8]*tI+ti[12],tt[13]=ti[1]*tS+ti[5]*tT+ti[9]*tI+ti[13],tt[14]=ti[2]*tS+ti[6]*tT+ti[10]*tI+ti[14],tt[15]=ti[3]*tS+ti[7]*tT+ti[11]*tI+ti[15]):(th=ti[1],tf=ti[2],td=ti[3],tm=ti[4],ty=ti[5],tg=ti[6],t_=ti[7],tv=ti[8],tx=ti[9],tb=ti[10],tw=ti[11],tt[0]=tc=ti[0],tt[1]=th,tt[2]=tf,tt[3]=td,tt[4]=tm,tt[5]=ty,tt[6]=tg,tt[7]=t_,tt[8]=tv,tt[9]=tx,tt[10]=tb,tt[11]=tw,tt[12]=tc*tS+tm*tT+tv*tI+ti[12],tt[13]=th*tS+ty*tT+tx*tI+ti[13],tt[14]=tf*tS+tg*tT+tb*tI+ti[14],tt[15]=td*tS+t_*tT+tw*tI+ti[15]),tt},tt.triggerPluginCompletionEvent=ei,tt.uniqueId=y,tt.validateCustomStyleLayer=function(tt){var ti=[],ta=tt.id;return void 0===ta&&ti.push({message:"layers."+ta+': missing required property "id"'}),void 0===tt.render&&ti.push({message:"layers."+ta+': missing required method "render"'}),tt.renderingMode&&"2d"!==tt.renderingMode&&"3d"!==tt.renderingMode&&ti.push({message:"layers."+ta+': property "renderingMode" must be either "2d" or "3d"'}),ti},tt.validateLight=eC,tt.validateStyle=ez,tt.values=function(tt){var ti=[];for(var ta in tt)ti.push(tt[ta]);return ti},tt.vectorTile=i5,tt.version="1.13.1",tt.warnOnce=A,tt.webpSupported=tA,tt.window=tf,tt.wrap=c}),define(["./shared"],function(tt){function t(tt){var ti=typeof tt;if("number"===ti||"boolean"===ti||"string"===ti||null==tt)return JSON.stringify(tt);if(Array.isArray(tt)){for(var ta="[",tc=0;tc<tt.length;tc+=1)ta+=t(tt[tc])+",";return ta+"]"}for(var th=Object.keys(tt).sort(),tf="{",td=0;td<th.length;td++)tf+=JSON.stringify(th[td])+":"+t(tt[th[td]])+",";return tf+"}"}function r(ti){for(var ta="",tc=0,th=tt.refProperties;tc<th.length;tc+=1)ta+="/"+t(ti[th[tc]]);return ta}var i=function(tt){this.keyCache={},tt&&this.replace(tt)};i.prototype.replace=function(tt){this._layerConfigs={},this._layers={},this.update(tt,[])},i.prototype.update=function(ti,ta){for(var tc=this,th=0;th<ti.length;th+=1){var tf=ti[th];this._layerConfigs[tf.id]=tf;var td=this._layers[tf.id]=tt.createStyleLayer(tf);td._featureFilter=tt.featureFilter(td.filter),this.keyCache[tf.id]&&delete this.keyCache[tf.id]}for(var tm=0;tm<ta.length;tm+=1){var ty=ta[tm];delete this.keyCache[ty],delete this._layerConfigs[ty],delete this._layers[ty]}this.familiesBySource={};for(var tg=0,t_=function(tt,ti){for(var ta={},tc=0;tc<tt.length;tc++){var th=ti&&ti[tt[tc].id]||r(tt[tc]);ti&&(ti[tt[tc].id]=th);var tf=ta[th];tf||(tf=ta[th]=[]),tf.push(tt[tc])}var td=[];for(var tm in ta)td.push(ta[tm]);return td}(tt.values(this._layerConfigs),this.keyCache);tg<t_.length;tg+=1){var tv=t_[tg].map(function(tt){return tc._layers[tt.id]}),tx=tv[0];if("none"!==tx.visibility){var tb=tx.source||"",tw=this.familiesBySource[tb];tw||(tw=this.familiesBySource[tb]={});var tS=tx.sourceLayer||"_geojsonTileLayer",tT=tw[tS];tT||(tT=tw[tS]=[]),tT.push(tv)}}};var o=function(ti){var ta={},tc=[];for(var th in ti){var tf=ti[th],td=ta[th]={};for(var tm in tf){var ty=tf[+tm];if(ty&&0!==ty.bitmap.width&&0!==ty.bitmap.height){var tg={x:0,y:0,w:ty.bitmap.width+2,h:ty.bitmap.height+2};tc.push(tg),td[tm]={rect:tg,metrics:ty.metrics}}}}var t_=tt.potpack(tc),tv=new tt.AlphaImage({width:t_.w||1,height:t_.h||1});for(var tx in ti){var tb=ti[tx];for(var tw in tb){var tS=tb[+tw];if(tS&&0!==tS.bitmap.width&&0!==tS.bitmap.height){var tT=ta[tx][tw].rect;tt.AlphaImage.copy(tS.bitmap,tv,{x:0,y:0},{x:tT.x+1,y:tT.y+1},tS.bitmap)}}}this.image=tv,this.positions=ta};tt.register("GlyphAtlas",o);var n=function(ti){this.tileID=new tt.OverscaledTileID(ti.tileID.overscaledZ,ti.tileID.wrap,ti.tileID.canonical.z,ti.tileID.canonical.x,ti.tileID.canonical.y),this.uid=ti.uid,this.zoom=ti.zoom,this.pixelRatio=ti.pixelRatio,this.tileSize=ti.tileSize,this.source=ti.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ti.showCollisionBoxes,this.collectResourceTiming=!!ti.collectResourceTiming,this.returnDependencies=!!ti.returnDependencies,this.promoteId=ti.promoteId};function s(ti,ta,tc){for(var th=new tt.EvaluationParameters(ta),tf=0;tf<ti.length;tf+=1)ti[tf].recalculate(th,tc)}function a(ti,ta){var tc=tt.getArrayBuffer(ti.request,function(ti,tc,th,tf){ti?ta(ti):tc&&ta(null,{vectorTile:new tt.vectorTile.VectorTile(new tt.pbf(tc)),rawData:tc,cacheControl:th,expires:tf})});return function(){tc.cancel(),ta()}}n.prototype.parse=function(ti,ta,tc,th,tf){var td=this;this.status="parsing",this.data=ti,this.collisionBoxArray=new tt.CollisionBoxArray;var tm=new tt.DictionaryCoder(Object.keys(ti.layers).sort()),ty=new tt.FeatureIndex(this.tileID,this.promoteId);ty.bucketLayerIDs=[];var tg,t_,tv,tx,tb={},tw={featureIndex:ty,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:tc},tS=ta.familiesBySource[this.source];for(var tT in tS){var tI=ti.layers[tT];if(tI){1===tI.version&&tt.warnOnce('Vector tile source "'+this.source+'" layer "'+tT+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var tE=tm.encode(tT),tA=[],tP=0;tP<tI.length;tP++){var tz=tI.feature(tP),tC=ty.getId(tz,tT);tA.push({feature:tz,id:tC,index:tP,sourceLayerIndex:tE})}for(var tk=0,tM=tS[tT];tk<tM.length;tk+=1){var tD=tM[tk],tL=tD[0];tL.minzoom&&this.zoom<Math.floor(tL.minzoom)||tL.maxzoom&&this.zoom>=tL.maxzoom||"none"!==tL.visibility&&(s(tD,this.zoom,tc),(tb[tL.id]=tL.createBucket({index:ty.bucketLayerIDs.length,layers:tD,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tE,sourceID:this.source})).populate(tA,tw,this.tileID.canonical),ty.bucketLayerIDs.push(tD.map(function(tt){return tt.id})))}}}var tB=tt.mapObject(tw.glyphDependencies,function(tt){return Object.keys(tt).map(Number)});Object.keys(tB).length?th.send("getGlyphs",{uid:this.uid,stacks:tB},function(tt,ti){tg||(tg=tt,t_=ti,z.call(td))}):t_={};var tR=Object.keys(tw.iconDependencies);tR.length?th.send("getImages",{icons:tR,source:this.source,tileID:this.tileID,type:"icons"},function(tt,ti){tg||(tg=tt,tv=ti,z.call(td))}):tv={};var tO=Object.keys(tw.patternDependencies);function z(){if(tg)return tf(tg);if(t_&&tv&&tx){var ti=new o(t_),ta=new tt.ImageAtlas(tv,tx);for(var th in tb){var td=tb[th];td instanceof tt.SymbolBucket?(s(td.layers,this.zoom,tc),tt.performSymbolLayout(td,t_,ti.positions,tv,ta.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):td.hasPattern&&(td instanceof tt.LineBucket||td instanceof tt.FillBucket||td instanceof tt.FillExtrusionBucket)&&(s(td.layers,this.zoom,tc),td.addFeatures(tw,this.tileID.canonical,ta.patternPositions))}this.status="done",tf(null,{buckets:tt.values(tb).filter(function(tt){return!tt.isEmpty()}),featureIndex:ty,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ti.image,imageAtlas:ta,glyphMap:this.returnDependencies?t_:null,iconMap:this.returnDependencies?tv:null,glyphPositions:this.returnDependencies?ti.positions:null})}}tO.length?th.send("getImages",{icons:tO,source:this.source,tileID:this.tileID,type:"patterns"},function(tt,ti){tg||(tg=tt,tx=ti,z.call(td))}):tx={},z.call(this)};var l=function(tt,ti,ta,tc){this.actor=tt,this.layerIndex=ti,this.availableImages=ta,this.loadVectorData=tc||a,this.loading={},this.loaded={}};l.prototype.loadTile=function(ti,ta){var tc=this,th=ti.uid;this.loading||(this.loading={});var tf=!!(ti&&ti.request&&ti.request.collectResourceTiming)&&new tt.RequestPerformance(ti.request),td=this.loading[th]=new n(ti);td.abort=this.loadVectorData(ti,function(ti,tm){if(delete tc.loading[th],ti||!tm)return td.status="done",tc.loaded[th]=td,ta(ti);var ty=tm.rawData,tg={};tm.expires&&(tg.expires=tm.expires),tm.cacheControl&&(tg.cacheControl=tm.cacheControl);var t_={};if(tf){var tv=tf.finish();tv&&(t_.resourceTiming=JSON.parse(JSON.stringify(tv)))}td.vectorTile=tm.vectorTile,td.parse(tm.vectorTile,tc.layerIndex,tc.availableImages,tc.actor,function(ti,tc){if(ti||!tc)return ta(ti);ta(null,tt.extend({rawTileData:ty.slice(0)},tc,tg,t_))}),tc.loaded=tc.loaded||{},tc.loaded[th]=td})},l.prototype.reloadTile=function(tt,ti){var ta=this,tc=this.loaded,th=tt.uid,tf=this;if(tc&&tc[th]){var td=tc[th];td.showCollisionBoxes=tt.showCollisionBoxes;var a=function(tt,tc){var th=td.reloadCallback;th&&(delete td.reloadCallback,td.parse(td.vectorTile,tf.layerIndex,ta.availableImages,tf.actor,th)),ti(tt,tc)};"parsing"===td.status?td.reloadCallback=a:"done"===td.status&&(td.vectorTile?td.parse(td.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}},l.prototype.abortTile=function(tt,ti){var ta=this.loading,tc=tt.uid;ta&&ta[tc]&&ta[tc].abort&&(ta[tc].abort(),delete ta[tc]),ti()},l.prototype.removeTile=function(tt,ti){var ta=this.loaded,tc=tt.uid;ta&&ta[tc]&&delete ta[tc],ti()};var ti=tt.window.ImageBitmap,h=function(){this.loaded={}};function c(tt,ti){if(0!==tt.length){p(tt[0],ti);for(var ta=1;ta<tt.length;ta++)p(tt[ta],!ti)}}function p(tt,ti){for(var ta=0,tc=0,th=tt.length,tf=th-1;tc<th;tf=tc++)ta+=(tt[tc][0]-tt[tf][0])*(tt[tf][1]+tt[tc][1]);ta>=0!=!!ti&&tt.reverse()}h.prototype.loadTile=function(ta,tc){var th=ta.uid,tf=ta.encoding,td=ta.rawImageData,tm=ti&&td instanceof ti?this.getImageData(td):td,ty=new tt.DEMData(th,tm,tf);this.loaded=this.loaded||{},this.loaded[th]=ty,tc(null,ty)},h.prototype.getImageData=function(ti){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ti.width,ti.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=ti.width,this.offscreenCanvas.height=ti.height,this.offscreenCanvasContext.drawImage(ti,0,0,ti.width,ti.height);var ta=this.offscreenCanvasContext.getImageData(-1,-1,ti.width+2,ti.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new tt.RGBAImage({width:ta.width,height:ta.height},ta.data)},h.prototype.removeTile=function(tt){var ti=this.loaded,ta=tt.uid;ti&&ti[ta]&&delete ti[ta]};var ta=tt.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(ti){this._feature=ti,this.extent=tt.EXTENT,this.type=ti.type,this.properties=ti.tags,"id"in ti&&!isNaN(ti.id)&&(this.id=parseInt(ti.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var ti=[],ta=0,tc=this._feature.geometry;ta<tc.length;ta+=1){var th=tc[ta];ti.push([new tt.Point$1(th[0],th[1])])}return ti}for(var tf=[],td=0,tm=this._feature.geometry;td<tm.length;td+=1){for(var ty=[],tg=0,t_=tm[td];tg<t_.length;tg+=1){var tv=t_[tg];ty.push(new tt.Point$1(tv[0],tv[1]))}tf.push(ty)}return tf},d.prototype.toGeoJSON=function(tt,ti,tc){return ta.call(this,tt,ti,tc)};var g=function(ti){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=tt.EXTENT,this.length=ti.length,this._features=ti};g.prototype.feature=function(tt){return new d(this._features[tt])};var tc=tt.vectorTile.VectorTileFeature,th=y;function y(tt,ti){this.options=ti||{},this.features=tt,this.length=tt.length}function x(tt,ti){this.id="number"==typeof tt.id?tt.id:void 0,this.type=tt.type,this.rawGeometry=1===tt.type?[tt.geometry]:tt.geometry,this.properties=tt.tags,this.extent=ti||4096}y.prototype.feature=function(tt){return new x(this.features[tt],this.options.extent)},x.prototype.loadGeometry=function(){var ti=this.rawGeometry;this.geometry=[];for(var ta=0;ta<ti.length;ta++){for(var tc=ti[ta],th=[],tf=0;tf<tc.length;tf++)th.push(new tt.Point$1(tc[tf][0],tc[tf][1]));this.geometry.push(th)}return this.geometry},x.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var tt=this.geometry,ti=1/0,ta=-1/0,tc=1/0,th=-1/0,tf=0;tf<tt.length;tf++)for(var td=tt[tf],tm=0;tm<td.length;tm++){var ty=td[tm];ti=Math.min(ti,ty.x),ta=Math.max(ta,ty.x),tc=Math.min(tc,ty.y),th=Math.max(th,ty.y)}return[ti,tc,ta,th]},x.prototype.toGeoJSON=tc.prototype.toGeoJSON;var tf=I;function I(ti){var ta=new tt.pbf;return function(tt,ti){for(var ta in tt.layers)ti.writeMessage(3,M,tt.layers[ta])}(ti,ta),ta.finish()}function M(tt,ti){ti.writeVarintField(15,tt.version||1),ti.writeStringField(1,tt.name||""),ti.writeVarintField(5,tt.extent||4096);var ta,tc={keys:[],values:[],keycache:{},valuecache:{}};for(ta=0;ta<tt.length;ta++)tc.feature=tt.feature(ta),ti.writeMessage(2,b,tc);var th=tc.keys;for(ta=0;ta<th.length;ta++)ti.writeStringField(3,th[ta]);var tf=tc.values;for(ta=0;ta<tf.length;ta++)ti.writeMessage(4,C,tf[ta])}function b(tt,ti){var ta=tt.feature;void 0!==ta.id&&ti.writeVarintField(1,ta.id),ti.writeMessage(2,_,tt),ti.writeVarintField(3,ta.type),ti.writeMessage(4,T,ta)}function _(tt,ti){var ta=tt.feature,tc=tt.keys,th=tt.values,tf=tt.keycache,td=tt.valuecache;for(var tm in ta.properties){var ty=tf[tm];void 0===ty&&(tc.push(tm),tf[tm]=ty=tc.length-1),ti.writeVarint(ty);var tg=ta.properties[tm],t_=typeof tg;"string"!==t_&&"boolean"!==t_&&"number"!==t_&&(tg=JSON.stringify(tg));var tv=t_+":"+tg,tx=td[tv];void 0===tx&&(th.push(tg),td[tv]=tx=th.length-1),ti.writeVarint(tx)}}function T(tt,ti){for(var ta=tt.loadGeometry(),tc=tt.type,th=0,tf=0,td=ta.length,tm=0;tm<td;tm++){var ty=ta[tm],tg=1;1===tc&&(tg=ty.length),ti.writeVarint((tg<<3)+1);for(var t_=3===tc?ty.length-1:ty.length,tv=0;tv<t_;tv++){1===tv&&1!==tc&&ti.writeVarint((t_-1<<3)+2);var tx=ty[tv].x-th,tb=ty[tv].y-tf;ti.writeVarint(tx<<1^tx>>31),ti.writeVarint(tb<<1^tb>>31),th+=tx,tf+=tb}3===tc&&ti.writeVarint(15)}}function C(tt,ti){var ta=typeof tt;"string"===ta?ti.writeStringField(1,tt):"boolean"===ta?ti.writeBooleanField(7,tt):"number"===ta&&(tt%1!=0?ti.writeDoubleField(3,tt):tt<0?ti.writeSVarintField(6,tt):ti.writeVarintField(5,tt))}function D(tt,ti,ta,tc){L(tt,ta,tc),L(ti,2*ta,2*tc),L(ti,2*ta+1,2*tc+1)}function L(tt,ti,ta){var tc=tt[ti];tt[ti]=tt[ta],tt[ta]=tc}function z(tt,ti,ta,tc){var th=tt-ta,tf=ti-tc;return th*th+tf*tf}tf.fromVectorTileJs=I,tf.fromGeojsonVt=function(tt,ti){ti=ti||{};var ta={};for(var tc in tt)ta[tc]=new th(tt[tc].features,ti),ta[tc].name=tc,ta[tc].version=ti.version,ta[tc].extent=ti.extent;return I({layers:ta})},tf.GeoJSONWrapper=th;var O=function(tt){return tt[0]},E=function(tt){return tt[1]},F=function(tt,ti,ta,tc,th){void 0===ti&&(ti=O),void 0===ta&&(ta=E),void 0===tc&&(tc=64),void 0===th&&(th=Float64Array),this.nodeSize=tc,this.points=tt;for(var tf=tt.length<65536?Uint16Array:Uint32Array,td=this.ids=new tf(tt.length),tm=this.coords=new th(2*tt.length),ty=0;ty<tt.length;ty++)td[ty]=ty,tm[2*ty]=ti(tt[ty]),tm[2*ty+1]=ta(tt[ty]);!function e(tt,ti,ta,tc,th,tf){if(!(th-tc<=ta)){var td=tc+th>>1;(function e(tt,ti,ta,tc,th,tf){for(;th>tc;){if(th-tc>600){var td=th-tc+1,tm=ta-tc+1,ty=Math.log(td),tg=.5*Math.exp(2*ty/3),t_=.5*Math.sqrt(ty*tg*(td-tg)/td)*(tm-td/2<0?-1:1);e(tt,ti,ta,Math.max(tc,Math.floor(ta-tm*tg/td+t_)),Math.min(th,Math.floor(ta+(td-tm)*tg/td+t_)),tf)}var tv=ti[2*ta+tf],tx=tc,tb=th;for(D(tt,ti,tc,ta),ti[2*th+tf]>tv&&D(tt,ti,tc,th);tx<tb;){for(D(tt,ti,tx,tb),tx++,tb--;ti[2*tx+tf]<tv;)tx++;for(;ti[2*tb+tf]>tv;)tb--}ti[2*tc+tf]===tv?D(tt,ti,tc,tb):D(tt,ti,++tb,th),tb<=ta&&(tc=tb+1),ta<=tb&&(th=tb-1)}})(tt,ti,td,tc,th,tf%2),e(tt,ti,ta,tc,td-1,tf+1),e(tt,ti,ta,td+1,th,tf+1)}}(td,tm,tc,0,td.length-1,0)};F.prototype.range=function(tt,ti,ta,tc){return function(tt,ti,ta,tc,th,tf,td){for(var tm,ty,tg=[0,tt.length-1,0],t_=[];tg.length;){var tv=tg.pop(),tx=tg.pop(),tb=tg.pop();if(tx-tb<=td)for(var tw=tb;tw<=tx;tw++)ty=ti[2*tw+1],(tm=ti[2*tw])>=ta&&tm<=th&&ty>=tc&&ty<=tf&&t_.push(tt[tw]);else{var tS=Math.floor((tb+tx)/2);ty=ti[2*tS+1],(tm=ti[2*tS])>=ta&&tm<=th&&ty>=tc&&ty<=tf&&t_.push(tt[tS]);var tT=(tv+1)%2;(0===tv?ta<=tm:tc<=ty)&&(tg.push(tb),tg.push(tS-1),tg.push(tT)),(0===tv?th>=tm:tf>=ty)&&(tg.push(tS+1),tg.push(tx),tg.push(tT))}}return t_}(this.ids,this.coords,tt,ti,ta,tc,this.nodeSize)},F.prototype.within=function(tt,ti,ta){return function(tt,ti,ta,tc,th,tf){for(var td=[0,tt.length-1,0],tm=[],ty=th*th;td.length;){var tg=td.pop(),t_=td.pop(),tv=td.pop();if(t_-tv<=tf)for(var tx=tv;tx<=t_;tx++)z(ti[2*tx],ti[2*tx+1],ta,tc)<=ty&&tm.push(tt[tx]);else{var tb=Math.floor((tv+t_)/2),tw=ti[2*tb],tS=ti[2*tb+1];z(tw,tS,ta,tc)<=ty&&tm.push(tt[tb]);var tT=(tg+1)%2;(0===tg?ta-th<=tw:tc-th<=tS)&&(td.push(tv),td.push(tb-1),td.push(tT)),(0===tg?ta+th>=tw:tc+th>=tS)&&(td.push(tb+1),td.push(t_),td.push(tT))}}return tm}(this.ids,this.coords,tt,ti,ta,this.nodeSize)};var td={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(tt){return tt}},J=function(tt){this.options=V(Object.create(td),tt),this.trees=Array(this.options.maxZoom+1)};function Z(tt,ti,ta,tc,th){return{x:tt,y:ti,zoom:1/0,id:ta,parentId:-1,numPoints:tc,properties:th}}function A(tt,ti){var ta=tt.geometry.coordinates,tc=ta[1];return{x:Y(ta[0]),y:j(tc),zoom:1/0,index:ti,parentId:-1}}function B(tt){return{type:"Feature",id:tt.id,properties:G(tt),geometry:{type:"Point",coordinates:[360*(tt.x-.5),360*Math.atan(Math.exp((180-360*tt.y)*Math.PI/180))/Math.PI-90]}}}function G(tt){var ti=tt.numPoints,ta=ti>=1e4?Math.round(ti/1e3)+"k":ti>=1e3?Math.round(ti/100)/10+"k":ti;return V(V({},tt.properties),{cluster:!0,cluster_id:tt.id,point_count:ti,point_count_abbreviated:ta})}function Y(tt){return tt/360+.5}function j(tt){var ti=Math.sin(tt*Math.PI/180),ta=.5-.25*Math.log((1+ti)/(1-ti))/Math.PI;return ta<0?0:ta>1?1:ta}function V(tt,ti){for(var ta in ti)tt[ta]=ti[ta];return tt}function X(tt){return tt.x}function W(tt){return tt.y}function R(tt,ti,ta,tc,th,tf){var td=th-ta,tm=tf-tc;if(0!==td||0!==tm){var ty=((tt-ta)*td+(ti-tc)*tm)/(td*td+tm*tm);ty>1?(ta=th,tc=tf):ty>0&&(ta+=td*ty,tc+=tm*ty)}return(td=tt-ta)*td+(tm=ti-tc)*tm}function q(tt,ti,ta,tc){var th={id:void 0===tt?null:tt,type:ti,geometry:ta,tags:tc,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var ti=tt.geometry,ta=tt.type;if("Point"===ta||"MultiPoint"===ta||"LineString"===ta)U(tt,ti);else if("Polygon"===ta||"MultiLineString"===ta)for(var tc=0;tc<ti.length;tc++)U(tt,ti[tc]);else if("MultiPolygon"===ta)for(tc=0;tc<ti.length;tc++)for(var th=0;th<ti[tc].length;th++)U(tt,ti[tc][th])}(th),th}function U(tt,ti){for(var ta=0;ta<ti.length;ta+=3)tt.minX=Math.min(tt.minX,ti[ta]),tt.minY=Math.min(tt.minY,ti[ta+1]),tt.maxX=Math.max(tt.maxX,ti[ta]),tt.maxY=Math.max(tt.maxY,ti[ta+1])}function $(tt,ti,ta,tc){if(ti.geometry){var th=ti.geometry.coordinates,tf=ti.geometry.type,td=Math.pow(ta.tolerance/((1<<ta.maxZoom)*ta.extent),2),tm=[],ty=ti.id;if(ta.promoteId?ty=ti.properties[ta.promoteId]:ta.generateId&&(ty=tc||0),"Point"===tf)H(th,tm);else if("MultiPoint"===tf)for(var tg=0;tg<th.length;tg++)H(th[tg],tm);else if("LineString"===tf)K(th,tm,td,!1);else if("MultiLineString"===tf){if(ta.lineMetrics){for(tg=0;tg<th.length;tg++)K(th[tg],tm=[],td,!1),tt.push(q(ty,"LineString",tm,ti.properties));return}Q(th,tm,td,!1)}else if("Polygon"===tf)Q(th,tm,td,!0);else{if("MultiPolygon"!==tf){if("GeometryCollection"===tf){for(tg=0;tg<ti.geometry.geometries.length;tg++)$(tt,{id:ty,geometry:ti.geometry.geometries[tg],properties:ti.properties},ta,tc);return}throw Error("Input data is not a valid GeoJSON object.")}for(tg=0;tg<th.length;tg++){var t_=[];Q(th[tg],t_,td,!0),tm.push(t_)}}tt.push(q(ty,tf,tm,ti.properties))}}function H(tt,ti){var ta;ti.push(tt[0]/360+.5),ti.push(te(tt[1])),ti.push(0)}function K(tt,ti,ta,tc){for(var th,tf,td=0,tm=0;tm<tt.length;tm++){var ty,tg=tt[tm][0]/360+.5,t_=te(tt[tm][1]);ti.push(tg),ti.push(t_),ti.push(0),tm>0&&(td+=tc?(th*t_-tg*tf)/2:Math.sqrt(Math.pow(tg-th,2)+Math.pow(t_-tf,2))),th=tg,tf=t_}var tv=ti.length-3;ti[2]=1,function e(tt,ti,ta,tc){for(var th,tf=tc,td=ta-ti>>1,tm=ta-ti,ty=tt[ti],tg=tt[ti+1],t_=tt[ta],tv=tt[ta+1],tx=ti+3;tx<ta;tx+=3){var tb=R(tt[tx],tt[tx+1],ty,tg,t_,tv);if(tb>tf)th=tx,tf=tb;else if(tb===tf){var tw=Math.abs(tx-td);tw<tm&&(th=tx,tm=tw)}}tf>tc&&(th-ti>3&&e(tt,ti,th,tc),tt[th+2]=tf,ta-th>3&&e(tt,th,ta,tc))}(ti,0,tv,ta),ti[tv+2]=1,ti.size=Math.abs(td),ti.start=0,ti.end=ti.size}function Q(tt,ti,ta,tc){for(var th=0;th<tt.length;th++){var tf=[];K(tt[th],tf,ta,tc),ti.push(tf)}}function te(tt){var ti=Math.sin(tt*Math.PI/180),ta=.5-.25*Math.log((1+ti)/(1-ti))/Math.PI;return ta<0?0:ta>1?1:ta}function re(tt,ti,ta,tc,th,tf,td,tm){if(tc/=ti,tf>=(ta/=ti)&&td<tc)return tt;if(td<ta||tf>=tc)return null;for(var ty=[],tg=0;tg<tt.length;tg++){var t_=tt[tg],tv=t_.geometry,tx=t_.type,tb=0===th?t_.minX:t_.minY,tw=0===th?t_.maxX:t_.maxY;if(tb>=ta&&tw<tc)ty.push(t_);else if(!(tw<ta||tb>=tc)){var tS=[];if("Point"===tx||"MultiPoint"===tx)ie(tv,tS,ta,tc,th);else if("LineString"===tx)oe(tv,tS,ta,tc,th,!1,tm.lineMetrics);else if("MultiLineString"===tx)se(tv,tS,ta,tc,th,!1);else if("Polygon"===tx)se(tv,tS,ta,tc,th,!0);else if("MultiPolygon"===tx)for(var tT=0;tT<tv.length;tT++){var tI=[];se(tv[tT],tI,ta,tc,th,!0),tI.length&&tS.push(tI)}if(tS.length){if(tm.lineMetrics&&"LineString"===tx){for(tT=0;tT<tS.length;tT++)ty.push(q(t_.id,tx,tS[tT],t_.tags));continue}"LineString"!==tx&&"MultiLineString"!==tx||(1===tS.length?(tx="LineString",tS=tS[0]):tx="MultiLineString"),"Point"!==tx&&"MultiPoint"!==tx||(tx=3===tS.length?"Point":"MultiPoint"),ty.push(q(t_.id,tx,tS,t_.tags))}}}return ty.length?ty:null}function ie(tt,ti,ta,tc,th){for(var tf=0;tf<tt.length;tf+=3){var td=tt[tf+th];td>=ta&&td<=tc&&(ti.push(tt[tf]),ti.push(tt[tf+1]),ti.push(tt[tf+2]))}}function oe(tt,ti,ta,tc,th,tf,td){for(var tm,ty,tg=ne(tt),t_=0===th?le:ue,tv=tt.start,tx=0;tx<tt.length-3;tx+=3){var tb=tt[tx],tw=tt[tx+1],tS=tt[tx+2],tT=tt[tx+3],tI=tt[tx+4],tE=0===th?tb:tw,tA=0===th?tT:tI,tP=!1;td&&(tm=Math.sqrt(Math.pow(tb-tT,2)+Math.pow(tw-tI,2))),tE<ta?tA>ta&&(ty=t_(tg,tb,tw,tT,tI,ta),td&&(tg.start=tv+tm*ty)):tE>tc?tA<tc&&(ty=t_(tg,tb,tw,tT,tI,tc),td&&(tg.start=tv+tm*ty)):ae(tg,tb,tw,tS),tA<ta&&tE>=ta&&(ty=t_(tg,tb,tw,tT,tI,ta),tP=!0),tA>tc&&tE<=tc&&(ty=t_(tg,tb,tw,tT,tI,tc),tP=!0),!tf&&tP&&(td&&(tg.end=tv+tm*ty),ti.push(tg),tg=ne(tt)),td&&(tv+=tm)}var tz=tt.length-3;tb=tt[tz],tw=tt[tz+1],tS=tt[tz+2],(tE=0===th?tb:tw)>=ta&&tE<=tc&&ae(tg,tb,tw,tS),tz=tg.length-3,tf&&tz>=3&&(tg[tz]!==tg[0]||tg[tz+1]!==tg[1])&&ae(tg,tg[0],tg[1],tg[2]),tg.length&&ti.push(tg)}function ne(tt){var ti=[];return ti.size=tt.size,ti.start=tt.start,ti.end=tt.end,ti}function se(tt,ti,ta,tc,th,tf){for(var td=0;td<tt.length;td++)oe(tt[td],ti,ta,tc,th,tf,!1)}function ae(tt,ti,ta,tc){tt.push(ti),tt.push(ta),tt.push(tc)}function le(tt,ti,ta,tc,th,tf){var td=(tf-ti)/(tc-ti);return tt.push(tf),tt.push(ta+(th-ta)*td),tt.push(1),td}function ue(tt,ti,ta,tc,th,tf){var td=(tf-ta)/(th-ta);return tt.push(ti+(tc-ti)*td),tt.push(tf),tt.push(1),td}function he(tt,ti){for(var ta=[],tc=0;tc<tt.length;tc++){var th,tf=tt[tc],td=tf.type;if("Point"===td||"MultiPoint"===td||"LineString"===td)th=ce(tf.geometry,ti);else if("MultiLineString"===td||"Polygon"===td){th=[];for(var tm=0;tm<tf.geometry.length;tm++)th.push(ce(tf.geometry[tm],ti))}else if("MultiPolygon"===td)for(th=[],tm=0;tm<tf.geometry.length;tm++){for(var ty=[],tg=0;tg<tf.geometry[tm].length;tg++)ty.push(ce(tf.geometry[tm][tg],ti));th.push(ty)}ta.push(q(tf.id,td,th,tf.tags))}return ta}function ce(tt,ti){var ta=[];ta.size=tt.size,void 0!==tt.start&&(ta.start=tt.start,ta.end=tt.end);for(var tc=0;tc<tt.length;tc+=3)ta.push(tt[tc]+ti,tt[tc+1],tt[tc+2]);return ta}function pe(tt,ti){if(tt.transformed)return tt;var ta,tc,th,tf=1<<tt.z,td=tt.x,tm=tt.y;for(ta=0;ta<tt.features.length;ta++){var ty=tt.features[ta],tg=ty.geometry,t_=ty.type;if(ty.geometry=[],1===t_)for(tc=0;tc<tg.length;tc+=2)ty.geometry.push(fe(tg[tc],tg[tc+1],ti,tf,td,tm));else for(tc=0;tc<tg.length;tc++){var tv=[];for(th=0;th<tg[tc].length;th+=2)tv.push(fe(tg[tc][th],tg[tc][th+1],ti,tf,td,tm));ty.geometry.push(tv)}}return tt.transformed=!0,tt}function fe(tt,ti,ta,tc,th,tf){return[Math.round(ta*(tt*tc-th)),Math.round(ta*(ti*tc-tf))]}function de(tt,ti,ta,tc,th){for(var tf=ti===th.maxZoom?0:th.tolerance/((1<<ti)*th.extent),td={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ta,y:tc,z:ti,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},tm=0;tm<tt.length;tm++){td.numFeatures++,ge(td,tt[tm],tf,th);var ty=tt[tm].minX,tg=tt[tm].minY,t_=tt[tm].maxX,tv=tt[tm].maxY;ty<td.minX&&(td.minX=ty),tg<td.minY&&(td.minY=tg),t_>td.maxX&&(td.maxX=t_),tv>td.maxY&&(td.maxY=tv)}return td}function ge(tt,ti,ta,tc){var th=ti.geometry,tf=ti.type,td=[];if("Point"===tf||"MultiPoint"===tf)for(var tm=0;tm<th.length;tm+=3)td.push(th[tm]),td.push(th[tm+1]),tt.numPoints++,tt.numSimplified++;else if("LineString"===tf)ve(td,th,tt,ta,!1,!1);else if("MultiLineString"===tf||"Polygon"===tf)for(tm=0;tm<th.length;tm++)ve(td,th[tm],tt,ta,"Polygon"===tf,0===tm);else if("MultiPolygon"===tf)for(var ty=0;ty<th.length;ty++){var tg=th[ty];for(tm=0;tm<tg.length;tm++)ve(td,tg[tm],tt,ta,!0,0===tm)}if(td.length){var t_=ti.tags||null;if("LineString"===tf&&tc.lineMetrics){for(var tv in t_={},ti.tags)t_[tv]=ti.tags[tv];t_.mapbox_clip_start=th.start/th.size,t_.mapbox_clip_end=th.end/th.size}var tx={geometry:td,type:"Polygon"===tf||"MultiPolygon"===tf?3:"LineString"===tf||"MultiLineString"===tf?2:1,tags:t_};null!==ti.id&&(tx.id=ti.id),tt.features.push(tx)}}function ve(tt,ti,ta,tc,th,tf){var td=tc*tc;if(tc>0&&ti.size<(th?td:tc))ta.numPoints+=ti.length/3;else{for(var tm=[],ty=0;ty<ti.length;ty+=3)(0===tc||ti[ty+2]>td)&&(ta.numSimplified++,tm.push(ti[ty]),tm.push(ti[ty+1])),ta.numPoints++;th&&function(tt,ti){for(var ta=0,tc=0,th=tt.length,tf=th-2;tc<th;tf=tc,tc+=2)ta+=(tt[tc]-tt[tf])*(tt[tc+1]+tt[tf+1]);if(ta>0===ti)for(tc=0,th=tt.length;tc<th/2;tc+=2){var td=tt[tc],tm=tt[tc+1];tt[tc]=tt[th-2-tc],tt[tc+1]=tt[th-1-tc],tt[th-2-tc]=td,tt[th-1-tc]=tm}}(tm,tf),tt.push(tm)}}function me(tt,ti){var ta,tc,th,tf,td,tm,ty=(ti=this.options=function(tt,ti){for(var ta in ti)tt[ta]=ti[ta];return tt}(Object.create(this.options),ti)).debug;if(ty&&console.time("preprocess data"),ti.maxZoom<0||ti.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(ti.promoteId&&ti.generateId)throw Error("promoteId and generateId cannot be used together.");var tg=function(tt,ti){var ta=[];if("FeatureCollection"===tt.type)for(var tc=0;tc<tt.features.length;tc++)$(ta,tt.features[tc],ti,tc);else $(ta,"Feature"===tt.type?tt:{geometry:tt},ti);return ta}(tt,ti);this.tiles={},this.tileCoords=[],ty&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ti.indexMaxZoom,ti.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ta=tg,th=(tc=ti).buffer/tc.extent,tf=ta,td=re(ta,1,-1-th,th,0,-1,2,tc),tm=re(ta,1,1-th,2+th,0,-1,2,tc),(td||tm)&&(tf=re(ta,1,-th,1+th,0,-1,2,tc)||[],td&&(tf=he(td,1).concat(tf)),tm&&(tf=tf.concat(he(tm,-1)))),tg=tf).length&&this.splitTile(tg,0,0,0),ty&&(tg.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(tt,ti,ta){return 32*((1<<tt)*ta+ti)+tt}function xe(tt,ti){var ta=tt.tileID.canonical;if(!this._geoJSONIndex)return ti(null,null);var tc=this._geoJSONIndex.getTile(ta.z,ta.x,ta.y);if(!tc)return ti(null,null);var th=new g(tc.features),td=tf(th);0===td.byteOffset&&td.byteLength===td.buffer.byteLength||(td=new Uint8Array(td)),ti(null,{vectorTile:th,rawData:td.buffer})}J.prototype.load=function(tt){var ti=this.options,ta=ti.log,tc=ti.minZoom,th=ti.maxZoom,tf=ti.nodeSize;ta&&console.time("total time");var td="prepare "+tt.length+" points";ta&&console.time(td),this.points=tt;for(var tm=[],ty=0;ty<tt.length;ty++)tt[ty].geometry&&tm.push(A(tt[ty],ty));this.trees[th+1]=new F(tm,X,W,tf,Float32Array),ta&&console.timeEnd(td);for(var tg=th;tg>=tc;tg--){var t_=+Date.now();tm=this._cluster(tm,tg),this.trees[tg]=new F(tm,X,W,tf,Float32Array),ta&&console.log("z%d: %d clusters in %dms",tg,tm.length,+Date.now()-t_)}return ta&&console.timeEnd("total time"),this},J.prototype.getClusters=function(tt,ti){var ta=((tt[0]+180)%360+360)%360-180,tc=Math.max(-90,Math.min(90,tt[1])),th=180===tt[2]?180:((tt[2]+180)%360+360)%360-180,tf=Math.max(-90,Math.min(90,tt[3]));if(tt[2]-tt[0]>=360)ta=-180,th=180;else if(ta>th){var td=this.getClusters([ta,tc,180,tf],ti),tm=this.getClusters([-180,tc,th,tf],ti);return td.concat(tm)}for(var ty=this.trees[this._limitZoom(ti)],tg=[],t_=0,tv=ty.range(Y(ta),j(tf),Y(th),j(tc));t_<tv.length;t_+=1){var tx=ty.points[tv[t_]];tg.push(tx.numPoints?B(tx):this.points[tx.index])}return tg},J.prototype.getChildren=function(tt){var ti=this._getOriginId(tt),ta=this._getOriginZoom(tt),tc="No cluster with the specified id.",th=this.trees[ta];if(!th)throw Error(tc);var tf=th.points[ti];if(!tf)throw Error(tc);for(var td=this.options.radius/(this.options.extent*Math.pow(2,ta-1)),tm=[],ty=0,tg=th.within(tf.x,tf.y,td);ty<tg.length;ty+=1){var t_=th.points[tg[ty]];t_.parentId===tt&&tm.push(t_.numPoints?B(t_):this.points[t_.index])}if(0===tm.length)throw Error(tc);return tm},J.prototype.getLeaves=function(tt,ti,ta){var tc=[];return this._appendLeaves(tc,tt,ti=ti||10,ta=ta||0,0),tc},J.prototype.getTile=function(tt,ti,ta){var tc=this.trees[this._limitZoom(tt)],th=Math.pow(2,tt),tf=this.options,td=tf.radius/tf.extent,tm=(ta-td)/th,ty=(ta+1+td)/th,tg={features:[]};return this._addTileFeatures(tc.range((ti-td)/th,tm,(ti+1+td)/th,ty),tc.points,ti,ta,th,tg),0===ti&&this._addTileFeatures(tc.range(1-td/th,tm,1,ty),tc.points,th,ta,th,tg),ti===th-1&&this._addTileFeatures(tc.range(0,tm,td/th,ty),tc.points,-1,ta,th,tg),tg.features.length?tg:null},J.prototype.getClusterExpansionZoom=function(tt){for(var ti=this._getOriginZoom(tt)-1;ti<=this.options.maxZoom;){var ta=this.getChildren(tt);if(ti++,1!==ta.length)break;tt=ta[0].properties.cluster_id}return ti},J.prototype._appendLeaves=function(tt,ti,ta,tc,th){for(var tf=0,td=this.getChildren(ti);tf<td.length;tf+=1){var tm=td[tf],ty=tm.properties;if(ty&&ty.cluster?th+ty.point_count<=tc?th+=ty.point_count:th=this._appendLeaves(tt,ty.cluster_id,ta,tc,th):th<tc?th++:tt.push(tm),tt.length===ta)break}return th},J.prototype._addTileFeatures=function(tt,ti,ta,tc,th,tf){for(var td=0;td<tt.length;td+=1){var tm=ti[tt[td]],ty=tm.numPoints,tg={type:1,geometry:[[Math.round(this.options.extent*(tm.x*th-ta)),Math.round(this.options.extent*(tm.y*th-tc))]],tags:ty?G(tm):this.points[tm.index].properties},t_=void 0;ty?t_=tm.id:this.options.generateId?t_=tm.index:this.points[tm.index].id&&(t_=this.points[tm.index].id),void 0!==t_&&(tg.id=t_),tf.features.push(tg)}},J.prototype._limitZoom=function(tt){return Math.max(this.options.minZoom,Math.min(+tt,this.options.maxZoom+1))},J.prototype._cluster=function(tt,ti){for(var ta=[],tc=this.options,th=tc.reduce,tf=tc.minPoints,td=tc.radius/(tc.extent*Math.pow(2,ti)),tm=0;tm<tt.length;tm++){var ty=tt[tm];if(!(ty.zoom<=ti)){ty.zoom=ti;for(var tg=this.trees[ti+1],t_=tg.within(ty.x,ty.y,td),tv=ty.numPoints||1,tx=tv,tb=0;tb<t_.length;tb+=1){var tw=tg.points[t_[tb]];tw.zoom>ti&&(tx+=tw.numPoints||1)}if(tx>=tf){for(var tS=ty.x*tv,tT=ty.y*tv,tI=th&&tv>1?this._map(ty,!0):null,tE=(tm<<5)+(ti+1)+this.points.length,tA=0;tA<t_.length;tA+=1){var tP=tg.points[t_[tA]];if(!(tP.zoom<=ti)){tP.zoom=ti;var tz=tP.numPoints||1;tS+=tP.x*tz,tT+=tP.y*tz,tP.parentId=tE,th&&(tI||(tI=this._map(ty,!0)),th(tI,this._map(tP)))}}ty.parentId=tE,ta.push(Z(tS/tx,tT/tx,tE,tx,tI))}else if(ta.push(ty),tx>1)for(var tC=0;tC<t_.length;tC+=1){var tk=tg.points[t_[tC]];tk.zoom<=ti||(tk.zoom=ti,ta.push(tk))}}}return ta},J.prototype._getOriginId=function(tt){return tt-this.points.length>>5},J.prototype._getOriginZoom=function(tt){return(tt-this.points.length)%32},J.prototype._map=function(tt,ti){if(tt.numPoints)return ti?V({},tt.properties):tt.properties;var ta=this.points[tt.index].properties,tc=this.options.map(ta);return ti&&tc===ta?V({},tc):tc},me.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},me.prototype.splitTile=function(tt,ti,ta,tc,th,tf,td){for(var tm=[tt,ti,ta,tc],ty=this.options,tg=ty.debug;tm.length;){tc=tm.pop(),ta=tm.pop(),ti=tm.pop(),tt=tm.pop();var t_=1<<ti,tv=ye(ti,ta,tc),tx=this.tiles[tv];if(!tx&&(tg>1&&console.time("creation"),tx=this.tiles[tv]=de(tt,ti,ta,tc,ty),this.tileCoords.push({z:ti,x:ta,y:tc}),tg)){tg>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ti,ta,tc,tx.numFeatures,tx.numPoints,tx.numSimplified),console.timeEnd("creation"));var tb="z"+ti;this.stats[tb]=(this.stats[tb]||0)+1,this.total++}if(tx.source=tt,th){if(ti===ty.maxZoom||ti===th)continue;var tw=1<<th-ti;if(ta!==Math.floor(tf/tw)||tc!==Math.floor(td/tw))continue}else if(ti===ty.indexMaxZoom||tx.numPoints<=ty.indexMaxPoints)continue;if(tx.source=null,0!==tt.length){tg>1&&console.time("clipping");var tS,tT,tI,tE,tA,tP,tz=.5*ty.buffer/ty.extent,tC=.5-tz,tk=.5+tz,tM=1+tz;tS=tT=tI=tE=null,tA=re(tt,t_,ta-tz,ta+tk,0,tx.minX,tx.maxX,ty),tP=re(tt,t_,ta+tC,ta+tM,0,tx.minX,tx.maxX,ty),tt=null,tA&&(tS=re(tA,t_,tc-tz,tc+tk,1,tx.minY,tx.maxY,ty),tT=re(tA,t_,tc+tC,tc+tM,1,tx.minY,tx.maxY,ty),tA=null),tP&&(tI=re(tP,t_,tc-tz,tc+tk,1,tx.minY,tx.maxY,ty),tE=re(tP,t_,tc+tC,tc+tM,1,tx.minY,tx.maxY,ty),tP=null),tg>1&&console.timeEnd("clipping"),tm.push(tS||[],ti+1,2*ta,2*tc),tm.push(tT||[],ti+1,2*ta,2*tc+1),tm.push(tI||[],ti+1,2*ta+1,2*tc),tm.push(tE||[],ti+1,2*ta+1,2*tc+1)}}},me.prototype.getTile=function(tt,ti,ta){var tc=this.options,th=tc.extent,tf=tc.debug;if(tt<0||tt>24)return null;var td=1<<tt,tm=ye(tt,ti=(ti%td+td)%td,ta);if(this.tiles[tm])return pe(this.tiles[tm],th);tf>1&&console.log("drilling down to z%d-%d-%d",tt,ti,ta);for(var ty,tg=tt,t_=ti,tv=ta;!ty&&tg>0;)tg--,t_=Math.floor(t_/2),tv=Math.floor(tv/2),ty=this.tiles[ye(tg,t_,tv)];return ty&&ty.source?(tf>1&&console.log("found parent tile z%d-%d-%d",tg,t_,tv),tf>1&&console.time("drilling down"),this.splitTile(ty.source,tg,t_,tv,tt,ti,ta),tf>1&&console.timeEnd("drilling down"),this.tiles[tm]?pe(this.tiles[tm],th):null):null};var tm=function(ti){function r(tt,ta,tc,th){ti.call(this,tt,ta,tc,xe),th&&(this.loadGeoJSON=th)}return ti&&(r.__proto__=ti),(r.prototype=Object.create(ti&&ti.prototype)).constructor=r,r.prototype.loadData=function(tt,ti){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ti,this._pendingLoadDataParams=tt,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var ti=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ta=this._pendingCallback,tc=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var th=!!(tc&&tc.request&&tc.request.collectResourceTiming)&&new tt.RequestPerformance(tc.request);this.loadGeoJSON(tc,function(tf,td){if(tf||!td)return ta(tf);if("object"!=typeof td)return ta(Error("Input data given to '"+tc.source+"' is not a valid GeoJSON object."));!function e(tt,ti){var ta,tc=tt&&tt.type;if("FeatureCollection"===tc)for(ta=0;ta<tt.features.length;ta++)e(tt.features[ta],ti);else if("GeometryCollection"===tc)for(ta=0;ta<tt.geometries.length;ta++)e(tt.geometries[ta],ti);else if("Feature"===tc)e(tt.geometry,ti);else if("Polygon"===tc)c(tt.coordinates,ti);else if("MultiPolygon"===tc)for(ta=0;ta<tt.coordinates.length;ta++)c(tt.coordinates[ta],ti);return tt}(td,!0);try{if(tc.filter){var tm,ty,tg=tt.createExpression(tc.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===tg.result)throw Error(tg.value.map(function(tt){return tt.key+": "+tt.message}).join(", "));var t_=td.features.filter(function(tt){return tg.value.evaluate({zoom:0},tt)});td={type:"FeatureCollection",features:t_}}ti._geoJSONIndex=tc.cluster?new J(function(ti){var ta=ti.superclusterOptions,tc=ti.clusterProperties;if(!tc||!ta)return ta;for(var th={},tf={},td={accumulated:null,zoom:0},tm={properties:null},ty=Object.keys(tc),tg=0;tg<ty.length;tg+=1){var t_=ty[tg],tv=tc[t_],tx=tv[0],tb=tt.createExpression(tv[1]),tw=tt.createExpression("string"==typeof tx?[tx,["accumulated"],["get",t_]]:tx);th[t_]=tb.value,tf[t_]=tw.value}return ta.map=function(tt){tm.properties=tt;for(var ti={},ta=0;ta<ty.length;ta+=1){var tc=ty[ta];ti[tc]=th[tc].evaluate(td,tm)}return ti},ta.reduce=function(tt,ti){tm.properties=ti;for(var ta=0;ta<ty.length;ta+=1){var tc=ty[ta];td.accumulated=tt[tc],tt[tc]=tf[tc].evaluate(td,tm)}},ta}(tc)).load(td.features):(tm=td,ty=tc.geojsonVtOptions,new me(tm,ty))}catch(tt){return ta(tt)}ti.loaded={};var tv={};if(th){var tx=th.finish();tx&&(tv.resourceTiming={},tv.resourceTiming[tc.source]=JSON.parse(JSON.stringify(tx)))}ta(null,tv)})}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(tt,ta){var tc=this.loaded;return tc&&tc[tt.uid]?ti.prototype.reloadTile.call(this,tt,ta):this.loadTile(tt,ta)},r.prototype.loadGeoJSON=function(ti,ta){if(ti.request)tt.getJSON(ti.request,ta);else{if("string"!=typeof ti.data)return ta(Error("Input data given to '"+ti.source+"' is not a valid GeoJSON object."));try{return ta(null,JSON.parse(ti.data))}catch(tt){return ta(Error("Input data given to '"+ti.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(tt,ti){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ti()},r.prototype.getClusterExpansionZoom=function(tt,ti){try{ti(null,this._geoJSONIndex.getClusterExpansionZoom(tt.clusterId))}catch(tt){ti(tt)}},r.prototype.getClusterChildren=function(tt,ti){try{ti(null,this._geoJSONIndex.getChildren(tt.clusterId))}catch(tt){ti(tt)}},r.prototype.getClusterLeaves=function(tt,ti){try{ti(null,this._geoJSONIndex.getLeaves(tt.clusterId,tt.limit,tt.offset))}catch(tt){ti(tt)}},r}(l),Se=function(ti){var ta=this;this.self=ti,this.actor=new tt.Actor(ti,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:tm},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(tt,ti){if(ta.workerSourceTypes[tt])throw Error('Worker source with name "'+tt+'" already registered.');ta.workerSourceTypes[tt]=ti},this.self.registerRTLTextPlugin=function(ti){if(tt.plugin.isParsed())throw Error("RTL text plugin already registered.");tt.plugin.applyArabicShaping=ti.applyArabicShaping,tt.plugin.processBidirectionalText=ti.processBidirectionalText,tt.plugin.processStyledBidirectionalText=ti.processStyledBidirectionalText}};return Se.prototype.setReferrer=function(tt,ti){this.referrer=ti},Se.prototype.setImages=function(tt,ti,ta){for(var tc in this.availableImages[tt]=ti,this.workerSources[tt]){var th=this.workerSources[tt][tc];for(var tf in th)th[tf].availableImages=ti}ta()},Se.prototype.setLayers=function(tt,ti,ta){this.getLayerIndex(tt).replace(ti),ta()},Se.prototype.updateLayers=function(tt,ti,ta){this.getLayerIndex(tt).update(ti.layers,ti.removedIds),ta()},Se.prototype.loadTile=function(tt,ti,ta){this.getWorkerSource(tt,ti.type,ti.source).loadTile(ti,ta)},Se.prototype.loadDEMTile=function(tt,ti,ta){this.getDEMWorkerSource(tt,ti.source).loadTile(ti,ta)},Se.prototype.reloadTile=function(tt,ti,ta){this.getWorkerSource(tt,ti.type,ti.source).reloadTile(ti,ta)},Se.prototype.abortTile=function(tt,ti,ta){this.getWorkerSource(tt,ti.type,ti.source).abortTile(ti,ta)},Se.prototype.removeTile=function(tt,ti,ta){this.getWorkerSource(tt,ti.type,ti.source).removeTile(ti,ta)},Se.prototype.removeDEMTile=function(tt,ti){this.getDEMWorkerSource(tt,ti.source).removeTile(ti)},Se.prototype.removeSource=function(tt,ti,ta){if(this.workerSources[tt]&&this.workerSources[tt][ti.type]&&this.workerSources[tt][ti.type][ti.source]){var tc=this.workerSources[tt][ti.type][ti.source];delete this.workerSources[tt][ti.type][ti.source],void 0!==tc.removeSource?tc.removeSource(ti,ta):ta()}},Se.prototype.loadWorkerSource=function(tt,ti,ta){try{this.self.importScripts(ti.url),ta()}catch(tt){ta(tt.toString())}},Se.prototype.syncRTLPluginState=function(ti,ta,tc){try{tt.plugin.setState(ta);var th=tt.plugin.getPluginURL();if(tt.plugin.isLoaded()&&!tt.plugin.isParsed()&&null!=th){this.self.importScripts(th);var tf=tt.plugin.isParsed();tc(tf?void 0:Error("RTL Text Plugin failed to import scripts from "+th),tf)}}catch(tt){tc(tt.toString())}},Se.prototype.getAvailableImages=function(tt){var ti=this.availableImages[tt];return ti||(ti=[]),ti},Se.prototype.getLayerIndex=function(tt){var ti=this.layerIndexes[tt];return ti||(ti=this.layerIndexes[tt]=new i),ti},Se.prototype.getWorkerSource=function(tt,ti,ta){var tc=this;return this.workerSources[tt]||(this.workerSources[tt]={}),this.workerSources[tt][ti]||(this.workerSources[tt][ti]={}),this.workerSources[tt][ti][ta]||(this.workerSources[tt][ti][ta]=new this.workerSourceTypes[ti]({send:function(ti,ta,th){tc.actor.send(ti,ta,th,tt)}},this.getLayerIndex(tt),this.getAvailableImages(tt))),this.workerSources[tt][ti][ta]},Se.prototype.getDEMWorkerSource=function(tt,ti){return this.demWorkerSources[tt]||(this.demWorkerSources[tt]={}),this.demWorkerSources[tt][ti]||(this.demWorkerSources[tt][ti]=new h),this.demWorkerSources[tt][ti]},Se.prototype.enforceCacheSizeLimit=function(ti,ta){tt.enforceCacheSizeLimit(ta)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Se(self)),Se}),define(["./shared"],function(tt){var ti=tt.createCommonjsModule(function(tt){function e(tt){return!i(tt)}function i(tt){var ta;return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var tt,ti,ta=new Blob([""],{type:"text/javascript"}),tc=URL.createObjectURL(ta);try{ti=new Worker(tc),tt=!0}catch(ti){tt=!1}return ti&&ti.terminate(),URL.revokeObjectURL(tc),tt}()?"insufficient worker support":"Uint8ClampedArray"in window?ArrayBuffer.isView?!function(){var tt=document.createElement("canvas");tt.width=tt.height=1;var ti=tt.getContext("2d");if(!ti)return!1;var ta=ti.getImageData(0,0,1,1);return ta&&ta.width===tt.width}()?"insufficient Canvas/getImageData support":(void 0===ti[ta=tt&&tt.failIfMajorPerformanceCaveat]&&(ti[ta]=function(tt){var ti,ta,tc=(ti=document.createElement("canvas"),(ta=Object.create(e.webGLContextAttributes)).failIfMajorPerformanceCaveat=tt,ti.probablySupportsContext?ti.probablySupportsContext("webgl",ta)||ti.probablySupportsContext("experimental-webgl",ta):ti.supportsContext?ti.supportsContext("webgl",ta)||ti.supportsContext("experimental-webgl",ta):ti.getContext("webgl",ta)||ti.getContext("experimental-webgl",ta));if(!tc)return!1;var th=tc.createShader(tc.VERTEX_SHADER);return!(!th||tc.isContextLost())&&(tc.shaderSource(th,"void main() {}"),tc.compileShader(th),!0===tc.getShaderParameter(th,tc.COMPILE_STATUS))}(ta)),ti[ta]?void 0:"insufficient WebGL support"):"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support"}tt.exports?tt.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=i);var ti={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),ta={create:function(ti,ta,tc){var th=tt.window.document.createElement(ti);return void 0!==ta&&(th.className=ta),tc&&tc.appendChild(th),th},createNS:function(ti,ta){return tt.window.document.createElementNS(ti,ta)}},tc=tt.window.document&&tt.window.document.documentElement.style;function r(tt){if(!tc)return tt[0];for(var ti=0;ti<tt.length;ti++)if(tt[ti]in tc)return tt[ti];return tt[0]}var th,tf=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);ta.disableDrag=function(){tc&&tf&&(th=tc[tf],tc[tf]="none")},ta.enableDrag=function(){tc&&tf&&(tc[tf]=th)};var td=r(["transform","WebkitTransform"]);ta.setTransform=function(tt,ti){tt.style[td]=ti};var tm=!1;try{var ty=Object.defineProperty({},"passive",{get:function(){tm=!0}});tt.window.addEventListener("test",ty,ty),tt.window.removeEventListener("test",ty,ty)}catch(tt){tm=!1}ta.addEventListener=function(tt,ti,ta,tc){void 0===tc&&(tc={}),tt.addEventListener(ti,ta,"passive"in tc&&tm?tc:tc.capture)},ta.removeEventListener=function(tt,ti,ta,tc){void 0===tc&&(tc={}),tt.removeEventListener(ti,ta,"passive"in tc&&tm?tc:tc.capture)};var u=function(ti){ti.preventDefault(),ti.stopPropagation(),tt.window.removeEventListener("click",u,!0)};function h(tt){var ti=tt.userImage;return!!(ti&&ti.render&&ti.render())&&(tt.data.replace(new Uint8Array(ti.data.buffer)),!0)}ta.suppressClick=function(){tt.window.addEventListener("click",u,!0),tt.window.setTimeout(function(){tt.window.removeEventListener("click",u,!0)},0)},ta.mousePos=function(ti,ta){var tc=ti.getBoundingClientRect();return new tt.Point(ta.clientX-tc.left-ti.clientLeft,ta.clientY-tc.top-ti.clientTop)},ta.touchPos=function(ti,ta){for(var tc=ti.getBoundingClientRect(),th=[],tf=0;tf<ta.length;tf++)th.push(new tt.Point(ta[tf].clientX-tc.left-ti.clientLeft,ta[tf].clientY-tc.top-ti.clientTop));return th},ta.mouseButton=function(ti){return void 0!==tt.window.InstallTrigger&&2===ti.button&&ti.ctrlKey&&tt.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:ti.button},ta.remove=function(tt){tt.parentNode&&tt.parentNode.removeChild(tt)};var tg=function(ti){function i(){ti.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new tt.RGBAImage({width:1,height:1}),this.dirty=!0}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(tt){if(this.loaded!==tt&&(this.loaded=tt,tt)){for(var ti=0,ta=this.requestors;ti<ta.length;ti+=1){var tc=ta[ti];this._notify(tc.ids,tc.callback)}this.requestors=[]}},i.prototype.getImage=function(tt){return this.images[tt]},i.prototype.addImage=function(tt,ti){this._validate(tt,ti)&&(this.images[tt]=ti)},i.prototype._validate=function(ti,ta){var tc=!0;return this._validateStretch(ta.stretchX,ta.data&&ta.data.width)||(this.fire(new tt.ErrorEvent(Error('Image "'+ti+'" has invalid "stretchX" value'))),tc=!1),this._validateStretch(ta.stretchY,ta.data&&ta.data.height)||(this.fire(new tt.ErrorEvent(Error('Image "'+ti+'" has invalid "stretchY" value'))),tc=!1),this._validateContent(ta.content,ta)||(this.fire(new tt.ErrorEvent(Error('Image "'+ti+'" has invalid "content" value'))),tc=!1),tc},i.prototype._validateStretch=function(tt,ti){if(!tt)return!0;for(var ta=0,tc=0;tc<tt.length;tc+=1){var th=tt[tc];if(th[0]<ta||th[1]<th[0]||ti<th[1])return!1;ta=th[1]}return!0},i.prototype._validateContent=function(tt,ti){return!(tt&&(4!==tt.length||tt[0]<0||ti.data.width<tt[0]||tt[1]<0||ti.data.height<tt[1]||tt[2]<0||ti.data.width<tt[2]||tt[3]<0||ti.data.height<tt[3]||tt[2]<tt[0]||tt[3]<tt[1]))},i.prototype.updateImage=function(tt,ti){ti.version=this.images[tt].version+1,this.images[tt]=ti,this.updatedImages[tt]=!0},i.prototype.removeImage=function(tt){var ti=this.images[tt];delete this.images[tt],delete this.patterns[tt],ti.userImage&&ti.userImage.onRemove&&ti.userImage.onRemove()},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(tt,ti){var ta=!0;if(!this.isLoaded())for(var tc=0;tc<tt.length;tc+=1)this.images[tt[tc]]||(ta=!1);this.isLoaded()||ta?this._notify(tt,ti):this.requestors.push({ids:tt,callback:ti})},i.prototype._notify=function(ti,ta){for(var tc={},th=0;th<ti.length;th+=1){var tf=ti[th];this.images[tf]||this.fire(new tt.Event("styleimagemissing",{id:tf}));var td=this.images[tf];td?tc[tf]={data:td.data.clone(),pixelRatio:td.pixelRatio,sdf:td.sdf,version:td.version,stretchX:td.stretchX,stretchY:td.stretchY,content:td.content,hasRenderCallback:!!(td.userImage&&td.userImage.render)}:tt.warnOnce('Image "'+tf+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}ta(null,tc)},i.prototype.getPixelSize=function(){var tt=this.atlasImage;return{width:tt.width,height:tt.height}},i.prototype.getPattern=function(ti){var ta=this.patterns[ti],tc=this.getImage(ti);if(!tc)return null;if(ta&&ta.position.version===tc.version)return ta.position;if(ta)ta.position.version=tc.version;else{var th={w:tc.data.width+2,h:tc.data.height+2,x:0,y:0},tf=new tt.ImagePosition(th,tc);this.patterns[ti]={bin:th,position:tf}}return this._updatePatternAtlas(),this.patterns[ti].position},i.prototype.bind=function(ti){var ta=ti.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new tt.Texture(ti,this.atlasImage,ta.RGBA),this.atlasTexture.bind(ta.LINEAR,ta.CLAMP_TO_EDGE)},i.prototype._updatePatternAtlas=function(){var ti=[];for(var ta in this.patterns)ti.push(this.patterns[ta].bin);var tc=tt.potpack(ti),th=tc.w,tf=tc.h,td=this.atlasImage;for(var tm in td.resize({width:th||1,height:tf||1}),this.patterns){var ty=this.patterns[tm].bin,tg=ty.x+1,t_=ty.y+1,tv=this.images[tm].data,tx=tv.width,tb=tv.height;tt.RGBAImage.copy(tv,td,{x:0,y:0},{x:tg,y:t_},{width:tx,height:tb}),tt.RGBAImage.copy(tv,td,{x:0,y:tb-1},{x:tg,y:t_-1},{width:tx,height:1}),tt.RGBAImage.copy(tv,td,{x:0,y:0},{x:tg,y:t_+tb},{width:tx,height:1}),tt.RGBAImage.copy(tv,td,{x:tx-1,y:0},{x:tg-1,y:t_},{width:1,height:tb}),tt.RGBAImage.copy(tv,td,{x:0,y:0},{x:tg+tx,y:t_},{width:1,height:tb})}this.dirty=!0},i.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},i.prototype.dispatchRenderCallbacks=function(tt){for(var ti=0;ti<tt.length;ti+=1){var ta=tt[ti];if(!this.callbackDispatchedThisFrame[ta]){this.callbackDispatchedThisFrame[ta]=!0;var tc=this.images[ta];h(tc)&&this.updateImage(ta,tc)}}},i}(tt.Evented),t_=m,tv=m;function m(tt,ti,ta,tc,th,tf){this.fontSize=tt||24,this.buffer=void 0===ti?3:ti,this.cutoff=tc||.25,this.fontFamily=th||"sans-serif",this.fontWeight=tf||"normal",this.radius=ta||8;var td=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=td,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(td*td),this.gridInner=new Float64Array(td*td),this.f=new Float64Array(td),this.d=new Float64Array(td),this.z=new Float64Array(td+1),this.v=new Int16Array(td),this.middle=Math.round(td/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(tt,ti,ta,tc,th,tf,td){for(var tm=0;tm<ti;tm++){for(var ty=0;ty<ta;ty++)tc[ty]=tt[ty*ti+tm];for(v(tc,th,tf,td,ta),ty=0;ty<ta;ty++)tt[ty*ti+tm]=th[ty]}for(ty=0;ty<ta;ty++){for(tm=0;tm<ti;tm++)tc[tm]=tt[ty*ti+tm];for(v(tc,th,tf,td,ti),tm=0;tm<ti;tm++)tt[ty*ti+tm]=Math.sqrt(th[tm])}}function v(tt,ti,ta,tc,th){ta[0]=0,tc[0]=-1e20,tc[1]=1e20;for(var tf=1,td=0;tf<th;tf++){for(var tm=(tt[tf]+tf*tf-(tt[ta[td]]+ta[td]*ta[td]))/(2*tf-2*ta[td]);tm<=tc[td];)td--,tm=(tt[tf]+tf*tf-(tt[ta[td]]+ta[td]*ta[td]))/(2*tf-2*ta[td]);ta[++td]=tf,tc[td]=tm,tc[td+1]=1e20}for(tf=0,td=0;tf<th;tf++){for(;tc[td+1]<tf;)td++;ti[tf]=(tf-ta[td])*(tf-ta[td])+tt[ta[td]]}}m.prototype.draw=function(tt){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(tt,this.buffer,this.middle);for(var ti=this.ctx.getImageData(0,0,this.size,this.size),ta=new Uint8ClampedArray(this.size*this.size),tc=0;tc<this.size*this.size;tc++){var th=ti.data[4*tc+3]/255;this.gridOuter[tc]=1===th?0:0===th?1e20:Math.pow(Math.max(0,.5-th),2),this.gridInner[tc]=1===th?1e20:0===th?0:Math.pow(Math.max(0,th-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),tc=0;tc<this.size*this.size;tc++)ta[tc]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[tc]-this.gridInner[tc])/this.radius+this.cutoff))));return ta},t_.default=tv;var y=function(tt,ti){this.requestManager=tt,this.localIdeographFontFamily=ti,this.entries={}};y.prototype.setURL=function(tt){this.url=tt},y.prototype.getGlyphs=function(ti,ta){var tc=this,th=[];for(var tf in ti)for(var td=0,tm=ti[tf];td<tm.length;td+=1)th.push({stack:tf,id:tm[td]});tt.asyncAll(th,function(tt,ti){var ta=tt.stack,th=tt.id,tf=tc.entries[ta];tf||(tf=tc.entries[ta]={glyphs:{},requests:{},ranges:{}});var td=tf.glyphs[th];if(void 0===td){if(td=tc._tinySDF(tf,ta,th))return tf.glyphs[th]=td,void ti(null,{stack:ta,id:th,glyph:td});var tm=Math.floor(th/256);if(256*tm>65535)ti(Error("glyphs > 65535 not supported"));else if(tf.ranges[tm])ti(null,{stack:ta,id:th,glyph:td});else{var ty=tf.requests[tm];ty||(ty=tf.requests[tm]=[],y.loadGlyphRange(ta,tm,tc.url,tc.requestManager,function(tt,ti){if(ti){for(var ta in ti)tc._doesCharSupportLocalGlyph(+ta)||(tf.glyphs[+ta]=ti[+ta]);tf.ranges[tm]=!0}for(var th=0,td=ty;th<td.length;th+=1)(0,td[th])(tt,ti);delete tf.requests[tm]})),ty.push(function(tt,tc){tt?ti(tt):tc&&ti(null,{stack:ta,id:th,glyph:tc[th]||null})})}}else ti(null,{stack:ta,id:th,glyph:td})},function(tt,ti){if(tt)ta(tt);else if(ti){for(var tc={},th=0;th<ti.length;th+=1){var tf=ti[th],td=tf.stack,tm=tf.id,ty=tf.glyph;(tc[td]||(tc[td]={}))[tm]=ty&&{id:ty.id,bitmap:ty.bitmap.clone(),metrics:ty.metrics}}ta(null,tc)}})},y.prototype._doesCharSupportLocalGlyph=function(ti){return!!this.localIdeographFontFamily&&(tt.isChar["CJK Unified Ideographs"](ti)||tt.isChar["Hangul Syllables"](ti)||tt.isChar.Hiragana(ti)||tt.isChar.Katakana(ti))},y.prototype._tinySDF=function(ti,ta,tc){var th=this.localIdeographFontFamily;if(th&&this._doesCharSupportLocalGlyph(tc)){var tf=ti.tinySDF;if(!tf){var td="400";/bold/i.test(ta)?td="900":/medium/i.test(ta)?td="500":/light/i.test(ta)&&(td="200"),tf=ti.tinySDF=new y.TinySDF(24,3,8,.25,th,td)}return{id:tc,bitmap:new tt.AlphaImage({width:30,height:30},tf.draw(String.fromCharCode(tc))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(ti,ta,tc,th,tf){var td=256*ta,tm=td+255,ty=th.transformRequest(th.normalizeGlyphsURL(tc).replace("{fontstack}",ti).replace("{range}",td+"-"+tm),tt.ResourceType.Glyphs);tt.getArrayBuffer(ty,function(ti,ta){if(ti)tf(ti);else if(ta){for(var tc={},th=0,td=tt.parseGlyphPBF(ta);th<td.length;th+=1){var tm=td[th];tc[tm.id]=tm}tf(null,tc)}})},y.TinySDF=t_;var x=function(){this.specification=tt.styleSpec.light.position};x.prototype.possiblyEvaluate=function(ti,ta){return tt.sphericalToCartesian(ti.expression.evaluate(ta))},x.prototype.interpolate=function(ti,ta,tc){return{x:tt.number(ti.x,ta.x,tc),y:tt.number(ti.y,ta.y,tc),z:tt.number(ti.z,ta.z,tc)}};var tx=new tt.Properties({anchor:new tt.DataConstantProperty(tt.styleSpec.light.anchor),position:new x,color:new tt.DataConstantProperty(tt.styleSpec.light.color),intensity:new tt.DataConstantProperty(tt.styleSpec.light.intensity)}),tb=function(ti){function i(ta){ti.call(this),this._transitionable=new tt.Transitionable(tx),this.setLight(ta),this._transitioning=this._transitionable.untransitioned()}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(ti,ta){if(void 0===ta&&(ta={}),!this._validate(tt.validateLight,ti,ta))for(var tc in ti){var th=ti[tc];tt.endsWith(tc,"-transition")?this._transitionable.setTransition(tc.slice(0,-11),th):this._transitionable.setValue(tc,th)}},i.prototype.updateTransitions=function(tt){this._transitioning=this._transitionable.transitioned(tt,this._transitioning)},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(tt){this.properties=this._transitioning.possiblyEvaluate(tt)},i.prototype._validate=function(ti,ta,tc){return(!tc||!1!==tc.validate)&&tt.emitValidationErrors(this,ti.call(tt.validateStyle,tt.extend({value:ta,style:{glyphs:!0,sprite:!0},styleSpec:tt.styleSpec})))},i}(tt.Evented),T=function(tt,ti){this.width=tt,this.height=ti,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};T.prototype.getDash=function(tt,ti){var ta=tt.join(",")+String(ti);return this.dashEntry[ta]||(this.dashEntry[ta]=this.addDash(tt,ti)),this.dashEntry[ta]},T.prototype.getDashRanges=function(tt,ti,ta){var tc=[],th=tt.length%2==1?-tt[tt.length-1]*ta:0,tf=tt[0]*ta,td=!0;tc.push({left:th,right:tf,isDash:td,zeroLength:0===tt[0]});for(var tm=tt[0],ty=1;ty<tt.length;ty++){var tg=tt[ty];tc.push({left:th=tm*ta,right:tf=(tm+=tg)*ta,isDash:td=!td,zeroLength:0===tg})}return tc},T.prototype.addRoundDash=function(tt,ti,ta){for(var tc=ti/2,th=-ta;th<=ta;th++)for(var tf=this.width*(this.nextRow+ta+th),td=0,tm=tt[td],ty=0;ty<this.width;ty++){ty/tm.right>1&&(tm=tt[++td]);var tg=Math.min(Math.abs(ty-tm.left),Math.abs(ty-tm.right)),t_=void 0,tv=th/ta*(tc+1);if(tm.isDash){var tx=tc-Math.abs(tv);t_=Math.sqrt(tg*tg+tx*tx)}else t_=tc-Math.sqrt(tg*tg+tv*tv);this.data[tf+ty]=Math.max(0,Math.min(255,t_+128))}},T.prototype.addRegularDash=function(tt){for(var ti=tt.length-1;ti>=0;--ti){var ta=tt[ti],tc=tt[ti+1];ta.zeroLength?tt.splice(ti,1):tc&&tc.isDash===ta.isDash&&(tc.left=ta.left,tt.splice(ti,1))}var th=tt[0],tf=tt[tt.length-1];th.isDash===tf.isDash&&(th.left=tf.left-this.width,tf.right=th.right+this.width);for(var td=this.width*this.nextRow,tm=0,ty=tt[tm],tg=0;tg<this.width;tg++){tg/ty.right>1&&(ty=tt[++tm]);var t_=Math.min(Math.abs(tg-ty.left),Math.abs(tg-ty.right));this.data[td+tg]=Math.max(0,Math.min(255,(ty.isDash?t_:-t_)+128))}},T.prototype.addDash=function(ti,ta){var tc=ta?7:0,th=2*tc+1;if(this.nextRow+th>this.height)return tt.warnOnce("LineAtlas out of space"),null;for(var tf=0,td=0;td<ti.length;td++)tf+=ti[td];if(0!==tf){var tm=this.width/tf,ty=this.getDashRanges(ti,this.width,tm);ta?this.addRoundDash(ty,tm,tc):this.addRegularDash(ty)}var tg={y:(this.nextRow+tc+.5)/this.height,height:2*tc/this.height,width:tf};return this.nextRow+=th,this.dirty=!0,tg},T.prototype.bind=function(tt){var ti=tt.gl;this.texture?(ti.bindTexture(ti.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,ti.texSubImage2D(ti.TEXTURE_2D,0,0,0,this.width,this.height,ti.ALPHA,ti.UNSIGNED_BYTE,this.data))):(this.texture=ti.createTexture(),ti.bindTexture(ti.TEXTURE_2D,this.texture),ti.texParameteri(ti.TEXTURE_2D,ti.TEXTURE_WRAP_S,ti.REPEAT),ti.texParameteri(ti.TEXTURE_2D,ti.TEXTURE_WRAP_T,ti.REPEAT),ti.texParameteri(ti.TEXTURE_2D,ti.TEXTURE_MIN_FILTER,ti.LINEAR),ti.texParameteri(ti.TEXTURE_2D,ti.TEXTURE_MAG_FILTER,ti.LINEAR),ti.texImage2D(ti.TEXTURE_2D,0,ti.ALPHA,this.width,this.height,0,ti.ALPHA,ti.UNSIGNED_BYTE,this.data))};var E=function e(ti,ta){this.workerPool=ti,this.actors=[],this.currentActor=0,this.id=tt.uniqueId();for(var tc=this.workerPool.acquire(this.id),th=0;th<tc.length;th++){var tf=new e.Actor(tc[th],ta,this.id);tf.name="Worker "+th,this.actors.push(tf)}};function I(ti,ta,tc){var r=function(th,tf){if(th)return tc(th);if(tf){var td=tt.pick(tt.extend(tf,ti),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);tf.vector_layers&&(td.vectorLayers=tf.vector_layers,td.vectorLayerIds=td.vectorLayers.map(function(tt){return tt.id})),td.tiles=ta.canonicalizeTileset(td,ti.url),tc(null,td)}};return ti.url?tt.getJSON(ta.transformRequest(ta.normalizeSourceURL(ti.url),tt.ResourceType.Source),r):tt.browser.frame(function(){return r(null,ti)})}E.prototype.broadcast=function(ti,ta,tc){tt.asyncAll(this.actors,function(tt,tc){tt.send(ti,ta,tc)},tc=tc||function(){})},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach(function(tt){tt.remove()}),this.actors=[],this.workerPool.release(this.id)},E.Actor=tt.Actor;var P=function(ti,ta,tc){this.bounds=tt.LngLatBounds.convert(this.validateBounds(ti)),this.minzoom=ta||0,this.maxzoom=tc||24};P.prototype.validateBounds=function(tt){return Array.isArray(tt)&&4===tt.length?[Math.max(-180,tt[0]),Math.max(-90,tt[1]),Math.min(180,tt[2]),Math.min(90,tt[3])]:[-180,-90,180,90]},P.prototype.contains=function(ti){var ta=Math.pow(2,ti.z),tc=Math.floor(tt.mercatorXfromLng(this.bounds.getWest())*ta),th=Math.floor(tt.mercatorYfromLat(this.bounds.getNorth())*ta),tf=Math.ceil(tt.mercatorXfromLng(this.bounds.getEast())*ta),td=Math.ceil(tt.mercatorYfromLat(this.bounds.getSouth())*ta);return ti.x>=tc&&ti.x<tf&&ti.y>=th&&ti.y<td};var tw=function(ti){function i(ta,tc,th,tf){if(ti.call(this),this.id=ta,this.dispatcher=th,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,tt.extend(this,tt.pick(tc,["url","scheme","tileSize","promoteId"])),this._options=tt.extend({type:"vector"},tc),this._collectResourceTiming=tc.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(tf)}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(){var ti=this;this._loaded=!1,this.fire(new tt.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,function(ta,tc){ti._tileJSONRequest=null,ti._loaded=!0,ta?ti.fire(new tt.ErrorEvent(ta)):tc&&(tt.extend(ti,tc),tc.bounds&&(ti.tileBounds=new P(tc.bounds,ti.minzoom,ti.maxzoom)),tt.postTurnstileEvent(tc.tiles,ti.map._requestManager._customAccessToken),tt.postMapLoadEvent(tc.tiles,ti.map._getMapId(),ti.map._requestManager._skuToken,ti.map._requestManager._customAccessToken),ti.fire(new tt.Event("data",{dataType:"source",sourceDataType:"metadata"})),ti.fire(new tt.Event("data",{dataType:"source",sourceDataType:"content"})))})},i.prototype.loaded=function(){return this._loaded},i.prototype.hasTile=function(tt){return!this.tileBounds||this.tileBounds.contains(tt.canonical)},i.prototype.onAdd=function(tt){this.map=tt,this.load()},i.prototype.setSourceProperty=function(tt){this._tileJSONRequest&&this._tileJSONRequest.cancel(),tt(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},i.prototype.setTiles=function(tt){var ti=this;return this.setSourceProperty(function(){ti._options.tiles=tt}),this},i.prototype.setUrl=function(tt){var ti=this;return this.setSourceProperty(function(){ti.url=tt,ti._options.url=tt}),this},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return tt.extend({},this._options)},i.prototype.loadTile=function(ti,ta){var tc=this.map._requestManager.normalizeTileURL(ti.tileID.canonical.url(this.tiles,this.scheme)),th={request:this.map._requestManager.transformRequest(tc,tt.ResourceType.Tile),uid:ti.uid,tileID:ti.tileID,zoom:ti.tileID.overscaledZ,tileSize:this.tileSize*ti.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:tt.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(tc,th){return delete ti.request,ti.aborted?ta(null):tc&&404!==tc.status?ta(tc):(th&&th.resourceTiming&&(ti.resourceTiming=th.resourceTiming),this.map._refreshExpiredTiles&&th&&ti.setExpiryData(th),ti.loadVectorData(th,this.map.painter),tt.cacheEntryPossiblyAdded(this.dispatcher),ta(null),void(ti.reloadCallback&&(this.loadTile(ti,ti.reloadCallback),ti.reloadCallback=null)))}th.request.collectResourceTiming=this._collectResourceTiming,ti.actor&&"expired"!==ti.state?"loading"===ti.state?ti.reloadCallback=ta:ti.request=ti.actor.send("reloadTile",th,a.bind(this)):(ti.actor=this.dispatcher.getActor(),ti.request=ti.actor.send("loadTile",th,a.bind(this)))},i.prototype.abortTile=function(tt){tt.request&&(tt.request.cancel(),delete tt.request),tt.actor&&tt.actor.send("abortTile",{uid:tt.uid,type:this.type,source:this.id},void 0)},i.prototype.unloadTile=function(tt){tt.unloadVectorData(),tt.actor&&tt.actor.send("removeTile",{uid:tt.uid,type:this.type,source:this.id},void 0)},i.prototype.hasTransition=function(){return!1},i}(tt.Evented),tS=function(ti){function i(ta,tc,th,tf){ti.call(this),this.id=ta,this.dispatcher=th,this.setEventedParent(tf),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=tt.extend({type:"raster"},tc),tt.extend(this,tt.pick(tc,["url","scheme","tileSize"]))}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(){var ti=this;this._loaded=!1,this.fire(new tt.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,function(ta,tc){ti._tileJSONRequest=null,ti._loaded=!0,ta?ti.fire(new tt.ErrorEvent(ta)):tc&&(tt.extend(ti,tc),tc.bounds&&(ti.tileBounds=new P(tc.bounds,ti.minzoom,ti.maxzoom)),tt.postTurnstileEvent(tc.tiles),tt.postMapLoadEvent(tc.tiles,ti.map._getMapId(),ti.map._requestManager._skuToken),ti.fire(new tt.Event("data",{dataType:"source",sourceDataType:"metadata"})),ti.fire(new tt.Event("data",{dataType:"source",sourceDataType:"content"})))})},i.prototype.loaded=function(){return this._loaded},i.prototype.onAdd=function(tt){this.map=tt,this.load()},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return tt.extend({},this._options)},i.prototype.hasTile=function(tt){return!this.tileBounds||this.tileBounds.contains(tt.canonical)},i.prototype.loadTile=function(ti,ta){var tc=this,th=this.map._requestManager.normalizeTileURL(ti.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);ti.request=tt.getImage(this.map._requestManager.transformRequest(th,tt.ResourceType.Tile),function(th,tf){if(delete ti.request,ti.aborted)ti.state="unloaded",ta(null);else if(th)ti.state="errored",ta(th);else if(tf){tc.map._refreshExpiredTiles&&ti.setExpiryData(tf),delete tf.cacheControl,delete tf.expires;var td=tc.map.painter.context,tm=td.gl;ti.texture=tc.map.painter.getTileTexture(tf.width),ti.texture?ti.texture.update(tf,{useMipmap:!0}):(ti.texture=new tt.Texture(td,tf,tm.RGBA,{useMipmap:!0}),ti.texture.bind(tm.LINEAR,tm.CLAMP_TO_EDGE,tm.LINEAR_MIPMAP_NEAREST),td.extTextureFilterAnisotropic&&tm.texParameterf(tm.TEXTURE_2D,td.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,td.extTextureFilterAnisotropicMax)),ti.state="loaded",tt.cacheEntryPossiblyAdded(tc.dispatcher),ta(null)}})},i.prototype.abortTile=function(tt,ti){tt.request&&(tt.request.cancel(),delete tt.request),ti()},i.prototype.unloadTile=function(tt,ti){tt.texture&&this.map.painter.saveTileTexture(tt.texture),ti()},i.prototype.hasTransition=function(){return!1},i}(tt.Evented),tT=function(ti){function i(ta,tc,th,tf){ti.call(this,ta,tc,th,tf),this.type="raster-dem",this.maxzoom=22,this._options=tt.extend({type:"raster-dem"},tc),this.encoding=tc.encoding||"mapbox"}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(ti,ta){var tc=this.map._requestManager.normalizeTileURL(ti.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function r(tt,tc){tt&&(ti.state="errored",ta(tt)),tc&&(ti.dem=tc,ti.needsHillshadePrepare=!0,ti.state="loaded",ta(null))}ti.request=tt.getImage(this.map._requestManager.transformRequest(tc,tt.ResourceType.Tile),(function(tc,th){if(delete ti.request,ti.aborted)ti.state="unloaded",ta(null);else if(tc)ti.state="errored",ta(tc);else if(th){this.map._refreshExpiredTiles&&ti.setExpiryData(th),delete th.cacheControl,delete th.expires;var tf=tt.window.ImageBitmap&&th instanceof tt.window.ImageBitmap&&tt.offscreenCanvasSupported()?th:tt.browser.getImageData(th,1),td={uid:ti.uid,coord:ti.tileID,source:this.id,rawImageData:tf,encoding:this.encoding};ti.actor&&"expired"!==ti.state||(ti.actor=this.dispatcher.getActor(),ti.actor.send("loadDEMTile",td,r.bind(this)))}}).bind(this)),ti.neighboringTiles=this._getNeighboringTiles(ti.tileID)},i.prototype._getNeighboringTiles=function(ti){var ta=ti.canonical,tc=Math.pow(2,ta.z),th=(ta.x-1+tc)%tc,tf=0===ta.x?ti.wrap-1:ti.wrap,td=(ta.x+1+tc)%tc,tm=ta.x+1===tc?ti.wrap+1:ti.wrap,ty={};return ty[new tt.OverscaledTileID(ti.overscaledZ,tf,ta.z,th,ta.y).key]={backfilled:!1},ty[new tt.OverscaledTileID(ti.overscaledZ,tm,ta.z,td,ta.y).key]={backfilled:!1},ta.y>0&&(ty[new tt.OverscaledTileID(ti.overscaledZ,tf,ta.z,th,ta.y-1).key]={backfilled:!1},ty[new tt.OverscaledTileID(ti.overscaledZ,ti.wrap,ta.z,ta.x,ta.y-1).key]={backfilled:!1},ty[new tt.OverscaledTileID(ti.overscaledZ,tm,ta.z,td,ta.y-1).key]={backfilled:!1}),ta.y+1<tc&&(ty[new tt.OverscaledTileID(ti.overscaledZ,tf,ta.z,th,ta.y+1).key]={backfilled:!1},ty[new tt.OverscaledTileID(ti.overscaledZ,ti.wrap,ta.z,ta.x,ta.y+1).key]={backfilled:!1},ty[new tt.OverscaledTileID(ti.overscaledZ,tm,ta.z,td,ta.y+1).key]={backfilled:!1}),ty},i.prototype.unloadTile=function(tt){tt.demTexture&&this.map.painter.saveTileTexture(tt.demTexture),tt.fbo&&(tt.fbo.destroy(),delete tt.fbo),tt.dem&&delete tt.dem,delete tt.neighboringTiles,tt.state="unloaded",tt.actor&&tt.actor.send("removeDEMTile",{uid:tt.uid,source:this.id})},i}(tS),tI=function(ti){function i(ta,tc,th,tf){ti.call(this),this.id=ta,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=th.getActor(),this.setEventedParent(tf),this._data=tc.data,this._options=tt.extend({},tc),this._collectResourceTiming=tc.collectResourceTiming,this._resourceTiming=[],void 0!==tc.maxzoom&&(this.maxzoom=tc.maxzoom),tc.type&&(this.type=tc.type),tc.attribution&&(this.attribution=tc.attribution),this.promoteId=tc.promoteId;var td=tt.EXTENT/this.tileSize;this.workerOptions=tt.extend({source:this.id,cluster:tc.cluster||!1,geojsonVtOptions:{buffer:(void 0!==tc.buffer?tc.buffer:128)*td,tolerance:(void 0!==tc.tolerance?tc.tolerance:.375)*td,extent:tt.EXTENT,maxZoom:this.maxzoom,lineMetrics:tc.lineMetrics||!1,generateId:tc.generateId||!1},superclusterOptions:{maxZoom:void 0!==tc.clusterMaxZoom?Math.min(tc.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,tc.clusterMinPoints||2),extent:tt.EXTENT,radius:(tc.clusterRadius||50)*td,log:!1,generateId:tc.generateId||!1},clusterProperties:tc.clusterProperties,filter:tc.filter},tc.workerOptions)}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(){var ti=this;this.fire(new tt.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(ta){if(ta)ti.fire(new tt.ErrorEvent(ta));else{var tc={dataType:"source",sourceDataType:"metadata"};ti._collectResourceTiming&&ti._resourceTiming&&ti._resourceTiming.length>0&&(tc.resourceTiming=ti._resourceTiming,ti._resourceTiming=[]),ti.fire(new tt.Event("data",tc))}})},i.prototype.onAdd=function(tt){this.map=tt,this.load()},i.prototype.setData=function(ti){var ta=this;return this._data=ti,this.fire(new tt.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(ti){if(ti)ta.fire(new tt.ErrorEvent(ti));else{var tc={dataType:"source",sourceDataType:"content"};ta._collectResourceTiming&&ta._resourceTiming&&ta._resourceTiming.length>0&&(tc.resourceTiming=ta._resourceTiming,ta._resourceTiming=[]),ta.fire(new tt.Event("data",tc))}}),this},i.prototype.getClusterExpansionZoom=function(tt,ti){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:tt,source:this.id},ti),this},i.prototype.getClusterChildren=function(tt,ti){return this.actor.send("geojson.getClusterChildren",{clusterId:tt,source:this.id},ti),this},i.prototype.getClusterLeaves=function(tt,ti,ta,tc){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:tt,limit:ti,offset:ta},tc),this},i.prototype._updateWorkerData=function(ti){var ta=this;this._loaded=!1;var tc=tt.extend({},this.workerOptions),th=this._data;"string"==typeof th?(tc.request=this.map._requestManager.transformRequest(tt.browser.resolveURL(th),tt.ResourceType.Source),tc.request.collectResourceTiming=this._collectResourceTiming):tc.data=JSON.stringify(th),this.actor.send(this.type+".loadData",tc,function(tt,th){ta._removed||th&&th.abandoned||(ta._loaded=!0,th&&th.resourceTiming&&th.resourceTiming[ta.id]&&(ta._resourceTiming=th.resourceTiming[ta.id].slice(0)),ta.actor.send(ta.type+".coalesce",{source:tc.source},null),ti(tt))})},i.prototype.loaded=function(){return this._loaded},i.prototype.loadTile=function(ti,ta){var tc=this,th=ti.actor?"reloadTile":"loadTile";ti.actor=this.actor,ti.request=this.actor.send(th,{type:this.type,uid:ti.uid,tileID:ti.tileID,zoom:ti.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:tt.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(tt,tf){return delete ti.request,ti.unloadVectorData(),ti.aborted?ta(null):tt?ta(tt):(ti.loadVectorData(tf,tc.map.painter,"reloadTile"===th),ta(null))})},i.prototype.abortTile=function(tt){tt.request&&(tt.request.cancel(),delete tt.request),tt.aborted=!0},i.prototype.unloadTile=function(tt){tt.unloadVectorData(),this.actor.send("removeTile",{uid:tt.uid,type:this.type,source:this.id})},i.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},i.prototype.serialize=function(){return tt.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i}(tt.Evented),tE=tt.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),tA=function(ti){function i(tt,ta,tc,th){ti.call(this),this.id=tt,this.dispatcher=tc,this.coordinates=ta.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(th),this.options=ta}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(ti,ta){var tc=this;this._loaded=!1,this.fire(new tt.Event("dataloading",{dataType:"source"})),this.url=this.options.url,tt.getImage(this.map._requestManager.transformRequest(this.url,tt.ResourceType.Image),function(th,tf){tc._loaded=!0,th?tc.fire(new tt.ErrorEvent(th)):tf&&(tc.image=tf,ti&&(tc.coordinates=ti),ta&&ta(),tc._finishLoading())})},i.prototype.loaded=function(){return this._loaded},i.prototype.updateImage=function(tt){var ti=this;return this.image&&tt.url&&(this.options.url=tt.url,this.load(tt.coordinates,function(){ti.texture=null})),this},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new tt.Event("data",{dataType:"source",sourceDataType:"metadata"})))},i.prototype.onAdd=function(tt){this.map=tt,this.load()},i.prototype.setCoordinates=function(ti){var ta=this;this.coordinates=ti;var tc=ti.map(tt.MercatorCoordinate.fromLngLat);this.tileID=function(ti){for(var ta=1/0,tc=1/0,th=-1/0,tf=-1/0,td=0;td<ti.length;td+=1){var tm=ti[td];ta=Math.min(ta,tm.x),tc=Math.min(tc,tm.y),th=Math.max(th,tm.x),tf=Math.max(tf,tm.y)}var ty=Math.max(0,Math.floor(-Math.log(Math.max(th-ta,tf-tc))/Math.LN2)),tg=Math.pow(2,ty);return new tt.CanonicalTileID(ty,Math.floor((ta+th)/2*tg),Math.floor((tc+tf)/2*tg))}(tc),this.minzoom=this.maxzoom=this.tileID.z;var th=tc.map(function(tt){return ta.tileID.getTilePoint(tt)._round()});return this._boundsArray=new tt.StructArrayLayout4i8,this._boundsArray.emplaceBack(th[0].x,th[0].y,0,0),this._boundsArray.emplaceBack(th[1].x,th[1].y,tt.EXTENT,0),this._boundsArray.emplaceBack(th[3].x,th[3].y,0,tt.EXTENT),this._boundsArray.emplaceBack(th[2].x,th[2].y,tt.EXTENT,tt.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new tt.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var ti=this.map.painter.context,ta=ti.gl;for(var tc in this.boundsBuffer||(this.boundsBuffer=ti.createVertexBuffer(this._boundsArray,tE.members)),this.boundsSegments||(this.boundsSegments=tt.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new tt.Texture(ti,this.image,ta.RGBA),this.texture.bind(ta.LINEAR,ta.CLAMP_TO_EDGE)),this.tiles){var th=this.tiles[tc];"loaded"!==th.state&&(th.state="loaded",th.texture=this.texture)}}},i.prototype.loadTile=function(tt,ti){this.tileID&&this.tileID.equals(tt.tileID.canonical)?(this.tiles[String(tt.tileID.wrap)]=tt,tt.buckets={}):tt.state="errored",ti(null)},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i}(tt.Evented),tP=function(ti){function i(tt,ta,tc,th){ti.call(this,tt,ta,tc,th),this.roundZoom=!0,this.type="video",this.options=ta}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(){var ti=this;this._loaded=!1;var ta=this.options;this.urls=[];for(var tc=0,th=ta.urls;tc<th.length;tc+=1)this.urls.push(this.map._requestManager.transformRequest(th[tc],tt.ResourceType.Source).url);tt.getVideo(this.urls,function(ta,tc){ti._loaded=!0,ta?ti.fire(new tt.ErrorEvent(ta)):tc&&(ti.video=tc,ti.video.loop=!0,ti.video.addEventListener("playing",function(){ti.map.triggerRepaint()}),ti.map&&ti.video.play(),ti._finishLoading())})},i.prototype.pause=function(){this.video&&this.video.pause()},i.prototype.play=function(){this.video&&this.video.play()},i.prototype.seek=function(ti){if(this.video){var ta=this.video.seekable;ti<ta.start(0)||ti>ta.end(0)?this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+ta.start(0)+" and "+ta.end(0)+"-second mark."))):this.video.currentTime=ti}},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(tt){this.map||(this.map=tt,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var ti=this.map.painter.context,ta=ti.gl;for(var tc in this.boundsBuffer||(this.boundsBuffer=ti.createVertexBuffer(this._boundsArray,tE.members)),this.boundsSegments||(this.boundsSegments=tt.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(ta.LINEAR,ta.CLAMP_TO_EDGE),ta.texSubImage2D(ta.TEXTURE_2D,0,0,0,ta.RGBA,ta.UNSIGNED_BYTE,this.video)):(this.texture=new tt.Texture(ti,this.video,ta.RGBA),this.texture.bind(ta.LINEAR,ta.CLAMP_TO_EDGE)),this.tiles){var th=this.tiles[tc];"loaded"!==th.state&&(th.state="loaded",th.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(tA),tz=function(ti){function i(ta,tc,th,tf){ti.call(this,ta,tc,th,tf),tc.coordinates?Array.isArray(tc.coordinates)&&4===tc.coordinates.length&&!tc.coordinates.some(function(tt){return!Array.isArray(tt)||2!==tt.length||tt.some(function(tt){return"number"!=typeof tt})})||this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+ta,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+ta,null,'missing required property "coordinates"'))),tc.animate&&"boolean"!=typeof tc.animate&&this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+ta,null,'optional "animate" property must be a boolean value'))),tc.canvas?"string"==typeof tc.canvas||tc.canvas instanceof tt.window.HTMLCanvasElement||this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+ta,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new tt.ErrorEvent(new tt.ValidationError("sources."+ta,null,'missing required property "canvas"'))),this.options=tc,this.animate=void 0===tc.animate||tc.animate}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof tt.window.HTMLCanvasElement?this.options.canvas:tt.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new tt.ErrorEvent(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(tt){this.map=tt,this.load(),this.canvas&&this.animate&&this.play()},i.prototype.onRemove=function(){this.pause()},i.prototype.prepare=function(){var ti=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,ti=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,ti=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var ta=this.map.painter.context,tc=ta.gl;for(var th in this.boundsBuffer||(this.boundsBuffer=ta.createVertexBuffer(this._boundsArray,tE.members)),this.boundsSegments||(this.boundsSegments=tt.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(ti||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new tt.Texture(ta,this.canvas,tc.RGBA,{premultiply:!0}),this.tiles){var tf=this.tiles[th];"loaded"!==tf.state&&(tf.state="loaded",tf.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var tt=0,ti=[this.canvas.width,this.canvas.height];tt<ti.length;tt+=1){var ta=ti[tt];if(isNaN(ta)||ta<=0)return!0}return!1},i}(tA),tC={vector:tw,raster:tS,"raster-dem":tT,geojson:tI,video:tP,image:tA,canvas:tz};function B(ti,ta){var tc=tt.identity([]);return tt.translate(tc,tc,[1,1,0]),tt.scale(tc,tc,[.5*ti.width,.5*ti.height,1]),tt.multiply(tc,tc,ti.calculatePosMatrix(ta.toUnwrapped()))}function O(tt,ti,ta,tc,th,tf){var td=function(tt,ti,ta){if(tt)for(var tc=0;tc<tt.length;tc+=1){var th=ti[tt[tc]];if(th&&th.source===ta&&"fill-extrusion"===th.type)return!0}else for(var tf in ti){var td=ti[tf];if(td.source===ta&&"fill-extrusion"===td.type)return!0}return!1}(th&&th.layers,ti,tt.id),tm=tf.maxPitchScaleFactor(),ty=tt.tilesIn(tc,tm,td);ty.sort(F);for(var tg=[],t_=0;t_<ty.length;t_+=1){var tv=ty[t_];tg.push({wrappedTileID:tv.tileID.wrapped().key,queryResults:tv.tile.queryRenderedFeatures(ti,ta,tt._state,tv.queryGeometry,tv.cameraQueryGeometry,tv.scale,th,tf,tm,B(tt.transform,tv.tileID))})}var tx=function(tt){for(var ti={},ta={},tc=0;tc<tt.length;tc+=1){var th=tt[tc],tf=th.queryResults,td=th.wrappedTileID,tm=ta[td]=ta[td]||{};for(var ty in tf)for(var tg=tf[ty],t_=tm[ty]=tm[ty]||{},tv=ti[ty]=ti[ty]||[],tx=0;tx<tg.length;tx+=1){var tb=tg[tx];t_[tb.featureIndex]||(t_[tb.featureIndex]=!0,tv.push(tb))}}return ti}(tg);for(var tb in tx)tx[tb].forEach(function(ti){var ta=ti.feature,tc=tt.getFeatureState(ta.layer["source-layer"],ta.id);ta.source=ta.layer.source,ta.layer["source-layer"]&&(ta.sourceLayer=ta.layer["source-layer"]),ta.state=tc});return tx}function F(tt,ti){var ta=tt.tileID,tc=ti.tileID;return ta.overscaledZ-tc.overscaledZ||ta.canonical.y-tc.canonical.y||ta.wrap-tc.wrap||ta.canonical.x-tc.canonical.x}var U=function(tt,ti){this.max=tt,this.onRemove=ti,this.reset()};U.prototype.reset=function(){for(var tt in this.data)for(var ti=0,ta=this.data[tt];ti<ta.length;ti+=1){var tc=ta[ti];tc.timeout&&clearTimeout(tc.timeout),this.onRemove(tc.value)}return this.data={},this.order=[],this},U.prototype.add=function(tt,ti,ta){var tc=this,th=tt.wrapped().key;void 0===this.data[th]&&(this.data[th]=[]);var tf={value:ti,timeout:void 0};if(void 0!==ta&&(tf.timeout=setTimeout(function(){tc.remove(tt,tf)},ta)),this.data[th].push(tf),this.order.push(th),this.order.length>this.max){var td=this._getAndRemoveByKey(this.order[0]);td&&this.onRemove(td)}return this},U.prototype.has=function(tt){return tt.wrapped().key in this.data},U.prototype.getAndRemove=function(tt){return this.has(tt)?this._getAndRemoveByKey(tt.wrapped().key):null},U.prototype._getAndRemoveByKey=function(tt){var ti=this.data[tt].shift();return ti.timeout&&clearTimeout(ti.timeout),0===this.data[tt].length&&delete this.data[tt],this.order.splice(this.order.indexOf(tt),1),ti.value},U.prototype.getByKey=function(tt){var ti=this.data[tt];return ti?ti[0].value:null},U.prototype.get=function(tt){return this.has(tt)?this.data[tt.wrapped().key][0].value:null},U.prototype.remove=function(tt,ti){if(!this.has(tt))return this;var ta=tt.wrapped().key,tc=void 0===ti?0:this.data[ta].indexOf(ti),th=this.data[ta][tc];return this.data[ta].splice(tc,1),th.timeout&&clearTimeout(th.timeout),0===this.data[ta].length&&delete this.data[ta],this.onRemove(th.value),this.order.splice(this.order.indexOf(ta),1),this},U.prototype.setMaxSize=function(tt){for(this.max=tt;this.order.length>this.max;){var ti=this._getAndRemoveByKey(this.order[0]);ti&&this.onRemove(ti)}return this},U.prototype.filter=function(tt){var ti=[];for(var ta in this.data)for(var tc=0,th=this.data[ta];tc<th.length;tc+=1){var tf=th[tc];tt(tf.value)||ti.push(tf)}for(var td=0;td<ti.length;td+=1){var tm=ti[td];this.remove(tm.value.tileID,tm)}};var N=function(tt,ti,ta){this.context=tt;var tc=tt.gl;this.buffer=tc.createBuffer(),this.dynamicDraw=!!ta,this.context.unbindVAO(),tt.bindElementBuffer.set(this.buffer),tc.bufferData(tc.ELEMENT_ARRAY_BUFFER,ti.arrayBuffer,this.dynamicDraw?tc.DYNAMIC_DRAW:tc.STATIC_DRAW),this.dynamicDraw||delete ti.arrayBuffer};N.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},N.prototype.updateData=function(tt){var ti=this.context.gl;this.context.unbindVAO(),this.bind(),ti.bufferSubData(ti.ELEMENT_ARRAY_BUFFER,0,tt.arrayBuffer)},N.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var tk={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},q=function(tt,ti,ta,tc){this.length=ti.length,this.attributes=ta,this.itemSize=ti.bytesPerElement,this.dynamicDraw=tc,this.context=tt;var th=tt.gl;this.buffer=th.createBuffer(),tt.bindVertexBuffer.set(this.buffer),th.bufferData(th.ARRAY_BUFFER,ti.arrayBuffer,this.dynamicDraw?th.DYNAMIC_DRAW:th.STATIC_DRAW),this.dynamicDraw||delete ti.arrayBuffer};q.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},q.prototype.updateData=function(tt){var ti=this.context.gl;this.bind(),ti.bufferSubData(ti.ARRAY_BUFFER,0,tt.arrayBuffer)},q.prototype.enableAttributes=function(tt,ti){for(var ta=0;ta<this.attributes.length;ta++){var tc=ti.attributes[this.attributes[ta].name];void 0!==tc&&tt.enableVertexAttribArray(tc)}},q.prototype.setVertexAttribPointers=function(tt,ti,ta){for(var tc=0;tc<this.attributes.length;tc++){var th=this.attributes[tc],tf=ti.attributes[th.name];void 0!==tf&&tt.vertexAttribPointer(tf,th.components,tt[tk[th.type]],!1,this.itemSize,th.offset+this.itemSize*(ta||0))}},q.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j=function(tt){this.gl=tt.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};j.prototype.get=function(){return this.current},j.prototype.set=function(tt){},j.prototype.getDefault=function(){return this.default},j.prototype.setDefault=function(){this.set(this.default)};var tM=function(ti){function i(){ti.apply(this,arguments)}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.getDefault=function(){return tt.Color.transparent},i.prototype.set=function(tt){var ti=this.current;(tt.r!==ti.r||tt.g!==ti.g||tt.b!==ti.b||tt.a!==ti.a||this.dirty)&&(this.gl.clearColor(tt.r,tt.g,tt.b,tt.a),this.current=tt,this.dirty=!1)},i}(j),tD=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.clearDepth(tt),this.current=tt,this.dirty=!1)},e}(j),tL=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.clearStencil(tt),this.current=tt,this.dirty=!1)},e}(j),tB=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(tt){var ti=this.current;(tt[0]!==ti[0]||tt[1]!==ti[1]||tt[2]!==ti[2]||tt[3]!==ti[3]||this.dirty)&&(this.gl.colorMask(tt[0],tt[1],tt[2],tt[3]),this.current=tt,this.dirty=!1)},e}(j),tR=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.depthMask(tt),this.current=tt,this.dirty=!1)},e}(j),tO=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.stencilMask(tt),this.current=tt,this.dirty=!1)},e}(j),tF=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(tt){var ti=this.current;(tt.func!==ti.func||tt.ref!==ti.ref||tt.mask!==ti.mask||this.dirty)&&(this.gl.stencilFunc(tt.func,tt.ref,tt.mask),this.current=tt,this.dirty=!1)},e}(j),tU=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){var tt=this.gl;return[tt.KEEP,tt.KEEP,tt.KEEP]},e.prototype.set=function(tt){var ti=this.current;(tt[0]!==ti[0]||tt[1]!==ti[1]||tt[2]!==ti[2]||this.dirty)&&(this.gl.stencilOp(tt[0],tt[1],tt[2]),this.current=tt,this.dirty=!1)},e}(j),tV=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;tt?ti.enable(ti.STENCIL_TEST):ti.disable(ti.STENCIL_TEST),this.current=tt,this.dirty=!1}},e}(j),tN=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(tt){var ti=this.current;(tt[0]!==ti[0]||tt[1]!==ti[1]||this.dirty)&&(this.gl.depthRange(tt[0],tt[1]),this.current=tt,this.dirty=!1)},e}(j),tj=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;tt?ti.enable(ti.DEPTH_TEST):ti.disable(ti.DEPTH_TEST),this.current=tt,this.dirty=!1}},e}(j),tq=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.depthFunc(tt),this.current=tt,this.dirty=!1)},e}(j),tZ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;tt?ti.enable(ti.BLEND):ti.disable(ti.BLEND),this.current=tt,this.dirty=!1}},e}(j),tG=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){var tt=this.gl;return[tt.ONE,tt.ZERO]},e.prototype.set=function(tt){var ti=this.current;(tt[0]!==ti[0]||tt[1]!==ti[1]||this.dirty)&&(this.gl.blendFunc(tt[0],tt[1]),this.current=tt,this.dirty=!1)},e}(j),tX=function(ti){function i(){ti.apply(this,arguments)}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.getDefault=function(){return tt.Color.transparent},i.prototype.set=function(tt){var ti=this.current;(tt.r!==ti.r||tt.g!==ti.g||tt.b!==ti.b||tt.a!==ti.a||this.dirty)&&(this.gl.blendColor(tt.r,tt.g,tt.b,tt.a),this.current=tt,this.dirty=!1)},i}(j),tW=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.blendEquation(tt),this.current=tt,this.dirty=!1)},e}(j),tK=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;tt?ti.enable(ti.CULL_FACE):ti.disable(ti.CULL_FACE),this.current=tt,this.dirty=!1}},e}(j),tJ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.cullFace(tt),this.current=tt,this.dirty=!1)},e}(j),tY=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.frontFace(tt),this.current=tt,this.dirty=!1)},e}(j),tH=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.useProgram(tt),this.current=tt,this.dirty=!1)},e}(j),t$=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(tt){(tt!==this.current||this.dirty)&&(this.gl.activeTexture(tt),this.current=tt,this.dirty=!1)},e}(j),tQ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){var tt=this.gl;return[0,0,tt.drawingBufferWidth,tt.drawingBufferHeight]},e.prototype.set=function(tt){var ti=this.current;(tt[0]!==ti[0]||tt[1]!==ti[1]||tt[2]!==ti[2]||tt[3]!==ti[3]||this.dirty)&&(this.gl.viewport(tt[0],tt[1],tt[2],tt[3]),this.current=tt,this.dirty=!1)},e}(j),t0=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.bindFramebuffer(ti.FRAMEBUFFER,tt),this.current=tt,this.dirty=!1}},e}(j),t1=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.bindRenderbuffer(ti.RENDERBUFFER,tt),this.current=tt,this.dirty=!1}},e}(j),t2=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.bindTexture(ti.TEXTURE_2D,tt),this.current=tt,this.dirty=!1}},e}(j),t5=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.bindBuffer(ti.ARRAY_BUFFER,tt),this.current=tt,this.dirty=!1}},e}(j),t4=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){var ti=this.gl;ti.bindBuffer(ti.ELEMENT_ARRAY_BUFFER,tt),this.current=tt,this.dirty=!1},e}(j),t3=function(tt){function e(ti){tt.call(this,ti),this.vao=ti.extVertexArrayObject}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(tt){this.vao&&(tt!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(tt),this.current=tt,this.dirty=!1)},e}(j),t6=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.pixelStorei(ti.UNPACK_ALIGNMENT,tt),this.current=tt,this.dirty=!1}},e}(j),t8=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.pixelStorei(ti.UNPACK_PREMULTIPLY_ALPHA_WEBGL,tt),this.current=tt,this.dirty=!1}},e}(j),t9=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){var ti=this.gl;ti.pixelStorei(ti.UNPACK_FLIP_Y_WEBGL,tt),this.current=tt,this.dirty=!1}},e}(j),t7=function(tt){function e(ti,ta){tt.call(this,ti),this.context=ti,this.parent=ta}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(j),et=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(tt){if(tt!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var ti=this.gl;ti.framebufferTexture2D(ti.FRAMEBUFFER,ti.COLOR_ATTACHMENT0,ti.TEXTURE_2D,tt,0),this.current=tt,this.dirty=!1}},e}(t7),ea=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.set=function(tt){if(tt!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var ti=this.gl;ti.framebufferRenderbuffer(ti.FRAMEBUFFER,ti.DEPTH_ATTACHMENT,ti.RENDERBUFFER,tt),this.current=tt,this.dirty=!1}},e}(t7),Et=function(tt,ti,ta,tc){this.context=tt,this.width=ti,this.height=ta;var th=this.framebuffer=tt.gl.createFramebuffer();this.colorAttachment=new et(tt,th),tc&&(this.depthAttachment=new ea(tt,th))};Et.prototype.destroy=function(){var tt=this.context.gl,ti=this.colorAttachment.get();if(ti&&tt.deleteTexture(ti),this.depthAttachment){var ta=this.depthAttachment.get();ta&&tt.deleteRenderbuffer(ta)}tt.deleteFramebuffer(this.framebuffer)};var It=function(tt,ti,ta){this.func=tt,this.mask=ti,this.range=ta};It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);var Pt=function(tt,ti,ta,tc,th,tf){this.test=tt,this.ref=ti,this.mask=ta,this.fail=tc,this.depthFail=th,this.pass=tf};Pt.disabled=new Pt({func:519,mask:0},0,0,7680,7680,7680);var St=function(tt,ti,ta){this.blendFunction=tt,this.blendColor=ti,this.mask=ta};St.disabled=new St(St.Replace=[1,0],tt.Color.transparent,[!1,!1,!1,!1]),St.unblended=new St(St.Replace,tt.Color.transparent,[!0,!0,!0,!0]),St.alphaBlended=new St([1,771],tt.Color.transparent,[!0,!0,!0,!0]);var Ct=function(tt,ti,ta){this.enable=tt,this.mode=ti,this.frontFace=ta};Ct.disabled=new Ct(!1,1029,2305),Ct.backCCW=new Ct(!0,1029,2305);var zt=function(tt){this.gl=tt,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new tM(this),this.clearDepth=new tD(this),this.clearStencil=new tL(this),this.colorMask=new tB(this),this.depthMask=new tR(this),this.stencilMask=new tO(this),this.stencilFunc=new tF(this),this.stencilOp=new tU(this),this.stencilTest=new tV(this),this.depthRange=new tN(this),this.depthTest=new tj(this),this.depthFunc=new tq(this),this.blend=new tZ(this),this.blendFunc=new tG(this),this.blendColor=new tX(this),this.blendEquation=new tW(this),this.cullFace=new tK(this),this.cullFaceSide=new tJ(this),this.frontFace=new tY(this),this.program=new tH(this),this.activeTexture=new t$(this),this.viewport=new tQ(this),this.bindFramebuffer=new t0(this),this.bindRenderbuffer=new t1(this),this.bindTexture=new t2(this),this.bindVertexBuffer=new t5(this),this.bindElementBuffer=new t4(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new t3(this),this.pixelStoreUnpack=new t6(this),this.pixelStoreUnpackPremultiplyAlpha=new t8(this),this.pixelStoreUnpackFlipY=new t9(this),this.extTextureFilterAnisotropic=tt.getExtension("EXT_texture_filter_anisotropic")||tt.getExtension("MOZ_EXT_texture_filter_anisotropic")||tt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=tt.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=tt.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(tt.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=tt.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=tt.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=tt.getParameter(tt.MAX_TEXTURE_SIZE)};zt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},zt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},zt.prototype.createIndexBuffer=function(tt,ti){return new N(this,tt,ti)},zt.prototype.createVertexBuffer=function(tt,ti,ta){return new q(this,tt,ti,ta)},zt.prototype.createRenderbuffer=function(tt,ti,ta){var tc=this.gl,th=tc.createRenderbuffer();return this.bindRenderbuffer.set(th),tc.renderbufferStorage(tc.RENDERBUFFER,tt,ti,ta),this.bindRenderbuffer.set(null),th},zt.prototype.createFramebuffer=function(tt,ti,ta){return new Et(this,tt,ti,ta)},zt.prototype.clear=function(tt){var ti=tt.color,ta=tt.depth,tc=this.gl,th=0;ti&&(th|=tc.COLOR_BUFFER_BIT,this.clearColor.set(ti),this.colorMask.set([!0,!0,!0,!0])),void 0!==ta&&(th|=tc.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(ta),this.depthMask.set(!0)),tc.clear(th)},zt.prototype.setCullFace=function(tt){!1===tt.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(tt.mode),this.frontFace.set(tt.frontFace))},zt.prototype.setDepthMode=function(tt){tt.func!==this.gl.ALWAYS||tt.mask?(this.depthTest.set(!0),this.depthFunc.set(tt.func),this.depthMask.set(tt.mask),this.depthRange.set(tt.range)):this.depthTest.set(!1)},zt.prototype.setStencilMode=function(tt){tt.test.func!==this.gl.ALWAYS||tt.mask?(this.stencilTest.set(!0),this.stencilMask.set(tt.mask),this.stencilOp.set([tt.fail,tt.depthFail,tt.pass]),this.stencilFunc.set({func:tt.test.func,ref:tt.ref,mask:tt.test.mask})):this.stencilTest.set(!1)},zt.prototype.setColorMode=function(ti){tt.deepEqual(ti.blendFunction,St.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(ti.blendFunction),this.blendColor.set(ti.blendColor)),this.colorMask.set(ti.mask)},zt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ec=function(ti){function i(ta,tc,th){var tf=this;ti.call(this),this.id=ta,this.dispatcher=th,this.on("data",function(tt){"source"===tt.dataType&&"metadata"===tt.sourceDataType&&(tf._sourceLoaded=!0),tf._sourceLoaded&&!tf._paused&&"source"===tt.dataType&&"content"===tt.sourceDataType&&(tf.reload(),tf.transform&&tf.update(tf.transform))}),this.on("error",function(){tf._sourceErrored=!0}),this._source=function(ti,ta,tc,th){var tf=new tC[ta.type](ti,ta,tc,th);if(tf.id!==ti)throw Error("Expected Source id to be "+ti+" instead of "+tf.id);return tt.bindAll(["load","abort","unload","serialize","prepare"],tf),tf}(ta,tc,th,this),this._tiles={},this._cache=new U(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new tt.SourceFeatureState}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.onAdd=function(tt){this.map=tt,this._maxTileCacheSize=tt?tt._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(tt)},i.prototype.onRemove=function(tt){this._source&&this._source.onRemove&&this._source.onRemove(tt)},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var tt in this._tiles){var ti=this._tiles[tt];if("loaded"!==ti.state&&"errored"!==ti.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){if(this._paused){var tt=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,tt&&this.reload(),this.transform&&this.update(this.transform)}},i.prototype._loadTile=function(tt,ti){return this._source.loadTile(tt,ti)},i.prototype._unloadTile=function(tt){if(this._source.unloadTile)return this._source.unloadTile(tt,function(){})},i.prototype._abortTile=function(tt){if(this._source.abortTile)return this._source.abortTile(tt,function(){})},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(tt){for(var ti in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var ta=this._tiles[ti];ta.upload(tt),ta.prepare(this.map.style.imageManager)}},i.prototype.getIds=function(){return tt.values(this._tiles).map(function(tt){return tt.tileID}).sort(At).map(function(tt){return tt.key})},i.prototype.getRenderableIds=function(ti){var ta=this,tc=[];for(var th in this._tiles)this._isIdRenderable(th,ti)&&tc.push(this._tiles[th]);return ti?tc.sort(function(ti,tc){var th=ti.tileID,tf=tc.tileID,td=new tt.Point(th.canonical.x,th.canonical.y)._rotate(ta.transform.angle),tm=new tt.Point(tf.canonical.x,tf.canonical.y)._rotate(ta.transform.angle);return th.overscaledZ-tf.overscaledZ||tm.y-td.y||tm.x-td.x}).map(function(tt){return tt.tileID.key}):tc.map(function(tt){return tt.tileID}).sort(At).map(function(tt){return tt.key})},i.prototype.hasRenderableParent=function(tt){var ti=this.findLoadedParent(tt,0);return!!ti&&this._isIdRenderable(ti.tileID.key)},i.prototype._isIdRenderable=function(tt,ti){return this._tiles[tt]&&this._tiles[tt].hasData()&&!this._coveredTiles[tt]&&(ti||!this._tiles[tt].holdingForFade())},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var tt in this._cache.reset(),this._tiles)"errored"!==this._tiles[tt].state&&this._reloadTile(tt,"reloading")},i.prototype._reloadTile=function(tt,ti){var ta=this._tiles[tt];ta&&("loading"!==ta.state&&(ta.state=ti),this._loadTile(ta,this._tileLoaded.bind(this,ta,tt,ti)))},i.prototype._tileLoaded=function(ti,ta,tc,th){if(th)return ti.state="errored",void(404!==th.status?this._source.fire(new tt.ErrorEvent(th,{tile:ti})):this.update(this.transform));ti.timeAdded=tt.browser.now(),"expired"===tc&&(ti.refreshedUponExpiration=!0),this._setTileReloadTimer(ta,ti),"raster-dem"===this.getSource().type&&ti.dem&&this._backfillDEM(ti),this._state.initializeTileState(ti,this.map?this.map.painter:null),this._source.fire(new tt.Event("data",{dataType:"source",tile:ti,coord:ti.tileID}))},i.prototype._backfillDEM=function(tt){for(var ti=this.getRenderableIds(),ta=0;ta<ti.length;ta++){var tc=ti[ta];if(tt.neighboringTiles&&tt.neighboringTiles[tc]){var th=this.getTileByID(tc);a(tt,th),a(th,tt)}}function a(tt,ti){tt.needsHillshadePrepare=!0;var ta=ti.tileID.canonical.x-tt.tileID.canonical.x,tc=ti.tileID.canonical.y-tt.tileID.canonical.y,th=Math.pow(2,tt.tileID.canonical.z),tf=ti.tileID.key;0===ta&&0===tc||Math.abs(tc)>1||(Math.abs(ta)>1&&(1===Math.abs(ta+th)?ta+=th:1===Math.abs(ta-th)&&(ta-=th)),ti.dem&&tt.dem&&(tt.dem.backfillBorder(ti.dem,ta,tc),tt.neighboringTiles&&tt.neighboringTiles[tf]&&(tt.neighboringTiles[tf].backfilled=!0)))}},i.prototype.getTile=function(tt){return this.getTileByID(tt.key)},i.prototype.getTileByID=function(tt){return this._tiles[tt]},i.prototype._retainLoadedChildren=function(tt,ti,ta,tc){for(var th in this._tiles){var tf=this._tiles[th];if(!(tc[th]||!tf.hasData()||tf.tileID.overscaledZ<=ti||tf.tileID.overscaledZ>ta)){for(var td=tf.tileID;tf&&tf.tileID.overscaledZ>ti+1;){var tm=tf.tileID.scaledTo(tf.tileID.overscaledZ-1);(tf=this._tiles[tm.key])&&tf.hasData()&&(td=tm)}for(var ty=td;ty.overscaledZ>ti;)if(tt[(ty=ty.scaledTo(ty.overscaledZ-1)).key]){tc[td.key]=td;break}}}},i.prototype.findLoadedParent=function(tt,ti){if(tt.key in this._loadedParentTiles){var ta=this._loadedParentTiles[tt.key];return ta&&ta.tileID.overscaledZ>=ti?ta:null}for(var tc=tt.overscaledZ-1;tc>=ti;tc--){var th=tt.scaledTo(tc),tf=this._getLoadedTile(th);if(tf)return tf}},i.prototype._getLoadedTile=function(tt){var ti=this._tiles[tt.key];return ti&&ti.hasData()?ti:this._cache.getByKey(tt.wrapped().key)},i.prototype.updateCacheSize=function(tt){var ti=Math.floor((Math.ceil(tt.width/this._source.tileSize)+1)*(Math.ceil(tt.height/this._source.tileSize)+1)*5),ta="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,ti):ti;this._cache.setMaxSize(ta)},i.prototype.handleWrapJump=function(tt){var ti=Math.round((tt-(void 0===this._prevLng?tt:this._prevLng))/360);if(this._prevLng=tt,ti){var ta={};for(var tc in this._tiles){var th=this._tiles[tc];th.tileID=th.tileID.unwrapTo(th.tileID.wrap+ti),ta[th.tileID.key]=th}for(var tf in this._tiles=ta,this._timers)clearTimeout(this._timers[tf]),delete this._timers[tf];for(var td in this._tiles)this._setTileReloadTimer(td,this._tiles[td])}},i.prototype.update=function(ti){var ta=this;if(this.transform=ti,this._sourceLoaded&&!this._paused){this.updateCacheSize(ti),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?tc=ti.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ti){return new tt.OverscaledTileID(ti.canonical.z,ti.wrap,ti.canonical.z,ti.canonical.x,ti.canonical.y)}):(tc=ti.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(tc=tc.filter(function(tt){return ta._source.hasTile(tt)}))):tc=[];var tc,th=ti.coveringZoomLevel(this._source),tf=Math.max(th-i.maxOverzooming,this._source.minzoom),td=Math.max(th+i.maxUnderzooming,this._source.minzoom),tm=this._updateRetainedTiles(tc,th);if(Mt(this._source.type)){for(var ty={},tg={},t_=0,tv=Object.keys(tm);t_<tv.length;t_+=1){var tx=tv[t_],tb=tm[tx],tw=this._tiles[tx];if(tw&&!(tw.fadeEndTime&&tw.fadeEndTime<=tt.browser.now())){var tS=this.findLoadedParent(tb,tf);tS&&(this._addTile(tS.tileID),ty[tS.tileID.key]=tS.tileID),tg[tx]=tb}}for(var tT in this._retainLoadedChildren(tg,th,td,tm),ty)tm[tT]||(this._coveredTiles[tT]=!0,tm[tT]=ty[tT])}for(var tI in tm)this._tiles[tI].clearFadeHold();for(var tE=0,tA=tt.keysDifference(this._tiles,tm);tE<tA.length;tE+=1){var tP=tA[tE],tz=this._tiles[tP];tz.hasSymbolBuckets&&!tz.holdingForFade()?tz.setHoldDuration(this.map._fadeDuration):tz.hasSymbolBuckets&&!tz.symbolFadeFinished()||this._removeTile(tP)}this._updateLoadedParentTileCache()}},i.prototype.releaseSymbolFadeTiles=function(){for(var tt in this._tiles)this._tiles[tt].holdingForFade()&&this._removeTile(tt)},i.prototype._updateRetainedTiles=function(tt,ti){for(var ta={},tc={},th=Math.max(ti-i.maxOverzooming,this._source.minzoom),tf=Math.max(ti+i.maxUnderzooming,this._source.minzoom),td={},tm=0;tm<tt.length;tm+=1){var ty=tt[tm],tg=this._addTile(ty);ta[ty.key]=ty,tg.hasData()||ti<this._source.maxzoom&&(td[ty.key]=ty)}this._retainLoadedChildren(td,ti,tf,ta);for(var t_=0;t_<tt.length;t_+=1){var tv=tt[t_],tx=this._tiles[tv.key];if(!tx.hasData()){if(ti+1>this._source.maxzoom){var tb=tv.children(this._source.maxzoom)[0],tw=this.getTile(tb);if(tw&&tw.hasData()){ta[tb.key]=tb;continue}}else{var tS=tv.children(this._source.maxzoom);if(ta[tS[0].key]&&ta[tS[1].key]&&ta[tS[2].key]&&ta[tS[3].key])continue}for(var tT=tx.wasRequested(),tI=tv.overscaledZ-1;tI>=th;--tI){var tE=tv.scaledTo(tI);if(tc[tE.key]||(tc[tE.key]=!0,(tx=this.getTile(tE))||!tT||(tx=this._addTile(tE)),tx&&(ta[tE.key]=tE,tT=tx.wasRequested(),tx.hasData())))break}}}return ta},i.prototype._updateLoadedParentTileCache=function(){for(var tt in this._loadedParentTiles={},this._tiles){for(var ti=[],ta=void 0,tc=this._tiles[tt].tileID;tc.overscaledZ>0;){if(tc.key in this._loadedParentTiles){ta=this._loadedParentTiles[tc.key];break}ti.push(tc.key);var th=tc.scaledTo(tc.overscaledZ-1);if(ta=this._getLoadedTile(th))break;tc=th}for(var tf=0;tf<ti.length;tf+=1)this._loadedParentTiles[ti[tf]]=ta}},i.prototype._addTile=function(ti){var ta=this._tiles[ti.key];if(ta)return ta;(ta=this._cache.getAndRemove(ti))&&(this._setTileReloadTimer(ti.key,ta),ta.tileID=ti,this._state.initializeTileState(ta,this.map?this.map.painter:null),this._cacheTimers[ti.key]&&(clearTimeout(this._cacheTimers[ti.key]),delete this._cacheTimers[ti.key],this._setTileReloadTimer(ti.key,ta)));var tc=!!ta;return tc||(ta=new tt.Tile(ti,this._source.tileSize*ti.overscaleFactor()),this._loadTile(ta,this._tileLoaded.bind(this,ta,ti.key,ta.state))),ta?(ta.uses++,this._tiles[ti.key]=ta,tc||this._source.fire(new tt.Event("dataloading",{tile:ta,coord:ta.tileID,dataType:"source"})),ta):null},i.prototype._setTileReloadTimer=function(tt,ti){var ta=this;tt in this._timers&&(clearTimeout(this._timers[tt]),delete this._timers[tt]);var tc=ti.getExpiryTimeout();tc&&(this._timers[tt]=setTimeout(function(){ta._reloadTile(tt,"expired"),delete ta._timers[tt]},tc))},i.prototype._removeTile=function(tt){var ti=this._tiles[tt];ti&&(ti.uses--,delete this._tiles[tt],this._timers[tt]&&(clearTimeout(this._timers[tt]),delete this._timers[tt]),ti.uses>0||(ti.hasData()&&"reloading"!==ti.state?this._cache.add(ti.tileID,ti,ti.getExpiryTimeout()):(ti.aborted=!0,this._abortTile(ti),this._unloadTile(ti))))},i.prototype.clearTiles=function(){for(var tt in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(tt);this._cache.reset()},i.prototype.tilesIn=function(ti,ta,tc){var th=this,tf=[],td=this.transform;if(!td)return tf;for(var tm=tc?td.getCameraQueryGeometry(ti):ti,ty=ti.map(function(tt){return td.pointCoordinate(tt)}),tg=tm.map(function(tt){return td.pointCoordinate(tt)}),t_=this.getIds(),tv=1/0,tx=1/0,tb=-1/0,tw=-1/0,tS=0;tS<tg.length;tS+=1){var tT=tg[tS];tv=Math.min(tv,tT.x),tx=Math.min(tx,tT.y),tb=Math.max(tb,tT.x),tw=Math.max(tw,tT.y)}for(var tI=0;tI<t_.length;tI++)(function(ti){var tc=th._tiles[t_[ti]];if(!tc.holdingForFade()){var tm=tc.tileID,tS=Math.pow(2,td.zoom-tc.tileID.overscaledZ),tT=ta*tc.queryPadding*tt.EXTENT/tc.tileSize/tS,tI=[tm.getTilePoint(new tt.MercatorCoordinate(tv,tx)),tm.getTilePoint(new tt.MercatorCoordinate(tb,tw))];if(tI[0].x-tT<tt.EXTENT&&tI[0].y-tT<tt.EXTENT&&tI[1].x+tT>=0&&tI[1].y+tT>=0){var tE=ty.map(function(tt){return tm.getTilePoint(tt)}),tA=tg.map(function(tt){return tm.getTilePoint(tt)});tf.push({tile:tc,tileID:tm,queryGeometry:tE,cameraQueryGeometry:tA,scale:tS})}}})(tI);return tf},i.prototype.getVisibleCoordinates=function(tt){for(var ti=this,ta=this.getRenderableIds(tt).map(function(tt){return ti._tiles[tt].tileID}),tc=0;tc<ta.length;tc+=1){var th=ta[tc];th.posMatrix=this.transform.calculatePosMatrix(th.toUnwrapped())}return ta},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(var ti in this._tiles){var ta=this._tiles[ti];if(void 0!==ta.fadeEndTime&&ta.fadeEndTime>=tt.browser.now())return!0}return!1},i.prototype.setFeatureState=function(tt,ti,ta){this._state.updateState(tt=tt||"_geojsonTileLayer",ti,ta)},i.prototype.removeFeatureState=function(tt,ti,ta){this._state.removeFeatureState(tt=tt||"_geojsonTileLayer",ti,ta)},i.prototype.getFeatureState=function(tt,ti){return this._state.getState(tt=tt||"_geojsonTileLayer",ti)},i.prototype.setDependencies=function(tt,ti,ta){var tc=this._tiles[tt];tc&&tc.setDependencies(ti,ta)},i.prototype.reloadTilesForDependencies=function(tt,ti){for(var ta in this._tiles)this._tiles[ta].hasDependency(tt,ti)&&this._reloadTile(ta,"reloading");this._cache.filter(function(ta){return!ta.hasDependency(tt,ti)})},i}(tt.Evented);function At(tt,ti){var ta=Math.abs(2*tt.wrap)-+(tt.wrap<0),tc=Math.abs(2*ti.wrap)-+(ti.wrap<0);return tt.overscaledZ-ti.overscaledZ||tc-ta||ti.canonical.y-tt.canonical.y||ti.canonical.x-tt.canonical.x}function Mt(tt){return"raster"===tt||"image"===tt||"video"===tt}function Lt(){return new tt.window.Worker(im.workerUrl)}ec.maxOverzooming=10,ec.maxUnderzooming=3;var eh="mapboxgl_preloaded_worker_pool",kt=function(){this.active={}};kt.prototype.acquire=function(tt){if(!this.workers)for(this.workers=[];this.workers.length<kt.workerCount;)this.workers.push(new Lt);return this.active[tt]=!0,this.workers.slice()},kt.prototype.release=function(tt){delete this.active[tt],0===this.numActive()&&(this.workers.forEach(function(tt){tt.terminate()}),this.workers=null)},kt.prototype.isPreloaded=function(){return!!this.active[eh]},kt.prototype.numActive=function(){return Object.keys(this.active).length};var ef,ed=Math.floor(tt.browser.hardwareConcurrency/2);function Ft(){return ef||(ef=new kt),ef}function Ut(ti,ta){var tc={};for(var th in ti)"ref"!==th&&(tc[th]=ti[th]);return tt.refProperties.forEach(function(tt){tt in ta&&(tc[tt]=ta[tt])}),tc}function Nt(tt){tt=tt.slice();for(var ti=Object.create(null),ta=0;ta<tt.length;ta++)ti[tt[ta].id]=tt[ta];for(var tc=0;tc<tt.length;tc++)"ref"in tt[tc]&&(tt[tc]=Ut(tt[tc],ti[tt[tc].ref]));return tt}kt.workerCount=Math.max(Math.min(ed,6),1);var em={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function qt(tt,ti,ta){ta.push({command:em.addSource,args:[tt,ti[tt]]})}function jt(tt,ti,ta){ti.push({command:em.removeSource,args:[tt]}),ta[tt]=!0}function Vt(tt,ti,ta,tc){jt(tt,ta,tc),qt(tt,ti,ta)}function Gt(ti,ta,tc){var th;for(th in ti[tc])if(ti[tc].hasOwnProperty(th)&&"data"!==th&&!tt.deepEqual(ti[tc][th],ta[tc][th]))return!1;for(th in ta[tc])if(ta[tc].hasOwnProperty(th)&&"data"!==th&&!tt.deepEqual(ti[tc][th],ta[tc][th]))return!1;return!0}function Wt(ti,ta,tc,th,tf,td){var tm;for(tm in ta=ta||{},ti=ti||{})ti.hasOwnProperty(tm)&&(tt.deepEqual(ti[tm],ta[tm])||tc.push({command:td,args:[th,tm,ta[tm],tf]}));for(tm in ta)ta.hasOwnProperty(tm)&&!ti.hasOwnProperty(tm)&&(tt.deepEqual(ti[tm],ta[tm])||tc.push({command:td,args:[th,tm,ta[tm],tf]}))}function Xt(tt){return tt.id}function Ht(tt,ti){return tt[ti.id]=ti,tt}var Kt=function(tt,ti){this.reset(tt,ti)};Kt.prototype.reset=function(tt,ti){this.points=tt||[],this._distances=[0];for(var ta=1;ta<this.points.length;ta++)this._distances[ta]=this._distances[ta-1]+this.points[ta].dist(this.points[ta-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(ti||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Kt.prototype.lerp=function(ti){if(1===this.points.length)return this.points[0];ti=tt.clamp(ti,0,1);for(var ta=1,tc=this._distances[ta],th=ti*this.paddedLength+this.padding;tc<th&&ta<this._distances.length;)tc=this._distances[++ta];var tf=ta-1,td=this._distances[tf],tm=tc-td,ty=tm>0?(th-td)/tm:0;return this.points[tf].mult(1-ty).add(this.points[ta].mult(ty))};var Yt=function(tt,ti,ta){var tc=this.boxCells=[],th=this.circleCells=[];this.xCellCount=Math.ceil(tt/ta),this.yCellCount=Math.ceil(ti/ta);for(var tf=0;tf<this.xCellCount*this.yCellCount;tf++)tc.push([]),th.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=tt,this.height=ti,this.xScale=this.xCellCount/tt,this.yScale=this.yCellCount/ti,this.boxUid=0,this.circleUid=0};function Jt(ti,ta,tc,th,tf){var td=tt.create();return ta?(tt.scale(td,td,[1/tf,1/tf,1]),tc||tt.rotateZ(td,td,th.angle)):tt.multiply(td,th.labelPlaneMatrix,ti),td}function Qt(ti,ta,tc,th,tf){if(ta){var td=tt.clone(ti);return tt.scale(td,td,[tf,tf,1]),tc||tt.rotateZ(td,td,-th.angle),td}return th.glCoordMatrix}function $t(ti,ta){var tc=[ti.x,ti.y,0,1];ue(tc,tc,ta);var th=tc[3];return{point:new tt.Point(tc[0]/th,tc[1]/th),signedDistanceFromCamera:th}}function te(tt,ti){return .5+tt/ti*.5}function ee(tt,ti){var ta=tt[0]/tt[3],tc=tt[1]/tt[3];return ta>=-ti[0]&&ta<=ti[0]&&tc>=-ti[1]&&tc<=ti[1]}function ie(ti,ta,tc,th,tf,td,tm,ty){var tg=th?ti.textSizeData:ti.iconSizeData,t_=tt.evaluateSizeForZoom(tg,tc.transform.zoom),tv=[256/tc.width*2+1,256/tc.height*2+1],tx=th?ti.text.dynamicLayoutVertexArray:ti.icon.dynamicLayoutVertexArray;tx.clear();for(var tb=ti.lineVertexArray,tw=th?ti.text.placedSymbolArray:ti.icon.placedSymbolArray,tS=tc.transform.width/tc.transform.height,tT=!1,tI=0;tI<tw.length;tI++){var tE=tw.get(tI);if(tE.hidden||tE.writingMode===tt.WritingMode.vertical&&!tT)ce(tE.numGlyphs,tx);else{tT=!1;var tA=[tE.anchorX,tE.anchorY,0,1];if(tt.transformMat4(tA,tA,ta),ee(tA,tv)){var tP=te(tc.transform.cameraToCenterDistance,tA[3]),tz=tt.evaluateSizeForFeature(tg,t_,tE),tC=tm?tz/tP:tz*tP,tk=new tt.Point(tE.anchorX,tE.anchorY),tM=$t(tk,tf).point,tD={},tL=ae(tE,tC,!1,ty,ta,tf,td,ti.glyphOffsetArray,tb,tx,tM,tk,tD,tS);tT=tL.useVertical,(tL.notEnoughRoom||tT||tL.needsFlipping&&ae(tE,tC,!0,ty,ta,tf,td,ti.glyphOffsetArray,tb,tx,tM,tk,tD,tS).notEnoughRoom)&&ce(tE.numGlyphs,tx)}else ce(tE.numGlyphs,tx)}}th?ti.text.dynamicLayoutVertexBuffer.updateData(tx):ti.icon.dynamicLayoutVertexBuffer.updateData(tx)}function oe(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_){var tv=tm.glyphStartIndex+tm.numGlyphs,tx=tm.lineStartIndex,tb=tm.lineStartIndex+tm.lineLength,tw=ti.getoffsetX(tm.glyphStartIndex),tS=ti.getoffsetX(tv-1),tT=se(tt*tw,ta,tc,th,tf,td,tm.segment,tx,tb,ty,tg,t_);if(!tT)return null;var tI=se(tt*tS,ta,tc,th,tf,td,tm.segment,tx,tb,ty,tg,t_);return tI?{first:tT,last:tI}:null}function re(ti,ta,tc,th){return ti===tt.WritingMode.horizontal&&Math.abs(tc.y-ta.y)>Math.abs(tc.x-ta.x)*th?{useVertical:!0}:(ti===tt.WritingMode.vertical?ta.y<tc.y:ta.x>tc.x)?{needsFlipping:!0}:null}function ae(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw){var tS,tT=ta/24,tI=ti.lineOffsetX*tT,tE=ti.lineOffsetY*tT;if(ti.numGlyphs>1){var tA=ti.glyphStartIndex+ti.numGlyphs,tP=ti.lineStartIndex,tz=ti.lineStartIndex+ti.lineLength,tC=oe(tT,ty,tI,tE,tc,tv,tx,ti,tg,td,tb);if(!tC)return{notEnoughRoom:!0};var tk=$t(tC.first.point,tm).point,tM=$t(tC.last.point,tm).point;if(th&&!tc){var tD=re(ti.writingMode,tk,tM,tw);if(tD)return tD}tS=[tC.first];for(var tL=ti.glyphStartIndex+1;tL<tA-1;tL++)tS.push(se(tT*ty.getoffsetX(tL),tI,tE,tc,tv,tx,ti.segment,tP,tz,tg,td,tb));tS.push(tC.last)}else{if(th&&!tc){var tB=$t(tx,tf).point,tR=ti.lineStartIndex+ti.segment+1,tO=new tt.Point(tg.getx(tR),tg.gety(tR)),tF=$t(tO,tf),tU=tF.signedDistanceFromCamera>0?tF.point:ne(tx,tO,tB,1,tf),tV=re(ti.writingMode,tB,tU,tw);if(tV)return tV}var tN=se(tT*ty.getoffsetX(ti.glyphStartIndex),tI,tE,tc,tv,tx,ti.segment,ti.lineStartIndex,ti.lineStartIndex+ti.lineLength,tg,td,tb);if(!tN)return{notEnoughRoom:!0};tS=[tN]}for(var tj=0,tq=tS;tj<tq.length;tj+=1){var tZ=tq[tj];tt.addDynamicAttributes(t_,tZ.point,tZ.angle)}return{}}function ne(tt,ti,ta,tc,th){var tf=$t(tt.add(tt.sub(ti)._unit()),th).point,td=ta.sub(tf);return ta.add(td._mult(tc/td.mag()))}function se(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx){var tb=th?ti-ta:ti+ta,tw=tb>0?1:-1,tS=0;th&&(tw*=-1,tS=Math.PI),tw<0&&(tS+=Math.PI);for(var tT=tw>0?ty+tm:ty+tm+1,tI=tf,tE=tf,tA=0,tP=0,tz=Math.abs(tb),tC=[];tA+tP<=tz;){if((tT+=tw)<ty||tT>=tg)return null;if(tE=tI,tC.push(tI),void 0===(tI=tx[tT])){var tk=new tt.Point(t_.getx(tT),t_.gety(tT)),tM=$t(tk,tv);if(tM.signedDistanceFromCamera>0)tI=tx[tT]=tM.point;else{var tD=tT-tw;tI=ne(0===tA?td:new tt.Point(t_.getx(tD),t_.gety(tD)),tk,tE,tz-tA+1,tv)}}tA+=tP,tP=tE.dist(tI)}var tL=(tz-tA)/tP,tB=tI.sub(tE),tR=tB.mult(tL)._add(tE);tR._add(tB._unit()._perp()._mult(tc*tw));var tO=tS+Math.atan2(tI.y-tE.y,tI.x-tE.x);return tC.push(tR),{point:tR,angle:tO,path:tC}}Yt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yt.prototype.insert=function(tt,ti,ta,tc,th){this._forEachCell(ti,ta,tc,th,this._insertBoxCell,this.boxUid++),this.boxKeys.push(tt),this.bboxes.push(ti),this.bboxes.push(ta),this.bboxes.push(tc),this.bboxes.push(th)},Yt.prototype.insertCircle=function(tt,ti,ta,tc){this._forEachCell(ti-tc,ta-tc,ti+tc,ta+tc,this._insertCircleCell,this.circleUid++),this.circleKeys.push(tt),this.circles.push(ti),this.circles.push(ta),this.circles.push(tc)},Yt.prototype._insertBoxCell=function(tt,ti,ta,tc,th,tf){this.boxCells[th].push(tf)},Yt.prototype._insertCircleCell=function(tt,ti,ta,tc,th,tf){this.circleCells[th].push(tf)},Yt.prototype._query=function(tt,ti,ta,tc,th,tf){if(ta<0||tt>this.width||tc<0||ti>this.height)return!th&&[];var td=[];if(tt<=0&&ti<=0&&this.width<=ta&&this.height<=tc){if(th)return!0;for(var tm=0;tm<this.boxKeys.length;tm++)td.push({key:this.boxKeys[tm],x1:this.bboxes[4*tm],y1:this.bboxes[4*tm+1],x2:this.bboxes[4*tm+2],y2:this.bboxes[4*tm+3]});for(var ty=0;ty<this.circleKeys.length;ty++){var tg=this.circles[3*ty],t_=this.circles[3*ty+1],tv=this.circles[3*ty+2];td.push({key:this.circleKeys[ty],x1:tg-tv,y1:t_-tv,x2:tg+tv,y2:t_+tv})}return tf?td.filter(tf):td}return this._forEachCell(tt,ti,ta,tc,this._queryCell,td,{hitTest:th,seenUids:{box:{},circle:{}}},tf),th?td.length>0:td},Yt.prototype._queryCircle=function(tt,ti,ta,tc,th){var tf=tt-ta,td=tt+ta,tm=ti-ta,ty=ti+ta;if(td<0||tf>this.width||ty<0||tm>this.height)return!tc&&[];var tg=[];return this._forEachCell(tf,tm,td,ty,this._queryCellCircle,tg,{hitTest:tc,circle:{x:tt,y:ti,radius:ta},seenUids:{box:{},circle:{}}},th),tc?tg.length>0:tg},Yt.prototype.query=function(tt,ti,ta,tc,th){return this._query(tt,ti,ta,tc,!1,th)},Yt.prototype.hitTest=function(tt,ti,ta,tc,th){return this._query(tt,ti,ta,tc,!0,th)},Yt.prototype.hitTestCircle=function(tt,ti,ta,tc){return this._queryCircle(tt,ti,ta,!0,tc)},Yt.prototype._queryCell=function(tt,ti,ta,tc,th,tf,td,tm){var ty=td.seenUids,tg=this.boxCells[th];if(null!==tg)for(var t_=this.bboxes,tv=0;tv<tg.length;tv+=1){var tx=tg[tv];if(!ty.box[tx]){ty.box[tx]=!0;var tb=4*tx;if(tt<=t_[tb+2]&&ti<=t_[tb+3]&&ta>=t_[tb+0]&&tc>=t_[tb+1]&&(!tm||tm(this.boxKeys[tx]))){if(td.hitTest)return tf.push(!0),!0;tf.push({key:this.boxKeys[tx],x1:t_[tb],y1:t_[tb+1],x2:t_[tb+2],y2:t_[tb+3]})}}}var tw=this.circleCells[th];if(null!==tw)for(var tS=this.circles,tT=0;tT<tw.length;tT+=1){var tI=tw[tT];if(!ty.circle[tI]){ty.circle[tI]=!0;var tE=3*tI;if(this._circleAndRectCollide(tS[tE],tS[tE+1],tS[tE+2],tt,ti,ta,tc)&&(!tm||tm(this.circleKeys[tI]))){if(td.hitTest)return tf.push(!0),!0;var tA=tS[tE],tP=tS[tE+1],tz=tS[tE+2];tf.push({key:this.circleKeys[tI],x1:tA-tz,y1:tP-tz,x2:tA+tz,y2:tP+tz})}}}},Yt.prototype._queryCellCircle=function(tt,ti,ta,tc,th,tf,td,tm){var ty=td.circle,tg=td.seenUids,t_=this.boxCells[th];if(null!==t_)for(var tv=this.bboxes,tx=0;tx<t_.length;tx+=1){var tb=t_[tx];if(!tg.box[tb]){tg.box[tb]=!0;var tw=4*tb;if(this._circleAndRectCollide(ty.x,ty.y,ty.radius,tv[tw+0],tv[tw+1],tv[tw+2],tv[tw+3])&&(!tm||tm(this.boxKeys[tb])))return tf.push(!0),!0}}var tS=this.circleCells[th];if(null!==tS)for(var tT=this.circles,tI=0;tI<tS.length;tI+=1){var tE=tS[tI];if(!tg.circle[tE]){tg.circle[tE]=!0;var tA=3*tE;if(this._circlesCollide(tT[tA],tT[tA+1],tT[tA+2],ty.x,ty.y,ty.radius)&&(!tm||tm(this.circleKeys[tE])))return tf.push(!0),!0}}},Yt.prototype._forEachCell=function(tt,ti,ta,tc,th,tf,td,tm){for(var ty=this._convertToXCellCoord(tt),tg=this._convertToYCellCoord(ti),t_=this._convertToXCellCoord(ta),tv=this._convertToYCellCoord(tc),tx=ty;tx<=t_;tx++)for(var tb=tg;tb<=tv;tb++)if(th.call(this,tt,ti,ta,tc,this.xCellCount*tb+tx,tf,td,tm))return},Yt.prototype._convertToXCellCoord=function(tt){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(tt*this.xScale)))},Yt.prototype._convertToYCellCoord=function(tt){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(tt*this.yScale)))},Yt.prototype._circlesCollide=function(tt,ti,ta,tc,th,tf){var td=tc-tt,tm=th-ti,ty=ta+tf;return ty*ty>td*td+tm*tm},Yt.prototype._circleAndRectCollide=function(tt,ti,ta,tc,th,tf,td){var tm=(tf-tc)/2,ty=Math.abs(tt-(tc+tm));if(ty>tm+ta)return!1;var tg=(td-th)/2,t_=Math.abs(ti-(th+tg));if(t_>tg+ta)return!1;if(ty<=tm||t_<=tg)return!0;var tv=ty-tm,tx=t_-tg;return tv*tv+tx*tx<=ta*ta};var ey=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(tt,ti){for(var ta=0;ta<tt;ta++){var tc=ti.length;ti.resize(tc+4),ti.float32.set(ey,3*tc)}}function ue(tt,ti,ta){var tc=ti[0],th=ti[1];return tt[0]=ta[0]*tc+ta[4]*th+ta[12],tt[1]=ta[1]*tc+ta[5]*th+ta[13],tt[3]=ta[3]*tc+ta[7]*th+ta[15],tt}var he=function(tt,ti,ta){void 0===ti&&(ti=new Yt(tt.width+200,tt.height+200,25)),void 0===ta&&(ta=new Yt(tt.width+200,tt.height+200,25)),this.transform=tt,this.grid=ti,this.ignoredGrid=ta,this.pitchfactor=Math.cos(tt._pitch)*tt.cameraToCenterDistance,this.screenRightBoundary=tt.width+100,this.screenBottomBoundary=tt.height+100,this.gridRightBoundary=tt.width+200,this.gridBottomBoundary=tt.height+200};function pe(ti,ta,tc){return ta*(tt.EXTENT/(ti.tileSize*Math.pow(2,tc-ti.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(tt,ti,ta,tc,th){var tf=this.projectAndGetPerspectiveRatio(tc,tt.anchorPointX,tt.anchorPointY),td=ta*tf.perspectiveRatio,tm=tt.x1*td+tf.point.x,ty=tt.y1*td+tf.point.y,tg=tt.x2*td+tf.point.x,t_=tt.y2*td+tf.point.y;return!this.isInsideGrid(tm,ty,tg,t_)||!ti&&this.grid.hitTest(tm,ty,tg,t_,th)?{box:[],offscreen:!1}:{box:[tm,ty,tg,t_],offscreen:this.isOffscreen(tm,ty,tg,t_)}},he.prototype.placeCollisionCircles=function(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb){var tw=[],tS=new tt.Point(ta.anchorX,ta.anchorY),tT=$t(tS,td),tI=te(this.transform.cameraToCenterDistance,tT.signedDistanceFromCamera),tE=(t_?tf/tI:tf*tI)/tt.ONE_EM,tA=$t(tS,tm).point,tP=oe(tE,th,ta.lineOffsetX*tE,ta.lineOffsetY*tE,!1,tA,tS,ta,tc,tm,{}),tz=!1,tC=!1,tk=!0;if(tP){for(var tM,tD=.5*tx*tI+tb,tL=new tt.Point(-100,-100),tB=new tt.Point(this.screenRightBoundary,this.screenBottomBoundary),tR=new Kt,tO=tP.first,tF=tP.last,tU=[],tV=tO.path.length-1;tV>=1;tV--)tU.push(tO.path[tV]);for(var tN=1;tN<tF.path.length;tN++)tU.push(tF.path[tN]);var tj=2.5*tD;if(ty){var tq=tU.map(function(tt){return $t(tt,ty)});tU=tq.some(function(tt){return tt.signedDistanceFromCamera<=0})?[]:tq.map(function(tt){return tt.point})}var tZ=[];if(tU.length>0){for(var tG=tU[0].clone(),tX=tU[0].clone(),tW=1;tW<tU.length;tW++)tG.x=Math.min(tG.x,tU[tW].x),tG.y=Math.min(tG.y,tU[tW].y),tX.x=Math.max(tX.x,tU[tW].x),tX.y=Math.max(tX.y,tU[tW].y);tZ=tG.x>=tL.x&&tX.x<=tB.x&&tG.y>=tL.y&&tX.y<=tB.y?[tU]:tX.x<tL.x||tG.x>tB.x||tX.y<tL.y||tG.y>tB.y?[]:tt.clipLine([tU],tL.x,tL.y,tB.x,tB.y)}for(var tK=0,tJ=tZ;tK<tJ.length;tK+=1){tR.reset(tJ[tK],.25*tD),tM=tR.length<=.5*tD?1:Math.ceil(tR.paddedLength/tj)+1;for(var tY=0;tY<tM;tY++){var tH=tY/Math.max(tM-1,1),t$=tR.lerp(tH),tQ=t$.x+100,t0=t$.y+100;tw.push(tQ,t0,tD,0);var t1=tQ-tD,t2=t0-tD,t5=tQ+tD,t4=t0+tD;if(tk=tk&&this.isOffscreen(t1,t2,t5,t4),tC=tC||this.isInsideGrid(t1,t2,t5,t4),!ti&&this.grid.hitTestCircle(tQ,t0,tD,tv)&&(tz=!0,!tg))return{circles:[],offscreen:!1,collisionDetected:tz}}}}return{circles:(tg||!tz)&&tC?tw:[],offscreen:tk,collisionDetected:tz}},he.prototype.queryRenderedSymbols=function(ti){if(0===ti.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var ta=[],tc=1/0,th=1/0,tf=-1/0,td=-1/0,tm=0;tm<ti.length;tm+=1){var ty=ti[tm],tg=new tt.Point(ty.x+100,ty.y+100);tc=Math.min(tc,tg.x),th=Math.min(th,tg.y),tf=Math.max(tf,tg.x),td=Math.max(td,tg.y),ta.push(tg)}for(var t_={},tv={},tx=0,tb=this.grid.query(tc,th,tf,td).concat(this.ignoredGrid.query(tc,th,tf,td));tx<tb.length;tx+=1){var tw=tb[tx],tS=tw.key;if(void 0===t_[tS.bucketInstanceId]&&(t_[tS.bucketInstanceId]={}),!t_[tS.bucketInstanceId][tS.featureIndex]){var tT=[new tt.Point(tw.x1,tw.y1),new tt.Point(tw.x2,tw.y1),new tt.Point(tw.x2,tw.y2),new tt.Point(tw.x1,tw.y2)];tt.polygonIntersectsPolygon(ta,tT)&&(t_[tS.bucketInstanceId][tS.featureIndex]=!0,void 0===tv[tS.bucketInstanceId]&&(tv[tS.bucketInstanceId]=[]),tv[tS.bucketInstanceId].push(tS.featureIndex))}}return tv},he.prototype.insertCollisionBox=function(tt,ti,ta,tc,th){(ti?this.ignoredGrid:this.grid).insert({bucketInstanceId:ta,featureIndex:tc,collisionGroupID:th},tt[0],tt[1],tt[2],tt[3])},he.prototype.insertCollisionCircles=function(tt,ti,ta,tc,th){for(var tf=ti?this.ignoredGrid:this.grid,td={bucketInstanceId:ta,featureIndex:tc,collisionGroupID:th},tm=0;tm<tt.length;tm+=4)tf.insertCircle(td,tt[tm],tt[tm+1],tt[tm+2])},he.prototype.projectAndGetPerspectiveRatio=function(ti,ta,tc){var th=[ta,tc,0,1];return ue(th,th,ti),{point:new tt.Point((th[0]/th[3]+1)/2*this.transform.width+100,(-th[1]/th[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/th[3]*.5}},he.prototype.isOffscreen=function(tt,ti,ta,tc){return ta<100||tt>=this.screenRightBoundary||tc<100||ti>this.screenBottomBoundary},he.prototype.isInsideGrid=function(tt,ti,ta,tc){return ta>=0&&tt<this.gridRightBoundary&&tc>=0&&ti<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var ti=tt.identity([]);return tt.translate(ti,ti,[-100,-100,0]),ti};var de=function(tt,ti,ta,tc){this.opacity=tt?Math.max(0,Math.min(1,tt.opacity+(tt.placed?ti:-ti))):tc&&ta?1:0,this.placed=ta};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var _e=function(tt,ti,ta,tc,th){this.text=new de(tt?tt.text:null,ti,ta,th),this.icon=new de(tt?tt.icon:null,ti,tc,th)};_e.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var fe=function(tt,ti,ta){this.text=tt,this.icon=ti,this.skipFade=ta},me=function(){this.invProjMatrix=tt.create(),this.viewportMatrix=tt.create(),this.circles=[]},ge=function(tt,ti,ta,tc,th){this.bucketInstanceId=tt,this.featureIndex=ti,this.sourceLayerIndex=ta,this.bucketIndex=tc,this.tileID=th},ve=function(tt){this.crossSourceCollisions=tt,this.maxGroupID=0,this.collisionGroups={}};function ye(ti,ta,tc,th,tf){var td=tt.getAnchorAlignment(ti),tm=-(td.horizontalAlign-.5)*ta,ty=-(td.verticalAlign-.5)*tc,tg=tt.evaluateVariableOffset(ti,th);return new tt.Point(tm+tg[0]*tf,ty+tg[1]*tf)}function xe(ti,ta,tc,th,tf,td){var tm=ti.x1,ty=ti.x2,tg=ti.y1,t_=ti.y2,tv=ti.anchorPointX,tx=ti.anchorPointY,tb=new tt.Point(ta,tc);return th&&tb._rotate(tf?td:-td),{x1:tm+tb.x,y1:tg+tb.y,x2:ty+tb.x,y2:t_+tb.y,anchorPointX:tv,anchorPointY:tx}}ve.prototype.get=function(tt){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[tt]){var ti=++this.maxGroupID;this.collisionGroups[tt]={ID:ti,predicate:function(tt){return tt.collisionGroupID===ti}}}return this.collisionGroups[tt]};var be=function(tt,ti,ta,tc){this.transform=tt.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=ti,this.retainedQueryData={},this.collisionGroups=new ve(ta),this.collisionCircleArrays={},this.prevPlacement=tc,tc&&(tc.prevPlacement=void 0),this.placedOrientations={}};function we(tt,ti,ta,tc,th){tt.emplaceBack(ti?1:0,ta?1:0,tc||0,th||0),tt.emplaceBack(ti?1:0,ta?1:0,tc||0,th||0),tt.emplaceBack(ti?1:0,ta?1:0,tc||0,th||0),tt.emplaceBack(ti?1:0,ta?1:0,tc||0,th||0)}function De(tt){if(0===tt.opacity&&!tt.placed)return 0;if(1===tt.opacity&&tt.placed)return 4294967295;var ti=tt.placed?1:0,ta=Math.floor(127*tt.opacity);return 33554432*ta+16777216*ti+131072*ta+65536*ti+512*ta+256*ti+2*ta+ti}be.prototype.getBucketParts=function(ti,ta,tc,th){var tf=tc.getBucket(ta),td=tc.latestFeatureIndex;if(tf&&td&&ta.id===tf.layerIds[0]){var tm=tc.collisionBoxArray,ty=tf.layers[0].layout,tg=Math.pow(2,this.transform.zoom-tc.tileID.overscaledZ),t_=tc.tileSize/tt.EXTENT,tv=this.transform.calculatePosMatrix(tc.tileID.toUnwrapped()),tx="map"===ty.get("text-pitch-alignment"),tb="map"===ty.get("text-rotation-alignment"),tw=pe(tc,1,this.transform.zoom),tS=Jt(tv,tx,tb,this.transform,tw),tT=null;if(tx){var tI=Qt(tv,tx,tb,this.transform,tw);tT=tt.multiply([],this.transform.labelPlaneMatrix,tI)}this.retainedQueryData[tf.bucketInstanceId]=new ge(tf.bucketInstanceId,td,tf.sourceLayerIndex,tf.index,tc.tileID);var tE={bucket:tf,layout:ty,posMatrix:tv,textLabelPlaneMatrix:tS,labelToScreenMatrix:tT,scale:tg,textPixelRatio:t_,holdingForFade:tc.holdingForFade(),collisionBoxArray:tm,partiallyEvaluatedTextSize:tt.evaluateSizeForZoom(tf.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(tf.sourceID)};if(th)for(var tA=0,tP=tf.sortKeyRanges;tA<tP.length;tA+=1){var tz=tP[tA];ti.push({sortKey:tz.sortKey,symbolInstanceStart:tz.symbolInstanceStart,symbolInstanceEnd:tz.symbolInstanceEnd,parameters:tE})}else ti.push({symbolInstanceStart:0,symbolInstanceEnd:tf.symbolInstances.length,parameters:tE})}},be.prototype.attemptAnchorPlacement=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw){var tS,tT=[tv.textOffset0,tv.textOffset1],tI=ye(tt,ta,tc,tT,th),tE=this.collisionIndex.placeCollisionBox(xe(ti,tI.x,tI.y,tf,td,this.transform.angle),t_,tm,ty,tg.predicate);if(!tw||0!==this.collisionIndex.placeCollisionBox(xe(tw,tI.x,tI.y,tf,td,this.transform.angle),t_,tm,ty,tg.predicate).box.length)return tE.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[tv.crossTileID]&&this.prevPlacement.placements[tv.crossTileID]&&this.prevPlacement.placements[tv.crossTileID].text&&(tS=this.prevPlacement.variableOffsets[tv.crossTileID].anchor),this.variableOffsets[tv.crossTileID]={textOffset:tT,width:ta,height:tc,anchor:tt,textBoxScale:th,prevAnchor:tS},this.markUsedJustification(tx,tt,tv,tb),tx.allowVerticalPlacement&&(this.markUsedOrientation(tx,tb,tv),this.placedOrientations[tv.crossTileID]=tb),{shift:tI,placedGlyphBoxes:tE}):void 0},be.prototype.placeLayerBucketPart=function(ti,ta,tc){var th=this,tf=ti.parameters,td=tf.bucket,tm=tf.layout,ty=tf.posMatrix,tg=tf.textLabelPlaneMatrix,t_=tf.labelToScreenMatrix,tv=tf.textPixelRatio,tx=tf.holdingForFade,tb=tf.collisionBoxArray,tw=tf.partiallyEvaluatedTextSize,tS=tf.collisionGroup,tT=tm.get("text-optional"),tI=tm.get("icon-optional"),tE=tm.get("text-allow-overlap"),tA=tm.get("icon-allow-overlap"),tP="map"===tm.get("text-rotation-alignment"),tz="map"===tm.get("text-pitch-alignment"),tC="none"!==tm.get("icon-text-fit"),tk="viewport-y"===tm.get("symbol-z-order"),tM=tE&&(tA||!td.hasIconData()||tI),tD=tA&&(tE||!td.hasTextData()||tT);!td.collisionArrays&&tb&&td.deserializeCollisionBoxes(tb);var P=function(ti,tf){if(!ta[ti.crossTileID]){if(tx)th.placements[ti.crossTileID]=new fe(!1,!1,!1);else{var tb,tk=!1,tL=!1,tB=!0,tR=null,tO={box:null,offscreen:null},tF={box:null,offscreen:null},tU=null,tV=null,tN=0,tj=0,tq=0;tf.textFeatureIndex?tN=tf.textFeatureIndex:ti.useRuntimeCollisionCircles&&(tN=ti.featureIndex),tf.verticalTextFeatureIndex&&(tj=tf.verticalTextFeatureIndex);var tZ=tf.textBox;if(tZ){var O=function(ta){var tc=tt.WritingMode.horizontal;if(td.allowVerticalPlacement&&!ta&&th.prevPlacement){var tf=th.prevPlacement.placedOrientations[ti.crossTileID];tf&&(th.placedOrientations[ti.crossTileID]=tf,th.markUsedOrientation(td,tc=tf,ti))}return tc},F=function(ta,tc){if(td.allowVerticalPlacement&&ti.numVerticalGlyphVertices>0&&tf.verticalTextBox)for(var th=0,tm=td.writingModes;th<tm.length&&(tm[th]===tt.WritingMode.vertical?tF=tO=tc():tO=ta(),!(tO&&tO.box&&tO.box.length));th+=1);else tO=ta()};if(tm.get("text-variable-anchor")){var tG=tm.get("text-variable-anchor");if(th.prevPlacement&&th.prevPlacement.variableOffsets[ti.crossTileID]){var tX=th.prevPlacement.variableOffsets[ti.crossTileID];tG.indexOf(tX.anchor)>0&&(tG=tG.filter(function(tt){return tt!==tX.anchor})).unshift(tX.anchor)}var Z=function(tt,ta,tc){for(var tf=tt.x2-tt.x1,tm=tt.y2-tt.y1,tg=ti.textBoxScale,t_=tC&&!tA?ta:null,tx={box:[],offscreen:!1},tb=tE?2*tG.length:tG.length,tw=0;tw<tb;++tw){var tT=th.attemptAnchorPlacement(tG[tw%tG.length],tt,tf,tm,tg,tP,tz,tv,ty,tS,tw>=tG.length,ti,td,tc,t_);if(tT&&(tx=tT.placedGlyphBoxes)&&tx.box&&tx.box.length){tk=!0,tR=tT.shift;break}}return tx};F(function(){return Z(tZ,tf.iconBox,tt.WritingMode.horizontal)},function(){var ta=tf.verticalTextBox;return td.allowVerticalPlacement&&!(tO&&tO.box&&tO.box.length)&&ti.numVerticalGlyphVertices>0&&ta?Z(ta,tf.verticalIconBox,tt.WritingMode.vertical):{box:null,offscreen:null}}),tO&&(tk=tO.box,tB=tO.offscreen);var tW=O(tO&&tO.box);if(!tk&&th.prevPlacement){var tK=th.prevPlacement.variableOffsets[ti.crossTileID];tK&&(th.variableOffsets[ti.crossTileID]=tK,th.markUsedJustification(td,tK.anchor,ti,tW))}}else{var V=function(tt,ta){var tc=th.collisionIndex.placeCollisionBox(tt,tE,tv,ty,tS.predicate);return tc&&tc.box&&tc.box.length&&(th.markUsedOrientation(td,ta,ti),th.placedOrientations[ti.crossTileID]=ta),tc};F(function(){return V(tZ,tt.WritingMode.horizontal)},function(){var ta=tf.verticalTextBox;return td.allowVerticalPlacement&&ti.numVerticalGlyphVertices>0&&ta?V(ta,tt.WritingMode.vertical):{box:null,offscreen:null}}),O(tO&&tO.box&&tO.box.length)}}if(tk=(tb=tO)&&tb.box&&tb.box.length>0,tB=tb&&tb.offscreen,ti.useRuntimeCollisionCircles){var tJ=td.text.placedSymbolArray.get(ti.centerJustifiedTextSymbolIndex),tY=tt.evaluateSizeForFeature(td.textSizeData,tw,tJ),tH=tm.get("text-padding");tU=th.collisionIndex.placeCollisionCircles(tE,tJ,td.lineVertexArray,td.glyphOffsetArray,tY,ty,tg,t_,tc,tz,tS.predicate,ti.collisionCircleDiameter,tH),tk=tE||tU.circles.length>0&&!tU.collisionDetected,tB=tB&&tU.offscreen}if(tf.iconFeatureIndex&&(tq=tf.iconFeatureIndex),tf.iconBox){var H=function(tt){var ti=tC&&tR?xe(tt,tR.x,tR.y,tP,tz,th.transform.angle):tt;return th.collisionIndex.placeCollisionBox(ti,tA,tv,ty,tS.predicate)};tL=tF&&tF.box&&tF.box.length&&tf.verticalIconBox?(tV=H(tf.verticalIconBox)).box.length>0:(tV=H(tf.iconBox)).box.length>0,tB=tB&&tV.offscreen}var t$=tT||0===ti.numHorizontalGlyphVertices&&0===ti.numVerticalGlyphVertices,tQ=tI||0===ti.numIconVertices;if(t$||tQ?tQ?t$||(tL=tL&&tk):tk=tL&&tk:tL=tk=tL&&tk,tk&&tb&&tb.box&&th.collisionIndex.insertCollisionBox(tb.box,tm.get("text-ignore-placement"),td.bucketInstanceId,tF&&tF.box&&tj?tj:tN,tS.ID),tL&&tV&&th.collisionIndex.insertCollisionBox(tV.box,tm.get("icon-ignore-placement"),td.bucketInstanceId,tq,tS.ID),tU&&(tk&&th.collisionIndex.insertCollisionCircles(tU.circles,tm.get("text-ignore-placement"),td.bucketInstanceId,tN,tS.ID),tc)){var t0=td.bucketInstanceId,t1=th.collisionCircleArrays[t0];void 0===t1&&(t1=th.collisionCircleArrays[t0]=new me);for(var t2=0;t2<tU.circles.length;t2+=4)t1.circles.push(tU.circles[t2+0]),t1.circles.push(tU.circles[t2+1]),t1.circles.push(tU.circles[t2+2]),t1.circles.push(tU.collisionDetected?1:0)}th.placements[ti.crossTileID]=new fe(tk||tM,tL||tD,tB||td.justReloaded),ta[ti.crossTileID]=!0}}};if(tk)for(var tL=td.getSortedSymbolIndexes(this.transform.angle),tB=tL.length-1;tB>=0;--tB){var tR=tL[tB];P(td.symbolInstances.get(tR),td.collisionArrays[tR])}else for(var tO=ti.symbolInstanceStart;tO<ti.symbolInstanceEnd;tO++)P(td.symbolInstances.get(tO),td.collisionArrays[tO]);if(tc&&td.bucketInstanceId in this.collisionCircleArrays){var tF=this.collisionCircleArrays[td.bucketInstanceId];tt.invert(tF.invProjMatrix,ty),tF.viewportMatrix=this.collisionIndex.getViewportMatrix()}td.justReloaded=!1},be.prototype.markUsedJustification=function(ti,ta,tc,th){var tf;tf=th===tt.WritingMode.vertical?tc.verticalPlacedTextSymbolIndex:({left:tc.leftJustifiedTextSymbolIndex,center:tc.centerJustifiedTextSymbolIndex,right:tc.rightJustifiedTextSymbolIndex})[tt.getAnchorJustification(ta)];for(var td=0,tm=[tc.leftJustifiedTextSymbolIndex,tc.centerJustifiedTextSymbolIndex,tc.rightJustifiedTextSymbolIndex,tc.verticalPlacedTextSymbolIndex];td<tm.length;td+=1){var ty=tm[td];ty>=0&&(ti.text.placedSymbolArray.get(ty).crossTileID=tf>=0&&ty!==tf?0:tc.crossTileID)}},be.prototype.markUsedOrientation=function(ti,ta,tc){for(var th=ta===tt.WritingMode.horizontal||ta===tt.WritingMode.horizontalOnly?ta:0,tf=ta===tt.WritingMode.vertical?ta:0,td=0,tm=[tc.leftJustifiedTextSymbolIndex,tc.centerJustifiedTextSymbolIndex,tc.rightJustifiedTextSymbolIndex];td<tm.length;td+=1)ti.text.placedSymbolArray.get(tm[td]).placedOrientation=th;tc.verticalPlacedTextSymbolIndex&&(ti.text.placedSymbolArray.get(tc.verticalPlacedTextSymbolIndex).placedOrientation=tf)},be.prototype.commit=function(tt){this.commitTime=tt,this.zoomAtLastRecencyCheck=this.transform.zoom;var ti=this.prevPlacement,ta=!1;this.prevZoomAdjustment=ti?ti.zoomAdjustment(this.transform.zoom):0;var tc=ti?ti.symbolFadeChange(tt):1,th=ti?ti.opacities:{},tf=ti?ti.variableOffsets:{},td=ti?ti.placedOrientations:{};for(var tm in this.placements){var ty=this.placements[tm],tg=th[tm];tg?(this.opacities[tm]=new _e(tg,tc,ty.text,ty.icon),ta=ta||ty.text!==tg.text.placed||ty.icon!==tg.icon.placed):(this.opacities[tm]=new _e(null,tc,ty.text,ty.icon,ty.skipFade),ta=ta||ty.text||ty.icon)}for(var t_ in th){var tv=th[t_];if(!this.opacities[t_]){var tx=new _e(tv,tc,!1,!1);tx.isHidden()||(this.opacities[t_]=tx,ta=ta||tv.text.placed||tv.icon.placed)}}for(var tb in tf)this.variableOffsets[tb]||!this.opacities[tb]||this.opacities[tb].isHidden()||(this.variableOffsets[tb]=tf[tb]);for(var tw in td)this.placedOrientations[tw]||!this.opacities[tw]||this.opacities[tw].isHidden()||(this.placedOrientations[tw]=td[tw]);ta?this.lastPlacementChangeTime=tt:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=ti?ti.lastPlacementChangeTime:tt)},be.prototype.updateLayerOpacities=function(tt,ti){for(var ta={},tc=0;tc<ti.length;tc+=1){var th=ti[tc],tf=th.getBucket(tt);tf&&th.latestFeatureIndex&&tt.id===tf.layerIds[0]&&this.updateBucketOpacities(tf,ta,th.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(ti,ta,tc){var th=this;ti.hasTextData()&&ti.text.opacityVertexArray.clear(),ti.hasIconData()&&ti.icon.opacityVertexArray.clear(),ti.hasIconCollisionBoxData()&&ti.iconCollisionBox.collisionVertexArray.clear(),ti.hasTextCollisionBoxData()&&ti.textCollisionBox.collisionVertexArray.clear();var tf=ti.layers[0].layout,td=new _e(null,0,!1,!1,!0),tm=tf.get("text-allow-overlap"),ty=tf.get("icon-allow-overlap"),tg=tf.get("text-variable-anchor"),t_="map"===tf.get("text-rotation-alignment"),tv="map"===tf.get("text-pitch-alignment"),tx="none"!==tf.get("icon-text-fit"),tb=new _e(null,0,tm&&(ty||!ti.hasIconData()||tf.get("icon-optional")),ty&&(tm||!ti.hasTextData()||tf.get("text-optional")),!0);!ti.collisionArrays&&tc&&(ti.hasIconCollisionBoxData()||ti.hasTextCollisionBoxData())&&ti.deserializeCollisionBoxes(tc);for(var _=function(tt,ti,ta){for(var tc=0;tc<ti/4;tc++)tt.opacityVertexArray.emplaceBack(ta)},tw=0;tw<ti.symbolInstances.length;tw++)(function(tc){var tf=ti.symbolInstances.get(tc),tm=tf.numHorizontalGlyphVertices,ty=tf.numVerticalGlyphVertices,tw=tf.crossTileID,tS=th.opacities[tw];ta[tw]?tS=td:tS||(th.opacities[tw]=tS=tb),ta[tw]=!0;var tT=tf.numIconVertices>0,tI=th.placedOrientations[tf.crossTileID],tE=tI===tt.WritingMode.vertical,tA=tI===tt.WritingMode.horizontal||tI===tt.WritingMode.horizontalOnly;if(tm>0||ty>0){var tP=De(tS.text);_(ti.text,tm,tE?eg:tP),_(ti.text,ty,tA?eg:tP);var tz=tS.text.isHidden();[tf.rightJustifiedTextSymbolIndex,tf.centerJustifiedTextSymbolIndex,tf.leftJustifiedTextSymbolIndex].forEach(function(tt){tt>=0&&(ti.text.placedSymbolArray.get(tt).hidden=tz||tE?1:0)}),tf.verticalPlacedTextSymbolIndex>=0&&(ti.text.placedSymbolArray.get(tf.verticalPlacedTextSymbolIndex).hidden=tz||tA?1:0);var tC=th.variableOffsets[tf.crossTileID];tC&&th.markUsedJustification(ti,tC.anchor,tf,tI);var tk=th.placedOrientations[tf.crossTileID];tk&&(th.markUsedJustification(ti,"left",tf,tk),th.markUsedOrientation(ti,tk,tf))}if(tT){var tM=De(tS.icon),tD=!(tx&&tf.verticalPlacedIconSymbolIndex&&tE);tf.placedIconSymbolIndex>=0&&(_(ti.icon,tf.numIconVertices,tD?tM:eg),ti.icon.placedSymbolArray.get(tf.placedIconSymbolIndex).hidden=tS.icon.isHidden()),tf.verticalPlacedIconSymbolIndex>=0&&(_(ti.icon,tf.numVerticalIconVertices,tD?eg:tM),ti.icon.placedSymbolArray.get(tf.verticalPlacedIconSymbolIndex).hidden=tS.icon.isHidden())}if(ti.hasIconCollisionBoxData()||ti.hasTextCollisionBoxData()){var tL=ti.collisionArrays[tc];if(tL){var tB=new tt.Point(0,0);if(tL.textBox||tL.verticalTextBox){var tR=!0;if(tg){var tO=th.variableOffsets[tw];tO?(tB=ye(tO.anchor,tO.width,tO.height,tO.textOffset,tO.textBoxScale),t_&&tB._rotate(tv?th.transform.angle:-th.transform.angle)):tR=!1}tL.textBox&&we(ti.textCollisionBox.collisionVertexArray,tS.text.placed,!tR||tE,tB.x,tB.y),tL.verticalTextBox&&we(ti.textCollisionBox.collisionVertexArray,tS.text.placed,!tR||tA,tB.x,tB.y)}var tF=!!(!tA&&tL.verticalIconBox);tL.iconBox&&we(ti.iconCollisionBox.collisionVertexArray,tS.icon.placed,tF,tx?tB.x:0,tx?tB.y:0),tL.verticalIconBox&&we(ti.iconCollisionBox.collisionVertexArray,tS.icon.placed,!tF,tx?tB.x:0,tx?tB.y:0)}}})(tw);if(ti.sortFeatures(this.transform.angle),this.retainedQueryData[ti.bucketInstanceId]&&(this.retainedQueryData[ti.bucketInstanceId].featureSortOrder=ti.featureSortOrder),ti.hasTextData()&&ti.text.opacityVertexBuffer&&ti.text.opacityVertexBuffer.updateData(ti.text.opacityVertexArray),ti.hasIconData()&&ti.icon.opacityVertexBuffer&&ti.icon.opacityVertexBuffer.updateData(ti.icon.opacityVertexArray),ti.hasIconCollisionBoxData()&&ti.iconCollisionBox.collisionVertexBuffer&&ti.iconCollisionBox.collisionVertexBuffer.updateData(ti.iconCollisionBox.collisionVertexArray),ti.hasTextCollisionBoxData()&&ti.textCollisionBox.collisionVertexBuffer&&ti.textCollisionBox.collisionVertexBuffer.updateData(ti.textCollisionBox.collisionVertexArray),ti.bucketInstanceId in this.collisionCircleArrays){var tS=this.collisionCircleArrays[ti.bucketInstanceId];ti.placementInvProjMatrix=tS.invProjMatrix,ti.placementViewportMatrix=tS.viewportMatrix,ti.collisionCircleArray=tS.circles,delete this.collisionCircleArrays[ti.bucketInstanceId]}},be.prototype.symbolFadeChange=function(tt){return 0===this.fadeDuration?1:(tt-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(tt){return Math.max(0,(this.transform.zoom-tt)/1.5)},be.prototype.hasTransitions=function(tt){return this.stale||tt-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(tt,ti){var ta=this.zoomAtLastRecencyCheck===ti?1-this.zoomAdjustment(ti):1;return this.zoomAtLastRecencyCheck=ti,this.commitTime+this.fadeDuration*ta>tt},be.prototype.setStale=function(){this.stale=!0};var eg=0,Me=function(tt){this._sortAcrossTiles="viewport-y"!==tt.layout.get("symbol-z-order")&&void 0!==tt.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Me.prototype.continuePlacement=function(tt,ti,ta,tc,th){for(var tf=this._bucketParts;this._currentTileIndex<tt.length;)if(ti.getBucketParts(tf,tc,tt[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,th())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,tf.sort(function(tt,ti){return tt.sortKey-ti.sortKey}));this._currentPartIndex<tf.length;)if(ti.placeLayerBucketPart(tf[this._currentPartIndex],this._seenCrossTileIDs,ta),this._currentPartIndex++,th())return!0;return!1};var Le=function(tt,ti,ta,tc,th,tf,td){this.placement=new be(tt,th,tf,td),this._currentPlacementIndex=ti.length-1,this._forceFullPlacement=ta,this._showCollisionBoxes=tc,this._done=!1};Le.prototype.isDone=function(){return this._done},Le.prototype.continuePlacement=function(ti,ta,tc){for(var th=this,tf=tt.browser.now(),n=function(){var ti=tt.browser.now()-tf;return!th._forceFullPlacement&&ti>2};this._currentPlacementIndex>=0;){var td=ta[ti[this._currentPlacementIndex]],tm=this.placement.collisionIndex.transform.zoom;if("symbol"===td.type&&(!td.minzoom||td.minzoom<=tm)&&(!td.maxzoom||td.maxzoom>tm)){if(this._inProgressLayer||(this._inProgressLayer=new Me(td)),this._inProgressLayer.continuePlacement(tc[td.source],this.placement,this._showCollisionBoxes,td,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Le.prototype.commit=function(tt){return this.placement.commit(tt),this.placement};var e_=512/tt.EXTENT/2,ke=function(tt,ti,ta){this.tileID=tt,this.indexedSymbolInstances={},this.bucketInstanceId=ta;for(var tc=0;tc<ti.length;tc++){var th=ti.get(tc),tf=th.key;this.indexedSymbolInstances[tf]||(this.indexedSymbolInstances[tf]=[]),this.indexedSymbolInstances[tf].push({crossTileID:th.crossTileID,coord:this.getScaledCoordinates(th,tt)})}};ke.prototype.getScaledCoordinates=function(ti,ta){var tc=e_/Math.pow(2,ta.canonical.z-this.tileID.canonical.z);return{x:Math.floor((ta.canonical.x*tt.EXTENT+ti.anchorX)*tc),y:Math.floor((ta.canonical.y*tt.EXTENT+ti.anchorY)*tc)}},ke.prototype.findMatches=function(tt,ti,ta){for(var tc=this.tileID.canonical.z<ti.canonical.z?1:Math.pow(2,this.tileID.canonical.z-ti.canonical.z),th=0;th<tt.length;th++){var tf=tt.get(th);if(!tf.crossTileID){var td=this.indexedSymbolInstances[tf.key];if(td)for(var tm=this.getScaledCoordinates(tf,ti),ty=0;ty<td.length;ty+=1){var tg=td[ty];if(Math.abs(tg.coord.x-tm.x)<=tc&&Math.abs(tg.coord.y-tm.y)<=tc&&!ta[tg.crossTileID]){ta[tg.crossTileID]=!0,tf.crossTileID=tg.crossTileID;break}}}}};var Be=function(){this.maxCrossTileID=0};Be.prototype.generate=function(){return++this.maxCrossTileID};var Oe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Oe.prototype.handleWrapJump=function(tt){var ti=Math.round((tt-this.lng)/360);if(0!==ti)for(var ta in this.indexes){var tc=this.indexes[ta],th={};for(var tf in tc){var td=tc[tf];td.tileID=td.tileID.unwrapTo(td.tileID.wrap+ti),th[td.tileID.key]=td}this.indexes[ta]=th}this.lng=tt},Oe.prototype.addBucket=function(tt,ti,ta){if(this.indexes[tt.overscaledZ]&&this.indexes[tt.overscaledZ][tt.key]){if(this.indexes[tt.overscaledZ][tt.key].bucketInstanceId===ti.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(tt.overscaledZ,this.indexes[tt.overscaledZ][tt.key])}for(var tc=0;tc<ti.symbolInstances.length;tc++)ti.symbolInstances.get(tc).crossTileID=0;this.usedCrossTileIDs[tt.overscaledZ]||(this.usedCrossTileIDs[tt.overscaledZ]={});var th=this.usedCrossTileIDs[tt.overscaledZ];for(var tf in this.indexes){var td=this.indexes[tf];if(Number(tf)>tt.overscaledZ)for(var tm in td){var ty=td[tm];ty.tileID.isChildOf(tt)&&ty.findMatches(ti.symbolInstances,tt,th)}else{var tg=td[tt.scaledTo(Number(tf)).key];tg&&tg.findMatches(ti.symbolInstances,tt,th)}}for(var t_=0;t_<ti.symbolInstances.length;t_++){var tv=ti.symbolInstances.get(t_);tv.crossTileID||(tv.crossTileID=ta.generate(),th[tv.crossTileID]=!0)}return void 0===this.indexes[tt.overscaledZ]&&(this.indexes[tt.overscaledZ]={}),this.indexes[tt.overscaledZ][tt.key]=new ke(tt,ti.symbolInstances,ti.bucketInstanceId),!0},Oe.prototype.removeBucketCrossTileIDs=function(tt,ti){for(var ta in ti.indexedSymbolInstances)for(var tc=0,th=ti.indexedSymbolInstances[ta];tc<th.length;tc+=1)delete this.usedCrossTileIDs[tt][th[tc].crossTileID]},Oe.prototype.removeStaleBuckets=function(tt){var ti=!1;for(var ta in this.indexes){var tc=this.indexes[ta];for(var th in tc)tt[tc[th].bucketInstanceId]||(this.removeBucketCrossTileIDs(ta,tc[th]),delete tc[th],ti=!0)}return ti};var Fe=function(){this.layerIndexes={},this.crossTileIDs=new Be,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Fe.prototype.addLayer=function(tt,ti,ta){var tc=this.layerIndexes[tt.id];void 0===tc&&(tc=this.layerIndexes[tt.id]=new Oe);var th=!1,tf={};tc.handleWrapJump(ta);for(var td=0;td<ti.length;td+=1){var tm=ti[td],ty=tm.getBucket(tt);ty&&tt.id===ty.layerIds[0]&&(ty.bucketInstanceId||(ty.bucketInstanceId=++this.maxBucketInstanceId),tc.addBucket(tm.tileID,ty,this.crossTileIDs)&&(th=!0),tf[ty.bucketInstanceId]=!0)}return tc.removeStaleBuckets(tf)&&(th=!0),th},Fe.prototype.pruneUnusedLayers=function(tt){var ti={};for(var ta in tt.forEach(function(tt){ti[tt]=!0}),this.layerIndexes)ti[ta]||delete this.layerIndexes[ta]};var Ue=function(ti,ta){return tt.emitValidationErrors(ti,ta&&ta.filter(function(tt){return"source.canvas"!==tt.identifier}))},ev=tt.pick(em,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ex=tt.pick(em,["setCenter","setZoom","setBearing","setPitch"]),eb=function(){var ti={},ta=tt.styleSpec.$version;for(var tc in tt.styleSpec.$root){var th,tf=tt.styleSpec.$root[tc];tf.required&&null!=(th="version"===tc?ta:"array"===tf.type?[]:{})&&(ti[tc]=th)}return ti}(),ew=function(ti){function i(ta,tc){var th=this;void 0===tc&&(tc={}),ti.call(this),this.map=ta,this.dispatcher=new E(Ft(),this),this.imageManager=new tg,this.imageManager.setEventedParent(this),this.glyphManager=new y(ta._requestManager,tc.localIdeographFontFamily),this.lineAtlas=new T(256,512),this.crossTileSymbolIndex=new Fe,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new tt.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",tt.getReferrer());var tf=this;this._rtlTextPluginCallback=i.registerForPluginStateChange(function(ti){tf.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ti.pluginStatus,pluginURL:ti.pluginURL},function(ti,ta){if(tt.triggerPluginCompletionEvent(ti),ta&&ta.every(function(tt){return tt}))for(var tc in tf.sourceCaches)tf.sourceCaches[tc].reload()})}),this.on("data",function(tt){if("source"===tt.dataType&&"metadata"===tt.sourceDataType){var ti=th.sourceCaches[tt.sourceId];if(ti){var ta=ti.getSource();if(ta&&ta.vectorLayerIds)for(var tc in th._layers){var tf=th._layers[tc];tf.source===ta.id&&th._validateLayer(tf)}}}})}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.loadURL=function(ti,ta){var tc=this;void 0===ta&&(ta={}),this.fire(new tt.Event("dataloading",{dataType:"style"}));var th="boolean"==typeof ta.validate?ta.validate:!tt.isMapboxURL(ti);ti=this.map._requestManager.normalizeStyleURL(ti,ta.accessToken);var tf=this.map._requestManager.transformRequest(ti,tt.ResourceType.Style);this._request=tt.getJSON(tf,function(ti,ta){tc._request=null,ti?tc.fire(new tt.ErrorEvent(ti)):ta&&tc._load(ta,th)})},i.prototype.loadJSON=function(ti,ta){var tc=this;void 0===ta&&(ta={}),this.fire(new tt.Event("dataloading",{dataType:"style"})),this._request=tt.browser.frame(function(){tc._request=null,tc._load(ti,!1!==ta.validate)})},i.prototype.loadEmpty=function(){this.fire(new tt.Event("dataloading",{dataType:"style"})),this._load(eb,!1)},i.prototype._load=function(ti,ta){if(!ta||!Ue(this,tt.validateStyle(ti))){for(var tc in this._loaded=!0,this.stylesheet=ti,ti.sources)this.addSource(tc,ti.sources[tc],{validate:!1});ti.sprite?this._loadSprite(ti.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(ti.glyphs);var th=Nt(this.stylesheet.layers);this._order=th.map(function(tt){return tt.id}),this._layers={},this._serializedLayers={};for(var tf=0;tf<th.length;tf+=1){var td=th[tf];(td=tt.createStyleLayer(td)).setEventedParent(this,{layer:{id:td.id}}),this._layers[td.id]=td,this._serializedLayers[td.id]=td.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new tb(this.stylesheet.light),this.fire(new tt.Event("data",{dataType:"style"})),this.fire(new tt.Event("style.load"))}},i.prototype._loadSprite=function(ti){var ta=this;this._spriteRequest=function(ti,ta,tc){var th,tf,td,tm=tt.browser.devicePixelRatio>1?"@2x":"",ty=tt.getJSON(ta.transformRequest(ta.normalizeSpriteURL(ti,tm,".json"),tt.ResourceType.SpriteJSON),function(tt,ti){ty=null,td||(td=tt,th=ti,u())}),tg=tt.getImage(ta.transformRequest(ta.normalizeSpriteURL(ti,tm,".png"),tt.ResourceType.SpriteImage),function(tt,ti){tg=null,td||(td=tt,tf=ti,u())});function u(){if(td)tc(td);else if(th&&tf){var ti=tt.browser.getImageData(tf),ta={};for(var tm in th){var ty=th[tm],tg=ty.width,t_=ty.height,tv=ty.x,tx=ty.y,tb=ty.sdf,tw=ty.pixelRatio,tS=ty.stretchX,tT=ty.stretchY,tI=ty.content,tE=new tt.RGBAImage({width:tg,height:t_});tt.RGBAImage.copy(ti,tE,{x:tv,y:tx},{x:0,y:0},{width:tg,height:t_}),ta[tm]={data:tE,pixelRatio:tw,sdf:tb,stretchX:tS,stretchY:tT,content:tI}}tc(null,ta)}}return{cancel:function(){ty&&(ty.cancel(),ty=null),tg&&(tg.cancel(),tg=null)}}}(ti,this.map._requestManager,function(ti,tc){if(ta._spriteRequest=null,ti)ta.fire(new tt.ErrorEvent(ti));else if(tc)for(var th in tc)ta.imageManager.addImage(th,tc[th]);ta.imageManager.setLoaded(!0),ta._availableImages=ta.imageManager.listImages(),ta.dispatcher.broadcast("setImages",ta._availableImages),ta.fire(new tt.Event("data",{dataType:"style"}))})},i.prototype._validateLayer=function(ti){var ta=this.sourceCaches[ti.source];if(ta){var tc=ti.sourceLayer;if(tc){var th=ta.getSource();("geojson"===th.type||th.vectorLayerIds&&-1===th.vectorLayerIds.indexOf(tc))&&this.fire(new tt.ErrorEvent(Error('Source layer "'+tc+'" does not exist on source "'+th.id+'" as specified by style layer "'+ti.id+'"')))}}},i.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var tt in this.sourceCaches)if(!this.sourceCaches[tt].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(tt){for(var ti=[],ta=0;ta<tt.length;ta+=1){var tc=this._layers[tt[ta]];"custom"!==tc.type&&ti.push(tc.serialize())}return ti},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var tt in this.sourceCaches)if(this.sourceCaches[tt].hasTransition())return!0;for(var ti in this._layers)if(this._layers[ti].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw Error("Style is not done loading")},i.prototype.update=function(ti){if(this._loaded){var ta=this._changed;if(this._changed){var tc=Object.keys(this._updatedLayers),th=Object.keys(this._removedLayers);for(var tf in(tc.length||th.length)&&this._updateWorkerLayers(tc,th),this._updatedSources){var td=this._updatedSources[tf];"reload"===td?this._reloadSource(tf):"clear"===td&&this._clearSource(tf)}for(var tm in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[tm].updateTransitions(ti);this.light.updateTransitions(ti),this._resetUpdates()}var ty={};for(var tg in this.sourceCaches){var t_=this.sourceCaches[tg];ty[tg]=t_.used,t_.used=!1}for(var tv=0,tx=this._order;tv<tx.length;tv+=1){var tb=this._layers[tx[tv]];tb.recalculate(ti,this._availableImages),!tb.isHidden(ti.zoom)&&tb.source&&(this.sourceCaches[tb.source].used=!0)}for(var tw in ty){var tS=this.sourceCaches[tw];ty[tw]!==tS.used&&tS.fire(new tt.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:tw}))}this.light.recalculate(ti),this.z=ti.zoom,ta&&this.fire(new tt.Event("data",{dataType:"style"}))}},i.prototype._updateTilesForChangedImages=function(){var tt=Object.keys(this._changedImages);if(tt.length){for(var ti in this.sourceCaches)this.sourceCaches[ti].reloadTilesForDependencies(["icons","patterns"],tt);this._changedImages={}}},i.prototype._updateWorkerLayers=function(tt,ti){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(tt),removedIds:ti})},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},i.prototype.setState=function(ti){var ta=this;if(this._checkLoaded(),Ue(this,tt.validateStyle(ti)))return!1;(ti=tt.clone$1(ti)).layers=Nt(ti.layers);var tc=(function(ti,ta){if(!ti)return[{command:em.setStyle,args:[ta]}];var tc=[];try{if(!tt.deepEqual(ti.version,ta.version))return[{command:em.setStyle,args:[ta]}];tt.deepEqual(ti.center,ta.center)||tc.push({command:em.setCenter,args:[ta.center]}),tt.deepEqual(ti.zoom,ta.zoom)||tc.push({command:em.setZoom,args:[ta.zoom]}),tt.deepEqual(ti.bearing,ta.bearing)||tc.push({command:em.setBearing,args:[ta.bearing]}),tt.deepEqual(ti.pitch,ta.pitch)||tc.push({command:em.setPitch,args:[ta.pitch]}),tt.deepEqual(ti.sprite,ta.sprite)||tc.push({command:em.setSprite,args:[ta.sprite]}),tt.deepEqual(ti.glyphs,ta.glyphs)||tc.push({command:em.setGlyphs,args:[ta.glyphs]}),tt.deepEqual(ti.transition,ta.transition)||tc.push({command:em.setTransition,args:[ta.transition]}),tt.deepEqual(ti.light,ta.light)||tc.push({command:em.setLight,args:[ta.light]});var th={},tf=[];!function(ti,ta,tc,th){var tf;for(tf in ta=ta||{},ti=ti||{})ti.hasOwnProperty(tf)&&(ta.hasOwnProperty(tf)||jt(tf,tc,th));for(tf in ta)ta.hasOwnProperty(tf)&&(ti.hasOwnProperty(tf)?tt.deepEqual(ti[tf],ta[tf])||("geojson"===ti[tf].type&&"geojson"===ta[tf].type&&Gt(ti,ta,tf)?tc.push({command:em.setGeoJSONSourceData,args:[tf,ta[tf].data]}):Vt(tf,ta,tc,th)):qt(tf,ta,tc))}(ti.sources,ta.sources,tf,th);var td=[];ti.layers&&ti.layers.forEach(function(tt){th[tt.source]?tc.push({command:em.removeLayer,args:[tt.id]}):td.push(tt)}),tc=tc.concat(tf),function(ti,ta,tc){ta=ta||[];var th,tf,td,tm,ty,tg,t_,tv=(ti=ti||[]).map(Xt),tx=ta.map(Xt),tb=ti.reduce(Ht,{}),tw=ta.reduce(Ht,{}),tS=tv.slice(),tT=Object.create(null);for(th=0,tf=0;th<tv.length;th++)tw.hasOwnProperty(td=tv[th])?tf++:(tc.push({command:em.removeLayer,args:[td]}),tS.splice(tS.indexOf(td,tf),1));for(th=0,tf=0;th<tx.length;th++)tS[tS.length-1-th]!==(td=tx[tx.length-1-th])&&(tb.hasOwnProperty(td)?(tc.push({command:em.removeLayer,args:[td]}),tS.splice(tS.lastIndexOf(td,tS.length-tf),1)):tf++,tc.push({command:em.addLayer,args:[tw[td],tg=tS[tS.length-th]]}),tS.splice(tS.length-th,0,td),tT[td]=!0);for(th=0;th<tx.length;th++)if(tm=tb[td=tx[th]],ty=tw[td],!tT[td]&&!tt.deepEqual(tm,ty)){if(tt.deepEqual(tm.source,ty.source)&&tt.deepEqual(tm["source-layer"],ty["source-layer"])&&tt.deepEqual(tm.type,ty.type)){for(t_ in Wt(tm.layout,ty.layout,tc,td,null,em.setLayoutProperty),Wt(tm.paint,ty.paint,tc,td,null,em.setPaintProperty),tt.deepEqual(tm.filter,ty.filter)||tc.push({command:em.setFilter,args:[td,ty.filter]}),tt.deepEqual(tm.minzoom,ty.minzoom)&&tt.deepEqual(tm.maxzoom,ty.maxzoom)||tc.push({command:em.setLayerZoomRange,args:[td,ty.minzoom,ty.maxzoom]}),tm)tm.hasOwnProperty(t_)&&"layout"!==t_&&"paint"!==t_&&"filter"!==t_&&"metadata"!==t_&&"minzoom"!==t_&&"maxzoom"!==t_&&(0===t_.indexOf("paint.")?Wt(tm[t_],ty[t_],tc,td,t_.slice(6),em.setPaintProperty):tt.deepEqual(tm[t_],ty[t_])||tc.push({command:em.setLayerProperty,args:[td,t_,ty[t_]]}));for(t_ in ty)ty.hasOwnProperty(t_)&&!tm.hasOwnProperty(t_)&&"layout"!==t_&&"paint"!==t_&&"filter"!==t_&&"metadata"!==t_&&"minzoom"!==t_&&"maxzoom"!==t_&&(0===t_.indexOf("paint.")?Wt(tm[t_],ty[t_],tc,td,t_.slice(6),em.setPaintProperty):tt.deepEqual(tm[t_],ty[t_])||tc.push({command:em.setLayerProperty,args:[td,t_,ty[t_]]}))}else tc.push({command:em.removeLayer,args:[td]}),tg=tS[tS.lastIndexOf(td)+1],tc.push({command:em.addLayer,args:[ty,tg]})}}(td,ta.layers,tc)}catch(tt){console.warn("Unable to compute style diff:",tt),tc=[{command:em.setStyle,args:[ta]}]}return tc})(this.serialize(),ti).filter(function(tt){return!(tt.command in ex)});if(0===tc.length)return!1;var th=tc.filter(function(tt){return!(tt.command in ev)});if(th.length>0)throw Error("Unimplemented: "+th.map(function(tt){return tt.command}).join(", ")+".");return tc.forEach(function(tt){"setTransition"!==tt.command&&ta[tt.command].apply(ta,tt.args)}),this.stylesheet=ti,!0},i.prototype.addImage=function(ti,ta){if(this.getImage(ti))return this.fire(new tt.ErrorEvent(Error("An image with this name already exists.")));this.imageManager.addImage(ti,ta),this._afterImageUpdated(ti)},i.prototype.updateImage=function(tt,ti){this.imageManager.updateImage(tt,ti)},i.prototype.getImage=function(tt){return this.imageManager.getImage(tt)},i.prototype.removeImage=function(ti){if(!this.getImage(ti))return this.fire(new tt.ErrorEvent(Error("No image with this name exists.")));this.imageManager.removeImage(ti),this._afterImageUpdated(ti)},i.prototype._afterImageUpdated=function(ti){this._availableImages=this.imageManager.listImages(),this._changedImages[ti]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new tt.Event("data",{dataType:"style"}))},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(ti,ta,tc){var th=this;if(void 0===tc&&(tc={}),this._checkLoaded(),void 0!==this.sourceCaches[ti])throw Error("There is already a source with this ID");if(!ta.type)throw Error("The type property must be defined, but only the following properties were given: "+Object.keys(ta).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(ta.type)>=0&&this._validate(tt.validateStyle.source,"sources."+ti,ta,null,tc))){this.map&&this.map._collectResourceTiming&&(ta.collectResourceTiming=!0);var tf=this.sourceCaches[ti]=new ec(ti,ta,this.dispatcher);tf.style=this,tf.setEventedParent(this,function(){return{isSourceLoaded:th.loaded(),source:tf.serialize(),sourceId:ti}}),tf.onAdd(this.map),this._changed=!0}},i.prototype.removeSource=function(ti){if(this._checkLoaded(),void 0===this.sourceCaches[ti])throw Error("There is no source with this ID");for(var ta in this._layers)if(this._layers[ta].source===ti)return this.fire(new tt.ErrorEvent(Error('Source "'+ti+'" cannot be removed while layer "'+ta+'" is using it.')));var tc=this.sourceCaches[ti];delete this.sourceCaches[ti],delete this._updatedSources[ti],tc.fire(new tt.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ti})),tc.setEventedParent(null),tc.clearTiles(),tc.onRemove&&tc.onRemove(this.map),this._changed=!0},i.prototype.setGeoJSONSourceData=function(tt,ti){this._checkLoaded(),this.sourceCaches[tt].getSource().setData(ti),this._changed=!0},i.prototype.getSource=function(tt){return this.sourceCaches[tt]&&this.sourceCaches[tt].getSource()},i.prototype.addLayer=function(ti,ta,tc){void 0===tc&&(tc={}),this._checkLoaded();var th=ti.id;if(this.getLayer(th))this.fire(new tt.ErrorEvent(Error('Layer with id "'+th+'" already exists on this map')));else{if("custom"===ti.type){if(Ue(this,tt.validateCustomStyleLayer(ti)))return;tf=tt.createStyleLayer(ti)}else{if("object"==typeof ti.source&&(this.addSource(th,ti.source),ti=tt.clone$1(ti),ti=tt.extend(ti,{source:th})),this._validate(tt.validateStyle.layer,"layers."+th,ti,{arrayIndex:-1},tc))return;tf=tt.createStyleLayer(ti),this._validateLayer(tf),tf.setEventedParent(this,{layer:{id:th}}),this._serializedLayers[tf.id]=tf.serialize()}var tf,td=ta?this._order.indexOf(ta):this._order.length;if(ta&&-1===td)this.fire(new tt.ErrorEvent(Error('Layer with id "'+ta+'" does not exist on this map.')));else{if(this._order.splice(td,0,th),this._layerOrderChanged=!0,this._layers[th]=tf,this._removedLayers[th]&&tf.source&&"custom"!==tf.type){var tm=this._removedLayers[th];delete this._removedLayers[th],tm.type!==tf.type?this._updatedSources[tf.source]="clear":(this._updatedSources[tf.source]="reload",this.sourceCaches[tf.source].pause())}this._updateLayer(tf),tf.onAdd&&tf.onAdd(this.map)}}},i.prototype.moveLayer=function(ti,ta){if(this._checkLoaded(),this._changed=!0,this._layers[ti]){if(ti!==ta){var tc=this._order.indexOf(ti);this._order.splice(tc,1);var th=ta?this._order.indexOf(ta):this._order.length;ta&&-1===th?this.fire(new tt.ErrorEvent(Error('Layer with id "'+ta+'" does not exist on this map.'))):(this._order.splice(th,0,ti),this._layerOrderChanged=!0)}}else this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot be moved.")))},i.prototype.removeLayer=function(ti){this._checkLoaded();var ta=this._layers[ti];if(ta){ta.setEventedParent(null);var tc=this._order.indexOf(ti);this._order.splice(tc,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[ti]=ta,delete this._layers[ti],delete this._serializedLayers[ti],delete this._updatedLayers[ti],delete this._updatedPaintProps[ti],ta.onRemove&&ta.onRemove(this.map)}else this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot be removed.")))},i.prototype.getLayer=function(tt){return this._layers[tt]},i.prototype.hasLayer=function(tt){return tt in this._layers},i.prototype.setLayerZoomRange=function(ti,ta,tc){this._checkLoaded();var th=this.getLayer(ti);th?th.minzoom===ta&&th.maxzoom===tc||(null!=ta&&(th.minzoom=ta),null!=tc&&(th.maxzoom=tc),this._updateLayer(th)):this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot have zoom extent.")))},i.prototype.setFilter=function(ti,ta,tc){void 0===tc&&(tc={}),this._checkLoaded();var th=this.getLayer(ti);if(th){if(!tt.deepEqual(th.filter,ta))return null==ta?(th.filter=void 0,void this._updateLayer(th)):void(this._validate(tt.validateStyle.filter,"layers."+th.id+".filter",ta,null,tc)||(th.filter=tt.clone$1(ta),this._updateLayer(th)))}else this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot be filtered.")))},i.prototype.getFilter=function(ti){return tt.clone$1(this.getLayer(ti).filter)},i.prototype.setLayoutProperty=function(ti,ta,tc,th){void 0===th&&(th={}),this._checkLoaded();var tf=this.getLayer(ti);tf?tt.deepEqual(tf.getLayoutProperty(ta),tc)||(tf.setLayoutProperty(ta,tc,th),this._updateLayer(tf)):this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getLayoutProperty=function(ti,ta){var tc=this.getLayer(ti);if(tc)return tc.getLayoutProperty(ta);this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style.")))},i.prototype.setPaintProperty=function(ti,ta,tc,th){void 0===th&&(th={}),this._checkLoaded();var tf=this.getLayer(ti);tf?tt.deepEqual(tf.getPaintProperty(ta),tc)||(tf.setPaintProperty(ta,tc,th)&&this._updateLayer(tf),this._changed=!0,this._updatedPaintProps[ti]=!0):this.fire(new tt.ErrorEvent(Error("The layer '"+ti+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getPaintProperty=function(tt,ti){return this.getLayer(tt).getPaintProperty(ti)},i.prototype.setFeatureState=function(ti,ta){this._checkLoaded();var tc=ti.source,th=ti.sourceLayer,tf=this.sourceCaches[tc];if(void 0!==tf){var td=tf.getSource().type;"geojson"===td&&th?this.fire(new tt.ErrorEvent(Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==td||th?(void 0===ti.id&&this.fire(new tt.ErrorEvent(Error("The feature id parameter must be provided."))),tf.setFeatureState(th,ti.id,ta)):this.fire(new tt.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new tt.ErrorEvent(Error("The source '"+tc+"' does not exist in the map's style.")))},i.prototype.removeFeatureState=function(ti,ta){this._checkLoaded();var tc=ti.source,th=this.sourceCaches[tc];if(void 0!==th){var tf=th.getSource().type,td="vector"===tf?ti.sourceLayer:void 0;"vector"!==tf||td?ta&&"string"!=typeof ti.id&&"number"!=typeof ti.id?this.fire(new tt.ErrorEvent(Error("A feature id is required to remove its specific state property."))):th.removeFeatureState(td,ti.id,ta):this.fire(new tt.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new tt.ErrorEvent(Error("The source '"+tc+"' does not exist in the map's style.")))},i.prototype.getFeatureState=function(ti){this._checkLoaded();var ta=ti.source,tc=ti.sourceLayer,th=this.sourceCaches[ta];if(void 0!==th){if("vector"!==th.getSource().type||tc)return void 0===ti.id&&this.fire(new tt.ErrorEvent(Error("The feature id parameter must be provided."))),th.getFeatureState(tc,ti.id);this.fire(new tt.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new tt.ErrorEvent(Error("The source '"+ta+"' does not exist in the map's style.")))},i.prototype.getTransition=function(){return tt.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return tt.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:tt.mapObject(this.sourceCaches,function(tt){return tt.serialize()}),layers:this._serializeLayers(this._order)},function(tt){return void 0!==tt})},i.prototype._updateLayer=function(tt){this._updatedLayers[tt.id]=!0,tt.source&&!this._updatedSources[tt.source]&&"raster"!==this.sourceCaches[tt.source].getSource().type&&(this._updatedSources[tt.source]="reload",this.sourceCaches[tt.source].pause()),this._changed=!0},i.prototype._flattenAndSortRenderedFeatures=function(tt){for(var ti=this,i=function(tt){return"fill-extrusion"===ti._layers[tt].type},ta={},tc=[],th=this._order.length-1;th>=0;th--){var tf=this._order[th];if(i(tf)){ta[tf]=th;for(var td=0;td<tt.length;td+=1){var tm=tt[td][tf];if(tm)for(var ty=0;ty<tm.length;ty+=1)tc.push(tm[ty])}}}tc.sort(function(tt,ti){return ti.intersectionZ-tt.intersectionZ});for(var tg=[],t_=this._order.length-1;t_>=0;t_--){var tv=this._order[t_];if(i(tv))for(var tx=tc.length-1;tx>=0;tx--){var tb=tc[tx].feature;if(ta[tb.layer.id]<t_)break;tg.push(tb),tc.pop()}else for(var tw=0;tw<tt.length;tw+=1){var tS=tt[tw][tv];if(tS)for(var tT=0;tT<tS.length;tT+=1)tg.push(tS[tT].feature)}}return tg},i.prototype.queryRenderedFeatures=function(ti,ta,tc){ta&&ta.filter&&this._validate(tt.validateStyle.filter,"queryRenderedFeatures.filter",ta.filter,null,ta);var th={};if(ta&&ta.layers){if(!Array.isArray(ta.layers))return this.fire(new tt.ErrorEvent(Error("parameters.layers must be an Array."))),[];for(var tf=0,td=ta.layers;tf<td.length;tf+=1){var tm=td[tf],ty=this._layers[tm];if(!ty)return this.fire(new tt.ErrorEvent(Error("The layer '"+tm+"' does not exist in the map's style and cannot be queried for features."))),[];th[ty.source]=!0}}var tg=[];for(var t_ in ta.availableImages=this._availableImages,this.sourceCaches)ta.layers&&!th[t_]||tg.push(O(this.sourceCaches[t_],this._layers,this._serializedLayers,ti,ta,tc));return this.placement&&tg.push(function(tt,ti,ta,tc,th,tf,td){for(var tm={},ty=tf.queryRenderedSymbols(tc),tg=[],t_=0,tv=Object.keys(ty).map(Number);t_<tv.length;t_+=1)tg.push(td[tv[t_]]);tg.sort(F);for(var tx=0;tx<tg.length;tx+=1)(function(){var ta=tg[tx],tc=ta.featureIndex.lookupSymbolFeatures(ty[ta.bucketInstanceId],ti,ta.bucketIndex,ta.sourceLayerIndex,th.filter,th.layers,th.availableImages,tt);for(var tf in tc){var td=tm[tf]=tm[tf]||[],t_=tc[tf];t_.sort(function(tt,ti){var tc=ta.featureSortOrder;if(tc){var th=tc.indexOf(tt.featureIndex);return tc.indexOf(ti.featureIndex)-th}return ti.featureIndex-tt.featureIndex});for(var tv=0;tv<t_.length;tv+=1)td.push(t_[tv])}})();var f=function(ti){tm[ti].forEach(function(tc){var th=tc.feature,tf=ta[tt[ti].source].getFeatureState(th.layer["source-layer"],th.id);th.source=th.layer.source,th.layer["source-layer"]&&(th.sourceLayer=th.layer["source-layer"]),th.state=tf})};for(var tb in tm)f(tb);return tm}(this._layers,this._serializedLayers,this.sourceCaches,ti,ta,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(tg)},i.prototype.querySourceFeatures=function(ti,ta){ta&&ta.filter&&this._validate(tt.validateStyle.filter,"querySourceFeatures.filter",ta.filter,null,ta);var tc=this.sourceCaches[ti];return tc?function(tt,ti){for(var ta=tt.getRenderableIds().map(function(ti){return tt.getTileByID(ti)}),tc=[],th={},tf=0;tf<ta.length;tf++){var td=ta[tf],tm=td.tileID.canonical.key;th[tm]||(th[tm]=!0,td.querySourceFeatures(tc,ti))}return tc}(tc,ta):[]},i.prototype.addSourceType=function(tt,ti,ta){return i.getSourceType(tt)?ta(Error('A source type called "'+tt+'" already exists.')):(i.setSourceType(tt,ti),ti.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:tt,url:ti.workerSourceURL},ta):ta(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(ti,ta){void 0===ta&&(ta={}),this._checkLoaded();var tc=this.light.getLight(),th=!1;for(var tf in ti)if(!tt.deepEqual(ti[tf],tc[tf])){th=!0;break}if(th){var td={now:tt.browser.now(),transition:tt.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(ti,ta),this.light.updateTransitions(td)}},i.prototype._validate=function(ti,ta,tc,th,tf){return void 0===tf&&(tf={}),(!tf||!1!==tf.validate)&&Ue(this,ti.call(tt.validateStyle,tt.extend({key:ta,style:this.serialize(),value:tc,styleSpec:tt.styleSpec},th)))},i.prototype._remove=function(){for(var ti in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),tt.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[ti].setEventedParent(null);for(var ta in this.sourceCaches)this.sourceCaches[ta].clearTiles(),this.sourceCaches[ta].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},i.prototype._clearSource=function(tt){this.sourceCaches[tt].clearTiles()},i.prototype._reloadSource=function(tt){this.sourceCaches[tt].resume(),this.sourceCaches[tt].reload()},i.prototype._updateSources=function(tt){for(var ti in this.sourceCaches)this.sourceCaches[ti].update(tt)},i.prototype._generateCollisionBoxes=function(){for(var tt in this.sourceCaches)this._reloadSource(tt)},i.prototype._updatePlacement=function(ti,ta,tc,th,tf){void 0===tf&&(tf=!1);for(var td=!1,tm=!1,ty={},tg=0,t_=this._order;tg<t_.length;tg+=1){var tv=this._layers[t_[tg]];if("symbol"===tv.type){if(!ty[tv.source]){var tx=this.sourceCaches[tv.source];ty[tv.source]=tx.getRenderableIds(!0).map(function(tt){return tx.getTileByID(tt)}).sort(function(tt,ti){return ti.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(ti.tileID)?-1:1)})}var tb=this.crossTileSymbolIndex.addLayer(tv,ty[tv.source],ti.center.lng);td=td||tb}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((tf=tf||this._layerOrderChanged||0===tc)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(tt.browser.now(),ti.zoom))&&(this.pauseablePlacement=new Le(ti,this._order,tf,ta,tc,th,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ty),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(tt.browser.now()),tm=!0),td&&this.pauseablePlacement.placement.setStale()),tm||td)for(var tw=0,tS=this._order;tw<tS.length;tw+=1){var tT=this._layers[tS[tw]];"symbol"===tT.type&&this.placement.updateLayerOpacities(tT,ty[tT.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(tt.browser.now())},i.prototype._releaseSymbolFadeTiles=function(){for(var tt in this.sourceCaches)this.sourceCaches[tt].releaseSymbolFadeTiles()},i.prototype.getImages=function(tt,ti,ta){this.imageManager.getImages(ti.icons,ta),this._updateTilesForChangedImages();var tc=this.sourceCaches[ti.source];tc&&tc.setDependencies(ti.tileID.key,ti.type,ti.icons)},i.prototype.getGlyphs=function(tt,ti,ta){this.glyphManager.getGlyphs(ti.stacks,ta)},i.prototype.getResource=function(ti,ta,tc){return tt.makeRequest(ta,tc)},i}(tt.Evented);ew.getSourceType=function(tt){return tC[tt]},ew.setSourceType=function(tt,ti){tC[tt]=ti},ew.registerForPluginStateChange=tt.registerForPluginStateChange;var eS=tt.createLayout([{name:"a_pos",type:"Int16",components:2}]),eT=gi("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}");function gi(tt,ti){var ta=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,tc=ti.match(/attribute ([\w]+) ([\w]+)/g),th=tt.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),tf=ti.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),td=tf?tf.concat(th):th,tm={};return{fragmentSource:tt=tt.replace(ta,function(tt,ti,ta,tc,th){return tm[th]=!0,"define"===ti?"\n#ifndef HAS_UNIFORM_u_"+th+"\nvarying "+ta+" "+tc+" "+th+";\n#else\nuniform "+ta+" "+tc+" u_"+th+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+th+"\n    "+ta+" "+tc+" "+th+" = u_"+th+";\n#endif\n"}),vertexSource:ti=ti.replace(ta,function(tt,ti,ta,tc,th){var tf="float"===tc?"vec2":"vec4",td=th.match(/color/)?"color":tf;return tm[th]?"define"===ti?"\n#ifndef HAS_UNIFORM_u_"+th+"\nuniform lowp float u_"+th+"_t;\nattribute "+ta+" "+tf+" a_"+th+";\nvarying "+ta+" "+tc+" "+th+";\n#else\nuniform "+ta+" "+tc+" u_"+th+";\n#endif\n":"vec4"===td?"\n#ifndef HAS_UNIFORM_u_"+th+"\n    "+th+" = a_"+th+";\n#else\n    "+ta+" "+tc+" "+th+" = u_"+th+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+th+"\n    "+th+" = unpack_mix_"+td+"(a_"+th+", u_"+th+"_t);\n#else\n    "+ta+" "+tc+" "+th+" = u_"+th+";\n#endif\n":"define"===ti?"\n#ifndef HAS_UNIFORM_u_"+th+"\nuniform lowp float u_"+th+"_t;\nattribute "+ta+" "+tf+" a_"+th+";\n#else\nuniform "+ta+" "+tc+" u_"+th+";\n#endif\n":"vec4"===td?"\n#ifndef HAS_UNIFORM_u_"+th+"\n    "+ta+" "+tc+" "+th+" = a_"+th+";\n#else\n    "+ta+" "+tc+" "+th+" = u_"+th+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+th+"\n    "+ta+" "+tc+" "+th+" = unpack_mix_"+td+"(a_"+th+", u_"+th+"_t);\n#else\n    "+ta+" "+tc+" "+th+" = u_"+th+";\n#endif\n"}),staticAttributes:tc,staticUniforms:td}}var eI=Object.freeze({__proto__:null,prelude:eT,background:gi("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:gi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gi("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:gi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:gi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:gi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:gi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:gi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:gi("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:gi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:gi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:gi("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:gi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:gi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:gi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:gi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:gi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:gi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:gi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")}),yi=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xi(tt){for(var ti=[],ta=0;ta<tt.length;ta++)if(null!==tt[ta]){var tc=tt[ta].split(" ");ti.push(tc.pop())}return ti}yi.prototype.bind=function(tt,ti,ta,tc,th,tf,td,tm){this.context=tt;for(var ty=this.boundPaintVertexBuffers.length!==tc.length,tg=0;!ty&&tg<tc.length;tg++)this.boundPaintVertexBuffers[tg]!==tc[tg]&&(ty=!0);tt.extVertexArrayObject&&this.vao&&this.boundProgram===ti&&this.boundLayoutVertexBuffer===ta&&!ty&&this.boundIndexBuffer===th&&this.boundVertexOffset===tf&&this.boundDynamicVertexBuffer===td&&this.boundDynamicVertexBuffer2===tm?(tt.bindVertexArrayOES.set(this.vao),td&&td.bind(),th&&th.dynamicDraw&&th.bind(),tm&&tm.bind()):this.freshBind(ti,ta,tc,th,tf,td,tm)},yi.prototype.freshBind=function(tt,ti,ta,tc,th,tf,td){var tm,ty=tt.numAttributes,tg=this.context,t_=tg.gl;if(tg.extVertexArrayObject)this.vao&&this.destroy(),this.vao=tg.extVertexArrayObject.createVertexArrayOES(),tg.bindVertexArrayOES.set(this.vao),tm=0,this.boundProgram=tt,this.boundLayoutVertexBuffer=ti,this.boundPaintVertexBuffers=ta,this.boundIndexBuffer=tc,this.boundVertexOffset=th,this.boundDynamicVertexBuffer=tf,this.boundDynamicVertexBuffer2=td;else{tm=tg.currentNumAttributes||0;for(var tv=ty;tv<tm;tv++)t_.disableVertexAttribArray(tv)}ti.enableAttributes(t_,tt);for(var tx=0;tx<ta.length;tx+=1)ta[tx].enableAttributes(t_,tt);tf&&tf.enableAttributes(t_,tt),td&&td.enableAttributes(t_,tt),ti.bind(),ti.setVertexAttribPointers(t_,tt,th);for(var tb=0;tb<ta.length;tb+=1){var tw=ta[tb];tw.bind(),tw.setVertexAttribPointers(t_,tt,th)}tf&&(tf.bind(),tf.setVertexAttribPointers(t_,tt,th)),tc&&tc.bind(),td&&(td.bind(),td.setVertexAttribPointers(t_,tt,th)),tg.currentNumAttributes=ty},yi.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var bi=function(tt,ti,ta,tc,th,tf){var td=tt.gl;this.program=td.createProgram();for(var tm=xi(ta.staticAttributes),ty=tc?tc.getBinderAttributes():[],tg=tm.concat(ty),t_=ta.staticUniforms?xi(ta.staticUniforms):[],tv=tc?tc.getBinderUniforms():[],tx=[],tb=0,tw=t_.concat(tv);tb<tw.length;tb+=1){var tS=tw[tb];0>tx.indexOf(tS)&&tx.push(tS)}var tT=tc?tc.defines():[];tf&&tT.push("#define OVERDRAW_INSPECTOR;");var tI=tT.concat(eT.fragmentSource,ta.fragmentSource).join("\n"),tE=tT.concat(eT.vertexSource,ta.vertexSource).join("\n"),tA=td.createShader(td.FRAGMENT_SHADER);if(td.isContextLost())this.failedToCreate=!0;else{td.shaderSource(tA,tI),td.compileShader(tA),td.attachShader(this.program,tA);var tP=td.createShader(td.VERTEX_SHADER);if(td.isContextLost())this.failedToCreate=!0;else{td.shaderSource(tP,tE),td.compileShader(tP),td.attachShader(this.program,tP),this.attributes={};var tz={};this.numAttributes=tg.length;for(var tC=0;tC<this.numAttributes;tC++)tg[tC]&&(td.bindAttribLocation(this.program,tC,tg[tC]),this.attributes[tg[tC]]=tC);td.linkProgram(this.program),td.deleteShader(tP),td.deleteShader(tA);for(var tk=0;tk<tx.length;tk++){var tM=tx[tk];if(tM&&!tz[tM]){var tD=td.getUniformLocation(this.program,tM);tD&&(tz[tM]=tD)}}this.fixedUniforms=th(tt,tz),this.binderUniforms=tc?tc.getUniforms(tt,tz):[]}}};function wi(tt,ti,ta){var tc=1/pe(ta,1,ti.transform.tileZoom),th=Math.pow(2,ta.tileID.overscaledZ),tf=ta.tileSize*Math.pow(2,ti.transform.tileZoom)/th,td=tf*(ta.tileID.canonical.x+ta.tileID.wrap*th),tm=tf*ta.tileID.canonical.y;return{u_image:0,u_texsize:ta.imageAtlasTexture.size,u_scale:[tc,tt.fromScale,tt.toScale],u_fade:tt.t,u_pixel_coord_upper:[td>>16,tm>>16],u_pixel_coord_lower:[65535&td,65535&tm]}}bi.prototype.draw=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx,tb,tw,tS){var tT,tI=tt.gl;if(!this.failedToCreate){for(var tE in tt.program.set(this.program),tt.setDepthMode(ta),tt.setStencilMode(tc),tt.setColorMode(th),tt.setCullFace(tf),this.fixedUniforms)this.fixedUniforms[tE].set(td[tE]);tb&&tb.setUniforms(tt,this.binderUniforms,tv,{zoom:tx});for(var tA=((tT={})[tI.LINES]=2,tT[tI.TRIANGLES]=3,tT[tI.LINE_STRIP]=1,tT)[ti],tP=0,tz=t_.get();tP<tz.length;tP+=1){var tC=tz[tP],tk=tC.vaos||(tC.vaos={});(tk[tm]||(tk[tm]=new yi)).bind(tt,this,ty,tb?tb.getPaintVertexBuffers():[],tg,tC.vertexOffset,tw,tS),tI.drawElements(ti,tC.primitiveLength*tA,tI.UNSIGNED_SHORT,tC.primitiveOffset*tA*2)}}};var Ti=function(ti,ta,tc,th){var tf=ta.style.light,td=tf.properties.get("position"),tm=[td.x,td.y,td.z],ty=tt.create$1();"viewport"===tf.properties.get("anchor")&&tt.fromRotation(ty,-ta.transform.angle),tt.transformMat3(tm,tm,ty);var tg=tf.properties.get("color");return{u_matrix:ti,u_lightpos:tm,u_lightintensity:tf.properties.get("intensity"),u_lightcolor:[tg.r,tg.g,tg.b],u_vertical_gradient:+tc,u_opacity:th}},Ii=function(tt){return{u_matrix:tt}},Pi=function(ti,ta,tc,th){return tt.extend(Ii(ti),wi(tc,ta,th))},zi=function(ti,ta,tc,th){var tf,td,tm=ti.transform;if("map"===th.paint.get("circle-pitch-alignment")){var ty=pe(tc,1,tm.zoom);tf=!0,td=[ty,ty]}else tf=!1,td=tm.pixelsToGLUnits;return{u_camera_to_center_distance:tm.cameraToCenterDistance,u_scale_with_map:+("map"===th.paint.get("circle-pitch-scale")),u_matrix:ti.translatePosMatrix(ta.posMatrix,tc,th.paint.get("circle-translate"),th.paint.get("circle-translate-anchor")),u_pitch_with_map:+tf,u_device_pixel_ratio:tt.browser.devicePixelRatio,u_extrude_scale:td}},Di=function(tt,ti,ta){var tc=pe(ta,1,ti.zoom),th=Math.pow(2,ti.zoom-ta.tileID.overscaledZ),tf=ta.tileID.overscaleFactor();return{u_matrix:tt,u_camera_to_center_distance:ti.cameraToCenterDistance,u_pixels_to_tile_units:tc,u_extrude_scale:[ti.pixelsToGLUnits[0]/(tc*th),ti.pixelsToGLUnits[1]/(tc*th)],u_overscale_factor:tf}},Mi=function(tt,ti,ta){return void 0===ta&&(ta=1),{u_matrix:tt,u_color:ti,u_overlay:0,u_overlay_scale:ta}},Li=function(tt){return{u_matrix:tt}},ki=function(ti,ta,tc){var th=ti.transform;return{u_matrix:Ni(ti,ta,tc),u_ratio:1/pe(ta,1,th.zoom),u_device_pixel_ratio:tt.browser.devicePixelRatio,u_units_to_pixels:[1/th.pixelsToGLUnits[0],1/th.pixelsToGLUnits[1]]}},Oi=function(ti,ta,tc,th){var tf=ti.transform,td=Ui(ta,tf);return{u_matrix:Ni(ti,ta,tc),u_texsize:ta.imageAtlasTexture.size,u_ratio:1/pe(ta,1,tf.zoom),u_device_pixel_ratio:tt.browser.devicePixelRatio,u_image:0,u_scale:[td,th.fromScale,th.toScale],u_fade:th.t,u_units_to_pixels:[1/tf.pixelsToGLUnits[0],1/tf.pixelsToGLUnits[1]]}},Fi=function(ti,ta,tc,th,tf){var td=ti.lineAtlas,tm=Ui(ta,ti.transform),ty="round"===tc.layout.get("line-cap"),tg=td.getDash(th.from,ty),t_=td.getDash(th.to,ty),tv=tg.width*tf.fromScale,tx=t_.width*tf.toScale;return tt.extend(ki(ti,ta,tc),{u_patternscale_a:[tm/tv,-tg.height/2],u_patternscale_b:[tm/tx,-t_.height/2],u_sdfgamma:td.width/(256*Math.min(tv,tx)*tt.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:tg.y,u_tex_y_b:t_.y,u_mix:tf.t})};function Ui(tt,ti){return 1/pe(tt,1,ti.tileZoom)}function Ni(tt,ti,ta){return tt.translatePosMatrix(ti.tileID.posMatrix,ti,ta.paint.get("line-translate"),ta.paint.get("line-translate-anchor"))}var Zi=function(tt,ti,ta,tc,th){var tf,td;return{u_matrix:tt,u_tl_parent:ti,u_scale_parent:ta,u_buffer_scale:1,u_fade_t:tc.mix,u_opacity:tc.opacity*th.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:th.paint.get("raster-brightness-min"),u_brightness_high:th.paint.get("raster-brightness-max"),u_saturation_factor:(td=th.paint.get("raster-saturation"))>0?1-1/(1.001-td):-td,u_contrast_factor:(tf=th.paint.get("raster-contrast"))>0?1/(1-tf):1+tf,u_spin_weights:qi(th.paint.get("raster-hue-rotate"))}};function qi(tt){var ti=Math.sin(tt*=Math.PI/180),ta=Math.cos(tt);return[(2*ta+1)/3,(-Math.sqrt(3)*ti-ta+1)/3,(Math.sqrt(3)*ti-ta+1)/3]}var eE,Vi=function(tt,ti,ta,tc,th,tf,td,tm,ty,tg){var t_=th.transform;return{u_is_size_zoom_constant:+("constant"===tt||"source"===tt),u_is_size_feature_constant:+("constant"===tt||"camera"===tt),u_size_t:ti?ti.uSizeT:0,u_size:ti?ti.uSize:0,u_camera_to_center_distance:t_.cameraToCenterDistance,u_pitch:t_.pitch/360*2*Math.PI,u_rotate_symbol:+ta,u_aspect_ratio:t_.width/t_.height,u_fade_change:th.options.fadeDuration?th.symbolFadeChange:1,u_matrix:tf,u_label_plane_matrix:td,u_coord_matrix:tm,u_is_text:+ty,u_pitch_with_map:+tc,u_texsize:tg,u_texture:0}},Gi=function(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv){var tx=tf.transform;return tt.extend(Vi(ti,ta,tc,th,tf,td,tm,ty,tg,t_),{u_gamma_scale:th?Math.cos(tx._pitch)*tx.cameraToCenterDistance:1,u_device_pixel_ratio:tt.browser.devicePixelRatio,u_is_halo:+tv})},Hi=function(ti,ta,tc,th,tf,td){var tm,ty,tg,t_,tv,tx,tb,tw,tS;return tt.extend((tm=tc.imageManager.getPattern(th.from.toString()),ty=tc.imageManager.getPattern(th.to.toString()),t_=(tg=tc.imageManager.getPixelSize()).width,tv=tg.height,tx=Math.pow(2,tf.tileID.overscaledZ),tw=(tb=tf.tileSize*Math.pow(2,tc.transform.tileZoom)/tx)*(tf.tileID.canonical.x+tf.tileID.wrap*tx),tS=tb*tf.tileID.canonical.y,{u_image:0,u_pattern_tl_a:tm.tl,u_pattern_br_a:tm.br,u_pattern_tl_b:ty.tl,u_pattern_br_b:ty.br,u_texsize:[t_,tv],u_mix:td.t,u_pattern_size_a:tm.displaySize,u_pattern_size_b:ty.displaySize,u_scale_a:td.fromScale,u_scale_b:td.toScale,u_tile_units_to_pixels:1/pe(tf,1,tc.transform.tileZoom),u_pixel_coord_upper:[tw>>16,tS>>16],u_pixel_coord_lower:[65535&tw,65535&tS]}),{u_matrix:ti,u_opacity:ta})},eA={fillExtrusion:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_lightpos:new tt.Uniform3f(ti,ta.u_lightpos),u_lightintensity:new tt.Uniform1f(ti,ta.u_lightintensity),u_lightcolor:new tt.Uniform3f(ti,ta.u_lightcolor),u_vertical_gradient:new tt.Uniform1f(ti,ta.u_vertical_gradient),u_opacity:new tt.Uniform1f(ti,ta.u_opacity)}},fillExtrusionPattern:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_lightpos:new tt.Uniform3f(ti,ta.u_lightpos),u_lightintensity:new tt.Uniform1f(ti,ta.u_lightintensity),u_lightcolor:new tt.Uniform3f(ti,ta.u_lightcolor),u_vertical_gradient:new tt.Uniform1f(ti,ta.u_vertical_gradient),u_height_factor:new tt.Uniform1f(ti,ta.u_height_factor),u_image:new tt.Uniform1i(ti,ta.u_image),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_pixel_coord_upper:new tt.Uniform2f(ti,ta.u_pixel_coord_upper),u_pixel_coord_lower:new tt.Uniform2f(ti,ta.u_pixel_coord_lower),u_scale:new tt.Uniform3f(ti,ta.u_scale),u_fade:new tt.Uniform1f(ti,ta.u_fade),u_opacity:new tt.Uniform1f(ti,ta.u_opacity)}},fill:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix)}},fillPattern:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_image:new tt.Uniform1i(ti,ta.u_image),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_pixel_coord_upper:new tt.Uniform2f(ti,ta.u_pixel_coord_upper),u_pixel_coord_lower:new tt.Uniform2f(ti,ta.u_pixel_coord_lower),u_scale:new tt.Uniform3f(ti,ta.u_scale),u_fade:new tt.Uniform1f(ti,ta.u_fade)}},fillOutline:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_world:new tt.Uniform2f(ti,ta.u_world)}},fillOutlinePattern:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_world:new tt.Uniform2f(ti,ta.u_world),u_image:new tt.Uniform1i(ti,ta.u_image),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_pixel_coord_upper:new tt.Uniform2f(ti,ta.u_pixel_coord_upper),u_pixel_coord_lower:new tt.Uniform2f(ti,ta.u_pixel_coord_lower),u_scale:new tt.Uniform3f(ti,ta.u_scale),u_fade:new tt.Uniform1f(ti,ta.u_fade)}},circle:function(ti,ta){return{u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_scale_with_map:new tt.Uniform1i(ti,ta.u_scale_with_map),u_pitch_with_map:new tt.Uniform1i(ti,ta.u_pitch_with_map),u_extrude_scale:new tt.Uniform2f(ti,ta.u_extrude_scale),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix)}},collisionBox:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_pixels_to_tile_units:new tt.Uniform1f(ti,ta.u_pixels_to_tile_units),u_extrude_scale:new tt.Uniform2f(ti,ta.u_extrude_scale),u_overscale_factor:new tt.Uniform1f(ti,ta.u_overscale_factor)}},collisionCircle:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_inv_matrix:new tt.UniformMatrix4f(ti,ta.u_inv_matrix),u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_viewport_size:new tt.Uniform2f(ti,ta.u_viewport_size)}},debug:function(ti,ta){return{u_color:new tt.UniformColor(ti,ta.u_color),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_overlay:new tt.Uniform1i(ti,ta.u_overlay),u_overlay_scale:new tt.Uniform1f(ti,ta.u_overlay_scale)}},clippingMask:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix)}},heatmap:function(ti,ta){return{u_extrude_scale:new tt.Uniform1f(ti,ta.u_extrude_scale),u_intensity:new tt.Uniform1f(ti,ta.u_intensity),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix)}},heatmapTexture:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_world:new tt.Uniform2f(ti,ta.u_world),u_image:new tt.Uniform1i(ti,ta.u_image),u_color_ramp:new tt.Uniform1i(ti,ta.u_color_ramp),u_opacity:new tt.Uniform1f(ti,ta.u_opacity)}},hillshade:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_image:new tt.Uniform1i(ti,ta.u_image),u_latrange:new tt.Uniform2f(ti,ta.u_latrange),u_light:new tt.Uniform2f(ti,ta.u_light),u_shadow:new tt.UniformColor(ti,ta.u_shadow),u_highlight:new tt.UniformColor(ti,ta.u_highlight),u_accent:new tt.UniformColor(ti,ta.u_accent)}},hillshadePrepare:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_image:new tt.Uniform1i(ti,ta.u_image),u_dimension:new tt.Uniform2f(ti,ta.u_dimension),u_zoom:new tt.Uniform1f(ti,ta.u_zoom),u_unpack:new tt.Uniform4f(ti,ta.u_unpack)}},line:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_ratio:new tt.Uniform1f(ti,ta.u_ratio),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_units_to_pixels:new tt.Uniform2f(ti,ta.u_units_to_pixels)}},lineGradient:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_ratio:new tt.Uniform1f(ti,ta.u_ratio),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_units_to_pixels:new tt.Uniform2f(ti,ta.u_units_to_pixels),u_image:new tt.Uniform1i(ti,ta.u_image),u_image_height:new tt.Uniform1f(ti,ta.u_image_height)}},linePattern:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_ratio:new tt.Uniform1f(ti,ta.u_ratio),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_image:new tt.Uniform1i(ti,ta.u_image),u_units_to_pixels:new tt.Uniform2f(ti,ta.u_units_to_pixels),u_scale:new tt.Uniform3f(ti,ta.u_scale),u_fade:new tt.Uniform1f(ti,ta.u_fade)}},lineSDF:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_ratio:new tt.Uniform1f(ti,ta.u_ratio),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_units_to_pixels:new tt.Uniform2f(ti,ta.u_units_to_pixels),u_patternscale_a:new tt.Uniform2f(ti,ta.u_patternscale_a),u_patternscale_b:new tt.Uniform2f(ti,ta.u_patternscale_b),u_sdfgamma:new tt.Uniform1f(ti,ta.u_sdfgamma),u_image:new tt.Uniform1i(ti,ta.u_image),u_tex_y_a:new tt.Uniform1f(ti,ta.u_tex_y_a),u_tex_y_b:new tt.Uniform1f(ti,ta.u_tex_y_b),u_mix:new tt.Uniform1f(ti,ta.u_mix)}},raster:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_tl_parent:new tt.Uniform2f(ti,ta.u_tl_parent),u_scale_parent:new tt.Uniform1f(ti,ta.u_scale_parent),u_buffer_scale:new tt.Uniform1f(ti,ta.u_buffer_scale),u_fade_t:new tt.Uniform1f(ti,ta.u_fade_t),u_opacity:new tt.Uniform1f(ti,ta.u_opacity),u_image0:new tt.Uniform1i(ti,ta.u_image0),u_image1:new tt.Uniform1i(ti,ta.u_image1),u_brightness_low:new tt.Uniform1f(ti,ta.u_brightness_low),u_brightness_high:new tt.Uniform1f(ti,ta.u_brightness_high),u_saturation_factor:new tt.Uniform1f(ti,ta.u_saturation_factor),u_contrast_factor:new tt.Uniform1f(ti,ta.u_contrast_factor),u_spin_weights:new tt.Uniform3f(ti,ta.u_spin_weights)}},symbolIcon:function(ti,ta){return{u_is_size_zoom_constant:new tt.Uniform1i(ti,ta.u_is_size_zoom_constant),u_is_size_feature_constant:new tt.Uniform1i(ti,ta.u_is_size_feature_constant),u_size_t:new tt.Uniform1f(ti,ta.u_size_t),u_size:new tt.Uniform1f(ti,ta.u_size),u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_pitch:new tt.Uniform1f(ti,ta.u_pitch),u_rotate_symbol:new tt.Uniform1i(ti,ta.u_rotate_symbol),u_aspect_ratio:new tt.Uniform1f(ti,ta.u_aspect_ratio),u_fade_change:new tt.Uniform1f(ti,ta.u_fade_change),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_label_plane_matrix:new tt.UniformMatrix4f(ti,ta.u_label_plane_matrix),u_coord_matrix:new tt.UniformMatrix4f(ti,ta.u_coord_matrix),u_is_text:new tt.Uniform1i(ti,ta.u_is_text),u_pitch_with_map:new tt.Uniform1i(ti,ta.u_pitch_with_map),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_texture:new tt.Uniform1i(ti,ta.u_texture)}},symbolSDF:function(ti,ta){return{u_is_size_zoom_constant:new tt.Uniform1i(ti,ta.u_is_size_zoom_constant),u_is_size_feature_constant:new tt.Uniform1i(ti,ta.u_is_size_feature_constant),u_size_t:new tt.Uniform1f(ti,ta.u_size_t),u_size:new tt.Uniform1f(ti,ta.u_size),u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_pitch:new tt.Uniform1f(ti,ta.u_pitch),u_rotate_symbol:new tt.Uniform1i(ti,ta.u_rotate_symbol),u_aspect_ratio:new tt.Uniform1f(ti,ta.u_aspect_ratio),u_fade_change:new tt.Uniform1f(ti,ta.u_fade_change),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_label_plane_matrix:new tt.UniformMatrix4f(ti,ta.u_label_plane_matrix),u_coord_matrix:new tt.UniformMatrix4f(ti,ta.u_coord_matrix),u_is_text:new tt.Uniform1i(ti,ta.u_is_text),u_pitch_with_map:new tt.Uniform1i(ti,ta.u_pitch_with_map),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_texture:new tt.Uniform1i(ti,ta.u_texture),u_gamma_scale:new tt.Uniform1f(ti,ta.u_gamma_scale),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_is_halo:new tt.Uniform1i(ti,ta.u_is_halo)}},symbolTextAndIcon:function(ti,ta){return{u_is_size_zoom_constant:new tt.Uniform1i(ti,ta.u_is_size_zoom_constant),u_is_size_feature_constant:new tt.Uniform1i(ti,ta.u_is_size_feature_constant),u_size_t:new tt.Uniform1f(ti,ta.u_size_t),u_size:new tt.Uniform1f(ti,ta.u_size),u_camera_to_center_distance:new tt.Uniform1f(ti,ta.u_camera_to_center_distance),u_pitch:new tt.Uniform1f(ti,ta.u_pitch),u_rotate_symbol:new tt.Uniform1i(ti,ta.u_rotate_symbol),u_aspect_ratio:new tt.Uniform1f(ti,ta.u_aspect_ratio),u_fade_change:new tt.Uniform1f(ti,ta.u_fade_change),u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_label_plane_matrix:new tt.UniformMatrix4f(ti,ta.u_label_plane_matrix),u_coord_matrix:new tt.UniformMatrix4f(ti,ta.u_coord_matrix),u_is_text:new tt.Uniform1i(ti,ta.u_is_text),u_pitch_with_map:new tt.Uniform1i(ti,ta.u_pitch_with_map),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_texsize_icon:new tt.Uniform2f(ti,ta.u_texsize_icon),u_texture:new tt.Uniform1i(ti,ta.u_texture),u_texture_icon:new tt.Uniform1i(ti,ta.u_texture_icon),u_gamma_scale:new tt.Uniform1f(ti,ta.u_gamma_scale),u_device_pixel_ratio:new tt.Uniform1f(ti,ta.u_device_pixel_ratio),u_is_halo:new tt.Uniform1i(ti,ta.u_is_halo)}},background:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_opacity:new tt.Uniform1f(ti,ta.u_opacity),u_color:new tt.UniformColor(ti,ta.u_color)}},backgroundPattern:function(ti,ta){return{u_matrix:new tt.UniformMatrix4f(ti,ta.u_matrix),u_opacity:new tt.Uniform1f(ti,ta.u_opacity),u_image:new tt.Uniform1i(ti,ta.u_image),u_pattern_tl_a:new tt.Uniform2f(ti,ta.u_pattern_tl_a),u_pattern_br_a:new tt.Uniform2f(ti,ta.u_pattern_br_a),u_pattern_tl_b:new tt.Uniform2f(ti,ta.u_pattern_tl_b),u_pattern_br_b:new tt.Uniform2f(ti,ta.u_pattern_br_b),u_texsize:new tt.Uniform2f(ti,ta.u_texsize),u_mix:new tt.Uniform1f(ti,ta.u_mix),u_pattern_size_a:new tt.Uniform2f(ti,ta.u_pattern_size_a),u_pattern_size_b:new tt.Uniform2f(ti,ta.u_pattern_size_b),u_scale_a:new tt.Uniform1f(ti,ta.u_scale_a),u_scale_b:new tt.Uniform1f(ti,ta.u_scale_b),u_pixel_coord_upper:new tt.Uniform2f(ti,ta.u_pixel_coord_upper),u_pixel_coord_lower:new tt.Uniform2f(ti,ta.u_pixel_coord_lower),u_tile_units_to_pixels:new tt.Uniform1f(ti,ta.u_tile_units_to_pixels)}}};function Yi(ti,ta,tc,th,tf,td,tm){for(var ty=ti.context,tg=ty.gl,t_=ti.useProgram("collisionBox"),tv=[],tx=0,tb=0,tw=0;tw<th.length;tw++){var tS=th[tw],tT=ta.getTile(tS),tI=tT.getBucket(tc);if(tI){var tE=tS.posMatrix;0===tf[0]&&0===tf[1]||(tE=ti.translatePosMatrix(tS.posMatrix,tT,tf,td));var tA=tm?tI.textCollisionBox:tI.iconCollisionBox,tP=tI.collisionCircleArray;if(tP.length>0){var tz=tt.create(),tC=tE;tt.mul(tz,tI.placementInvProjMatrix,ti.transform.glCoordMatrix),tt.mul(tz,tz,tI.placementViewportMatrix),tv.push({circleArray:tP,circleOffset:tb,transform:tC,invTransform:tz}),tb=tx+=tP.length/4}tA&&t_.draw(ty,tg.LINES,It.disabled,Pt.disabled,ti.colorModeForRenderPass(),Ct.disabled,Di(tE,ti.transform,tT),tc.id,tA.layoutVertexBuffer,tA.indexBuffer,tA.segments,null,ti.transform.zoom,null,null,tA.collisionVertexBuffer)}}if(tm&&tv.length){var tk=ti.useProgram("collisionCircle"),tM=new tt.StructArrayLayout2f1f2i16;tM.resize(4*tx),tM._trim();for(var tD=0,tL=0;tL<tv.length;tL+=1)for(var tB=tv[tL],tR=0;tR<tB.circleArray.length/4;tR++){var tO=4*tR,tF=tB.circleArray[tO+0],tU=tB.circleArray[tO+1],tV=tB.circleArray[tO+2],tN=tB.circleArray[tO+3];tM.emplace(tD++,tF,tU,tV,tN,0),tM.emplace(tD++,tF,tU,tV,tN,1),tM.emplace(tD++,tF,tU,tV,tN,2),tM.emplace(tD++,tF,tU,tV,tN,3)}(!eE||eE.length<2*tx)&&(eE=function(ti){var ta=2*ti,tc=new tt.StructArrayLayout3ui6;tc.resize(ta),tc._trim();for(var th=0;th<ta;th++){var tf=6*th;tc.uint16[tf+0]=4*th+0,tc.uint16[tf+1]=4*th+1,tc.uint16[tf+2]=4*th+2,tc.uint16[tf+3]=4*th+2,tc.uint16[tf+4]=4*th+3,tc.uint16[tf+5]=4*th+0}return tc}(tx));for(var tj=ty.createIndexBuffer(eE,!0),tq=ty.createVertexBuffer(tM,tt.collisionCircleLayout.members,!0),tZ=0;tZ<tv.length;tZ+=1){var tG,tX=tv[tZ],tW={u_matrix:tX.transform,u_inv_matrix:tX.invTransform,u_camera_to_center_distance:(tG=ti.transform).cameraToCenterDistance,u_viewport_size:[tG.width,tG.height]};tk.draw(ty,tg.TRIANGLES,It.disabled,Pt.disabled,ti.colorModeForRenderPass(),Ct.disabled,tW,tc.id,tq,tj,tt.SegmentVector.simpleSegment(0,2*tX.circleOffset,tX.circleArray.length,tX.circleArray.length/2),null,ti.transform.zoom,null,null,null)}tq.destroy(),tj.destroy()}}var eP=tt.identity(new Float32Array(16));function Qi(ti,ta,tc,th,tf,td){var tm=tt.getAnchorAlignment(ti),ty=-(tm.horizontalAlign-.5)*ta,tg=-(tm.verticalAlign-.5)*tc,t_=tt.evaluateVariableOffset(ti,th);return new tt.Point((ty/tf+t_[0])*td,(tg/tf+t_[1])*td)}function $i(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv){var tx=ti.text.placedSymbolArray,tb=ti.text.dynamicLayoutVertexArray,tw=ti.icon.dynamicLayoutVertexArray,tS={};tb.clear();for(var tT=0;tT<tx.length;tT++){var tI=tx.get(tT),tE=tI.hidden||!tI.crossTileID||ti.allowVerticalPlacement&&!tI.placedOrientation?null:th[tI.crossTileID];if(tE){var tA=new tt.Point(tI.anchorX,tI.anchorY),tP=$t(tA,tc?ty:tm),tz=te(td.cameraToCenterDistance,tP.signedDistanceFromCamera),tC=tf.evaluateSizeForFeature(ti.textSizeData,t_,tI)*tz/tt.ONE_EM;tc&&(tC*=ti.tilePixelRatio/tg);for(var tk=Qi(tE.anchor,tE.width,tE.height,tE.textOffset,tE.textBoxScale,tC),tM=tc?$t(tA.add(tk),tm).point:tP.point.add(ta?tk.rotate(-td.angle):tk),tD=ti.allowVerticalPlacement&&tI.placedOrientation===tt.WritingMode.vertical?Math.PI/2:0,tL=0;tL<tI.numGlyphs;tL++)tt.addDynamicAttributes(tb,tM,tD);tv&&tI.associatedIconIndex>=0&&(tS[tI.associatedIconIndex]={shiftedAnchor:tM,angle:tD})}else ce(tI.numGlyphs,tb)}if(tv){tw.clear();for(var tB=ti.icon.placedSymbolArray,tR=0;tR<tB.length;tR++){var tO=tB.get(tR);if(tO.hidden)ce(tO.numGlyphs,tw);else{var tF=tS[tR];if(tF)for(var tU=0;tU<tO.numGlyphs;tU++)tt.addDynamicAttributes(tw,tF.shiftedAnchor,tF.angle);else ce(tO.numGlyphs,tw)}}ti.icon.dynamicLayoutVertexBuffer.updateData(tw)}ti.text.dynamicLayoutVertexBuffer.updateData(tb)}function to(tt,ti,ta){return ta.iconsInText&&ti?"symbolTextAndIcon":tt?"symbolSDF":"symbolIcon"}function eo(ti,ta,tc,th,tf,td,tm,ty,tg,t_,tv,tx){for(var tb=ti.context,tw=tb.gl,tS=ti.transform,tT="map"===ty,tI="map"===tg,tE=tT&&"point"!==tc.layout.get("symbol-placement"),tA=tT&&!tI&&!tE,tP=void 0!==tc.layout.get("symbol-sort-key").constantOr(1),tz=!1,tC=ti.depthModeForSublayer(0,It.ReadOnly),tk=tc.layout.get("text-variable-anchor"),tM=[],tD=0;tD<th.length;tD+=1){var tL=th[tD],tB=ta.getTile(tL),tR=tB.getBucket(tc);if(tR){var tO=tf?tR.text:tR.icon;if(tO&&tO.segments.get().length){var tF,tU,tV,tN=tO.programConfigurations.get(tc.id),tj=tf||tR.sdfIcons,tq=tf?tR.textSizeData:tR.iconSizeData,tZ=tI||0!==tS.pitch,tG=ti.useProgram(to(tj,tf,tR),tN),tX=tt.evaluateSizeForZoom(tq,tS.zoom),tW=void 0,tK=[0,0],tJ=void 0,tY=void 0,tH=null,t$=void 0;if(tf)tJ=tB.glyphAtlasTexture,tY=tw.LINEAR,tW=tB.glyphAtlasTexture.size,tR.iconsInText&&(tK=tB.imageAtlasTexture.size,tH=tB.imageAtlasTexture,t$=tZ||ti.options.rotating||ti.options.zooming||"composite"===tq.kind||"camera"===tq.kind?tw.LINEAR:tw.NEAREST);else{var tQ=1!==tc.layout.get("icon-size").constantOr(0)||tR.iconsNeedLinear;tJ=tB.imageAtlasTexture,tY=tj||ti.options.rotating||ti.options.zooming||tQ||tZ?tw.LINEAR:tw.NEAREST,tW=tB.imageAtlasTexture.size}var t0=pe(tB,1,ti.transform.zoom),t1=Jt(tL.posMatrix,tI,tT,ti.transform,t0),t2=Qt(tL.posMatrix,tI,tT,ti.transform,t0),t5=tk&&tR.hasTextData(),t4="none"!==tc.layout.get("icon-text-fit")&&t5&&tR.hasIconData();tE&&ie(tR,tL.posMatrix,ti,tf,t1,t2,tI,t_);var t3=ti.translatePosMatrix(tL.posMatrix,tB,td,tm),t6=tE||tf&&tk||t4?eP:t1,t8=ti.translatePosMatrix(t2,tB,td,tm,!0),t9=tj&&0!==tc.paint.get(tf?"text-halo-width":"icon-halo-width").constantOr(1),t7={program:tG,buffers:tO,uniformValues:tj?tR.iconsInText?(tF=tq.kind,tU=tW,tV=tK,tt.extend(Gi(tF,tX,tA,tI,ti,t3,t6,t8,!0,tU,!0),{u_texsize_icon:tV,u_texture_icon:1})):Gi(tq.kind,tX,tA,tI,ti,t3,t6,t8,tf,tW,!0):Vi(tq.kind,tX,tA,tI,ti,t3,t6,t8,tf,tW),atlasTexture:tJ,atlasTextureIcon:tH,atlasInterpolation:tY,atlasInterpolationIcon:t$,isSDF:tj,hasHalo:t9};if(tP&&tR.canOverlap){tz=!0;for(var et=0,ea=tO.segments.get();et<ea.length;et+=1){var ec=ea[et];tM.push({segments:new tt.SegmentVector([ec]),sortKey:ec.sortKey,state:t7})}}else tM.push({segments:tO.segments,sortKey:0,state:t7})}}}tz&&tM.sort(function(tt,ti){return tt.sortKey-ti.sortKey});for(var eh=0;eh<tM.length;eh+=1){var ef=tM[eh],ed=ef.state;if(tb.activeTexture.set(tw.TEXTURE0),ed.atlasTexture.bind(ed.atlasInterpolation,tw.CLAMP_TO_EDGE),ed.atlasTextureIcon&&(tb.activeTexture.set(tw.TEXTURE1),ed.atlasTextureIcon&&ed.atlasTextureIcon.bind(ed.atlasInterpolationIcon,tw.CLAMP_TO_EDGE)),ed.isSDF){var em=ed.uniformValues;ed.hasHalo&&(em.u_is_halo=1,io(ed.buffers,ef.segments,tc,ti,ed.program,tC,tv,tx,em)),em.u_is_halo=0}io(ed.buffers,ef.segments,tc,ti,ed.program,tC,tv,tx,ed.uniformValues)}}function io(tt,ti,ta,tc,th,tf,td,tm,ty){var tg=tc.context;th.draw(tg,tg.gl.TRIANGLES,tf,td,tm,Ct.disabled,ty,ta.id,tt.layoutVertexBuffer,tt.indexBuffer,ti,ta.paint,tc.transform.zoom,tt.programConfigurations.get(ta.id),tt.dynamicLayoutVertexBuffer,tt.opacityVertexBuffer)}function oo(ti,ta,tc,th,tf,td,tm){var ty,tg,t_,tv,tx,tb=ti.context.gl,tw=tc.paint.get("fill-pattern"),tS=tw&&tw.constantOr(1),tT=tc.getCrossfadeParameters();tm?(tg=tS&&!tc.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ty=tb.LINES):(tg=tS?"fillPattern":"fill",ty=tb.TRIANGLES);for(var tI=0;tI<th.length;tI+=1){var tE=th[tI],tA=ta.getTile(tE);if(!tS||tA.patternsLoaded()){var tP=tA.getBucket(tc);if(tP){var tz=tP.programConfigurations.get(tc.id),tC=ti.useProgram(tg,tz);tS&&(ti.context.activeTexture.set(tb.TEXTURE0),tA.imageAtlasTexture.bind(tb.LINEAR,tb.CLAMP_TO_EDGE),tz.updatePaintBuffers(tT));var tk=tw.constantOr(null);if(tk&&tA.imageAtlas){var tM=tA.imageAtlas,tD=tM.patternPositions[tk.to.toString()],tL=tM.patternPositions[tk.from.toString()];tD&&tL&&tz.setConstantPatternPositions(tD,tL)}var tB=ti.translatePosMatrix(tE.posMatrix,tA,tc.paint.get("fill-translate"),tc.paint.get("fill-translate-anchor"));if(tm){tv=tP.indexBuffer2,tx=tP.segments2;var tR=[tb.drawingBufferWidth,tb.drawingBufferHeight];t_="fillOutlinePattern"===tg&&tS?tt.extend(Pi(tB,ti,tT,tA),{u_world:tR}):{u_matrix:tB,u_world:tR}}else tv=tP.indexBuffer,tx=tP.segments,t_=tS?Pi(tB,ti,tT,tA):Ii(tB);tC.draw(ti.context,ty,tf,ti.stencilModeForClipping(tE),td,Ct.disabled,t_,tc.id,tP.layoutVertexBuffer,tv,tx,tc.paint,ti.transform.zoom,tz)}}}}function ro(ti,ta,tc,th,tf,td,tm){for(var ty=ti.context,tg=ty.gl,t_=tc.paint.get("fill-extrusion-pattern"),tv=t_.constantOr(1),tx=tc.getCrossfadeParameters(),tb=tc.paint.get("fill-extrusion-opacity"),tw=0;tw<th.length;tw+=1){var tS=th[tw],tT=ta.getTile(tS),tI=tT.getBucket(tc);if(tI){var tE=tI.programConfigurations.get(tc.id),tA=ti.useProgram(tv?"fillExtrusionPattern":"fillExtrusion",tE);tv&&(ti.context.activeTexture.set(tg.TEXTURE0),tT.imageAtlasTexture.bind(tg.LINEAR,tg.CLAMP_TO_EDGE),tE.updatePaintBuffers(tx));var tP=t_.constantOr(null);if(tP&&tT.imageAtlas){var tz=tT.imageAtlas,tC=tz.patternPositions[tP.to.toString()],tk=tz.patternPositions[tP.from.toString()];tC&&tk&&tE.setConstantPatternPositions(tC,tk)}var tM=ti.translatePosMatrix(tS.posMatrix,tT,tc.paint.get("fill-extrusion-translate"),tc.paint.get("fill-extrusion-translate-anchor")),tD=tc.paint.get("fill-extrusion-vertical-gradient"),tL=tv?tt.extend(Ti(tM,ti,tD,tb),wi(tx,ti,tT),{u_height_factor:-Math.pow(2,tS.overscaledZ)/tT.tileSize/8}):Ti(tM,ti,tD,tb);tA.draw(ty,ty.gl.TRIANGLES,tf,td,tm,Ct.backCCW,tL,tc.id,tI.layoutVertexBuffer,tI.indexBuffer,tI.segments,tc.paint,ti.transform.zoom,tE)}}}function ao(ti,ta,tc,th,tf,td){var tm=ti.context,ty=tm.gl,tg=ta.fbo;if(tg){var t_,tv,tx,tb,tw,tS,tT,tI,tE=ti.useProgram("hillshade");tm.activeTexture.set(ty.TEXTURE0),ty.bindTexture(ty.TEXTURE_2D,tg.colorAttachment.get());var tA=(t_=tc.paint.get("hillshade-shadow-color"),tv=tc.paint.get("hillshade-highlight-color"),tx=tc.paint.get("hillshade-accent-color"),tb=tc.paint.get("hillshade-illumination-direction")*(Math.PI/180),"viewport"===tc.paint.get("hillshade-illumination-anchor")&&(tb-=ti.transform.angle),tI=!ti.options.moving,{u_matrix:ti.transform.calculatePosMatrix(ta.tileID.toUnwrapped(),tI),u_image:0,u_latrange:(tS=Math.pow(2,(tw=ta.tileID).canonical.z),tT=tw.canonical.y,[new tt.MercatorCoordinate(0,tT/tS).toLngLat().lat,new tt.MercatorCoordinate(0,(tT+1)/tS).toLngLat().lat]),u_light:[tc.paint.get("hillshade-exaggeration"),tb],u_shadow:t_,u_highlight:tv,u_accent:tx});tE.draw(tm,ty.TRIANGLES,th,tf,td,Ct.disabled,tA,tc.id,ti.rasterBoundsBuffer,ti.quadTriangleIndexBuffer,ti.rasterBoundsSegments)}}function no(ti,ta,tc,th,tf,td){var tm=ti.context,ty=tm.gl,tg=ta.dem;if(tg&&tg.data){var t_,tv,tx,tb=tg.dim,tw=tg.stride,tS=tg.getPixels();if(tm.activeTexture.set(ty.TEXTURE1),tm.pixelStoreUnpackPremultiplyAlpha.set(!1),ta.demTexture=ta.demTexture||ti.getTileTexture(tw),ta.demTexture){var tT=ta.demTexture;tT.update(tS,{premultiply:!1}),tT.bind(ty.NEAREST,ty.CLAMP_TO_EDGE)}else ta.demTexture=new tt.Texture(tm,tS,ty.RGBA,{premultiply:!1}),ta.demTexture.bind(ty.NEAREST,ty.CLAMP_TO_EDGE);tm.activeTexture.set(ty.TEXTURE0);var tI=ta.fbo;if(!tI){var tE=new tt.Texture(tm,{width:tb,height:tb,data:null},ty.RGBA);tE.bind(ty.LINEAR,ty.CLAMP_TO_EDGE),(tI=ta.fbo=tm.createFramebuffer(tb,tb,!0)).colorAttachment.set(tE.texture)}tm.bindFramebuffer.set(tI.framebuffer),tm.viewport.set([0,0,tb,tb]),ti.useProgram("hillshadePrepare").draw(tm,ty.TRIANGLES,th,tf,td,Ct.disabled,(t_=ta.tileID,tv=tg.stride,tx=tt.create(),tt.ortho(tx,0,tt.EXTENT,-tt.EXTENT,0,0,1),tt.translate(tx,tx,[0,-tt.EXTENT,0]),{u_matrix:tx,u_image:1,u_dimension:[tv,tv],u_zoom:t_.overscaledZ,u_unpack:tg.getUnpackVector()}),tc.id,ti.rasterBoundsBuffer,ti.quadTriangleIndexBuffer,ti.rasterBoundsSegments),ta.needsHillshadePrepare=!1}}function so(ti,ta,tc,th,tf){var td=th.paint.get("raster-fade-duration");if(td>0){var tm=tt.browser.now(),ty=(tm-ti.timeAdded)/td,tg=ta?(tm-ta.timeAdded)/td:-1,t_=tc.getSource(),tv=tf.coveringZoomLevel({tileSize:t_.tileSize,roundZoom:t_.roundZoom}),tx=!ta||Math.abs(ta.tileID.overscaledZ-tv)>Math.abs(ti.tileID.overscaledZ-tv),tb=tx&&ti.refreshedUponExpiration?1:tt.clamp(tx?ty:1-tg,0,1);return ti.refreshedUponExpiration&&ty>=1&&(ti.refreshedUponExpiration=!1),ta?{opacity:1,mix:1-tb}:{opacity:tb,mix:0}}return{opacity:1,mix:0}}var ez=new tt.Color(1,0,0,1),eC=new tt.Color(0,1,0,1),ek=new tt.Color(0,0,1,1),eM=new tt.Color(1,0,1,1),eD=new tt.Color(0,1,1,1);function _o(tt,ti,ta,tc){mo(tt,0,ti+ta/2,tt.transform.width,ta,tc)}function fo(tt,ti,ta,tc){mo(tt,ti-ta/2,0,ta,tt.transform.height,tc)}function mo(ti,ta,tc,th,tf,td){var tm=ti.context,ty=tm.gl;ty.enable(ty.SCISSOR_TEST),ty.scissor(ta*tt.browser.devicePixelRatio,tc*tt.browser.devicePixelRatio,th*tt.browser.devicePixelRatio,tf*tt.browser.devicePixelRatio),tm.clear({color:td}),ty.disable(ty.SCISSOR_TEST)}function go(ti,ta,tc){var th=ti.context,tf=th.gl,td=tc.posMatrix,tm=ti.useProgram("debug"),ty=It.disabled,tg=Pt.disabled,t_=ti.colorModeForRenderPass();th.activeTexture.set(tf.TEXTURE0),ti.emptyTexture.bind(tf.LINEAR,tf.CLAMP_TO_EDGE),tm.draw(th,tf.LINE_STRIP,ty,tg,t_,Ct.disabled,Mi(td,tt.Color.red),"$debug",ti.debugBuffer,ti.tileBorderIndexBuffer,ti.debugSegments);var tv=ta.getTileByID(tc.key).latestRawTileData,tx=Math.floor((tv&&tv.byteLength||0)/1024),tb=512/Math.min(ta.getTile(tc).tileSize,512)*(tc.overscaledZ/ti.transform.zoom)*.5,tw=tc.canonical.toString();tc.overscaledZ!==tc.canonical.z&&(tw+=" => "+tc.overscaledZ),function(tt,ti){tt.initDebugOverlayCanvas();var ta=tt.debugOverlayCanvas,tc=tt.context.gl,th=tt.debugOverlayCanvas.getContext("2d");th.clearRect(0,0,ta.width,ta.height),th.shadowColor="white",th.shadowBlur=2,th.lineWidth=1.5,th.strokeStyle="white",th.textBaseline="top",th.font="bold 36px Open Sans, sans-serif",th.fillText(ti,5,5),th.strokeText(ti,5,5),tt.debugOverlayTexture.update(ta),tt.debugOverlayTexture.bind(tc.LINEAR,tc.CLAMP_TO_EDGE)}(ti,tw+" "+tx+"kb"),tm.draw(th,tf.TRIANGLES,ty,tg,St.alphaBlended,Ct.disabled,Mi(td,tt.Color.transparent,tb),"$debug",ti.debugBuffer,ti.quadTriangleIndexBuffer,ti.debugSegments)}var eL={symbol:function(ti,ta,tc,th,tf){if("translucent"===ti.renderPass){var td=Pt.disabled,tm=ti.colorModeForRenderPass();tc.layout.get("text-variable-anchor")&&function(ti,ta,tc,th,tf,td,tm){for(var ty=ta.transform,tg="map"===tf,t_="map"===td,tv=0;tv<ti.length;tv+=1){var tx=ti[tv],tb=th.getTile(tx),tw=tb.getBucket(tc);if(tw&&tw.text&&tw.text.segments.get().length){var tS=tt.evaluateSizeForZoom(tw.textSizeData,ty.zoom),tT=pe(tb,1,ta.transform.zoom),tI=Jt(tx.posMatrix,t_,tg,ta.transform,tT),tE="none"!==tc.layout.get("icon-text-fit")&&tw.hasIconData();if(tS){var tA=Math.pow(2,ty.zoom-tb.tileID.overscaledZ);$i(tw,tg,t_,tm,tt.symbolSize,ty,tI,tx.posMatrix,tA,tS,tE)}}}}(th,ti,tc,ta,tc.layout.get("text-rotation-alignment"),tc.layout.get("text-pitch-alignment"),tf),0!==tc.paint.get("icon-opacity").constantOr(1)&&eo(ti,ta,tc,th,!1,tc.paint.get("icon-translate"),tc.paint.get("icon-translate-anchor"),tc.layout.get("icon-rotation-alignment"),tc.layout.get("icon-pitch-alignment"),tc.layout.get("icon-keep-upright"),td,tm),0!==tc.paint.get("text-opacity").constantOr(1)&&eo(ti,ta,tc,th,!0,tc.paint.get("text-translate"),tc.paint.get("text-translate-anchor"),tc.layout.get("text-rotation-alignment"),tc.layout.get("text-pitch-alignment"),tc.layout.get("text-keep-upright"),td,tm),ta.map.showCollisionBoxes&&(Yi(ti,ta,tc,th,tc.paint.get("text-translate"),tc.paint.get("text-translate-anchor"),!0),Yi(ti,ta,tc,th,tc.paint.get("icon-translate"),tc.paint.get("icon-translate-anchor"),!1))}},circle:function(ti,ta,tc,th){if("translucent"===ti.renderPass){var tf=tc.paint.get("circle-opacity"),td=tc.paint.get("circle-stroke-width"),tm=tc.paint.get("circle-stroke-opacity"),ty=void 0!==tc.layout.get("circle-sort-key").constantOr(1);if(0!==tf.constantOr(1)||0!==td.constantOr(1)&&0!==tm.constantOr(1)){for(var tg=ti.context,t_=tg.gl,tv=ti.depthModeForSublayer(0,It.ReadOnly),tx=Pt.disabled,tb=ti.colorModeForRenderPass(),tw=[],tS=0;tS<th.length;tS++){var tT=th[tS],tI=ta.getTile(tT),tE=tI.getBucket(tc);if(tE){var tA=tE.programConfigurations.get(tc.id),tP={programConfiguration:tA,program:ti.useProgram("circle",tA),layoutVertexBuffer:tE.layoutVertexBuffer,indexBuffer:tE.indexBuffer,uniformValues:zi(ti,tT,tI,tc)};if(ty)for(var tz=0,tC=tE.segments.get();tz<tC.length;tz+=1){var tk=tC[tz];tw.push({segments:new tt.SegmentVector([tk]),sortKey:tk.sortKey,state:tP})}else tw.push({segments:tE.segments,sortKey:0,state:tP})}}ty&&tw.sort(function(tt,ti){return tt.sortKey-ti.sortKey});for(var tM=0;tM<tw.length;tM+=1){var tD=tw[tM],tL=tD.state;tL.program.draw(tg,t_.TRIANGLES,tv,tx,tb,Ct.disabled,tL.uniformValues,tc.id,tL.layoutVertexBuffer,tL.indexBuffer,tD.segments,tc.paint,ti.transform.zoom,tL.programConfiguration)}}}},heatmap:function(ti,ta,tc,th){if(0!==tc.paint.get("heatmap-opacity")){if("offscreen"===ti.renderPass){var tf=ti.context,td=tf.gl,tm=Pt.disabled,ty=new St([td.ONE,td.ONE],tt.Color.transparent,[!0,!0,!0,!0]);(function(tt,ti,ta){var tc=tt.gl;tt.activeTexture.set(tc.TEXTURE1),tt.viewport.set([0,0,ti.width/4,ti.height/4]);var th=ta.heatmapFbo;if(th)tc.bindTexture(tc.TEXTURE_2D,th.colorAttachment.get()),tt.bindFramebuffer.set(th.framebuffer);else{var tf,td,tm=tc.createTexture();tc.bindTexture(tc.TEXTURE_2D,tm),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_WRAP_S,tc.CLAMP_TO_EDGE),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_WRAP_T,tc.CLAMP_TO_EDGE),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_MIN_FILTER,tc.LINEAR),tc.texParameteri(tc.TEXTURE_2D,tc.TEXTURE_MAG_FILTER,tc.LINEAR),tf=th=ta.heatmapFbo=tt.createFramebuffer(ti.width/4,ti.height/4,!1),(td=tt.gl).texImage2D(td.TEXTURE_2D,0,td.RGBA,ti.width/4,ti.height/4,0,td.RGBA,tt.extRenderToTextureHalfFloat?tt.extTextureHalfFloat.HALF_FLOAT_OES:td.UNSIGNED_BYTE,null),tf.colorAttachment.set(tm)}})(tf,ti,tc),tf.clear({color:tt.Color.transparent});for(var tg=0;tg<th.length;tg++){var t_=th[tg];if(!ta.hasRenderableParent(t_)){var tv=ta.getTile(t_),tx=tv.getBucket(tc);if(tx){var tb,tw,tS,tT=tx.programConfigurations.get(tc.id);ti.useProgram("heatmap",tT).draw(tf,td.TRIANGLES,It.disabled,tm,ty,Ct.disabled,(tb=t_.posMatrix,tw=ti.transform.zoom,tS=tc.paint.get("heatmap-intensity"),{u_matrix:tb,u_extrude_scale:pe(tv,1,tw),u_intensity:tS}),tc.id,tx.layoutVertexBuffer,tx.indexBuffer,tx.segments,tc.paint,ti.transform.zoom,tT)}}}tf.viewport.set([0,0,ti.width,ti.height])}else"translucent"===ti.renderPass&&(ti.context.setColorMode(ti.colorModeForRenderPass()),function(ti,ta){var tc=ti.context,th=tc.gl,tf=ta.heatmapFbo;if(tf){tc.activeTexture.set(th.TEXTURE0),th.bindTexture(th.TEXTURE_2D,tf.colorAttachment.get()),tc.activeTexture.set(th.TEXTURE1);var td,tm,ty=ta.colorRampTexture;ty||(ty=ta.colorRampTexture=new tt.Texture(tc,ta.colorRamp,th.RGBA)),ty.bind(th.LINEAR,th.CLAMP_TO_EDGE),ti.useProgram("heatmapTexture").draw(tc,th.TRIANGLES,It.disabled,Pt.disabled,ti.colorModeForRenderPass(),Ct.disabled,(td=tt.create(),tt.ortho(td,0,ti.width,ti.height,0,0,1),{u_matrix:td,u_world:[(tm=ti.context.gl).drawingBufferWidth,tm.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ta.paint.get("heatmap-opacity")}),ta.id,ti.viewportBuffer,ti.quadTriangleIndexBuffer,ti.viewportSegments,ta.paint,ti.transform.zoom)}}(ti,tc))}},line:function(ti,ta,tc,th){if("translucent"===ti.renderPass){var tf=tc.paint.get("line-opacity"),td=tc.paint.get("line-width");if(0!==tf.constantOr(1)&&0!==td.constantOr(1))for(var tm=ti.depthModeForSublayer(0,It.ReadOnly),ty=ti.colorModeForRenderPass(),tg=tc.paint.get("line-dasharray"),t_=tc.paint.get("line-pattern"),tv=t_.constantOr(1),tx=tc.paint.get("line-gradient"),tb=tc.getCrossfadeParameters(),tw=tv?"linePattern":tg?"lineSDF":tx?"lineGradient":"line",tS=ti.context,tT=tS.gl,tI=!0,tE=0;tE<th.length;tE+=1){var tA=th[tE],tP=ta.getTile(tA);if(!tv||tP.patternsLoaded()){var tz=tP.getBucket(tc);if(tz){var tC,tk=tz.programConfigurations.get(tc.id),tM=ti.context.program.get(),tD=ti.useProgram(tw,tk),tL=tI||tD.program!==tM,tB=t_.constantOr(null);if(tB&&tP.imageAtlas){var tR=tP.imageAtlas,tO=tR.patternPositions[tB.to.toString()],tF=tR.patternPositions[tB.from.toString()];tO&&tF&&tk.setConstantPatternPositions(tO,tF)}var tU=tv?Oi(ti,tP,tc,tb):tg?Fi(ti,tP,tc,tg,tb):tx?(tC=tz.lineClipsArray.length,tt.extend(ki(ti,tP,tc),{u_image:0,u_image_height:tC})):ki(ti,tP,tc);if(tv)tS.activeTexture.set(tT.TEXTURE0),tP.imageAtlasTexture.bind(tT.LINEAR,tT.CLAMP_TO_EDGE),tk.updatePaintBuffers(tb);else if(tg&&(tL||ti.lineAtlas.dirty))tS.activeTexture.set(tT.TEXTURE0),ti.lineAtlas.bind(tS);else if(tx){var tV=tz.gradients[tc.id],tN=tV.texture;if(tc.gradientVersion!==tV.version){var tj=256;if(tc.stepInterpolant){var tq=ta.getSource().maxzoom,tZ=tA.canonical.z===tq?Math.ceil(1<<ti.transform.maxZoom-tA.canonical.z):1;tj=tt.clamp(tt.nextPowerOfTwo(tz.maxLineLength/tt.EXTENT*1024*tZ),256,tS.maxTextureSize)}tV.gradient=tt.renderColorRamp({expression:tc.gradientExpression(),evaluationKey:"lineProgress",resolution:tj,image:tV.gradient||void 0,clips:tz.lineClipsArray}),tV.texture?tV.texture.update(tV.gradient):tV.texture=new tt.Texture(tS,tV.gradient,tT.RGBA),tV.version=tc.gradientVersion,tN=tV.texture}tS.activeTexture.set(tT.TEXTURE0),tN.bind(tc.stepInterpolant?tT.NEAREST:tT.LINEAR,tT.CLAMP_TO_EDGE)}tD.draw(tS,tT.TRIANGLES,tm,ti.stencilModeForClipping(tA),ty,Ct.disabled,tU,tc.id,tz.layoutVertexBuffer,tz.indexBuffer,tz.segments,tc.paint,ti.transform.zoom,tk,tz.layoutVertexBuffer2),tI=!1}}}}},fill:function(ti,ta,tc,th){var tf=tc.paint.get("fill-color"),td=tc.paint.get("fill-opacity");if(0!==td.constantOr(1)){var tm=ti.colorModeForRenderPass(),ty=tc.paint.get("fill-pattern"),tg=ti.opaquePassEnabledForLayer()&&!ty.constantOr(1)&&1===tf.constantOr(tt.Color.transparent).a&&1===td.constantOr(0)?"opaque":"translucent";if(ti.renderPass===tg){var t_=ti.depthModeForSublayer(1,"opaque"===ti.renderPass?It.ReadWrite:It.ReadOnly);oo(ti,ta,tc,th,t_,tm,!1)}if("translucent"===ti.renderPass&&tc.paint.get("fill-antialias")){var tv=ti.depthModeForSublayer(tc.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly);oo(ti,ta,tc,th,tv,tm,!0)}}},"fill-extrusion":function(tt,ti,ta,tc){var th=ta.paint.get("fill-extrusion-opacity");if(0!==th&&"translucent"===tt.renderPass){var tf=new It(tt.context.gl.LEQUAL,It.ReadWrite,tt.depthRangeFor3D);if(1!==th||ta.paint.get("fill-extrusion-pattern").constantOr(1))ro(tt,ti,ta,tc,tf,Pt.disabled,St.disabled),ro(tt,ti,ta,tc,tf,tt.stencilModeFor3D(),tt.colorModeForRenderPass());else{var td=tt.colorModeForRenderPass();ro(tt,ti,ta,tc,tf,Pt.disabled,td)}}},hillshade:function(tt,ti,ta,tc){if("offscreen"===tt.renderPass||"translucent"===tt.renderPass){for(var th=tt.context,tf=tt.depthModeForSublayer(0,It.ReadOnly),td=tt.colorModeForRenderPass(),tm="translucent"===tt.renderPass?tt.stencilConfigForOverlap(tc):[{},tc],ty=tm[0],tg=0,t_=tm[1];tg<t_.length;tg+=1){var tv=t_[tg],tx=ti.getTile(tv);tx.needsHillshadePrepare&&"offscreen"===tt.renderPass?no(tt,tx,ta,tf,Pt.disabled,td):"translucent"===tt.renderPass&&ao(tt,tx,ta,tf,ty[tv.overscaledZ],td)}th.viewport.set([0,0,tt.width,tt.height])}},raster:function(tt,ti,ta,tc){if("translucent"===tt.renderPass&&0!==ta.paint.get("raster-opacity")&&tc.length)for(var th=tt.context,tf=th.gl,td=ti.getSource(),tm=tt.useProgram("raster"),ty=tt.colorModeForRenderPass(),tg=td instanceof tA?[{},tc]:tt.stencilConfigForOverlap(tc),t_=tg[0],tv=tg[1],tx=tv[tv.length-1].overscaledZ,tb=!tt.options.moving,tw=0;tw<tv.length;tw+=1){var tS=tv[tw],tT=tt.depthModeForSublayer(tS.overscaledZ-tx,1===ta.paint.get("raster-opacity")?It.ReadWrite:It.ReadOnly,tf.LESS),tI=ti.getTile(tS),tE=tt.transform.calculatePosMatrix(tS.toUnwrapped(),tb);tI.registerFadeDuration(ta.paint.get("raster-fade-duration"));var tP=ti.findLoadedParent(tS,0),tz=so(tI,tP,ti,ta,tt.transform),tC=void 0,tk=void 0,tM="nearest"===ta.paint.get("raster-resampling")?tf.NEAREST:tf.LINEAR;th.activeTexture.set(tf.TEXTURE0),tI.texture.bind(tM,tf.CLAMP_TO_EDGE,tf.LINEAR_MIPMAP_NEAREST),th.activeTexture.set(tf.TEXTURE1),tP?(tP.texture.bind(tM,tf.CLAMP_TO_EDGE,tf.LINEAR_MIPMAP_NEAREST),tC=Math.pow(2,tP.tileID.overscaledZ-tI.tileID.overscaledZ),tk=[tI.tileID.canonical.x*tC%1,tI.tileID.canonical.y*tC%1]):tI.texture.bind(tM,tf.CLAMP_TO_EDGE,tf.LINEAR_MIPMAP_NEAREST);var tD=Zi(tE,tk||[0,0],tC||1,tz,ta);td instanceof tA?tm.draw(th,tf.TRIANGLES,tT,Pt.disabled,ty,Ct.disabled,tD,ta.id,td.boundsBuffer,tt.quadTriangleIndexBuffer,td.boundsSegments):tm.draw(th,tf.TRIANGLES,tT,t_[tS.overscaledZ],ty,Ct.disabled,tD,ta.id,tt.rasterBoundsBuffer,tt.quadTriangleIndexBuffer,tt.rasterBoundsSegments)}},background:function(tt,ti,ta){var tc=ta.paint.get("background-color"),th=ta.paint.get("background-opacity");if(0!==th){var tf=tt.context,td=tf.gl,tm=tt.transform,ty=tm.tileSize,tg=ta.paint.get("background-pattern");if(!tt.isPatternMissing(tg)){var t_=!tg&&1===tc.a&&1===th&&tt.opaquePassEnabledForLayer()?"opaque":"translucent";if(tt.renderPass===t_){var tv=Pt.disabled,tx=tt.depthModeForSublayer(0,"opaque"===t_?It.ReadWrite:It.ReadOnly),tb=tt.colorModeForRenderPass(),tw=tt.useProgram(tg?"backgroundPattern":"background"),tS=tm.coveringTiles({tileSize:ty});tg&&(tf.activeTexture.set(td.TEXTURE0),tt.imageManager.bind(tt.context));for(var tT=ta.getCrossfadeParameters(),tI=0;tI<tS.length;tI+=1){var tE=tS[tI],tA=tt.transform.calculatePosMatrix(tE.toUnwrapped()),tP=tg?Hi(tA,th,tt,tg,{tileID:tE,tileSize:ty},tT):{u_matrix:tA,u_opacity:th,u_color:tc};tw.draw(tf,td.TRIANGLES,tx,tv,tb,Ct.disabled,tP,ta.id,tt.tileExtentBuffer,tt.quadTriangleIndexBuffer,tt.tileExtentSegments)}}}}},debug:function(tt,ti,ta){for(var tc=0;tc<ta.length;tc++)go(tt,ti,ta[tc])},custom:function(tt,ti,ta){var tc=tt.context,th=ta.implementation;if("offscreen"===tt.renderPass){var tf=th.prerender;tf&&(tt.setCustomLayerDefaults(),tc.setColorMode(tt.colorModeForRenderPass()),tf.call(th,tc.gl,tt.transform.customLayerMatrix()),tc.setDirty(),tt.setBaseState())}else if("translucent"===tt.renderPass){tt.setCustomLayerDefaults(),tc.setColorMode(tt.colorModeForRenderPass()),tc.setStencilMode(Pt.disabled);var td="3d"===th.renderingMode?new It(tt.context.gl.LEQUAL,It.ReadWrite,tt.depthRangeFor3D):tt.depthModeForSublayer(0,It.ReadOnly);tc.setDepthMode(td),th.render(tc.gl,tt.transform.customLayerMatrix()),tc.setDirty(),tt.setBaseState(),tc.bindFramebuffer.set(null)}}},yo=function(tt,ti){this.context=new zt(tt),this.transform=ti,this._tileTextures={},this.setup(),this.numSublayers=ec.maxUnderzooming+ec.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new Fe,this.gpuTimers={}};yo.prototype.resize=function(ti,ta){if(this.width=ti*tt.browser.devicePixelRatio,this.height=ta*tt.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var tc=0,th=this.style._order;tc<th.length;tc+=1)this.style._layers[th[tc]].resize()},yo.prototype.setup=function(){var ti=this.context,ta=new tt.StructArrayLayout2i4;ta.emplaceBack(0,0),ta.emplaceBack(tt.EXTENT,0),ta.emplaceBack(0,tt.EXTENT),ta.emplaceBack(tt.EXTENT,tt.EXTENT),this.tileExtentBuffer=ti.createVertexBuffer(ta,eS.members),this.tileExtentSegments=tt.SegmentVector.simpleSegment(0,0,4,2);var tc=new tt.StructArrayLayout2i4;tc.emplaceBack(0,0),tc.emplaceBack(tt.EXTENT,0),tc.emplaceBack(0,tt.EXTENT),tc.emplaceBack(tt.EXTENT,tt.EXTENT),this.debugBuffer=ti.createVertexBuffer(tc,eS.members),this.debugSegments=tt.SegmentVector.simpleSegment(0,0,4,5);var th=new tt.StructArrayLayout4i8;th.emplaceBack(0,0,0,0),th.emplaceBack(tt.EXTENT,0,tt.EXTENT,0),th.emplaceBack(0,tt.EXTENT,0,tt.EXTENT),th.emplaceBack(tt.EXTENT,tt.EXTENT,tt.EXTENT,tt.EXTENT),this.rasterBoundsBuffer=ti.createVertexBuffer(th,tE.members),this.rasterBoundsSegments=tt.SegmentVector.simpleSegment(0,0,4,2);var tf=new tt.StructArrayLayout2i4;tf.emplaceBack(0,0),tf.emplaceBack(1,0),tf.emplaceBack(0,1),tf.emplaceBack(1,1),this.viewportBuffer=ti.createVertexBuffer(tf,eS.members),this.viewportSegments=tt.SegmentVector.simpleSegment(0,0,4,2);var td=new tt.StructArrayLayout1ui2;td.emplaceBack(0),td.emplaceBack(1),td.emplaceBack(3),td.emplaceBack(2),td.emplaceBack(0),this.tileBorderIndexBuffer=ti.createIndexBuffer(td);var tm=new tt.StructArrayLayout3ui6;tm.emplaceBack(0,1,2),tm.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=ti.createIndexBuffer(tm),this.emptyTexture=new tt.Texture(ti,{width:1,height:1,data:new Uint8Array([0,0,0,0])},ti.gl.RGBA);var ty=this.context.gl;this.stencilClearMode=new Pt({func:ty.ALWAYS,mask:0},0,255,ty.ZERO,ty.ZERO,ty.ZERO)},yo.prototype.clearStencil=function(){var ti=this.context,ta=ti.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var tc=tt.create();tt.ortho(tc,0,this.width,this.height,0,0,1),tt.scale(tc,tc,[ta.drawingBufferWidth,ta.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(ti,ta.TRIANGLES,It.disabled,this.stencilClearMode,St.disabled,Ct.disabled,Li(tc),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},yo.prototype._renderTileClippingMasks=function(tt,ti){if(this.currentStencilSource!==tt.source&&tt.isTileClipped()&&ti&&ti.length){this.currentStencilSource=tt.source;var ta=this.context,tc=ta.gl;this.nextStencilID+ti.length>256&&this.clearStencil(),ta.setColorMode(St.disabled),ta.setDepthMode(It.disabled);var th=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var tf=0;tf<ti.length;tf+=1){var td=ti[tf],tm=this._tileClippingMaskIDs[td.key]=this.nextStencilID++;th.draw(ta,tc.TRIANGLES,It.disabled,new Pt({func:tc.ALWAYS,mask:0},tm,255,tc.KEEP,tc.KEEP,tc.REPLACE),St.disabled,Ct.disabled,Li(td.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},yo.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var tt=this.nextStencilID++,ti=this.context.gl;return new Pt({func:ti.NOTEQUAL,mask:255},tt,255,ti.KEEP,ti.KEEP,ti.REPLACE)},yo.prototype.stencilModeForClipping=function(tt){var ti=this.context.gl;return new Pt({func:ti.EQUAL,mask:255},this._tileClippingMaskIDs[tt.key],0,ti.KEEP,ti.KEEP,ti.REPLACE)},yo.prototype.stencilConfigForOverlap=function(tt){var ti,ta=this.context.gl,tc=tt.sort(function(tt,ti){return ti.overscaledZ-tt.overscaledZ}),th=tc[tc.length-1].overscaledZ,tf=tc[0].overscaledZ-th+1;if(tf>1){this.currentStencilSource=void 0,this.nextStencilID+tf>256&&this.clearStencil();for(var td={},tm=0;tm<tf;tm++)td[tm+th]=new Pt({func:ta.GEQUAL,mask:255},tm+this.nextStencilID,255,ta.KEEP,ta.KEEP,ta.REPLACE);return this.nextStencilID+=tf,[td,tc]}return[((ti={})[th]=Pt.disabled,ti),tc]},yo.prototype.colorModeForRenderPass=function(){var ti=this.context.gl;return this._showOverdrawInspector?new St([ti.CONSTANT_COLOR,ti.ONE],new tt.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?St.unblended:St.alphaBlended},yo.prototype.depthModeForSublayer=function(tt,ti,ta){if(!this.opaquePassEnabledForLayer())return It.disabled;var tc=1-((1+this.currentLayer)*this.numSublayers+tt)*this.depthEpsilon;return new It(ta||this.context.gl.LEQUAL,ti,[tc,tc])},yo.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},yo.prototype.render=function(ti,ta){var tc,th,tf,td,tm=this;this.style=ti,this.options=ta,this.lineAtlas=ti.lineAtlas,this.imageManager=ti.imageManager,this.glyphManager=ti.glyphManager,this.symbolFadeChange=ti.placement.symbolFadeChange(tt.browser.now()),this.imageManager.beginFrame();var ty=this.style._order,tg=this.style.sourceCaches;for(var t_ in tg){var tv=tg[t_];tv.used&&tv.prepare(this.context)}var tx,tb,tw={},tS={},tT={};for(var tI in tg){var tE=tg[tI];tw[tI]=tE.getVisibleCoordinates(),tS[tI]=tw[tI].slice().reverse(),tT[tI]=tE.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var tA=0;tA<ty.length;tA++)if(this.style._layers[ty[tA]].is3D()){this.opaquePassCutoff=tA;break}this.renderPass="offscreen";for(var tP=0;tP<ty.length;tP+=1){var tz=this.style._layers[ty[tP]];if(tz.hasOffscreenPass()&&!tz.isHidden(this.transform.zoom)){var tC=tS[tz.source];("custom"===tz.type||tC.length)&&this.renderLayer(this,tg[tz.source],tz,tC)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:ta.showOverdrawInspector?tt.Color.black:tt.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=ta.showOverdrawInspector,this.depthRangeFor3D=[0,1-(ti._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=ty.length-1;this.currentLayer>=0;this.currentLayer--){var tk=this.style._layers[ty[this.currentLayer]],tM=tg[tk.source],tD=tw[tk.source];this._renderTileClippingMasks(tk,tD),this.renderLayer(this,tM,tk,tD)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<ty.length;this.currentLayer++){var tL=this.style._layers[ty[this.currentLayer]],tB=tg[tL.source],tR=("symbol"===tL.type?tT:tS)[tL.source];this._renderTileClippingMasks(tL,tw[tL.source]),this.renderLayer(this,tB,tL,tR)}this.options.showTileBoundaries&&(tt.values(this.style._layers).forEach(function(tt){tt.source&&!tt.isHidden(tm.transform.zoom)&&(tt.source!==(tb&&tb.id)&&(tb=tm.style.sourceCaches[tt.source]),(!tx||tx.getSource().maxzoom<tb.getSource().maxzoom)&&(tx=tb))}),tx&&eL.debug(this,tx,tx.getVisibleCoordinates())),this.options.showPadding&&(tc=this.transform.padding,_o(this,this.transform.height-(tc.top||0),3,ez),_o(this,tc.bottom||0,3,eC),fo(this,tc.left||0,3,ek),fo(this,this.transform.width-(tc.right||0),3,eM),mo(this,(tf=(th=this.transform.centerPoint).x)-1,(td=this.transform.height-th.y)-10,2,20,eD),mo(this,tf-10,td-1,20,2,eD)),this.context.setDefault()},yo.prototype.renderLayer=function(tt,ti,ta,tc){ta.isHidden(this.transform.zoom)||("background"===ta.type||"custom"===ta.type||tc.length)&&(this.id=ta.id,this.gpuTimingStart(ta),eL[ta.type](tt,ti,ta,tc,this.style.placement.variableOffsets),this.gpuTimingEnd())},yo.prototype.gpuTimingStart=function(tt){if(this.options.gpuTiming){var ti=this.context.extTimerQuery,ta=this.gpuTimers[tt.id];ta||(ta=this.gpuTimers[tt.id]={calls:0,cpuTime:0,query:ti.createQueryEXT()}),ta.calls++,ti.beginQueryEXT(ti.TIME_ELAPSED_EXT,ta.query)}},yo.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var tt=this.context.extTimerQuery;tt.endQueryEXT(tt.TIME_ELAPSED_EXT)}},yo.prototype.collectGpuTimers=function(){var tt=this.gpuTimers;return this.gpuTimers={},tt},yo.prototype.queryGpuTimers=function(tt){var ti={};for(var ta in tt){var tc=tt[ta],th=this.context.extTimerQuery,tf=th.getQueryObjectEXT(tc.query,th.QUERY_RESULT_EXT)/1e6;th.deleteQueryEXT(tc.query),ti[ta]=tf}return ti},yo.prototype.translatePosMatrix=function(ti,ta,tc,th,tf){if(!tc[0]&&!tc[1])return ti;var td=tf?"map"===th?this.transform.angle:0:"viewport"===th?-this.transform.angle:0;if(td){var tm=Math.sin(td),ty=Math.cos(td);tc=[tc[0]*ty-tc[1]*tm,tc[0]*tm+tc[1]*ty]}var tg=[tf?tc[0]:pe(ta,tc[0],this.transform.zoom),tf?tc[1]:pe(ta,tc[1],this.transform.zoom),0],t_=new Float32Array(16);return tt.translate(t_,ti,tg),t_},yo.prototype.saveTileTexture=function(tt){var ti=this._tileTextures[tt.size[0]];ti?ti.push(tt):this._tileTextures[tt.size[0]]=[tt]},yo.prototype.getTileTexture=function(tt){var ti=this._tileTextures[tt];return ti&&ti.length>0?ti.pop():null},yo.prototype.isPatternMissing=function(tt){if(!tt)return!1;if(!tt.from||!tt.to)return!0;var ti=this.imageManager.getPattern(tt.from.toString()),ta=this.imageManager.getPattern(tt.to.toString());return!ti||!ta},yo.prototype.useProgram=function(tt,ti){this.cache=this.cache||{};var ta=""+tt+(ti?ti.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[ta]||(this.cache[ta]=new bi(this.context,tt,eI[tt],ti,eA[tt],this._showOverdrawInspector)),this.cache[ta]},yo.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},yo.prototype.setBaseState=function(){var tt=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(tt.FUNC_ADD)},yo.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=tt.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new tt.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},yo.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xo=function(tt,ti){this.points=tt,this.planes=ti};xo.fromInvProjectionMatrix=function(ti,ta,tc){var th=Math.pow(2,tc),tf=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(ta){return tt.transformMat4([],ta,ti)}).map(function(ti){return tt.scale$1([],ti,1/ti[3]/ta*th)}),td=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(ti){var ta=tt.sub([],tf[ti[0]],tf[ti[1]]),tc=tt.sub([],tf[ti[2]],tf[ti[1]]),th=tt.normalize([],tt.cross([],ta,tc)),td=-tt.dot(th,tf[ti[1]]);return th.concat(td)});return new xo(tf,td)};var bo=function(ti,ta){this.min=ti,this.max=ta,this.center=tt.scale$2([],tt.add([],this.min,this.max),.5)};bo.prototype.quadrant=function(ti){for(var ta=[ti%2==0,ti<2],tc=tt.clone$2(this.min),th=tt.clone$2(this.max),tf=0;tf<ta.length;tf++)tc[tf]=ta[tf]?this.min[tf]:this.center[tf],th[tf]=ta[tf]?this.center[tf]:this.max[tf];return th[2]=this.max[2],new bo(tc,th)},bo.prototype.distanceX=function(tt){return Math.max(Math.min(this.max[0],tt[0]),this.min[0])-tt[0]},bo.prototype.distanceY=function(tt){return Math.max(Math.min(this.max[1],tt[1]),this.min[1])-tt[1]},bo.prototype.intersects=function(ti){for(var ta=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],tc=!0,th=0;th<ti.planes.length;th++){for(var tf=ti.planes[th],td=0,tm=0;tm<ta.length;tm++)td+=tt.dot$1(tf,ta[tm])>=0;if(0===td)return 0;td!==ta.length&&(tc=!1)}if(tc)return 2;for(var ty=0;ty<3;ty++){for(var tg=Number.MAX_VALUE,t_=-Number.MAX_VALUE,tv=0;tv<ti.points.length;tv++){var tx=ti.points[tv][ty]-this.min[ty];tg=Math.min(tg,tx),t_=Math.max(t_,tx)}if(t_<0||tg>this.max[ty]-this.min[ty])return 0}return 1};var wo=function(tt,ti,ta,tc){if(void 0===tt&&(tt=0),void 0===ti&&(ti=0),void 0===ta&&(ta=0),void 0===tc&&(tc=0),isNaN(tt)||tt<0||isNaN(ti)||ti<0||isNaN(ta)||ta<0||isNaN(tc)||tc<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=tt,this.bottom=ti,this.left=ta,this.right=tc};wo.prototype.interpolate=function(ti,ta,tc){return null!=ta.top&&null!=ti.top&&(this.top=tt.number(ti.top,ta.top,tc)),null!=ta.bottom&&null!=ti.bottom&&(this.bottom=tt.number(ti.bottom,ta.bottom,tc)),null!=ta.left&&null!=ti.left&&(this.left=tt.number(ti.left,ta.left,tc)),null!=ta.right&&null!=ti.right&&(this.right=tt.number(ti.right,ta.right,tc)),this},wo.prototype.getCenter=function(ti,ta){var tc=tt.clamp((this.left+ti-this.right)/2,0,ti),th=tt.clamp((this.top+ta-this.bottom)/2,0,ta);return new tt.Point(tc,th)},wo.prototype.equals=function(tt){return this.top===tt.top&&this.bottom===tt.bottom&&this.left===tt.left&&this.right===tt.right},wo.prototype.clone=function(){return new wo(this.top,this.bottom,this.left,this.right)},wo.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var To=function(ti,ta,tc,th,tf){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===tf||tf,this._minZoom=ti||0,this._maxZoom=ta||22,this._minPitch=null==tc?0:tc,this._maxPitch=null==th?60:th,this.setMaxBounds(),this.width=0,this.height=0,this._center=new tt.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wo,this._posMatrixCache={},this._alignedPosMatrixCache={}},eB={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};To.prototype.clone=function(){var tt=new To(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return tt.tileSize=this.tileSize,tt.latRange=this.latRange,tt.width=this.width,tt.height=this.height,tt._center=this._center,tt.zoom=this.zoom,tt.angle=this.angle,tt._fov=this._fov,tt._pitch=this._pitch,tt._unmodified=this._unmodified,tt._edgeInsets=this._edgeInsets.clone(),tt._calcMatrices(),tt},eB.minZoom.get=function(){return this._minZoom},eB.minZoom.set=function(tt){this._minZoom!==tt&&(this._minZoom=tt,this.zoom=Math.max(this.zoom,tt))},eB.maxZoom.get=function(){return this._maxZoom},eB.maxZoom.set=function(tt){this._maxZoom!==tt&&(this._maxZoom=tt,this.zoom=Math.min(this.zoom,tt))},eB.minPitch.get=function(){return this._minPitch},eB.minPitch.set=function(tt){this._minPitch!==tt&&(this._minPitch=tt,this.pitch=Math.max(this.pitch,tt))},eB.maxPitch.get=function(){return this._maxPitch},eB.maxPitch.set=function(tt){this._maxPitch!==tt&&(this._maxPitch=tt,this.pitch=Math.min(this.pitch,tt))},eB.renderWorldCopies.get=function(){return this._renderWorldCopies},eB.renderWorldCopies.set=function(tt){void 0===tt?tt=!0:null===tt&&(tt=!1),this._renderWorldCopies=tt},eB.worldSize.get=function(){return this.tileSize*this.scale},eB.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},eB.size.get=function(){return new tt.Point(this.width,this.height)},eB.bearing.get=function(){return-this.angle/Math.PI*180},eB.bearing.set=function(ti){var ta=-tt.wrap(ti,-180,180)*Math.PI/180;this.angle!==ta&&(this._unmodified=!1,this.angle=ta,this._calcMatrices(),this.rotationMatrix=tt.create$2(),tt.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},eB.pitch.get=function(){return this._pitch/Math.PI*180},eB.pitch.set=function(ti){var ta=tt.clamp(ti,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==ta&&(this._unmodified=!1,this._pitch=ta,this._calcMatrices())},eB.fov.get=function(){return this._fov/Math.PI*180},eB.fov.set=function(tt){tt=Math.max(.01,Math.min(60,tt)),this._fov!==tt&&(this._unmodified=!1,this._fov=tt/180*Math.PI,this._calcMatrices())},eB.zoom.get=function(){return this._zoom},eB.zoom.set=function(tt){var ti=Math.min(Math.max(tt,this.minZoom),this.maxZoom);this._zoom!==ti&&(this._unmodified=!1,this._zoom=ti,this.scale=this.zoomScale(ti),this.tileZoom=Math.floor(ti),this.zoomFraction=ti-this.tileZoom,this._constrain(),this._calcMatrices())},eB.center.get=function(){return this._center},eB.center.set=function(tt){tt.lat===this._center.lat&&tt.lng===this._center.lng||(this._unmodified=!1,this._center=tt,this._constrain(),this._calcMatrices())},eB.padding.get=function(){return this._edgeInsets.toJSON()},eB.padding.set=function(tt){this._edgeInsets.equals(tt)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,tt,1),this._calcMatrices())},eB.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},To.prototype.isPaddingEqual=function(tt){return this._edgeInsets.equals(tt)},To.prototype.interpolatePadding=function(tt,ti,ta){this._unmodified=!1,this._edgeInsets.interpolate(tt,ti,ta),this._constrain(),this._calcMatrices()},To.prototype.coveringZoomLevel=function(tt){return Math.max(0,(tt.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/tt.tileSize)))},To.prototype.getVisibleUnwrappedCoordinates=function(ti){var ta=[new tt.UnwrappedTileID(0,ti)];if(this._renderWorldCopies)for(var tc=this.pointCoordinate(new tt.Point(0,0)),th=this.pointCoordinate(new tt.Point(this.width,0)),tf=this.pointCoordinate(new tt.Point(this.width,this.height)),td=this.pointCoordinate(new tt.Point(0,this.height)),tm=Math.floor(Math.min(tc.x,th.x,tf.x,td.x)),ty=Math.floor(Math.max(tc.x,th.x,tf.x,td.x)),tg=tm-1;tg<=ty+1;tg++)0!==tg&&ta.push(new tt.UnwrappedTileID(tg,ti));return ta},To.prototype.coveringTiles=function(ti){var ta=this.coveringZoomLevel(ti),tc=ta;if(void 0!==ti.minzoom&&ta<ti.minzoom)return[];void 0!==ti.maxzoom&&ta>ti.maxzoom&&(ta=ti.maxzoom);var th=tt.MercatorCoordinate.fromLngLat(this.center),tf=Math.pow(2,ta),td=[tf*th.x,tf*th.y,0],tm=xo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ta),ty=ti.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(ty=ta);var c=function(tt){return{aabb:new bo([tt*tf,0,0],[(tt+1)*tf,tf,0]),zoom:0,x:0,y:0,wrap:tt,fullyVisible:!1}},tg=[],t_=[],tv=ta,tx=ti.reparseOverscaled?tc:ta;if(this._renderWorldCopies)for(var tb=1;tb<=3;tb++)tg.push(c(-tb)),tg.push(c(tb));for(tg.push(c(0));tg.length>0;){var tw=tg.pop(),tS=tw.x,tT=tw.y,tI=tw.fullyVisible;if(!tI){var tE=tw.aabb.intersects(tm);if(0===tE)continue;tI=2===tE}var tA=Math.max(Math.abs(tw.aabb.distanceX(td)),Math.abs(tw.aabb.distanceY(td)));if(tw.zoom===tv||tA>3+(1<<tv-tw.zoom)-2&&tw.zoom>=ty)t_.push({tileID:new tt.OverscaledTileID(tw.zoom===tv?tx:tw.zoom,tw.wrap,tw.zoom,tS,tT),distanceSq:tt.sqrLen([td[0]-.5-tS,td[1]-.5-tT])});else for(var tP=0;tP<4;tP++){var tz=(tS<<1)+tP%2,tC=(tT<<1)+(tP>>1);tg.push({aabb:tw.aabb.quadrant(tP),zoom:tw.zoom+1,x:tz,y:tC,wrap:tw.wrap,fullyVisible:tI})}}return t_.sort(function(tt,ti){return tt.distanceSq-ti.distanceSq}).map(function(tt){return tt.tileID})},To.prototype.resize=function(tt,ti){this.width=tt,this.height=ti,this.pixelsToGLUnits=[2/tt,-2/ti],this._constrain(),this._calcMatrices()},eB.unmodified.get=function(){return this._unmodified},To.prototype.zoomScale=function(tt){return Math.pow(2,tt)},To.prototype.scaleZoom=function(tt){return Math.log(tt)/Math.LN2},To.prototype.project=function(ti){var ta=tt.clamp(ti.lat,-this.maxValidLatitude,this.maxValidLatitude);return new tt.Point(tt.mercatorXfromLng(ti.lng)*this.worldSize,tt.mercatorYfromLat(ta)*this.worldSize)},To.prototype.unproject=function(ti){return new tt.MercatorCoordinate(ti.x/this.worldSize,ti.y/this.worldSize).toLngLat()},eB.point.get=function(){return this.project(this.center)},To.prototype.setLocationAtPoint=function(ti,ta){var tc=this.pointCoordinate(ta),th=this.pointCoordinate(this.centerPoint),tf=this.locationCoordinate(ti),td=new tt.MercatorCoordinate(tf.x-(tc.x-th.x),tf.y-(tc.y-th.y));this.center=this.coordinateLocation(td),this._renderWorldCopies&&(this.center=this.center.wrap())},To.prototype.locationPoint=function(tt){return this.coordinatePoint(this.locationCoordinate(tt))},To.prototype.pointLocation=function(tt){return this.coordinateLocation(this.pointCoordinate(tt))},To.prototype.locationCoordinate=function(ti){return tt.MercatorCoordinate.fromLngLat(ti)},To.prototype.coordinateLocation=function(tt){return tt.toLngLat()},To.prototype.pointCoordinate=function(ti){var ta=[ti.x,ti.y,0,1],tc=[ti.x,ti.y,1,1];tt.transformMat4(ta,ta,this.pixelMatrixInverse),tt.transformMat4(tc,tc,this.pixelMatrixInverse);var th=ta[3],tf=tc[3],td=ta[1]/th,tm=tc[1]/tf,ty=ta[2]/th,tg=tc[2]/tf,t_=ty===tg?0:(0-ty)/(tg-ty);return new tt.MercatorCoordinate(tt.number(ta[0]/th,tc[0]/tf,t_)/this.worldSize,tt.number(td,tm,t_)/this.worldSize)},To.prototype.coordinatePoint=function(ti){var ta=[ti.x*this.worldSize,ti.y*this.worldSize,0,1];return tt.transformMat4(ta,ta,this.pixelMatrix),new tt.Point(ta[0]/ta[3],ta[1]/ta[3])},To.prototype.getBounds=function(){return(new tt.LngLatBounds).extend(this.pointLocation(new tt.Point(0,0))).extend(this.pointLocation(new tt.Point(this.width,0))).extend(this.pointLocation(new tt.Point(this.width,this.height))).extend(this.pointLocation(new tt.Point(0,this.height)))},To.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new tt.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},To.prototype.setMaxBounds=function(tt){tt?(this.lngRange=[tt.getWest(),tt.getEast()],this.latRange=[tt.getSouth(),tt.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},To.prototype.calculatePosMatrix=function(ti,ta){void 0===ta&&(ta=!1);var tc=ti.key,th=ta?this._alignedPosMatrixCache:this._posMatrixCache;if(th[tc])return th[tc];var tf=ti.canonical,td=this.worldSize/this.zoomScale(tf.z),tm=tf.x+Math.pow(2,tf.z)*ti.wrap,ty=tt.identity(new Float64Array(16));return tt.translate(ty,ty,[tm*td,tf.y*td,0]),tt.scale(ty,ty,[td/tt.EXTENT,td/tt.EXTENT,1]),tt.multiply(ty,ta?this.alignedProjMatrix:this.projMatrix,ty),th[tc]=new Float32Array(ty),th[tc]},To.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},To.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var ti,ta,tc,th,tf=-90,td=90,tm=-180,ty=180,tg=this.size,t_=this._unmodified;if(this.latRange){var tv=this.latRange;tf=tt.mercatorYfromLat(tv[1])*this.worldSize,ti=(td=tt.mercatorYfromLat(tv[0])*this.worldSize)-tf<tg.y?tg.y/(td-tf):0}if(this.lngRange){var tx=this.lngRange;tm=tt.mercatorXfromLng(tx[0])*this.worldSize,ta=(ty=tt.mercatorXfromLng(tx[1])*this.worldSize)-tm<tg.x?tg.x/(ty-tm):0}var tb=this.point,tw=Math.max(ta||0,ti||0);if(tw)return this.center=this.unproject(new tt.Point(ta?(ty+tm)/2:tb.x,ti?(td+tf)/2:tb.y)),this.zoom+=this.scaleZoom(tw),this._unmodified=t_,void(this._constraining=!1);if(this.latRange){var tS=tb.y,tT=tg.y/2;tS-tT<tf&&(th=tf+tT),tS+tT>td&&(th=td-tT)}if(this.lngRange){var tI=tb.x,tE=tg.x/2;tI-tE<tm&&(tc=tm+tE),tI+tE>ty&&(tc=ty-tE)}void 0===tc&&void 0===th||(this.center=this.unproject(new tt.Point(void 0!==tc?tc:tb.x,void 0!==th?th:tb.y))),this._unmodified=t_,this._constraining=!1}},To.prototype._calcMatrices=function(){if(this.height){var ti=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var ta=Math.PI/2+this._pitch,tc=this._fov*(.5+ti.y/this.height),th=Math.sin(tc)*this.cameraToCenterDistance/Math.sin(tt.clamp(Math.PI-ta-tc,.01,Math.PI-.01)),tf=this.point,td=tf.x,tm=tf.y,ty=1.01*(Math.cos(Math.PI/2-this._pitch)*th+this.cameraToCenterDistance),tg=this.height/50,t_=new Float64Array(16);tt.perspective(t_,this._fov,this.width/this.height,tg,ty),t_[8]=-(2*ti.x)/this.width,t_[9]=2*ti.y/this.height,tt.scale(t_,t_,[1,-1,1]),tt.translate(t_,t_,[0,0,-this.cameraToCenterDistance]),tt.rotateX(t_,t_,this._pitch),tt.rotateZ(t_,t_,this.angle),tt.translate(t_,t_,[-td,-tm,0]),this.mercatorMatrix=tt.scale([],t_,[this.worldSize,this.worldSize,this.worldSize]),tt.scale(t_,t_,[1,1,tt.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=t_,this.invProjMatrix=tt.invert([],this.projMatrix);var tv=this.width%2/2,tx=this.height%2/2,tb=Math.cos(this.angle),tw=Math.sin(this.angle),tS=td-Math.round(td)+tb*tv+tw*tx,tT=tm-Math.round(tm)+tb*tx+tw*tv,tI=new Float64Array(t_);if(tt.translate(tI,tI,[tS>.5?tS-1:tS,tT>.5?tT-1:tT,0]),this.alignedProjMatrix=tI,t_=tt.create(),tt.scale(t_,t_,[this.width/2,-this.height/2,1]),tt.translate(t_,t_,[1,-1,0]),this.labelPlaneMatrix=t_,t_=tt.create(),tt.scale(t_,t_,[1,-1,1]),tt.translate(t_,t_,[-1,-1,0]),tt.scale(t_,t_,[2/this.width,2/this.height,1]),this.glCoordMatrix=t_,this.pixelMatrix=tt.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(t_=tt.invert(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");this.pixelMatrixInverse=t_,this._posMatrixCache={},this._alignedPosMatrixCache={}}},To.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var ti=this.pointCoordinate(new tt.Point(0,0)),ta=[ti.x*this.worldSize,ti.y*this.worldSize,0,1];return tt.transformMat4(ta,ta,this.pixelMatrix)[3]/this.cameraToCenterDistance},To.prototype.getCameraPoint=function(){var ti=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new tt.Point(0,ti))},To.prototype.getCameraQueryGeometry=function(ti){var ta=this.getCameraPoint();if(1===ti.length)return[ti[0],ta];for(var tc=ta.x,th=ta.y,tf=ta.x,td=ta.y,tm=0;tm<ti.length;tm+=1){var ty=ti[tm];tc=Math.min(tc,ty.x),th=Math.min(th,ty.y),tf=Math.max(tf,ty.x),td=Math.max(td,ty.y)}return[new tt.Point(tc,th),new tt.Point(tf,th),new tt.Point(tf,td),new tt.Point(tc,td),new tt.Point(tc,th)]},Object.defineProperties(To.prototype,eB);var Io=function(ti){var ta,tc,th,tf;this._hashName=ti&&encodeURIComponent(ti),tt.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(ta=this._updateHashUnthrottled.bind(this),tc=!1,th=null,tf=function(){th=null,tc&&(ta(),th=setTimeout(tf,300),tc=!1)},function(){return tc=!0,th||tf(),th})};Io.prototype.addTo=function(ti){return this._map=ti,tt.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Io.prototype.remove=function(){return tt.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Io.prototype.getHashString=function(ti){var ta=this._map.getCenter(),tc=Math.round(100*this._map.getZoom())/100,th=Math.pow(10,Math.ceil((tc*Math.LN2+Math.log(512/360/.5))/Math.LN10)),tf=Math.round(ta.lng*th)/th,td=Math.round(ta.lat*th)/th,tm=this._map.getBearing(),ty=this._map.getPitch(),tg="";if(tg+=ti?"/"+tf+"/"+td+"/"+tc:tc+"/"+td+"/"+tf,(tm||ty)&&(tg+="/"+Math.round(10*tm)/10),ty&&(tg+="/"+Math.round(ty)),this._hashName){var t_=this._hashName,tv=!1,tx=tt.window.location.hash.slice(1).split("&").map(function(tt){var ti=tt.split("=")[0];return ti===t_?(tv=!0,ti+"="+tg):tt}).filter(function(tt){return tt});return tv||tx.push(t_+"="+tg),"#"+tx.join("&")}return"#"+tg},Io.prototype._getCurrentHash=function(){var ti,ta=this,tc=tt.window.location.hash.replace("#","");return this._hashName?(tc.split("&").map(function(tt){return tt.split("=")}).forEach(function(tt){tt[0]===ta._hashName&&(ti=tt)}),(ti&&ti[1]||"").split("/")):tc.split("/")},Io.prototype._onHashChange=function(){var tt=this._getCurrentHash();if(tt.length>=3&&!tt.some(function(tt){return isNaN(tt)})){var ti=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(tt[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+tt[2],+tt[1]],zoom:+tt[0],bearing:ti,pitch:+(tt[4]||0)}),!0}return!1},Io.prototype._updateHashUnthrottled=function(){var ti=tt.window.location.href.replace(/(#.+)?$/,this.getHashString());try{tt.window.history.replaceState(tt.window.history.state,null,ti)}catch(tt){}};var eR={linearity:.3,easing:tt.bezier(0,0,.3,1)},eO=tt.extend({deceleration:2500,maxSpeed:1400},eR),eF=tt.extend({deceleration:20,maxSpeed:1400},eR),eU=tt.extend({deceleration:1e3,maxSpeed:360},eR),eV=tt.extend({deceleration:1e3,maxSpeed:90},eR),Ao=function(tt){this._map=tt,this.clear()};function Mo(tt,ti){(!tt.duration||tt.duration<ti.duration)&&(tt.duration=ti.duration,tt.easing=ti.easing)}function Lo(ti,ta,tc){var th=tc.maxSpeed,tf=tc.linearity,td=tc.deceleration,tm=tt.clamp(ti*tf/(ta/1e3),-th,th),ty=Math.abs(tm)/(td*tf);return{easing:tc.easing,duration:1e3*ty,amount:tm*(ty/2)}}Ao.prototype.clear=function(){this._inertiaBuffer=[]},Ao.prototype.record=function(ti){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:tt.browser.now(),settings:ti})},Ao.prototype._drainInertiaBuffer=function(){for(var ti=this._inertiaBuffer,ta=tt.browser.now();ti.length>0&&ta-ti[0].time>160;)ti.shift()},Ao.prototype._onMoveEnd=function(ti){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var ta={zoom:0,bearing:0,pitch:0,pan:new tt.Point(0,0),pinchAround:void 0,around:void 0},tc=0,th=this._inertiaBuffer;tc<th.length;tc+=1){var tf=th[tc].settings;ta.zoom+=tf.zoomDelta||0,ta.bearing+=tf.bearingDelta||0,ta.pitch+=tf.pitchDelta||0,tf.panDelta&&ta.pan._add(tf.panDelta),tf.around&&(ta.around=tf.around),tf.pinchAround&&(ta.pinchAround=tf.pinchAround)}var td=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,tm={};if(ta.pan.mag()){var ty=Lo(ta.pan.mag(),td,tt.extend({},eO,ti||{}));tm.offset=ta.pan.mult(ty.amount/ta.pan.mag()),tm.center=this._map.transform.center,Mo(tm,ty)}if(ta.zoom){var tg=Lo(ta.zoom,td,eF);tm.zoom=this._map.transform.zoom+tg.amount,Mo(tm,tg)}if(ta.bearing){var t_=Lo(ta.bearing,td,eU);tm.bearing=this._map.transform.bearing+tt.clamp(t_.amount,-179,179),Mo(tm,t_)}if(ta.pitch){var tv=Lo(ta.pitch,td,eV);tm.pitch=this._map.transform.pitch+tv.amount,Mo(tm,tv)}if(tm.zoom||tm.bearing){var tx=void 0===ta.pinchAround?ta.around:ta.pinchAround;tm.around=tx?this._map.unproject(tx):this._map.getCenter()}return this.clear(),tt.extend(tm,{noMoveStart:!0})}};var eN=function(ti){function o(tc,th,tf,td){void 0===td&&(td={});var tm=ta.mousePos(th.getCanvasContainer(),tf),ty=th.unproject(tm);ti.call(this,tc,tt.extend({point:tm,lngLat:ty,originalEvent:tf},td)),this._defaultPrevented=!1,this.target=th}ti&&(o.__proto__=ti),(o.prototype=Object.create(ti&&ti.prototype)).constructor=o;var tc={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},tc.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,tc),o}(tt.Event),ej=function(ti){function o(tc,th,tf){var td="touchend"===tc?tf.changedTouches:tf.touches,tm=ta.touchPos(th.getCanvasContainer(),td),ty=tm.map(function(tt){return th.unproject(tt)}),tg=tm.reduce(function(tt,ti,ta,tc){return tt.add(ti.div(tc.length))},new tt.Point(0,0)),t_=th.unproject(tg);ti.call(this,tc,{points:tm,point:tg,lngLats:ty,lngLat:t_,originalEvent:tf}),this._defaultPrevented=!1}ti&&(o.__proto__=ti),(o.prototype=Object.create(ti&&ti.prototype)).constructor=o;var tc={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},tc.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,tc),o}(tt.Event),eq=function(tt){function e(ti,ta,tc){tt.call(this,ti,{originalEvent:tc}),this._defaultPrevented=!1}tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e;var ti={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},ti.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,ti),e}(tt.Event),Oo=function(tt,ti){this._map=tt,this._clickTolerance=ti.clickTolerance};Oo.prototype.reset=function(){delete this._mousedownPos},Oo.prototype.wheel=function(tt){return this._firePreventable(new eq(tt.type,this._map,tt))},Oo.prototype.mousedown=function(tt,ti){return this._mousedownPos=ti,this._firePreventable(new eN(tt.type,this._map,tt))},Oo.prototype.mouseup=function(tt){this._map.fire(new eN(tt.type,this._map,tt))},Oo.prototype.click=function(tt,ti){this._mousedownPos&&this._mousedownPos.dist(ti)>=this._clickTolerance||this._map.fire(new eN(tt.type,this._map,tt))},Oo.prototype.dblclick=function(tt){return this._firePreventable(new eN(tt.type,this._map,tt))},Oo.prototype.mouseover=function(tt){this._map.fire(new eN(tt.type,this._map,tt))},Oo.prototype.mouseout=function(tt){this._map.fire(new eN(tt.type,this._map,tt))},Oo.prototype.touchstart=function(tt){return this._firePreventable(new ej(tt.type,this._map,tt))},Oo.prototype.touchmove=function(tt){this._map.fire(new ej(tt.type,this._map,tt))},Oo.prototype.touchend=function(tt){this._map.fire(new ej(tt.type,this._map,tt))},Oo.prototype.touchcancel=function(tt){this._map.fire(new ej(tt.type,this._map,tt))},Oo.prototype._firePreventable=function(tt){if(this._map.fire(tt),tt.defaultPrevented)return{}},Oo.prototype.isEnabled=function(){return!0},Oo.prototype.isActive=function(){return!1},Oo.prototype.enable=function(){},Oo.prototype.disable=function(){};var Fo=function(tt){this._map=tt};Fo.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fo.prototype.mousemove=function(tt){this._map.fire(new eN(tt.type,this._map,tt))},Fo.prototype.mousedown=function(){this._delayContextMenu=!0},Fo.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new eN("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fo.prototype.contextmenu=function(tt){this._delayContextMenu?this._contextMenuEvent=tt:this._map.fire(new eN(tt.type,this._map,tt)),this._map.listens("contextmenu")&&tt.preventDefault()},Fo.prototype.isEnabled=function(){return!0},Fo.prototype.isActive=function(){return!1},Fo.prototype.enable=function(){},Fo.prototype.disable=function(){};var Uo=function(tt,ti){this._map=tt,this._el=tt.getCanvasContainer(),this._container=tt.getContainer(),this._clickTolerance=ti.clickTolerance||1};function No(tt,ti){for(var ta={},tc=0;tc<tt.length;tc++)ta[tt[tc].identifier]=ti[tc];return ta}Uo.prototype.isEnabled=function(){return!!this._enabled},Uo.prototype.isActive=function(){return!!this._active},Uo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Uo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Uo.prototype.mousedown=function(tt,ti){this.isEnabled()&&tt.shiftKey&&0===tt.button&&(ta.disableDrag(),this._startPos=this._lastPos=ti,this._active=!0)},Uo.prototype.mousemoveWindow=function(tt,ti){if(this._active&&!(this._lastPos.equals(ti)||!this._box&&ti.dist(this._startPos)<this._clickTolerance)){var tc=this._startPos;this._lastPos=ti,this._box||(this._box=ta.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",tt));var th=Math.min(tc.x,ti.x),tf=Math.max(tc.x,ti.x),td=Math.min(tc.y,ti.y),tm=Math.max(tc.y,ti.y);ta.setTransform(this._box,"translate("+th+"px,"+td+"px)"),this._box.style.width=tf-th+"px",this._box.style.height=tm-td+"px"}},Uo.prototype.mouseupWindow=function(ti,tc){var th=this;if(this._active&&0===ti.button){var tf=this._startPos;if(this.reset(),ta.suppressClick(),tf.x!==tc.x||tf.y!==tc.y)return this._map.fire(new tt.Event("boxzoomend",{originalEvent:ti})),{cameraAnimation:function(tt){return tt.fitScreenCoordinates(tf,tc,th._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",ti)}},Uo.prototype.keydown=function(tt){this._active&&27===tt.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",tt))},Uo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ta.remove(this._box),this._box=null),ta.enableDrag(),delete this._startPos,delete this._lastPos},Uo.prototype._fireEvent=function(ti,ta){return this._map.fire(new tt.Event(ti,{originalEvent:ta}))};var Zo=function(tt){this.reset(),this.numTouches=tt.numTouches};Zo.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Zo.prototype.touchstart=function(ti,ta,tc){(this.centroid||tc.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=ti.timeStamp),tc.length===this.numTouches&&(this.centroid=function(ti){for(var ta=new tt.Point(0,0),tc=0;tc<ti.length;tc+=1)ta._add(ti[tc]);return ta.div(ti.length)}(ta),this.touches=No(tc,ta)))},Zo.prototype.touchmove=function(tt,ti,ta){if(!this.aborted&&this.centroid){var tc=No(ta,ti);for(var th in this.touches){var tf=tc[th];(!tf||tf.dist(this.touches[th])>30)&&(this.aborted=!0)}}},Zo.prototype.touchend=function(tt,ti,ta){if((!this.centroid||tt.timeStamp-this.startTime>500)&&(this.aborted=!0),0===ta.length){var tc=!this.aborted&&this.centroid;if(this.reset(),tc)return tc}};var qo=function(tt){this.singleTap=new Zo(tt),this.numTaps=tt.numTaps,this.reset()};qo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},qo.prototype.touchstart=function(tt,ti,ta){this.singleTap.touchstart(tt,ti,ta)},qo.prototype.touchmove=function(tt,ti,ta){this.singleTap.touchmove(tt,ti,ta)},qo.prototype.touchend=function(tt,ti,ta){var tc=this.singleTap.touchend(tt,ti,ta);if(tc){var th=tt.timeStamp-this.lastTime<500,tf=!this.lastTap||30>this.lastTap.dist(tc);if(th&&tf||this.reset(),this.count++,this.lastTime=tt.timeStamp,this.lastTap=tc,this.count===this.numTaps)return this.reset(),tc}};var jo=function(){this._zoomIn=new qo({numTouches:1,numTaps:2}),this._zoomOut=new qo({numTouches:2,numTaps:1}),this.reset()};jo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},jo.prototype.touchstart=function(tt,ti,ta){this._zoomIn.touchstart(tt,ti,ta),this._zoomOut.touchstart(tt,ti,ta)},jo.prototype.touchmove=function(tt,ti,ta){this._zoomIn.touchmove(tt,ti,ta),this._zoomOut.touchmove(tt,ti,ta)},jo.prototype.touchend=function(tt,ti,ta){var tc=this,th=this._zoomIn.touchend(tt,ti,ta),tf=this._zoomOut.touchend(tt,ti,ta);return th?(this._active=!0,tt.preventDefault(),setTimeout(function(){return tc.reset()},0),{cameraAnimation:function(ti){return ti.easeTo({duration:300,zoom:ti.getZoom()+1,around:ti.unproject(th)},{originalEvent:tt})}}):tf?(this._active=!0,tt.preventDefault(),setTimeout(function(){return tc.reset()},0),{cameraAnimation:function(ti){return ti.easeTo({duration:300,zoom:ti.getZoom()-1,around:ti.unproject(tf)},{originalEvent:tt})}}):void 0},jo.prototype.touchcancel=function(){this.reset()},jo.prototype.enable=function(){this._enabled=!0},jo.prototype.disable=function(){this._enabled=!1,this.reset()},jo.prototype.isEnabled=function(){return this._enabled},jo.prototype.isActive=function(){return this._active};var eZ={0:1,2:2},Go=function(tt){this.reset(),this._clickTolerance=tt.clickTolerance||1};Go.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Go.prototype._correctButton=function(tt,ti){return!1},Go.prototype._move=function(tt,ti){return{}},Go.prototype.mousedown=function(tt,ti){if(!this._lastPoint){var tc=ta.mouseButton(tt);this._correctButton(tt,tc)&&(this._lastPoint=ti,this._eventButton=tc)}},Go.prototype.mousemoveWindow=function(tt,ti){var ta,tc=this._lastPoint;if(tc){if(tt.preventDefault(),ta=eZ[this._eventButton],void 0===tt.buttons||(tt.buttons&ta)!==ta)this.reset();else if(this._moved||!(ti.dist(tc)<this._clickTolerance))return this._moved=!0,this._lastPoint=ti,this._move(tc,ti)}},Go.prototype.mouseupWindow=function(tt){this._lastPoint&&ta.mouseButton(tt)===this._eventButton&&(this._moved&&ta.suppressClick(),this.reset())},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var eG=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.mousedown=function(ti,ta){tt.prototype.mousedown.call(this,ti,ta),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(tt,ti){return 0===ti&&!tt.ctrlKey},e.prototype._move=function(tt,ti){return{around:ti,panDelta:ti.sub(tt)}},e}(Go),eX=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._correctButton=function(tt,ti){return 0===ti&&tt.ctrlKey||2===ti},e.prototype._move=function(tt,ti){var ta=.8*(ti.x-tt.x);if(ta)return this._active=!0,{bearingDelta:ta}},e.prototype.contextmenu=function(tt){tt.preventDefault()},e}(Go),eW=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype._correctButton=function(tt,ti){return 0===ti&&tt.ctrlKey||2===ti},e.prototype._move=function(tt,ti){var ta=-.5*(ti.y-tt.y);if(ta)return this._active=!0,{pitchDelta:ta}},e.prototype.contextmenu=function(tt){tt.preventDefault()},e}(Go),Ko=function(tt){this._minTouches=1,this._clickTolerance=tt.clickTolerance||1,this.reset()};Ko.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new tt.Point(0,0)},Ko.prototype.touchstart=function(tt,ti,ta){return this._calculateTransform(tt,ti,ta)},Ko.prototype.touchmove=function(tt,ti,ta){if(this._active&&!(ta.length<this._minTouches))return tt.preventDefault(),this._calculateTransform(tt,ti,ta)},Ko.prototype.touchend=function(tt,ti,ta){this._calculateTransform(tt,ti,ta),this._active&&ta.length<this._minTouches&&this.reset()},Ko.prototype.touchcancel=function(){this.reset()},Ko.prototype._calculateTransform=function(ti,ta,tc){tc.length>0&&(this._active=!0);var th=No(tc,ta),tf=new tt.Point(0,0),td=new tt.Point(0,0),tm=0;for(var ty in th){var tg=th[ty],t_=this._touches[ty];t_&&(tf._add(tg),td._add(tg.sub(t_)),tm++,th[ty]=tg)}if(this._touches=th,!(tm<this._minTouches)&&td.mag()){var tv=td.div(tm);if(this._sum._add(tv),!(this._sum.mag()<this._clickTolerance))return{around:tf.div(tm),panDelta:tv}}},Ko.prototype.enable=function(){this._enabled=!0},Ko.prototype.disable=function(){this._enabled=!1,this.reset()},Ko.prototype.isEnabled=function(){return this._enabled},Ko.prototype.isActive=function(){return this._active};var Yo=function(){this.reset()};function Jo(tt,ti,ta){for(var tc=0;tc<tt.length;tc++)if(tt[tc].identifier===ta)return ti[tc]}function Qo(tt,ti){return Math.log(tt/ti)/Math.LN2}Yo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Yo.prototype._start=function(tt){},Yo.prototype._move=function(tt,ti,ta){return{}},Yo.prototype.touchstart=function(tt,ti,ta){this._firstTwoTouches||ta.length<2||(this._firstTwoTouches=[ta[0].identifier,ta[1].identifier],this._start([ti[0],ti[1]]))},Yo.prototype.touchmove=function(tt,ti,ta){if(this._firstTwoTouches){tt.preventDefault();var tc=this._firstTwoTouches,th=tc[1],tf=Jo(ta,ti,tc[0]),td=Jo(ta,ti,th);if(tf&&td){var tm=this._aroundCenter?null:tf.add(td).div(2);return this._move([tf,td],tm,tt)}}},Yo.prototype.touchend=function(tt,ti,tc){if(this._firstTwoTouches){var th=this._firstTwoTouches,tf=th[1],td=Jo(tc,ti,th[0]),tm=Jo(tc,ti,tf);td&&tm||(this._active&&ta.suppressClick(),this.reset())}},Yo.prototype.touchcancel=function(){this.reset()},Yo.prototype.enable=function(tt){this._enabled=!0,this._aroundCenter=!!tt&&"center"===tt.around},Yo.prototype.disable=function(){this._enabled=!1,this.reset()},Yo.prototype.isEnabled=function(){return this._enabled},Yo.prototype.isActive=function(){return this._active};var eK=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.reset=function(){tt.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(tt){this._startDistance=this._distance=tt[0].dist(tt[1])},e.prototype._move=function(tt,ti){var ta=this._distance;if(this._distance=tt[0].dist(tt[1]),this._active||!(.1>Math.abs(Qo(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:Qo(this._distance,ta),pinchAround:ti}},e}(Yo);function tr(tt,ti){return 180*tt.angleWith(ti)/Math.PI}var eJ=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.reset=function(){tt.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(tt){this._startVector=this._vector=tt[0].sub(tt[1]),this._minDiameter=tt[0].dist(tt[1])},e.prototype._move=function(tt,ti){var ta=this._vector;if(this._vector=tt[0].sub(tt[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,ta),pinchAround:ti}},e.prototype._isBelowThreshold=function(tt){this._minDiameter=Math.min(this._minDiameter,tt.mag());var ti=25/(Math.PI*this._minDiameter)*360;return Math.abs(tr(tt,this._startVector))<ti},e}(Yo);function ir(tt){return Math.abs(tt.y)>Math.abs(tt.x)}var eY=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e.prototype.reset=function(){tt.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(tt){this._lastPoints=tt,ir(tt[0].sub(tt[1]))&&(this._valid=!1)},e.prototype._move=function(tt,ti,ta){var tc=tt[0].sub(this._lastPoints[0]),th=tt[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(tc,th,ta.timeStamp),this._valid)return this._lastPoints=tt,this._active=!0,{pitchDelta:-((tc.y+th.y)/2*.5)}},e.prototype.gestureBeginsVertically=function(tt,ti,ta){if(void 0!==this._valid)return this._valid;var tc=tt.mag()>=2,th=ti.mag()>=2;if(tc||th){if(!tc||!th)return void 0===this._firstMove&&(this._firstMove=ta),ta-this._firstMove<100&&void 0;var tf=tt.y>0==ti.y>0;return ir(tt)&&ir(ti)&&tf}},e}(Yo),ar=function(){this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1};function nr(tt){return tt*(2-tt)}ar.prototype.reset=function(){this._active=!1},ar.prototype.keydown=function(tt){var ti=this;if(!(tt.altKey||tt.ctrlKey||tt.metaKey)){var ta=0,tc=0,th=0,tf=0,td=0;switch(tt.keyCode){case 61:case 107:case 171:case 187:ta=1;break;case 189:case 109:case 173:ta=-1;break;case 37:tt.shiftKey?tc=-1:(tt.preventDefault(),tf=-1);break;case 39:tt.shiftKey?tc=1:(tt.preventDefault(),tf=1);break;case 38:tt.shiftKey?th=1:(tt.preventDefault(),td=-1);break;case 40:tt.shiftKey?th=-1:(tt.preventDefault(),td=1);break;default:return}return this._rotationDisabled&&(tc=0,th=0),{cameraAnimation:function(tm){var ty=tm.getZoom();tm.easeTo({duration:300,easeId:"keyboardHandler",easing:nr,zoom:ta?Math.round(ty)+ta*(tt.shiftKey?2:1):ty,bearing:tm.getBearing()+tc*ti._bearingStep,pitch:tm.getPitch()+th*ti._pitchStep,offset:[-tf*ti._panStep,-td*ti._panStep],center:tm.getCenter()},{originalEvent:tt})}}}},ar.prototype.enable=function(){this._enabled=!0},ar.prototype.disable=function(){this._enabled=!1,this.reset()},ar.prototype.isEnabled=function(){return this._enabled},ar.prototype.isActive=function(){return this._active},ar.prototype.disableRotation=function(){this._rotationDisabled=!0},ar.prototype.enableRotation=function(){this._rotationDisabled=!1};var sr=function(ti,ta){this._map=ti,this._el=ti.getCanvasContainer(),this._handler=ta,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,tt.bindAll(["_onTimeout"],this)};sr.prototype.setZoomRate=function(tt){this._defaultZoomRate=tt},sr.prototype.setWheelZoomRate=function(tt){this._wheelZoomRate=tt},sr.prototype.isEnabled=function(){return!!this._enabled},sr.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},sr.prototype.isZooming=function(){return!!this._zooming},sr.prototype.enable=function(tt){this.isEnabled()||(this._enabled=!0,this._aroundCenter=tt&&"center"===tt.around)},sr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},sr.prototype.wheel=function(ti){if(this.isEnabled()){var ta=ti.deltaMode===tt.window.WheelEvent.DOM_DELTA_LINE?40*ti.deltaY:ti.deltaY,tc=tt.browser.now(),th=tc-(this._lastWheelEventTime||0);this._lastWheelEventTime=tc,0!==ta&&ta%4.000244140625==0?this._type="wheel":0!==ta&&4>Math.abs(ta)?this._type="trackpad":th>400?(this._type=null,this._lastValue=ta,this._timeout=setTimeout(this._onTimeout,40,ti)):this._type||(this._type=200>Math.abs(th*ta)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,ta+=this._lastValue)),ti.shiftKey&&ta&&(ta/=4),this._type&&(this._lastWheelEvent=ti,this._delta-=ta,this._active||this._start(ti)),ti.preventDefault()}},sr.prototype._onTimeout=function(tt){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(tt)},sr.prototype._start=function(ti){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var tc=ta.mousePos(this._el,ti);this._around=tt.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(tc)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},sr.prototype.renderFrame=function(){var ti=this;if(this._frameId&&(this._frameId=null,this.isActive())){var ta=this._map.transform;if(0!==this._delta){var tc="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,th=2/(1+Math.exp(-Math.abs(this._delta*tc)));this._delta<0&&0!==th&&(th=1/th);var tf="number"==typeof this._targetZoom?ta.zoomScale(this._targetZoom):ta.scale;this._targetZoom=Math.min(ta.maxZoom,Math.max(ta.minZoom,ta.scaleZoom(tf*th))),"wheel"===this._type&&(this._startZoom=ta.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var td,tm="number"==typeof this._targetZoom?this._targetZoom:ta.zoom,ty=this._startZoom,tg=this._easing,t_=!1;if("wheel"===this._type&&ty&&tg){var tv=Math.min((tt.browser.now()-this._lastWheelEventTime)/200,1),tx=tg(tv);td=tt.number(ty,tm,tx),tv<1?this._frameId||(this._frameId=!0):t_=!0}else td=tm,t_=!0;return this._active=!0,t_&&(this._active=!1,this._finishTimeout=setTimeout(function(){ti._zooming=!1,ti._handler._triggerRenderFrame(),delete ti._targetZoom,delete ti._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!t_,zoomDelta:td-ta.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},sr.prototype._smoothOutEasing=function(ti){var ta=tt.ease;if(this._prevEase){var tc=this._prevEase,th=(tt.browser.now()-tc.start)/tc.duration,tf=tc.easing(th+.01)-tc.easing(th),td=.27/Math.sqrt(tf*tf+1e-4)*.01,tm=Math.sqrt(.0729-td*td);ta=tt.bezier(td,tm,.25,1)}return this._prevEase={start:tt.browser.now(),duration:ti,easing:ta},ta},sr.prototype.reset=function(){this._active=!1};var lr=function(tt,ti){this._clickZoom=tt,this._tapZoom=ti};lr.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},lr.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},lr.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},lr.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var cr=function(){this.reset()};cr.prototype.reset=function(){this._active=!1},cr.prototype.dblclick=function(tt,ti){return tt.preventDefault(),{cameraAnimation:function(ta){ta.easeTo({duration:300,zoom:ta.getZoom()+(tt.shiftKey?-1:1),around:ta.unproject(ti)},{originalEvent:tt})}}},cr.prototype.enable=function(){this._enabled=!0},cr.prototype.disable=function(){this._enabled=!1,this.reset()},cr.prototype.isEnabled=function(){return this._enabled},cr.prototype.isActive=function(){return this._active};var ur=function(){this._tap=new qo({numTouches:1,numTaps:1}),this.reset()};ur.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ur.prototype.touchstart=function(tt,ti,ta){this._swipePoint||(this._tapTime&&tt.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?ta.length>0&&(this._swipePoint=ti[0],this._swipeTouch=ta[0].identifier):this._tap.touchstart(tt,ti,ta))},ur.prototype.touchmove=function(tt,ti,ta){if(this._tapTime){if(this._swipePoint&&ta[0].identifier===this._swipeTouch){var tc=ti[0],th=tc.y-this._swipePoint.y;return this._swipePoint=tc,tt.preventDefault(),this._active=!0,{zoomDelta:th/128}}}else this._tap.touchmove(tt,ti,ta)},ur.prototype.touchend=function(tt,ti,ta){this._tapTime?this._swipePoint&&0===ta.length&&this.reset():this._tap.touchend(tt,ti,ta)&&(this._tapTime=tt.timeStamp)},ur.prototype.touchcancel=function(){this.reset()},ur.prototype.enable=function(){this._enabled=!0},ur.prototype.disable=function(){this._enabled=!1,this.reset()},ur.prototype.isEnabled=function(){return this._enabled},ur.prototype.isActive=function(){return this._active};var hr=function(tt,ti,ta){this._el=tt,this._mousePan=ti,this._touchPan=ta};hr.prototype.enable=function(tt){this._inertiaOptions=tt||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pr=function(tt,ti,ta){this._pitchWithRotate=tt.pitchWithRotate,this._mouseRotate=ti,this._mousePitch=ta};pr.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pr.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pr.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pr.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var dr=function(tt,ti,ta,tc){this._el=tt,this._touchZoom=ti,this._touchRotate=ta,this._tapDragZoom=tc,this._rotationDisabled=!1,this._enabled=!0};dr.prototype.enable=function(tt){this._touchZoom.enable(tt),this._rotationDisabled||this._touchRotate.enable(tt),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},dr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},dr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},dr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},dr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},dr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _r=function(tt){return tt.zoom||tt.drag||tt.pitch||tt.rotate},eH=function(tt){function e(){tt.apply(this,arguments)}return tt&&(e.__proto__=tt),(e.prototype=Object.create(tt&&tt.prototype)).constructor=e,e}(tt.Event);function mr(tt){return tt.panDelta&&tt.panDelta.mag()||tt.zoomDelta||tt.bearingDelta||tt.pitchDelta}var gr=function(ti,tc){this._map=ti,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ao(ti),this._bearingSnap=tc.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(tc),tt.bindAll(["handleEvent","handleWindowEvent"],this);var th=this._el;this._listeners=[[th,"touchstart",{passive:!0}],[th,"touchmove",{passive:!1}],[th,"touchend",void 0],[th,"touchcancel",void 0],[th,"mousedown",void 0],[th,"mousemove",void 0],[th,"mouseup",void 0],[tt.window.document,"mousemove",{capture:!0}],[tt.window.document,"mouseup",void 0],[th,"mouseover",void 0],[th,"mouseout",void 0],[th,"dblclick",void 0],[th,"click",void 0],[th,"keydown",{capture:!1}],[th,"keyup",void 0],[th,"wheel",{passive:!1}],[th,"contextmenu",void 0],[tt.window,"blur",void 0]];for(var tf=0,td=this._listeners;tf<td.length;tf+=1){var tm=td[tf],ty=tm[0];ta.addEventListener(ty,tm[1],ty===tt.window.document?this.handleWindowEvent:this.handleEvent,tm[2])}};gr.prototype.destroy=function(){for(var ti=0,tc=this._listeners;ti<tc.length;ti+=1){var th=tc[ti],tf=th[0];ta.removeEventListener(tf,th[1],tf===tt.window.document?this.handleWindowEvent:this.handleEvent,th[2])}},gr.prototype._addDefaultHandlers=function(tt){var ti=this._map,ta=ti.getCanvasContainer();this._add("mapEvent",new Oo(ti,tt));var tc=ti.boxZoom=new Uo(ti,tt);this._add("boxZoom",tc);var th=new jo,tf=new cr;ti.doubleClickZoom=new lr(tf,th),this._add("tapZoom",th),this._add("clickZoom",tf);var td=new ur;this._add("tapDragZoom",td);var tm=ti.touchPitch=new eY;this._add("touchPitch",tm);var ty=new eX(tt),tg=new eW(tt);ti.dragRotate=new pr(tt,ty,tg),this._add("mouseRotate",ty,["mousePitch"]),this._add("mousePitch",tg,["mouseRotate"]);var t_=new eG(tt),tv=new Ko(tt);ti.dragPan=new hr(ta,t_,tv),this._add("mousePan",t_),this._add("touchPan",tv,["touchZoom","touchRotate"]);var tx=new eJ,tb=new eK;ti.touchZoomRotate=new dr(ta,tb,tx,td),this._add("touchRotate",tx,["touchPan","touchZoom"]),this._add("touchZoom",tb,["touchPan","touchRotate"]);var tw=ti.scrollZoom=new sr(ti,this);this._add("scrollZoom",tw,["mousePan"]);var tS=ti.keyboard=new ar;this._add("keyboard",tS),this._add("blockableMapEvent",new Fo(ti));for(var tT=0,tI=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];tT<tI.length;tT+=1){var tE=tI[tT];tt.interactive&&tt[tE]&&ti[tE].enable(tt[tE])}},gr.prototype._add=function(tt,ti,ta){this._handlers.push({handlerName:tt,handler:ti,allowed:ta}),this._handlersById[tt]=ti},gr.prototype.stop=function(tt){if(!this._updatingCamera){for(var ti=0,ta=this._handlers;ti<ta.length;ti+=1)ta[ti].handler.reset();this._inertia.clear(),this._fireEvents({},{},tt),this._changes=[]}},gr.prototype.isActive=function(){for(var tt=0,ti=this._handlers;tt<ti.length;tt+=1)if(ti[tt].handler.isActive())return!0;return!1},gr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gr.prototype.isMoving=function(){return!!_r(this._eventsInProgress)||this.isZooming()},gr.prototype._blockedByActive=function(tt,ti,ta){for(var tc in tt)if(tc!==ta&&(!ti||0>ti.indexOf(tc)))return!0;return!1},gr.prototype.handleWindowEvent=function(tt){this.handleEvent(tt,tt.type+"Window")},gr.prototype._getMapTouches=function(tt){for(var ti=[],ta=0;ta<tt.length;ta+=1){var tc=tt[ta];this._el.contains(tc.target)&&ti.push(tc)}return ti},gr.prototype.handleEvent=function(tt,ti){if("blur"!==tt.type){this._updatingCamera=!0;for(var tc="renderFrame"===tt.type?void 0:tt,th={needsRenderFrame:!1},tf={},td={},tm=tt.touches?this._getMapTouches(tt.touches):void 0,ty=tm?ta.touchPos(this._el,tm):ta.mousePos(this._el,tt),tg=0,t_=this._handlers;tg<t_.length;tg+=1){var tv=t_[tg],tx=tv.handlerName,tb=tv.handler,tw=tv.allowed;if(tb.isEnabled()){var tS=void 0;this._blockedByActive(td,tw,tx)?tb.reset():tb[ti||tt.type]&&(tS=tb[ti||tt.type](tt,ty,tm),this.mergeHandlerResult(th,tf,tS,tx,tc),tS&&tS.needsRenderFrame&&this._triggerRenderFrame()),(tS||tb.isActive())&&(td[tx]=tb)}}var tT={};for(var tI in this._previousActiveHandlers)td[tI]||(tT[tI]=tc);this._previousActiveHandlers=td,(Object.keys(tT).length||mr(th))&&(this._changes.push([th,tf,tT]),this._triggerRenderFrame()),(Object.keys(td).length||mr(th))&&this._map._stop(!0),this._updatingCamera=!1;var tE=th.cameraAnimation;tE&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],tE(this._map))}else this.stop(!0)},gr.prototype.mergeHandlerResult=function(ti,ta,tc,th,tf){if(tc){tt.extend(ti,tc);var td={handlerName:th,originalEvent:tc.originalEvent||tf};void 0!==tc.zoomDelta&&(ta.zoom=td),void 0!==tc.panDelta&&(ta.drag=td),void 0!==tc.pitchDelta&&(ta.pitch=td),void 0!==tc.bearingDelta&&(ta.rotate=td)}},gr.prototype._applyChanges=function(){for(var ti={},ta={},tc={},th=0,tf=this._changes;th<tf.length;th+=1){var td=tf[th],tm=td[0],ty=td[1],tg=td[2];tm.panDelta&&(ti.panDelta=(ti.panDelta||new tt.Point(0,0))._add(tm.panDelta)),tm.zoomDelta&&(ti.zoomDelta=(ti.zoomDelta||0)+tm.zoomDelta),tm.bearingDelta&&(ti.bearingDelta=(ti.bearingDelta||0)+tm.bearingDelta),tm.pitchDelta&&(ti.pitchDelta=(ti.pitchDelta||0)+tm.pitchDelta),void 0!==tm.around&&(ti.around=tm.around),void 0!==tm.pinchAround&&(ti.pinchAround=tm.pinchAround),tm.noInertia&&(ti.noInertia=tm.noInertia),tt.extend(ta,ty),tt.extend(tc,tg)}this._updateMapTransform(ti,ta,tc),this._changes=[]},gr.prototype._updateMapTransform=function(tt,ti,ta){var tc=this._map,th=tc.transform;if(!mr(tt))return this._fireEvents(ti,ta,!0);var tf=tt.panDelta,td=tt.zoomDelta,tm=tt.bearingDelta,ty=tt.pitchDelta,tg=tt.around,t_=tt.pinchAround;void 0!==t_&&(tg=t_),tc._stop(!0),tg=tg||tc.transform.centerPoint;var tv=th.pointLocation(tf?tg.sub(tf):tg);tm&&(th.bearing+=tm),ty&&(th.pitch+=ty),td&&(th.zoom+=td),th.setLocationAtPoint(tv,tg),this._map._update(),tt.noInertia||this._inertia.record(tt),this._fireEvents(ti,ta,!0)},gr.prototype._fireEvents=function(ti,ta,tc){var th=this,tf=_r(this._eventsInProgress),td=_r(ti),tm={};for(var ty in ti)this._eventsInProgress[ty]||(tm[ty+"start"]=ti[ty].originalEvent),this._eventsInProgress[ty]=ti[ty];for(var tg in!tf&&td&&this._fireEvent("movestart",td.originalEvent),tm)this._fireEvent(tg,tm[tg]);for(var t_ in td&&this._fireEvent("move",td.originalEvent),ti)this._fireEvent(t_,ti[t_].originalEvent);var tv,tx={};for(var tb in this._eventsInProgress){var tw=this._eventsInProgress[tb],tS=tw.handlerName,tT=tw.originalEvent;this._handlersById[tS].isActive()||(delete this._eventsInProgress[tb],tx[tb+"end"]=tv=ta[tS]||tT)}for(var tI in tx)this._fireEvent(tI,tx[tI]);var tE=_r(this._eventsInProgress);if(tc&&(tf||td)&&!tE){this._updatingCamera=!0;var tA=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(tt){return 0!==tt&&-th._bearingSnap<tt&&tt<th._bearingSnap};tA?(x(tA.bearing||this._map.getBearing())&&(tA.bearing=0),this._map.easeTo(tA,{originalEvent:tv})):(this._map.fire(new tt.Event("moveend",{originalEvent:tv})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gr.prototype._fireEvent=function(ti,ta){this._map.fire(new tt.Event(ti,ta?{originalEvent:ta}:{}))},gr.prototype._requestFrame=function(){var tt=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(ti){delete tt._frameId,tt.handleEvent(new eH("renderFrame",{timeStamp:ti})),tt._applyChanges()})},gr.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var e$=function(ti){function i(ta,tc){ti.call(this),this._moving=!1,this._zooming=!1,this.transform=ta,this._bearingSnap=tc.bearingSnap,tt.bindAll(["_renderFrameCallback"],this)}return ti&&(i.__proto__=ti),(i.prototype=Object.create(ti&&ti.prototype)).constructor=i,i.prototype.getCenter=function(){return new tt.LngLat(this.transform.center.lng,this.transform.center.lat)},i.prototype.setCenter=function(tt,ti){return this.jumpTo({center:tt},ti)},i.prototype.panBy=function(ti,ta,tc){return ti=tt.Point.convert(ti).mult(-1),this.panTo(this.transform.center,tt.extend({offset:ti},ta),tc)},i.prototype.panTo=function(ti,ta,tc){return this.easeTo(tt.extend({center:ti},ta),tc)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(tt,ti){return this.jumpTo({zoom:tt},ti),this},i.prototype.zoomTo=function(ti,ta,tc){return this.easeTo(tt.extend({zoom:ti},ta),tc)},i.prototype.zoomIn=function(tt,ti){return this.zoomTo(this.getZoom()+1,tt,ti),this},i.prototype.zoomOut=function(tt,ti){return this.zoomTo(this.getZoom()-1,tt,ti),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(tt,ti){return this.jumpTo({bearing:tt},ti),this},i.prototype.getPadding=function(){return this.transform.padding},i.prototype.setPadding=function(tt,ti){return this.jumpTo({padding:tt},ti),this},i.prototype.rotateTo=function(ti,ta,tc){return this.easeTo(tt.extend({bearing:ti},ta),tc)},i.prototype.resetNorth=function(ti,ta){return this.rotateTo(0,tt.extend({duration:1e3},ti),ta),this},i.prototype.resetNorthPitch=function(ti,ta){return this.easeTo(tt.extend({bearing:0,pitch:0,duration:1e3},ti),ta),this},i.prototype.snapToNorth=function(tt,ti){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(tt,ti):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(tt,ti){return this.jumpTo({pitch:tt},ti),this},i.prototype.cameraForBounds=function(ti,ta){ti=tt.LngLatBounds.convert(ti);var tc=ta&&ta.bearing||0;return this._cameraForBoxAndBearing(ti.getNorthWest(),ti.getSouthEast(),tc,ta)},i.prototype._cameraForBoxAndBearing=function(ti,ta,tc,th){var tf={top:0,bottom:0,right:0,left:0};if("number"==typeof(th=tt.extend({padding:tf,offset:[0,0],maxZoom:this.transform.maxZoom},th)).padding){var td=th.padding;th.padding={top:td,bottom:td,right:td,left:td}}th.padding=tt.extend(tf,th.padding);var tm=this.transform,ty=tm.padding,tg=tm.project(tt.LngLat.convert(ti)),t_=tm.project(tt.LngLat.convert(ta)),tv=tg.rotate(-tc*Math.PI/180),tx=t_.rotate(-tc*Math.PI/180),tb=new tt.Point(Math.max(tv.x,tx.x),Math.max(tv.y,tx.y)),tw=new tt.Point(Math.min(tv.x,tx.x),Math.min(tv.y,tx.y)),tS=tb.sub(tw),tT=(tm.width-(ty.left+ty.right+th.padding.left+th.padding.right))/tS.x,tI=(tm.height-(ty.top+ty.bottom+th.padding.top+th.padding.bottom))/tS.y;if(!(tI<0||tT<0)){var tE=Math.min(tm.scaleZoom(tm.scale*Math.min(tT,tI)),th.maxZoom),tA="number"==typeof th.offset.x?new tt.Point(th.offset.x,th.offset.y):tt.Point.convert(th.offset),tP=new tt.Point((th.padding.left-th.padding.right)/2,(th.padding.top-th.padding.bottom)/2).rotate(tc*Math.PI/180),tz=tA.add(tP).mult(tm.scale/tm.zoomScale(tE));return{center:tm.unproject(tg.add(t_).div(2).sub(tz)),zoom:tE,bearing:tc}}tt.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},i.prototype.fitBounds=function(tt,ti,ta){return this._fitInternal(this.cameraForBounds(tt,ti),ti,ta)},i.prototype.fitScreenCoordinates=function(ti,ta,tc,th,tf){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(tt.Point.convert(ti)),this.transform.pointLocation(tt.Point.convert(ta)),tc,th),th,tf)},i.prototype._fitInternal=function(ti,ta,tc){return ti?(delete(ta=tt.extend(ti,ta)).padding,ta.linear?this.easeTo(ta,tc):this.flyTo(ta,tc)):this},i.prototype.jumpTo=function(ti,ta){this.stop();var tc=this.transform,th=!1,tf=!1,td=!1;return"zoom"in ti&&tc.zoom!==+ti.zoom&&(th=!0,tc.zoom=+ti.zoom),void 0!==ti.center&&(tc.center=tt.LngLat.convert(ti.center)),"bearing"in ti&&tc.bearing!==+ti.bearing&&(tf=!0,tc.bearing=+ti.bearing),"pitch"in ti&&tc.pitch!==+ti.pitch&&(td=!0,tc.pitch=+ti.pitch),null==ti.padding||tc.isPaddingEqual(ti.padding)||(tc.padding=ti.padding),this.fire(new tt.Event("movestart",ta)).fire(new tt.Event("move",ta)),th&&this.fire(new tt.Event("zoomstart",ta)).fire(new tt.Event("zoom",ta)).fire(new tt.Event("zoomend",ta)),tf&&this.fire(new tt.Event("rotatestart",ta)).fire(new tt.Event("rotate",ta)).fire(new tt.Event("rotateend",ta)),td&&this.fire(new tt.Event("pitchstart",ta)).fire(new tt.Event("pitch",ta)).fire(new tt.Event("pitchend",ta)),this.fire(new tt.Event("moveend",ta))},i.prototype.easeTo=function(ti,ta){var tc=this;this._stop(!1,ti.easeId),(!1===(ti=tt.extend({offset:[0,0],duration:500,easing:tt.ease},ti)).animate||!ti.essential&&tt.browser.prefersReducedMotion)&&(ti.duration=0);var th=this.transform,tf=this.getZoom(),td=this.getBearing(),tm=this.getPitch(),ty=this.getPadding(),tg="zoom"in ti?+ti.zoom:tf,t_="bearing"in ti?this._normalizeBearing(ti.bearing,td):td,tv="pitch"in ti?+ti.pitch:tm,tx="padding"in ti?ti.padding:th.padding,tb=tt.Point.convert(ti.offset),tw=th.centerPoint.add(tb),tS=th.pointLocation(tw),tT=tt.LngLat.convert(ti.center||tS);this._normalizeCenter(tT);var tI,tE,tA=th.project(tS),tP=th.project(tT).sub(tA),tz=th.zoomScale(tg-tf);ti.around&&(tI=tt.LngLat.convert(ti.around),tE=th.locationPoint(tI));var tC={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||tg!==tf,this._rotating=this._rotating||td!==t_,this._pitching=this._pitching||tv!==tm,this._padding=!th.isPaddingEqual(tx),this._easeId=ti.easeId,this._prepareEase(ta,ti.noMoveStart,tC),this._ease(function(ti){if(tc._zooming&&(th.zoom=tt.number(tf,tg,ti)),tc._rotating&&(th.bearing=tt.number(td,t_,ti)),tc._pitching&&(th.pitch=tt.number(tm,tv,ti)),tc._padding&&(th.interpolatePadding(ty,tx,ti),tw=th.centerPoint.add(tb)),tI)th.setLocationAtPoint(tI,tE);else{var tS=th.zoomScale(th.zoom-tf),tT=Math.pow(tg>tf?Math.min(2,tz):Math.max(.5,tz),1-ti),tC=th.unproject(tA.add(tP.mult(ti*tT)).mult(tS));th.setLocationAtPoint(th.renderWorldCopies?tC.wrap():tC,tw)}tc._fireMoveEvents(ta)},function(tt){tc._afterEase(ta,tt)},ti),this},i.prototype._prepareEase=function(ti,ta,tc){void 0===tc&&(tc={}),this._moving=!0,ta||tc.moving||this.fire(new tt.Event("movestart",ti)),this._zooming&&!tc.zooming&&this.fire(new tt.Event("zoomstart",ti)),this._rotating&&!tc.rotating&&this.fire(new tt.Event("rotatestart",ti)),this._pitching&&!tc.pitching&&this.fire(new tt.Event("pitchstart",ti))},i.prototype._fireMoveEvents=function(ti){this.fire(new tt.Event("move",ti)),this._zooming&&this.fire(new tt.Event("zoom",ti)),this._rotating&&this.fire(new tt.Event("rotate",ti)),this._pitching&&this.fire(new tt.Event("pitch",ti))},i.prototype._afterEase=function(ti,ta){if(!this._easeId||!ta||this._easeId!==ta){delete this._easeId;var tc=this._zooming,th=this._rotating,tf=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,tc&&this.fire(new tt.Event("zoomend",ti)),th&&this.fire(new tt.Event("rotateend",ti)),tf&&this.fire(new tt.Event("pitchend",ti)),this.fire(new tt.Event("moveend",ti))}},i.prototype.flyTo=function(ti,ta){var tc=this;if(!ti.essential&&tt.browser.prefersReducedMotion){var th=tt.pick(ti,["center","zoom","bearing","pitch","around"]);return this.jumpTo(th,ta)}this.stop(),ti=tt.extend({offset:[0,0],speed:1.2,curve:1.42,easing:tt.ease},ti);var tf=this.transform,td=this.getZoom(),tm=this.getBearing(),ty=this.getPitch(),tg=this.getPadding(),t_="zoom"in ti?tt.clamp(+ti.zoom,tf.minZoom,tf.maxZoom):td,tv="bearing"in ti?this._normalizeBearing(ti.bearing,tm):tm,tx="pitch"in ti?+ti.pitch:ty,tb="padding"in ti?ti.padding:tf.padding,tw=tf.zoomScale(t_-td),tS=tt.Point.convert(ti.offset),tT=tf.centerPoint.add(tS),tI=tf.pointLocation(tT),tE=tt.LngLat.convert(ti.center||tI);this._normalizeCenter(tE);var tA=tf.project(tI),tP=tf.project(tE).sub(tA),tz=ti.curve,tC=Math.max(tf.width,tf.height),tk=tC/tw,tM=tP.mag();if("minZoom"in ti){var tD=tt.clamp(Math.min(ti.minZoom,td,t_),tf.minZoom,tf.maxZoom);tz=Math.sqrt(tC/tf.zoomScale(tD-td)/tM*2)}var tL=tz*tz;function C(tt){var ti=(tk*tk-tC*tC+(tt?-1:1)*tL*tL*tM*tM)/(2*(tt?tk:tC)*tL*tM);return Math.log(Math.sqrt(ti*ti+1)-ti)}function z(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function D(tt){return(Math.exp(tt)+Math.exp(-tt))/2}var tB=C(0),M=function(tt){return D(tB)/D(tB+tz*tt)},L=function(tt){var ti;return tC*((D(tB)*(z(ti=tB+tz*tt)/D(ti))-z(tB))/tL)/tM},tR=(C(1)-tB)/tz;if(1e-6>Math.abs(tM)||!isFinite(tR)){if(1e-6>Math.abs(tC-tk))return this.easeTo(ti,ta);var tO=tk<tC?-1:1;tR=Math.abs(Math.log(tk/tC))/tz,L=function(){return 0},M=function(tt){return Math.exp(tO*tz*tt)}}return ti.duration="duration"in ti?+ti.duration:1e3*tR/("screenSpeed"in ti?+ti.screenSpeed/tz:+ti.speed),ti.maxDuration&&ti.duration>ti.maxDuration&&(ti.duration=0),this._zooming=!0,this._rotating=tm!==tv,this._pitching=tx!==ty,this._padding=!tf.isPaddingEqual(tb),this._prepareEase(ta,!1),this._ease(function(ti){var th=ti*tR,tw=1/M(th);tf.zoom=1===ti?t_:td+tf.scaleZoom(tw),tc._rotating&&(tf.bearing=tt.number(tm,tv,ti)),tc._pitching&&(tf.pitch=tt.number(ty,tx,ti)),tc._padding&&(tf.interpolatePadding(tg,tb,ti),tT=tf.centerPoint.add(tS));var tI=1===ti?tE:tf.unproject(tA.add(tP.mult(L(th))).mult(tw));tf.setLocationAtPoint(tf.renderWorldCopies?tI.wrap():tI,tT),tc._fireMoveEvents(ta)},function(){return tc._afterEase(ta)},ti),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){return this._stop()},i.prototype._stop=function(tt,ti){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var ta=this._onEaseEnd;delete this._onEaseEnd,ta.call(this,ti)}if(!tt){var tc=this.handlers;tc&&tc.stop(!1)}return this},i.prototype._ease=function(ti,ta,tc){!1===tc.animate||0===tc.duration?(ti(1),ta()):(this._easeStart=tt.browser.now(),this._easeOptions=tc,this._onEaseFrame=ti,this._onEaseEnd=ta,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},i.prototype._renderFrameCallback=function(){var ti=Math.min((tt.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(ti)),ti<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},i.prototype._normalizeBearing=function(ti,ta){var tc=Math.abs((ti=tt.wrap(ti,-180,180))-ta);return Math.abs(ti-360-ta)<tc&&(ti-=360),Math.abs(ti+360-ta)<tc&&(ti+=360),ti},i.prototype._normalizeCenter=function(tt){var ti=this.transform;if(ti.renderWorldCopies&&!ti.lngRange){var ta=tt.lng-ti.center.lng;tt.lng+=ta>180?-360:ta<-180?360:0}},i}(tt.Evented),yr=function(ti){void 0===ti&&(ti={}),this.options=ti,tt.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};yr.prototype.getDefaultPosition=function(){return"bottom-right"},yr.prototype.onAdd=function(tt){var ti=this.options&&this.options.compact;return this._map=tt,this._container=ta.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ta.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ta.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),ti&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===ti&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},yr.prototype.onRemove=function(){ta.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},yr.prototype._setElementTitle=function(tt,ti){var ta=this._map._getUIString("AttributionControl."+ti);tt.title=ta,tt.setAttribute("aria-label",ta)},yr.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},yr.prototype._updateEditLink=function(){var ti=this._editLink;ti||(ti=this._editLink=this._container.querySelector(".mapbox-improve-map"));var ta=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||tt.config.ACCESS_TOKEN}];if(ti){var tc=ta.reduce(function(tt,ti,tc){return ti.value&&(tt+=ti.key+"="+ti.value+(tc<ta.length-1?"&":"")),tt},"?");ti.href=tt.config.FEEDBACK_URL+"/"+tc+(this._map._hash?this._map._hash.getHashString(!0):""),ti.rel="noopener nofollow",this._setElementTitle(ti,"MapFeedback")}},yr.prototype._updateData=function(tt){tt&&("metadata"===tt.sourceDataType||"visibility"===tt.sourceDataType||"style"===tt.dataType)&&(this._updateAttributions(),this._updateEditLink())},yr.prototype._updateAttributions=function(){if(this._map.style){var tt=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?tt=tt.concat(this.options.customAttribution.map(function(tt){return"string"!=typeof tt?"":tt})):"string"==typeof this.options.customAttribution&&tt.push(this.options.customAttribution)),this._map.style.stylesheet){var ti=this._map.style.stylesheet;this.styleOwner=ti.owner,this.styleId=ti.id}var ta=this._map.style.sourceCaches;for(var tc in ta){var th=ta[tc];if(th.used){var tf=th.getSource();tf.attribution&&0>tt.indexOf(tf.attribution)&&tt.push(tf.attribution)}}tt.sort(function(tt,ti){return tt.length-ti.length});var td=(tt=tt.filter(function(ti,ta){for(var tc=ta+1;tc<tt.length;tc++)if(tt[tc].indexOf(ti)>=0)return!1;return!0})).join(" | ");td!==this._attribHTML&&(this._attribHTML=td,tt.length?(this._innerContainer.innerHTML=td,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},yr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xr=function(){tt.bindAll(["_updateLogo"],this),tt.bindAll(["_updateCompact"],this)};xr.prototype.onAdd=function(tt){this._map=tt,this._container=ta.create("div","mapboxgl-ctrl");var ti=ta.create("a","mapboxgl-ctrl-logo");return ti.target="_blank",ti.rel="noopener nofollow",ti.href="https://www.mapbox.com/",ti.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),ti.setAttribute("rel","noopener nofollow"),this._container.appendChild(ti),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xr.prototype.onRemove=function(){ta.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xr.prototype.getDefaultPosition=function(){return"bottom-left"},xr.prototype._updateLogo=function(tt){tt&&"metadata"!==tt.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xr.prototype._logoRequired=function(){if(this._map.style){var tt=this._map.style.sourceCaches;for(var ti in tt)if(tt[ti].getSource().mapbox_logo)return!0;return!1}},xr.prototype._updateCompact=function(){var tt=this._container.children;if(tt.length){var ti=tt[0];this._map.getCanvasContainer().offsetWidth<250?ti.classList.add("mapboxgl-compact"):ti.classList.remove("mapboxgl-compact")}};var br=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};br.prototype.add=function(tt){var ti=++this._id;return this._queue.push({callback:tt,id:ti,cancelled:!1}),ti},br.prototype.remove=function(tt){for(var ti=this._currentlyRunning,ta=0,tc=ti?this._queue.concat(ti):this._queue;ta<tc.length;ta+=1){var th=tc[ta];if(th.id===tt)return void(th.cancelled=!0)}},br.prototype.run=function(tt){void 0===tt&&(tt=0);var ti=this._currentlyRunning=this._queue;this._queue=[];for(var ta=0;ta<ti.length;ta+=1){var tc=ti[ta];if(!tc.cancelled&&(tc.callback(tt),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},br.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var eQ={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},e0=tt.window.HTMLImageElement,e1=tt.window.HTMLElement,e2=tt.window.ImageBitmap,e5={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},e4=function(tc){function r(ti){var ta=this;if(null!=(ti=tt.extend({},e5,ti)).minZoom&&null!=ti.maxZoom&&ti.minZoom>ti.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=ti.minPitch&&null!=ti.maxPitch&&ti.minPitch>ti.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=ti.minPitch&&ti.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=ti.maxPitch&&ti.maxPitch>60)throw Error("maxPitch must be less than or equal to 60");var th=new To(ti.minZoom,ti.maxZoom,ti.minPitch,ti.maxPitch,ti.renderWorldCopies);if(tc.call(this,th,ti),this._interactive=ti.interactive,this._maxTileCacheSize=ti.maxTileCacheSize,this._failIfMajorPerformanceCaveat=ti.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=ti.preserveDrawingBuffer,this._antialias=ti.antialias,this._trackResize=ti.trackResize,this._bearingSnap=ti.bearingSnap,this._refreshExpiredTiles=ti.refreshExpiredTiles,this._fadeDuration=ti.fadeDuration,this._crossSourceCollisions=ti.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=ti.collectResourceTiming,this._renderTaskQueue=new br,this._controls=[],this._mapId=tt.uniqueId(),this._locale=tt.extend({},eQ,ti.locale),this._clickTolerance=ti.clickTolerance,this._requestManager=new tt.RequestManager(ti.transformRequest,ti.accessToken),"string"==typeof ti.container){if(this._container=tt.window.document.getElementById(ti.container),!this._container)throw Error("Container '"+ti.container+"' not found.")}else{if(!(ti.container instanceof e1))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=ti.container}if(ti.maxBounds&&this.setMaxBounds(ti.maxBounds),tt.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");this.on("move",function(){return ta._update(!1)}),this.on("moveend",function(){return ta._update(!1)}),this.on("zoom",function(){return ta._update(!0)}),void 0!==tt.window&&(tt.window.addEventListener("online",this._onWindowOnline,!1),tt.window.addEventListener("resize",this._onWindowResize,!1),tt.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gr(this,ti),this._hash=ti.hash&&new Io("string"==typeof ti.hash&&ti.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:ti.center,zoom:ti.zoom,bearing:ti.bearing,pitch:ti.pitch}),ti.bounds&&(this.resize(),this.fitBounds(ti.bounds,tt.extend({},ti.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=ti.localIdeographFontFamily,ti.style&&this.setStyle(ti.style,{localIdeographFontFamily:ti.localIdeographFontFamily}),ti.attributionControl&&this.addControl(new yr({customAttribution:ti.customAttribution})),this.addControl(new xr,ti.logoPosition),this.on("style.load",function(){ta.transform.unmodified&&ta.jumpTo(ta.style.stylesheet)}),this.on("data",function(ti){ta._update("style"===ti.dataType),ta.fire(new tt.Event(ti.dataType+"data",ti))}),this.on("dataloading",function(ti){ta.fire(new tt.Event(ti.dataType+"dataloading",ti))})}tc&&(r.__proto__=tc),(r.prototype=Object.create(tc&&tc.prototype)).constructor=r;var th={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(ti,ta){if(void 0===ta&&(ta=ti.getDefaultPosition?ti.getDefaultPosition():"top-right"),!ti||!ti.onAdd)return this.fire(new tt.ErrorEvent(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var tc=ti.onAdd(this);this._controls.push(ti);var th=this._controlPositions[ta];return -1!==ta.indexOf("bottom")?th.insertBefore(tc,th.firstChild):th.appendChild(tc),this},r.prototype.removeControl=function(ti){if(!ti||!ti.onRemove)return this.fire(new tt.ErrorEvent(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var ta=this._controls.indexOf(ti);return ta>-1&&this._controls.splice(ta,1),ti.onRemove(this),this},r.prototype.hasControl=function(tt){return this._controls.indexOf(tt)>-1},r.prototype.resize=function(ti){var ta=this._containerDimensions(),tc=ta[0],th=ta[1];this._resizeCanvas(tc,th),this.transform.resize(tc,th),this.painter.resize(tc,th);var tf=!this._moving;return tf&&(this.stop(),this.fire(new tt.Event("movestart",ti)).fire(new tt.Event("move",ti))),this.fire(new tt.Event("resize",ti)),tf&&this.fire(new tt.Event("moveend",ti)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(ti){return this.transform.setMaxBounds(tt.LngLatBounds.convert(ti)),this._update()},r.prototype.setMinZoom=function(tt){if((tt=null==tt?-2:tt)>=-2&&tt<=this.transform.maxZoom)return this.transform.minZoom=tt,this._update(),this.getZoom()<tt&&this.setZoom(tt),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(tt){if((tt=null==tt?22:tt)>=this.transform.minZoom)return this.transform.maxZoom=tt,this._update(),this.getZoom()>tt&&this.setZoom(tt),this;throw Error("maxZoom must be greater than the current minZoom")},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.setMinPitch=function(tt){if((tt=null==tt?0:tt)<0)throw Error("minPitch must be greater than or equal to 0");if(tt>=0&&tt<=this.transform.maxPitch)return this.transform.minPitch=tt,this._update(),this.getPitch()<tt&&this.setPitch(tt),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")},r.prototype.getMinPitch=function(){return this.transform.minPitch},r.prototype.setMaxPitch=function(tt){if((tt=null==tt?60:tt)>60)throw Error("maxPitch must be less than or equal to 60");if(tt>=this.transform.minPitch)return this.transform.maxPitch=tt,this._update(),this.getPitch()>tt&&this.setPitch(tt),this;throw Error("maxPitch must be greater than the current minPitch")},r.prototype.getMaxPitch=function(){return this.transform.maxPitch},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(tt){return this.transform.renderWorldCopies=tt,this._update()},r.prototype.project=function(ti){return this.transform.locationPoint(tt.LngLat.convert(ti))},r.prototype.unproject=function(ti){return this.transform.pointLocation(tt.Point.convert(ti))},r.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},r.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},r.prototype._createDelegatedListener=function(tt,ti,ta){var tc,th=this;if("mouseenter"===tt||"mouseover"===tt){var tf=!1;return{layer:ti,listener:ta,delegates:{mousemove:function(tc){var td=th.getLayer(ti)?th.queryRenderedFeatures(tc.point,{layers:[ti]}):[];td.length?tf||(tf=!0,ta.call(th,new eN(tt,th,tc.originalEvent,{features:td}))):tf=!1},mouseout:function(){tf=!1}}}}if("mouseleave"===tt||"mouseout"===tt){var td=!1;return{layer:ti,listener:ta,delegates:{mousemove:function(tc){(th.getLayer(ti)?th.queryRenderedFeatures(tc.point,{layers:[ti]}):[]).length?td=!0:td&&(td=!1,ta.call(th,new eN(tt,th,tc.originalEvent)))},mouseout:function(ti){td&&(td=!1,ta.call(th,new eN(tt,th,ti.originalEvent)))}}}}return{layer:ti,listener:ta,delegates:((tc={})[tt]=function(tt){var tc=th.getLayer(ti)?th.queryRenderedFeatures(tt.point,{layers:[ti]}):[];tc.length&&(tt.features=tc,ta.call(th,tt),delete tt.features)},tc)}},r.prototype.on=function(tt,ti,ta){if(void 0===ta)return tc.prototype.on.call(this,tt,ti);var th=this._createDelegatedListener(tt,ti,ta);for(var tf in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[tt]=this._delegatedListeners[tt]||[],this._delegatedListeners[tt].push(th),th.delegates)this.on(tf,th.delegates[tf]);return this},r.prototype.once=function(tt,ti,ta){if(void 0===ta)return tc.prototype.once.call(this,tt,ti);var th=this._createDelegatedListener(tt,ti,ta);for(var tf in th.delegates)this.once(tf,th.delegates[tf]);return this},r.prototype.off=function(tt,ti,ta){var th=this;return void 0===ta?tc.prototype.off.call(this,tt,ti):(this._delegatedListeners&&this._delegatedListeners[tt]&&function(tc){for(var tf=tc[tt],td=0;td<tf.length;td++){var tm=tf[td];if(tm.layer===ti&&tm.listener===ta){for(var ty in tm.delegates)th.off(ty,tm.delegates[ty]);return tf.splice(td,1),th}}}(this._delegatedListeners),this)},r.prototype.queryRenderedFeatures=function(ti,ta){if(!this.style)return[];if(void 0!==ta||void 0===ti||ti instanceof tt.Point||Array.isArray(ti)||(ta=ti,ti=void 0),ta=ta||{},(ti=ti||[[0,0],[this.transform.width,this.transform.height]])instanceof tt.Point||"number"==typeof ti[0])tc=[tt.Point.convert(ti)];else{var tc,th=tt.Point.convert(ti[0]),tf=tt.Point.convert(ti[1]);tc=[th,new tt.Point(tf.x,th.y),tf,new tt.Point(th.x,tf.y),th]}return this.style.queryRenderedFeatures(tc,ta,this.transform)},r.prototype.querySourceFeatures=function(tt,ti){return this.style.querySourceFeatures(tt,ti)},r.prototype.setStyle=function(ti,ta){return!1!==(ta=tt.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},ta)).diff&&ta.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&ti?(this._diffStyle(ti,ta),this):(this._localIdeographFontFamily=ta.localIdeographFontFamily,this._updateStyle(ti,ta))},r.prototype._getUIString=function(tt){var ti=this._locale[tt];if(null==ti)throw Error("Missing UI string '"+tt+"'");return ti},r.prototype._updateStyle=function(tt,ti){return this.style&&(this.style.setEventedParent(null),this.style._remove()),tt?(this.style=new ew(this,ti||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof tt?this.style.loadURL(tt):this.style.loadJSON(tt)):delete this.style,this},r.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ew(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},r.prototype._diffStyle=function(ti,ta){var tc=this;if("string"==typeof ti){var th=this._requestManager.normalizeStyleURL(ti),tf=this._requestManager.transformRequest(th,tt.ResourceType.Style);tt.getJSON(tf,function(ti,th){ti?tc.fire(new tt.ErrorEvent(ti)):th&&tc._updateDiff(th,ta)})}else"object"==typeof ti&&this._updateDiff(ti,ta)},r.prototype._updateDiff=function(ti,ta){try{this.style.setState(ti)&&this._update(!0)}catch(tc){tt.warnOnce("Unable to perform style diff: "+(tc.message||tc.error||tc)+".  Rebuilding the style from scratch."),this._updateStyle(ti,ta)}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():tt.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(tt,ti){return this._lazyInitEmptyStyle(),this.style.addSource(tt,ti),this._update(!0)},r.prototype.isSourceLoaded=function(ti){var ta=this.style&&this.style.sourceCaches[ti];if(void 0!==ta)return ta.loaded();this.fire(new tt.ErrorEvent(Error("There is no source with ID '"+ti+"'")))},r.prototype.areTilesLoaded=function(){var tt=this.style&&this.style.sourceCaches;for(var ti in tt){var ta=tt[ti]._tiles;for(var tc in ta){var th=ta[tc];if("loaded"!==th.state&&"errored"!==th.state)return!1}}return!0},r.prototype.addSourceType=function(tt,ti,ta){return this._lazyInitEmptyStyle(),this.style.addSourceType(tt,ti,ta)},r.prototype.removeSource=function(tt){return this.style.removeSource(tt),this._update(!0)},r.prototype.getSource=function(tt){return this.style.getSource(tt)},r.prototype.addImage=function(ti,ta,tc){void 0===tc&&(tc={});var th=tc.pixelRatio;void 0===th&&(th=1);var tf=tc.sdf;void 0===tf&&(tf=!1);var td=tc.stretchX,tm=tc.stretchY,ty=tc.content;if(this._lazyInitEmptyStyle(),ta instanceof e0||e2&&ta instanceof e2){var tg=tt.browser.getImageData(ta);this.style.addImage(ti,{data:new tt.RGBAImage({width:tg.width,height:tg.height},tg.data),pixelRatio:th,stretchX:td,stretchY:tm,content:ty,sdf:tf,version:0})}else{if(void 0===ta.width||void 0===ta.height)return this.fire(new tt.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));this.style.addImage(ti,{data:new tt.RGBAImage({width:ta.width,height:ta.height},new Uint8Array(ta.data)),pixelRatio:th,stretchX:td,stretchY:tm,content:ty,sdf:tf,version:0,userImage:ta}),ta.onAdd&&ta.onAdd(this,ti)}},r.prototype.updateImage=function(ti,ta){var tc=this.style.getImage(ti);if(!tc)return this.fire(new tt.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var th=ta instanceof e0||e2&&ta instanceof e2?tt.browser.getImageData(ta):ta,tf=th.width,td=th.height,tm=th.data;return void 0===tf||void 0===td?this.fire(new tt.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):tf!==tc.data.width||td!==tc.data.height?this.fire(new tt.ErrorEvent(Error("The width and height of the updated image must be that same as the previous version of the image"))):(tc.data.replace(tm,!(ta instanceof e0||e2&&ta instanceof e2)),void this.style.updateImage(ti,tc))},r.prototype.hasImage=function(ti){return ti?!!this.style.getImage(ti):(this.fire(new tt.ErrorEvent(Error("Missing required image id"))),!1)},r.prototype.removeImage=function(tt){this.style.removeImage(tt)},r.prototype.loadImage=function(ti,ta){tt.getImage(this._requestManager.transformRequest(ti,tt.ResourceType.Image),ta)},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(tt,ti){return this._lazyInitEmptyStyle(),this.style.addLayer(tt,ti),this._update(!0)},r.prototype.moveLayer=function(tt,ti){return this.style.moveLayer(tt,ti),this._update(!0)},r.prototype.removeLayer=function(tt){return this.style.removeLayer(tt),this._update(!0)},r.prototype.getLayer=function(tt){return this.style.getLayer(tt)},r.prototype.setLayerZoomRange=function(tt,ti,ta){return this.style.setLayerZoomRange(tt,ti,ta),this._update(!0)},r.prototype.setFilter=function(tt,ti,ta){return void 0===ta&&(ta={}),this.style.setFilter(tt,ti,ta),this._update(!0)},r.prototype.getFilter=function(tt){return this.style.getFilter(tt)},r.prototype.setPaintProperty=function(tt,ti,ta,tc){return void 0===tc&&(tc={}),this.style.setPaintProperty(tt,ti,ta,tc),this._update(!0)},r.prototype.getPaintProperty=function(tt,ti){return this.style.getPaintProperty(tt,ti)},r.prototype.setLayoutProperty=function(tt,ti,ta,tc){return void 0===tc&&(tc={}),this.style.setLayoutProperty(tt,ti,ta,tc),this._update(!0)},r.prototype.getLayoutProperty=function(tt,ti){return this.style.getLayoutProperty(tt,ti)},r.prototype.setLight=function(tt,ti){return void 0===ti&&(ti={}),this._lazyInitEmptyStyle(),this.style.setLight(tt,ti),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(tt,ti){return this.style.setFeatureState(tt,ti),this._update()},r.prototype.removeFeatureState=function(tt,ti){return this.style.removeFeatureState(tt,ti),this._update()},r.prototype.getFeatureState=function(tt){return this.style.getFeatureState(tt)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var tt=0,ti=0;return this._container&&(tt=this._container.clientWidth||400,ti=this._container.clientHeight||300),[tt,ti]},r.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==tt.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&tt.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},r.prototype._setupContainer=function(){var tt=this._container;tt.classList.add("mapboxgl-map"),(this._missingCSSCanary=ta.create("div","mapboxgl-canary",tt)).style.visibility="hidden",this._detectMissingCSS();var ti=this._canvasContainer=ta.create("div","mapboxgl-canvas-container",tt);this._interactive&&ti.classList.add("mapboxgl-interactive"),this._canvas=ta.create("canvas","mapboxgl-canvas",ti),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var tc=this._containerDimensions();this._resizeCanvas(tc[0],tc[1]);var th=this._controlContainer=ta.create("div","mapboxgl-control-container",tt),tf=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(tt){tf[tt]=ta.create("div","mapboxgl-ctrl-"+tt,th)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},r.prototype._resizeCanvas=function(ti,ta){var tc=tt.browser.devicePixelRatio||1;this._canvas.width=tc*ti,this._canvas.height=tc*ta,this._canvas.style.width=ti+"px",this._canvas.style.height=ta+"px"},r.prototype._setupPainter=function(){var ta=tt.extend({},ti.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),tc=this._canvas.getContext("webgl",ta)||this._canvas.getContext("experimental-webgl",ta);tc?(this.painter=new yo(tc,this.transform),tt.webpSupported.testSupport(tc)):this.fire(new tt.ErrorEvent(Error("Failed to initialize WebGL")))},r.prototype._contextLost=function(ti){ti.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new tt.Event("webglcontextlost",{originalEvent:ti}))},r.prototype._contextRestored=function(ti){this._setupPainter(),this.resize(),this._update(),this.fire(new tt.Event("webglcontextrestored",{originalEvent:ti}))},r.prototype._onMapScroll=function(tt){if(tt.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},r.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(tt){return this.style&&(this._styleDirty=this._styleDirty||tt,this._sourcesDirty=!0,this.triggerRepaint()),this},r.prototype._requestRenderFrame=function(tt){return this._update(),this._renderTaskQueue.add(tt)},r.prototype._cancelRenderFrame=function(tt){this._renderTaskQueue.remove(tt)},r.prototype._render=function(ti){var ta,tc=this,th=0,tf=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(ta=tf.createQueryEXT(),tf.beginQueryEXT(tf.TIME_ELAPSED_EXT,ta),th=tt.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(ti),!this._removed){var td=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var tm=this.transform.zoom,ty=tt.browser.now();this.style.zoomHistory.update(tm,ty);var tg=new tt.EvaluationParameters(tm,{now:ty,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),t_=tg.crossFadingFactor();1===t_&&t_===this._crossFadingFactor||(td=!0,this._crossFadingFactor=t_),this.style.update(tg)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new tt.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new tt.Event("load"))),this.style&&(this.style.hasTransitions()||td)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var tv=tt.browser.now()-th;tf.endQueryEXT(tf.TIME_ELAPSED_EXT,ta),setTimeout(function(){var ti=tf.getQueryObjectEXT(ta,tf.QUERY_RESULT_EXT)/1e6;tf.deleteQueryEXT(ta),tc.fire(new tt.Event("gpu-timing-frame",{cpuTime:tv,gpuTime:ti}))},50)}if(this.listens("gpu-timing-layer")){var tx=this.painter.collectGpuTimers();setTimeout(function(){var ti=tc.painter.queryGpuTimers(tx);tc.fire(new tt.Event("gpu-timing-layer",{layerTimes:ti}))},50)}var tb=this._sourcesDirty||this._styleDirty||this._placementDirty;return tb||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new tt.Event("idle")),!this._loaded||this._fullyLoaded||tb||(this._fullyLoaded=!0),this}},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var ti=0,ta=this._controls;ti<ta.length;ti+=1)ta[ti].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==tt.window&&(tt.window.removeEventListener("resize",this._onWindowResize,!1),tt.window.removeEventListener("orientationchange",this._onWindowResize,!1),tt.window.removeEventListener("online",this._onWindowOnline,!1));var tc=this.painter.context.gl.getExtension("WEBGL_lose_context");tc&&tc.loseContext(),Cr(this._canvasContainer),Cr(this._controlContainer),Cr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new tt.Event("remove"))},r.prototype.triggerRepaint=function(){var ti=this;this.style&&!this._frame&&(this._frame=tt.browser.frame(function(tt){ti._frame=null,ti._render(tt)}))},r.prototype._onWindowOnline=function(){this._update()},r.prototype._onWindowResize=function(tt){this._trackResize&&this.resize({originalEvent:tt})._update()},th.showTileBoundaries.get=function(){return!!this._showTileBoundaries},th.showTileBoundaries.set=function(tt){this._showTileBoundaries!==tt&&(this._showTileBoundaries=tt,this._update())},th.showPadding.get=function(){return!!this._showPadding},th.showPadding.set=function(tt){this._showPadding!==tt&&(this._showPadding=tt,this._update())},th.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},th.showCollisionBoxes.set=function(tt){this._showCollisionBoxes!==tt&&(this._showCollisionBoxes=tt,tt?this.style._generateCollisionBoxes():this._update())},th.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},th.showOverdrawInspector.set=function(tt){this._showOverdrawInspector!==tt&&(this._showOverdrawInspector=tt,this._update())},th.repaint.get=function(){return!!this._repaint},th.repaint.set=function(tt){this._repaint!==tt&&(this._repaint=tt,this.triggerRepaint())},th.vertices.get=function(){return!!this._vertices},th.vertices.set=function(tt){this._vertices=tt,this._update()},r.prototype._setCacheLimits=function(ti,ta){tt.setCacheLimits(ti,ta)},th.version.get=function(){return tt.version},Object.defineProperties(r.prototype,th),r}(e$);function Cr(tt){tt.parentNode&&tt.parentNode.removeChild(tt)}var e3={showCompass:!0,showZoom:!0,visualizePitch:!1},Dr=function(ti){var tc=this;this.options=tt.extend({},e3,ti),this._container=ta.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(tt){return tt.preventDefault()}),this.options.showZoom&&(tt.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(tt){return tc._map.zoomIn({},{originalEvent:tt})}),ta.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(tt){return tc._map.zoomOut({},{originalEvent:tt})}),ta.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(tt.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(tt){tc.options.visualizePitch?tc._map.resetNorthPitch({},{originalEvent:tt}):tc._map.resetNorth({},{originalEvent:tt})}),this._compassIcon=ta.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Dr.prototype._updateZoomButtons=function(){var tt=this._map.getZoom(),ti=tt===this._map.getMaxZoom(),ta=tt===this._map.getMinZoom();this._zoomInButton.disabled=ti,this._zoomOutButton.disabled=ta,this._zoomInButton.setAttribute("aria-disabled",ti.toString()),this._zoomOutButton.setAttribute("aria-disabled",ta.toString())},Dr.prototype._rotateCompassArrow=function(){var tt=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=tt},Dr.prototype.onAdd=function(tt){return this._map=tt,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ar(this._map,this._compass,this.options.visualizePitch)),this._container},Dr.prototype.onRemove=function(){ta.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Dr.prototype._createButton=function(tt,ti){var tc=ta.create("button",tt,this._container);return tc.type="button",tc.addEventListener("click",ti),tc},Dr.prototype._setButtonTitle=function(tt,ti){var ta=this._map._getUIString("NavigationControl."+ti);tt.title=ta,tt.setAttribute("aria-label",ta)};var Ar=function(ti,tc,th){void 0===th&&(th=!1),this._clickTolerance=10,this.element=tc,this.mouseRotate=new eX({clickTolerance:ti.dragRotate._mouseRotate._clickTolerance}),this.map=ti,th&&(this.mousePitch=new eW({clickTolerance:ti.dragRotate._mousePitch._clickTolerance})),tt.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ta.addEventListener(tc,"mousedown",this.mousedown),ta.addEventListener(tc,"touchstart",this.touchstart,{passive:!1}),ta.addEventListener(tc,"touchmove",this.touchmove),ta.addEventListener(tc,"touchend",this.touchend),ta.addEventListener(tc,"touchcancel",this.reset)};function Mr(ti,ta,tc){if(ti=new tt.LngLat(ti.lng,ti.lat),ta){var th=new tt.LngLat(ti.lng-360,ti.lat),tf=new tt.LngLat(ti.lng+360,ti.lat),td=tc.locationPoint(ti).distSqr(ta);tc.locationPoint(th).distSqr(ta)<td?ti=th:tc.locationPoint(tf).distSqr(ta)<td&&(ti=tf)}for(;Math.abs(ti.lng-tc.center.lng)>180;){var tm=tc.locationPoint(ti);if(tm.x>=0&&tm.y>=0&&tm.x<=tc.width&&tm.y<=tc.height)break;ti.lng>tc.center.lng?ti.lng-=360:ti.lng+=360}return ti}Ar.prototype.down=function(tt,ti){this.mouseRotate.mousedown(tt,ti),this.mousePitch&&this.mousePitch.mousedown(tt,ti),ta.disableDrag()},Ar.prototype.move=function(tt,ti){var ta=this.map,tc=this.mouseRotate.mousemoveWindow(tt,ti);if(tc&&tc.bearingDelta&&ta.setBearing(ta.getBearing()+tc.bearingDelta),this.mousePitch){var th=this.mousePitch.mousemoveWindow(tt,ti);th&&th.pitchDelta&&ta.setPitch(ta.getPitch()+th.pitchDelta)}},Ar.prototype.off=function(){var tt=this.element;ta.removeEventListener(tt,"mousedown",this.mousedown),ta.removeEventListener(tt,"touchstart",this.touchstart,{passive:!1}),ta.removeEventListener(tt,"touchmove",this.touchmove),ta.removeEventListener(tt,"touchend",this.touchend),ta.removeEventListener(tt,"touchcancel",this.reset),this.offTemp()},Ar.prototype.offTemp=function(){ta.enableDrag(),ta.removeEventListener(tt.window,"mousemove",this.mousemove),ta.removeEventListener(tt.window,"mouseup",this.mouseup)},Ar.prototype.mousedown=function(ti){this.down(tt.extend({},ti,{ctrlKey:!0,preventDefault:function(){return ti.preventDefault()}}),ta.mousePos(this.element,ti)),ta.addEventListener(tt.window,"mousemove",this.mousemove),ta.addEventListener(tt.window,"mouseup",this.mouseup)},Ar.prototype.mousemove=function(tt){this.move(tt,ta.mousePos(this.element,tt))},Ar.prototype.mouseup=function(tt){this.mouseRotate.mouseupWindow(tt),this.mousePitch&&this.mousePitch.mouseupWindow(tt),this.offTemp()},Ar.prototype.touchstart=function(tt){1!==tt.targetTouches.length?this.reset():(this._startPos=this._lastPos=ta.touchPos(this.element,tt.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return tt.preventDefault()}},this._startPos))},Ar.prototype.touchmove=function(tt){1!==tt.targetTouches.length?this.reset():(this._lastPos=ta.touchPos(this.element,tt.targetTouches)[0],this.move({preventDefault:function(){return tt.preventDefault()}},this._lastPos))},Ar.prototype.touchend=function(tt){0===tt.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ar.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var e6={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Rr(tt,ti,ta){var tc=tt.classList;for(var th in e6)tc.remove("mapboxgl-"+ta+"-anchor-"+th);tc.add("mapboxgl-"+ta+"-anchor-"+ti)}var e8,e9=function(ti){function o(tc,th){if(ti.call(this),(tc instanceof tt.window.HTMLElement||th)&&(tc=tt.extend({element:tc},th)),tt.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=tc&&tc.anchor||"center",this._color=tc&&tc.color||"#3FB1CE",this._scale=tc&&tc.scale||1,this._draggable=tc&&tc.draggable||!1,this._clickTolerance=tc&&tc.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=tc&&tc.rotation||0,this._rotationAlignment=tc&&tc.rotationAlignment||"auto",this._pitchAlignment=tc&&tc.pitchAlignment&&"auto"!==tc.pitchAlignment?tc.pitchAlignment:this._rotationAlignment,tc&&tc.element)this._element=tc.element,this._offset=tt.Point.convert(tc&&tc.offset||[0,0]);else{this._defaultMarker=!0,this._element=ta.create("div"),this._element.setAttribute("aria-label","Map marker");var tf=ta.createNS("http://www.w3.org/2000/svg","svg");tf.setAttributeNS(null,"display","block"),tf.setAttributeNS(null,"height","41px"),tf.setAttributeNS(null,"width","27px"),tf.setAttributeNS(null,"viewBox","0 0 27 41");var td=ta.createNS("http://www.w3.org/2000/svg","g");td.setAttributeNS(null,"stroke","none"),td.setAttributeNS(null,"stroke-width","1"),td.setAttributeNS(null,"fill","none"),td.setAttributeNS(null,"fill-rule","evenodd");var tm=ta.createNS("http://www.w3.org/2000/svg","g");tm.setAttributeNS(null,"fill-rule","nonzero");var ty=ta.createNS("http://www.w3.org/2000/svg","g");ty.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ty.setAttributeNS(null,"fill","#000000");for(var tg=0,t_=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];tg<t_.length;tg+=1){var tv=t_[tg],tx=ta.createNS("http://www.w3.org/2000/svg","ellipse");tx.setAttributeNS(null,"opacity","0.04"),tx.setAttributeNS(null,"cx","10.5"),tx.setAttributeNS(null,"cy","5.80029008"),tx.setAttributeNS(null,"rx",tv.rx),tx.setAttributeNS(null,"ry",tv.ry),ty.appendChild(tx)}var tb=ta.createNS("http://www.w3.org/2000/svg","g");tb.setAttributeNS(null,"fill",this._color);var tw=ta.createNS("http://www.w3.org/2000/svg","path");tw.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),tb.appendChild(tw);var tS=ta.createNS("http://www.w3.org/2000/svg","g");tS.setAttributeNS(null,"opacity","0.25"),tS.setAttributeNS(null,"fill","#000000");var tT=ta.createNS("http://www.w3.org/2000/svg","path");tT.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),tS.appendChild(tT);var tI=ta.createNS("http://www.w3.org/2000/svg","g");tI.setAttributeNS(null,"transform","translate(6.0, 7.0)"),tI.setAttributeNS(null,"fill","#FFFFFF");var tE=ta.createNS("http://www.w3.org/2000/svg","g");tE.setAttributeNS(null,"transform","translate(8.0, 8.0)");var tA=ta.createNS("http://www.w3.org/2000/svg","circle");tA.setAttributeNS(null,"fill","#000000"),tA.setAttributeNS(null,"opacity","0.25"),tA.setAttributeNS(null,"cx","5.5"),tA.setAttributeNS(null,"cy","5.5"),tA.setAttributeNS(null,"r","5.4999962");var tP=ta.createNS("http://www.w3.org/2000/svg","circle");tP.setAttributeNS(null,"fill","#FFFFFF"),tP.setAttributeNS(null,"cx","5.5"),tP.setAttributeNS(null,"cy","5.5"),tP.setAttributeNS(null,"r","5.4999962"),tE.appendChild(tA),tE.appendChild(tP),tm.appendChild(ty),tm.appendChild(tb),tm.appendChild(tS),tm.appendChild(tI),tm.appendChild(tE),tf.appendChild(tm),tf.setAttributeNS(null,"height",41*this._scale+"px"),tf.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(tf),this._offset=tt.Point.convert(tc&&tc.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(tt){tt.preventDefault()}),this._element.addEventListener("mousedown",function(tt){tt.preventDefault()}),Rr(this._element,this._anchor,"marker"),this._popup=null}return ti&&(o.__proto__=ti),(o.prototype=Object.create(ti&&ti.prototype)).constructor=o,o.prototype.addTo=function(tt){return this.remove(),this._map=tt,tt.getCanvasContainer().appendChild(this._element),tt.on("move",this._update),tt.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ta.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(ti){return this._lngLat=tt.LngLat.convert(ti),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(tt){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),tt){if(!("offset"in tt.options)){var ti=Math.sqrt(91.125);tt.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ti,-1*(24.6+ti)],"bottom-right":[-ti,-1*(24.6+ti)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=tt,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},o.prototype._onKeyPress=function(tt){var ti=tt.code,ta=tt.charCode||tt.keyCode;"Space"!==ti&&"Enter"!==ti&&32!==ta&&13!==ta||this.togglePopup()},o.prototype._onMapClick=function(tt){var ti=tt.originalEvent.target,ta=this._element;this._popup&&(ti===ta||ta.contains(ti))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var tt=this._popup;return tt&&(tt.isOpen()?tt.remove():tt.addTo(this._map)),this},o.prototype._update=function(tt){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Mr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var ti="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?ti="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(ti="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var tc="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?tc="rotateX(0deg)":"map"===this._pitchAlignment&&(tc="rotateX("+this._map.getPitch()+"deg)"),tt&&"moveend"!==tt.type||(this._pos=this._pos.round()),ta.setTransform(this._element,e6[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+tc+" "+ti)}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(ti){return this._offset=tt.Point.convert(ti),this._update(),this},o.prototype._onMove=function(ti){if(!this._isDragging){var ta=this._clickTolerance||this._map._clickTolerance;this._isDragging=ti.point.dist(this._pointerdownPos)>=ta}this._isDragging&&(this._pos=ti.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new tt.Event("dragstart"))),this.fire(new tt.Event("drag")))},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new tt.Event("dragend")),this._state="inactive"},o.prototype._addDragHandler=function(tt){this._element.contains(tt.originalEvent.target)&&(tt.preventDefault(),this._positionDelta=tt.point.sub(this._pos).add(this._offset),this._pointerdownPos=tt.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},o.prototype.setDraggable=function(tt){return this._draggable=!!tt,this._map&&(tt?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(tt){return this._rotation=tt||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(tt){return this._rotationAlignment=tt||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(tt){return this._pitchAlignment=tt&&"auto"!==tt?tt:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(tt.Evented),e7={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},it=0,ia=!1,il=function(ti){function o(ta){ti.call(this),this.options=tt.extend({},e7,ta),tt.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return ti&&(o.__proto__=ti),(o.prototype=Object.create(ti&&ti.prototype)).constructor=o,o.prototype.onAdd=function(ti){var tc;return this._map=ti,this._container=ta.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),tc=this._setupUI,void 0!==e8?tc(e8):void 0!==tt.window.navigator.permissions?tt.window.navigator.permissions.query({name:"geolocation"}).then(function(tt){tc(e8="denied"!==tt.state)}):tc(e8=!!tt.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(tt.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ta.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,it=0,ia=!1},o.prototype._isOutOfMapMaxBounds=function(tt){var ti=this._map.getMaxBounds(),ta=tt.coords;return ti&&(ta.longitude<ti.getWest()||ta.longitude>ti.getEast()||ta.latitude<ti.getSouth()||ta.latitude>ti.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},o.prototype._onSuccess=function(ti){if(this._map){if(this._isOutOfMapMaxBounds(ti))return this._setErrorState(),this.fire(new tt.Event("outofmaxbounds",ti)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=ti,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(ti),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(ti),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new tt.Event("geolocate",ti)),this._finish()}},o.prototype._updateCamera=function(ti){var ta=new tt.LngLat(ti.coords.longitude,ti.coords.latitude),tc=ti.coords.accuracy,th=this._map.getBearing(),tf=tt.extend({bearing:th},this.options.fitBoundsOptions);this._map.fitBounds(ta.toBounds(tc),tf,{geolocateSource:!0})},o.prototype._updateMarker=function(ti){if(ti){var ta=new tt.LngLat(ti.coords.longitude,ti.coords.latitude);this._accuracyCircleMarker.setLngLat(ta).addTo(this._map),this._userLocationDotMarker.setLngLat(ta).addTo(this._map),this._accuracy=ti.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},o.prototype._updateCircleRadius=function(){var tt=this._map._container.clientHeight/2,ti=this._map.unproject([0,tt]),ta=this._map.unproject([1,tt]),tc=ti.distanceTo(ta),th=Math.ceil(2*this._accuracy/tc);this._circleElement.style.width=th+"px",this._circleElement.style.height=th+"px"},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},o.prototype._onError=function(ti){if(this._map){if(this.options.trackUserLocation){if(1===ti.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var ta=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=ta,this._geolocateButton.setAttribute("aria-label",ta),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===ti.code&&ia)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new tt.Event("error",ti)),this._finish()}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(ti){var tc=this;if(this._container.addEventListener("contextmenu",function(tt){return tt.preventDefault()}),this._geolocateButton=ta.create("button","mapboxgl-ctrl-geolocate",this._container),ta.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===ti){tt.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var th=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=th,this._geolocateButton.setAttribute("aria-label",th)}else{var tf=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=tf,this._geolocateButton.setAttribute("aria-label",tf)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ta.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new e9(this._dotElement),this._circleElement=ta.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new e9({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(ti){ti.geolocateSource||"ACTIVE_LOCK"!==tc._watchState||ti.originalEvent&&"resize"===ti.originalEvent.type||(tc._watchState="BACKGROUND",tc._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),tc._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),tc.fire(new tt.Event("trackuserlocationend")))})},o.prototype.trigger=function(){if(!this._setup)return tt.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new tt.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":it--,ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new tt.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new tt.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var ti;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++it>1?(ti={maximumAge:6e5,timeout:0},ia=!0):(ti=this.options.positionOptions,ia=!1),this._geolocationWatchID=tt.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,ti)}}else tt.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},o.prototype._clearWatch=function(){tt.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(tt.Evented),ic={maxWidth:100,unit:"metric"},qr=function(ti){this.options=tt.extend({},ic,ti),tt.bindAll(["_onMove","setUnit"],this)};function jr(tt,ti,ta){var tc=ta&&ta.maxWidth||100,th=tt._container.clientHeight/2,tf=tt.unproject([0,th]),td=tt.unproject([tc,th]),tm=tf.distanceTo(td);if(ta&&"imperial"===ta.unit){var ty=3.2808*tm;ty>5280?Vr(ti,tc,ty/5280,tt._getUIString("ScaleControl.Miles")):Vr(ti,tc,ty,tt._getUIString("ScaleControl.Feet"))}else ta&&"nautical"===ta.unit?Vr(ti,tc,tm/1852,tt._getUIString("ScaleControl.NauticalMiles")):tm>=1e3?Vr(ti,tc,tm/1e3,tt._getUIString("ScaleControl.Kilometers")):Vr(ti,tc,tm,tt._getUIString("ScaleControl.Meters"))}function Vr(tt,ti,ta,tc){var th,tf,td,tm,ty=(td=Math.pow(10,(""+Math.floor(ta)).length-1))*(tm=(tm=ta/td)>=10?10:tm>=5?5:tm>=3?3:tm>=2?2:tm>=1?1:(tf=Math.pow(10,Math.ceil(-Math.log(th=tm)/Math.LN10)),Math.round(th*tf)/tf));tt.style.width=ti*(ty/ta)+"px",tt.innerHTML=ty+"&nbsp;"+tc}qr.prototype.getDefaultPosition=function(){return"bottom-left"},qr.prototype._onMove=function(){jr(this._map,this._container,this.options)},qr.prototype.onAdd=function(tt){return this._map=tt,this._container=ta.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",tt.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},qr.prototype.onRemove=function(){ta.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},qr.prototype.setUnit=function(tt){this.options.unit=tt,jr(this._map,this._container,this.options)};var Gr=function(ti){this._fullscreen=!1,ti&&ti.container&&(ti.container instanceof tt.window.HTMLElement?this._container=ti.container:tt.warnOnce("Full screen control 'container' must be a DOM element.")),tt.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in tt.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in tt.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in tt.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in tt.window.document&&(this._fullscreenchange="MSFullscreenChange")};Gr.prototype.onAdd=function(ti){return this._map=ti,this._container||(this._container=this._map.getContainer()),this._controlContainer=ta.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",tt.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Gr.prototype.onRemove=function(){ta.remove(this._controlContainer),this._map=null,tt.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Gr.prototype._checkFullscreenSupport=function(){return!!(tt.window.document.fullscreenEnabled||tt.window.document.mozFullScreenEnabled||tt.window.document.msFullscreenEnabled||tt.window.document.webkitFullscreenEnabled)},Gr.prototype._setupUI=function(){var ti=this._fullscreenButton=ta.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ta.create("span","mapboxgl-ctrl-icon",ti).setAttribute("aria-hidden",!0),ti.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),tt.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Gr.prototype._updateTitle=function(){var tt=this._getTitle();this._fullscreenButton.setAttribute("aria-label",tt),this._fullscreenButton.title=tt},Gr.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Gr.prototype._isFullscreen=function(){return this._fullscreen},Gr.prototype._changeIcon=function(){(tt.window.document.fullscreenElement||tt.window.document.mozFullScreenElement||tt.window.document.webkitFullscreenElement||tt.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Gr.prototype._onClickFullscreen=function(){this._isFullscreen()?tt.window.document.exitFullscreen?tt.window.document.exitFullscreen():tt.window.document.mozCancelFullScreen?tt.window.document.mozCancelFullScreen():tt.window.document.msExitFullscreen?tt.window.document.msExitFullscreen():tt.window.document.webkitCancelFullScreen&&tt.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ih={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},id=function(ti){function o(ta){ti.call(this),this.options=tt.extend(Object.create(ih),ta),tt.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return ti&&(o.__proto__=ti),(o.prototype=Object.create(ti&&ti.prototype)).constructor=o,o.prototype.addTo=function(ti){return this._map&&this.remove(),this._map=ti,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new tt.Event("open")),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&ta.remove(this._content),this._container&&(ta.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new tt.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(ti){return this._lngLat=tt.LngLat.convert(ti),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(ti){return this.setDOMContent(tt.window.document.createTextNode(ti))},o.prototype.setHTML=function(ti){var ta,tc=tt.window.document.createDocumentFragment(),th=tt.window.document.createElement("body");for(th.innerHTML=ti;ta=th.firstChild;)tc.appendChild(ta);return this.setDOMContent(tc)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(tt){return this.options.maxWidth=tt,this._update(),this},o.prototype.setDOMContent=function(tt){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ta.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(tt),this._createCloseButton(),this._update(),this._focusFirstElement(),this},o.prototype.addClassName=function(tt){this._container&&this._container.classList.add(tt)},o.prototype.removeClassName=function(tt){this._container&&this._container.classList.remove(tt)},o.prototype.setOffset=function(tt){return this.options.offset=tt,this._update(),this},o.prototype.toggleClassName=function(tt){if(this._container)return this._container.classList.toggle(tt)},o.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=ta.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},o.prototype._onMouseUp=function(tt){this._update(tt.point)},o.prototype._onMouseMove=function(tt){this._update(tt.point)},o.prototype._onDrag=function(tt){this._update(tt.point)},o.prototype._update=function(ti){var tc=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=ta.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ta.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(tt){return tc._container.classList.add(tt)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Mr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||ti)){var th=this._pos=this._trackPointer&&ti?ti:this._map.project(this._lngLat),tf=this.options.anchor,td=function e(ti){if(ti){if("number"==typeof ti){var ta=Math.round(Math.sqrt(.5*Math.pow(ti,2)));return{center:new tt.Point(0,0),top:new tt.Point(0,ti),"top-left":new tt.Point(ta,ta),"top-right":new tt.Point(-ta,ta),bottom:new tt.Point(0,-ti),"bottom-left":new tt.Point(ta,-ta),"bottom-right":new tt.Point(-ta,-ta),left:new tt.Point(ti,0),right:new tt.Point(-ti,0)}}if(ti instanceof tt.Point||Array.isArray(ti)){var tc=tt.Point.convert(ti);return{center:tc,top:tc,"top-left":tc,"top-right":tc,bottom:tc,"bottom-left":tc,"bottom-right":tc,left:tc,right:tc}}return{center:tt.Point.convert(ti.center||[0,0]),top:tt.Point.convert(ti.top||[0,0]),"top-left":tt.Point.convert(ti["top-left"]||[0,0]),"top-right":tt.Point.convert(ti["top-right"]||[0,0]),bottom:tt.Point.convert(ti.bottom||[0,0]),"bottom-left":tt.Point.convert(ti["bottom-left"]||[0,0]),"bottom-right":tt.Point.convert(ti["bottom-right"]||[0,0]),left:tt.Point.convert(ti.left||[0,0]),right:tt.Point.convert(ti.right||[0,0])}}return e(new tt.Point(0,0))}(this.options.offset);if(!tf){var tm,ty=this._container.offsetWidth,tg=this._container.offsetHeight;tm=th.y+td.bottom.y<tg?["top"]:th.y>this._map.transform.height-tg?["bottom"]:[],th.x<ty/2?tm.push("left"):th.x>this._map.transform.width-ty/2&&tm.push("right"),tf=0===tm.length?"bottom":tm.join("-")}var t_=th.add(td[tf]).round();ta.setTransform(this._container,e6[tf]+" translate("+t_.x+"px,"+t_.y+"px)"),Rr(this._container,tf,"popup")}},o.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var tt=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");tt&&tt.focus()}},o.prototype._onClose=function(){this.remove()},o}(tt.Evented),im={version:tt.version,supported:ti,setRTLTextPlugin:tt.setRTLTextPlugin,getRTLTextPluginStatus:tt.getRTLTextPluginStatus,Map:e4,NavigationControl:Dr,GeolocateControl:il,AttributionControl:yr,ScaleControl:qr,FullscreenControl:Gr,Popup:id,Marker:e9,Style:ew,LngLat:tt.LngLat,LngLatBounds:tt.LngLatBounds,Point:tt.Point,MercatorCoordinate:tt.MercatorCoordinate,Evented:tt.Evented,config:tt.config,prewarm:function(){Ft().acquire(eh)},clearPrewarmedResources:function(){var tt=ef;tt&&(tt.isPreloaded()&&1===tt.numActive()?(tt.release(eh),ef=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return tt.config.ACCESS_TOKEN},set accessToken(e){tt.config.ACCESS_TOKEN=e},get baseApiUrl(){return tt.config.API_URL},set baseApiUrl(e){tt.config.API_URL=e},get workerCount(){return kt.workerCount},set workerCount(t){kt.workerCount=t},get maxParallelImageRequests(){return tt.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){tt.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(ti){tt.clearTileCache(ti)},workerUrl:""};return im}),ta}()}}]);